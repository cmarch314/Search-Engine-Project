{"text": "Search LoginPreferencesHelp GuideAbout Trac WikiTimelineRoadmapBrowse SourceView TicketsSearch Context Navigation Previous ChangeNext Change Changeset 228 for vendor current libgaim protocols oscar peer c View differences inlineside by side Show lines around each change Show the changes in full context Ignore Blank lines Case changes White space changes Timestamp Mar 6 2 7 1 39 26 PM 8 years ago Author djp3Message Updating from gaim Repository File 1 edited vendor current libgaim protocols oscar peer c modified 23 diffs Legend UnmodifiedAddedRemoved vendor current libgaim protocols oscar peer c r65 r228 14 14 peer oft close conn 141141 142 if conn connect data NULL 143 144 gaim proxy connect cancel conn connect data 145 conn connect data NULL 142 if conn verified connect data NULL 143 144 gaim proxy connect cancel conn verified connect data 145 conn verified connect data NULL 146 147 148 if conn client connect data NULL 149 15 gaim proxy connect cancel conn client connect data 151 conn client connect data NULL 146152 147153 2 2 6 2 12 7 peer connection close conn 2 8 2 9 if conn checksum data NULL 21 peer oft checksum destroy conn checksum data 2 2211 2 3212 if conn xfer NULL 225234 g free conn clientip 226235 g free conn verifiedip 236 g free conn xferdata name 227237 gaim circ buffer destroy conn buffer outgoing 228238 283293 PeerConnection conn 284294 ssize t read 285 guint8 header 6 286295 287296 conn data 29 299 if conn buffer incoming data NULL 2913 292 Peek at the first 6 bytes to get the length 293 read recv conn fd header 6 MSG PEEK 3 1 Read the first 6 bytes magic string and frame length 3 2 read recv conn fd conn header conn header received 3 3 6 conn header received 2943 4 2953 5 Check if the remote user closed the connection 315325 316326 If we don t even have the first 6 bytes then do nothing 317 if read 6 327 conn header received read 328 if conn header received 6 318329 return 31933 32 Read the first 6 bytes magic string and frame length 321 read recv conn fd header 6 322 323331 All ODC OFT frames must start with a magic string 324 if memcmp conn magic header 4 332 if memcmp conn magic conn header 4 325333 326334 gaim debug warning oscar Expecting magic string to 328336 Closing connection n 329337 conn magic conn magic 1 conn magic 2 33 conn magic 3 header header 1 header 2 header 3 338 conn magic 3 conn header conn header 1 339 conn header 2 conn header 3 33134 peer connection destroy conn OSCAR DISCONNECT INVALID DATA NULL 332341 return 334343 335344 Initialize a new temporary ByteStream for incoming data 336 conn buffer incoming len aimutil get16 header 4 6 345 conn buffer incoming len aimutil get16 conn header 4 6 337346 conn buffer incoming data g new guint8 conn buffer incoming len 338347 conn buffer incoming offset 379388 peer oft recv frame conn conn buffer incoming 38 389 39 381391 g free conn buffer incoming data 382392 conn buffer incoming data NULL 393 394 conn header received 383395 384396 416428 417429 if conn ready 43 431 gaim input remove conn watcher outgoing 432 conn watcher outgoing 433 close conn fd 434 conn fd 1 418435 peer connection schedule destroy conn 419436 OSCAR DISCONNECT LOST CONNECTION NULL 437 42 438 else 421439 445463 446464 If we haven t already started writing stuff then start the cycle 447 if conn watcher outgoing 465 if conn watcher outgoing conn fd 1 448466 449467 conn watcher outgoing gaim input add conn fd 498516 499517static void 5 peer connection established cb gpointer data gint source const gchar error message 518peer connection common established cb gpointer data gint source const gchar error message gboolean verified 5 1519 5 252 PeerConnection conn 5 4522 conn data 5 5523 5 6 conn connect data NULL 524 if verified 525 conn verified connect data NULL 526 else 527 conn client connect data NULL 528 529 if source 53 531 if conn verified connect data NULL 532 conn client connect data NULL 533 534 Our parallel connection attemps have both failed 535 peer connection trynext conn 536 537 return 538 539 5 754 gaim timeout remove conn connect timeout timer 5 8541 conn connect timeout timer 5 9542 51 if source 511 512 peer connection trynext conn 513 return 543 if conn client connect data NULL 544 545 gaim proxy connect cancel conn client connect data 546 conn client connect data NULL 547 548 549 if conn verified connect data NULL 55 551 gaim proxy connect cancel conn verified connect data 552 conn verified connect data NULL 514553 515554 517556 518557 peer connection finalize connection conn 558 559 56 static void 561peer connection verified established cb gpointer data gint source const gchar error message 562 563 peer connection common established cb data source error message TRUE 564 565 566static void 567peer connection client established cb gpointer data gint source const gchar error message 568 569 peer connection common established cb data source error message FALSE 51957 52 571 64 691 This is a callback function used when we re connecting to a peer 641692 using either the client IP or the verified IP and the connection 642 took longer than 15 seconds to complete We do this because 693 took longer than 5 seconds to complete We do this because 643694 waiting for the OS to time out the connection attempt is not 644695 practical the default timeout on many OSes can be 3 minutes or 6547 5 with very high lag but decent throughput who are transferring 6557 6 large files But we don t care about those people 7 7 7 8 I Sean changed the timeout from 15 to 5 seconds as 6 seconds is 7 9 too long for a user to wait to send a file I m also parallelizing 71 requests when possible The longest we should have to wait now is 1 711 seconds We shouldn t make it shorter than this 656712 657713static gboolean 662718 conn data 663719 664 gaim debug info oscar Peer connection timed out after 15 seconds 72 gaim debug info oscar Peer connection timed out after 5 seconds 665721 Trying next method n 666 667 peer connection close conn 668722 669723 peer connection trynext conn 69 744 691745 692 1 Attempt to connect to the remote user using their verifiedip 746 1 Attempt to connect to the remote user using their verifiedip and clientip 747 We try these at the same time and use whichever succeeds first so we don t 748 have to wait for a timeout 693749 694 if conn flags PEER CONNECTION FLAG TRIED VERIFIEDIP 75 if conn flags PEER CONNECTION FLAG TRIED DIRECT 695751 conn verifiedip NULL conn port conn use proxy 696752 697 conn flags PEER CONNECTION FLAG TRIED VERIFIEDIP 753 conn flags PEER CONNECTION FLAG TRIED DIRECT 698754 699755 if conn type OSCAR CAPABILITY DIRECTIM 7 9765 71 766 711 conn connect data gaim proxy connect account 767 conn verified connect data gaim proxy connect NULL account 712768 conn verifiedip conn port 713 peer connection established cb conn 714 if conn connect data NULL 769 peer connection verified established cb conn 77 771 if conn verifiedip NULL 772 strcmp conn verifiedip conn clientip 773 774 conn client connect data gaim proxy connect NULL account 775 conn clientip conn port 776 peer connection client established cb conn 777 778 779 if conn verified connect data NULL 78 conn client connect data NULL 715781 716782 Connecting 717 conn connect timeout timer gaim timeout add 15 783 conn connect timeout timer gaim timeout add 5 718784 peer connection tooktoolong conn 719785 return 722788 723789 724 2 Attempt to connect to the remote user using their clientip 725 726 if conn flags PEER CONNECTION FLAG TRIED CLIENTIP 727 conn clientip NULL conn port conn use proxy 728 729 conn flags PEER CONNECTION FLAG TRIED CLIENTIP 73 731 if conn verifiedip NULL 732 strcmp conn verifiedip conn clientip 733 734 if conn type OSCAR CAPABILITY DIRECTIM 735 736 gchar tmp 737 GaimConversation conv 738 tmp g strdup printf Attempting to connect to s hu 739 conn clientip conn port 74 conv gaim conversation new GAIM CONV TYPE IM account conn sn 741 gaim conversation write conv NULL tmp 742 GAIM MESSAGE SYSTEM time NULL 743 g free tmp 744 745 746 conn connect data gaim proxy connect account 747 conn clientip conn port 748 peer connection established cb conn 749 if conn connect data NULL 75 751 Connecting 752 conn connect timeout timer gaim timeout add 15 753 peer connection tooktoolong conn 754 return 755 756 757 758 759 76 3 Attempt to have the remote user connect to us using both 79 2 Attempt to have the remote user connect to us using both 761791 our verifiedip and our clientip 762792 782812 783813 784 4 Attempt to have both users connect to an intermediate proxy 814 3 Attempt to have both users connect to an intermediate proxy 785815 server 786816 8 8838 8 9839 81 conn connect data gaim proxy connect account 84 conn verified connect data gaim proxy connect NULL account 811841 conn proxyip NULL conn proxyip PEER PROXY SERVER 812842 PEER PROXY PORT 813843 peer proxy connection established cb conn 814 if conn connect data NULL 844 if conn verified connect data NULL 815845 816846 Connecting 9961 26 9971 27 conn xfer gaim xfer new account GAIM XFER RECEIVE sn 998 conn xfer data conn 999 gaim xfer ref conn xfer 1 gaim xfer set size conn xfer args info sendfile totsize 1 1 1 2 Set the file name 1 3 if g utf8 validate args info sendfile filename 1 NULL 1 4 filename g strdup args info sendfile filename 1 5 else 1 6 filename gaim utf8 salvage args info sendfile filename 1 7 1 8 if args info sendfile subtype AIM OFT SUBTYPE SEND DIR 1 9 1 28 if conn xfer 1 29 1 3 conn xfer data conn 1 31 gaim xfer ref conn xfer 1 32 gaim xfer set size conn xfer args info sendfile totsize 1 33 1 34 Set the file name 1 35 if g utf8 validate args info sendfile filename 1 NULL 1 36 filename g strdup args info sendfile filename 1 37 else 1 38 filename gaim utf8 salvage args info sendfile filename 1 39 1 4 if args info sendfile subtype AIM OFT SUBTYPE SEND DIR 1 41 1 42 1 43 If they are sending us a directory then the last character 1 44 of the file name will be an asterisk We don t want to 1 45 save stuff to a directory named so we remove the 1 46 asterisk from the file name 1 47 1 48 char tmp strrchr filename 1 49 if tmp NULL tmp 1 1 5 tmp 1 51 1 52 gaim xfer set filename conn xfer filename 1 53 g free filename 1 54 1 1 1 55 1 11 If they are sending us a directory then the last character 1 12 of the file name will be an asterisk We don t want to 1 13 save stuff to a directory named so we remove the 1 14 asterisk from the file name 1 56 Set the message unless this is the dummy message from an 1 57 ICQ client or an empty message from an AIM client 1 58 TODO Maybe we should strip HTML and then see if strlen 1 151 59 1 16 char tmp strrchr filename 1 17 if tmp NULL tmp 1 1 18 tmp 1 19 1 2 gaim xfer set filename conn xfer filename 1 21 g free filename 1 22 1 23 1 24 Set the message unless this is the dummy message from an 1 25 ICQ client or an empty message from an AIM client 1 26 TODO Maybe we should strip HTML and then see if strlen 1 27 1 28 if message NULL 1 29 g ascii strncasecmp message ICQ COOL FT 13 1 3 g ascii strcasecmp message HTML 1 31 1 32 gaim xfer set message conn xfer message 1 33 1 34 1 35 Setup our I O op functions 1 36 gaim xfer set init fnc conn xfer peer oft recvcb init 1 37 gaim xfer set end fnc conn xfer peer oft recvcb end 1 38 gaim xfer set request denied fnc conn xfer peer oft cb generic cancel 1 39 gaim xfer set cancel recv fnc conn xfer peer oft cb generic cancel 1 4 gaim xfer set ack fnc conn xfer peer oft recvcb ack recv 1 41 1 42 Now perform the request 1 43 gaim xfer request conn xfer 1 6 if message NULL 1 61 g ascii strncasecmp message ICQ COOL FT 13 1 62 g ascii strcasecmp message HTML 1 63 1 64 gaim xfer set message conn xfer message 1 65 1 66 1 67 Setup our I O op functions 1 68 gaim xfer set init fnc conn xfer peer oft recvcb init 1 69 gaim xfer set end fnc conn xfer peer oft recvcb end 1 7 gaim xfer set request denied fnc conn xfer peer oft cb generic cancel 1 71 gaim xfer set cancel recv fnc conn xfer peer oft cb generic cancel 1 72 gaim xfer set ack fnc conn xfer peer oft recvcb ack recv 1 73 1 74 Now perform the request 1 75 gaim xfer request conn xfer 1 76 1 441 77 1 451 78 Note See TracChangeset for help on using the changeset viewer Download in other formats Unified Diff Zip Archive Powered by Trac 1 1 By Edgewall Software All content copyright 2 7 2 8 by LUCI http luci ics uci edu ", "_id": "http://djp3-pc2.ics.uci.edu/LUCICodeRepository/nomaticIM/changeset/228/vendor/current/libgaim/protocols/oscar/peer.c", "title": "\n      changeset 228 for vendor/current/libgaim/protocols/oscar/peer.c \u2013 nomatic*im\n    ", "html": "<!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Strict//EN\" \"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd\">\n<html xmlns=\"http://www.w3.org/1999/xhtml\">\n  \n  \n\n  \n\n\n  <head>\n\t\t<title>\n      Changeset 228 for vendor/current/libgaim/protocols/oscar/peer.c \u2013 Nomatic*IM\n    </title><meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\" /><meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge\" /><link rel=\"search\" href=\"/LUCICodeRepository/nomaticIM/search\" /><link rel=\"help\" href=\"/LUCICodeRepository/nomaticIM/wiki/TracGuide\" /><link rel=\"alternate\" href=\"?format=diff&amp;new=228\" type=\"text/plain\" class=\"diff\" title=\"Unified Diff\" /><link rel=\"alternate\" href=\"?format=zip&amp;new=228\" type=\"application/zip\" class=\"zip\" title=\"Zip Archive\" /><link rel=\"next\" href=\"/LUCICodeRepository/nomaticIM/changeset/274\" title=\"Changeset 274 for vendor/current/libgaim/protocols/oscar/peer.c\" /><link rel=\"start\" href=\"/LUCICodeRepository/nomaticIM/wiki\" /><link rel=\"stylesheet\" href=\"/LUCICodeRepository/nomaticIM/chrome/common/css/trac.css\" type=\"text/css\" /><link rel=\"stylesheet\" href=\"/LUCICodeRepository/nomaticIM/chrome/common/css/changeset.css\" type=\"text/css\" /><link rel=\"stylesheet\" href=\"/LUCICodeRepository/nomaticIM/chrome/common/css/diff.css\" type=\"text/css\" /><link rel=\"stylesheet\" href=\"/LUCICodeRepository/nomaticIM/chrome/common/css/code.css\" type=\"text/css\" /><link rel=\"prev\" href=\"/LUCICodeRepository/nomaticIM/changeset/65/vendor/current/libgaim/protocols/oscar/peer.c\" title=\"Changeset 65 for vendor/current/libgaim/protocols/oscar/peer.c\" /><link rel=\"shortcut icon\" href=\"http://luci.ics.uci.edu/logo32by32.gif\" type=\"image/gif\" /><link rel=\"icon\" href=\"http://luci.ics.uci.edu/logo32by32.gif\" type=\"image/gif\" /><link type=\"application/opensearchdescription+xml\" rel=\"search\" href=\"/LUCICodeRepository/nomaticIM/search/opensearch\" title=\"Search Nomatic*IM\" /><script type=\"text/javascript\" charset=\"utf-8\" src=\"/LUCICodeRepository/nomaticIM/chrome/common/js/jquery.js\"></script><script type=\"text/javascript\" charset=\"utf-8\" src=\"/LUCICodeRepository/nomaticIM/chrome/common/js/babel.js\"></script><script type=\"text/javascript\" charset=\"utf-8\" src=\"/LUCICodeRepository/nomaticIM/chrome/common/js/messages/en_US.js\"></script><script type=\"text/javascript\" charset=\"utf-8\" src=\"/LUCICodeRepository/nomaticIM/chrome/common/js/trac.js\"></script><script type=\"text/javascript\" charset=\"utf-8\" src=\"/LUCICodeRepository/nomaticIM/chrome/common/js/search.js\"></script><script type=\"text/javascript\" charset=\"utf-8\" src=\"/LUCICodeRepository/nomaticIM/chrome/common/js/diff.js\"></script><script type=\"text/javascript\">\n      jQuery(document).ready(function($) {\n        $(\".trac-toggledeleted\").show().click(function() {\n                  $(this).siblings().find(\".trac-deleted\").toggle();\n                  return false;\n        }).click();\n        $(\"#content\").find(\"li.entry h2 a\").parent().addAnchor(_(\"Link to this diff\"));\n      });\n    </script>\n\t</head>\n  <body>\n    <div id=\"banner\">\n      <div id=\"header\">\n        <a id=\"logo\" href=\"http://luci.ics.uci.edu/#code\"><img src=\"http://luci.ics.uci.edu/blog/archives/LUCIhorzTight.jpg\" alt=\"LUCI Code Repository\" /></a>\n      </div>\n      <form id=\"search\" action=\"/LUCICodeRepository/nomaticIM/search\" method=\"get\">\n        <div>\n          <label for=\"proj-search\">Search:</label>\n          <input type=\"text\" id=\"proj-search\" name=\"q\" size=\"18\" value=\"\" />\n          <input type=\"submit\" value=\"Search\" />\n        </div>\n      </form>\n      <div id=\"metanav\" class=\"nav\">\n    <ul>\n      <li class=\"first\"><a href=\"/LUCICodeRepository/nomaticIM/login\">Login</a></li><li><a href=\"/LUCICodeRepository/nomaticIM/prefs\">Preferences</a></li><li><a href=\"/LUCICodeRepository/nomaticIM/wiki/TracGuide\">Help/Guide</a></li><li class=\"last\"><a href=\"/LUCICodeRepository/nomaticIM/about\">About Trac</a></li>\n    </ul>\n  </div>\n    </div>\n    <div id=\"mainnav\" class=\"nav\">\n    <ul>\n      <li class=\"first\"><a href=\"/LUCICodeRepository/nomaticIM/wiki\">Wiki</a></li><li><a href=\"/LUCICodeRepository/nomaticIM/timeline\">Timeline</a></li><li><a href=\"/LUCICodeRepository/nomaticIM/roadmap\">Roadmap</a></li><li class=\"active\"><a href=\"/LUCICodeRepository/nomaticIM/browser\">Browse Source</a></li><li><a href=\"/LUCICodeRepository/nomaticIM/report\">View Tickets</a></li><li class=\"last\"><a href=\"/LUCICodeRepository/nomaticIM/search\">Search</a></li>\n    </ul>\n  </div>\n    <div id=\"main\">\n      <div id=\"ctxtnav\" class=\"nav\">\n        <h2>Context Navigation</h2>\n        <ul>\n          <li class=\"first\"><span>&larr; <a class=\"prev\" href=\"/LUCICodeRepository/nomaticIM/changeset/65/vendor/current/libgaim/protocols/oscar/peer.c\" title=\"Changeset 65 for vendor/current/libgaim/protocols/oscar/peer.c\">Previous Change</a></span></li><li class=\"last\"><span><a class=\"next\" href=\"/LUCICodeRepository/nomaticIM/changeset/274\" title=\"Changeset 274 for vendor/current/libgaim/protocols/oscar/peer.c\">Next Change</a> &rarr;</span></li>\n        </ul>\n        <hr />\n      </div>\n    <div id=\"content\" class=\"changeset\">\n      <div id=\"title\">\n            <h1>Changeset <a title=\"Show full changeset\" href=\"/LUCICodeRepository/nomaticIM/changeset/228\">228</a>\n              for <a title=\"Show entry in browser\" href=\"/LUCICodeRepository/nomaticIM/browser/vendor/current/libgaim/protocols/oscar/peer.c?rev=228\">vendor/current/libgaim/protocols/oscar/peer.c</a></h1>\n      </div>\n      <form id=\"prefs\" action=\"\">\n        <div>\n          \n  <label for=\"style\">View differences</label>\n  <select id=\"style\" name=\"style\">\n    <option selected=\"selected\" value=\"inline\">inline</option>\n    <option value=\"sidebyside\">side by side</option>\n  </select>\n  <div class=\"field\">\n    <label><input type=\"radio\" name=\"contextall\" value=\"0\" checked=\"checked\" />\n             Show</label>\n      <label><input type=\"text\" name=\"contextlines\" id=\"contextlines\" size=\"2\" maxlength=\"3\" value=\"2\" />\n             lines around each change</label><br />\n    <label><input type=\"radio\" name=\"contextall\" value=\"1\" />\n           Show the changes in full context</label>\n  </div>\n  <fieldset id=\"ignore\">\n    <legend>Ignore:</legend>\n    <div class=\"field\">\n      <input type=\"checkbox\" id=\"ignoreblanklines\" name=\"ignoreblanklines\" />\n      <label for=\"ignoreblanklines\">Blank lines</label>\n    </div>\n    <div class=\"field\">\n      <input type=\"checkbox\" id=\"ignorecase\" name=\"ignorecase\" />\n      <label for=\"ignorecase\">Case changes</label>\n    </div>\n    <div class=\"field\">\n      <input type=\"checkbox\" id=\"ignorewhitespace\" name=\"ignorewhitespace\" />\n      <label for=\"ignorewhitespace\">White space changes</label>\n    </div>\n  </fieldset>\n  <div class=\"buttons\">\n    <input type=\"submit\" name=\"update\" value=\"Update\" />\n  </div>\n\n        </div>\n      </form>\n      <dl id=\"overview\">\n          <dt class=\"property time\">Timestamp:</dt>\n          <dd class=\"time\">\n             Mar 6, 2007, 10:39:26 PM\n             (<a class=\"timeline\" href=\"/LUCICodeRepository/nomaticIM/timeline?from=2007-03-06T22%3A39%3A26-08%3A00&amp;precision=second\" title=\"See timeline at Mar 6, 2007, 10:39:26 PM\">8 years</a> ago)\n          </dd>\n          <dt class=\"property author\">Author:</dt>\n          <dd class=\"author\">djp3</dd>\n          <dt class=\"property message\">Message:</dt>\n          <dd class=\"message searchable\">\n            \n            \n              <p>\nUpdating from gaim Repository<br />\n</p>\n\n            \n            \n          </dd>\n        <dt class=\"property files\">\n          File:\n        </dt>\n        <dd class=\"files\">\n          <div class=\"legend\" id=\"file-legend\">\n            <dl>\n              <dt class=\"mod\"></dt><dd>1 edited</dd>\n            </dl>\n          </div>\n          <br />\n          <ul>\n            <li>\n          <div class=\"mod\"> </div>\n            <a title=\"Show entry in browser\" href=\"/LUCICodeRepository/nomaticIM/browser/vendor/current/libgaim/protocols/oscar/peer.c?rev=228\">\n              vendor/current/libgaim/protocols/oscar/peer.c\n            </a>\n          <span class=\"comment\">(modified)</span>\n              (<a title=\"Show differences\" href=\"#file0\">23 diffs</a>)\n            </li>\n          </ul>\n        </dd>\n      </dl>\n      <div class=\"diff\">\n        <div class=\"legend\" id=\"diff-legend\">\n          <h3>Legend:</h3>\n          <dl>\n            <dt class=\"unmod\"></dt><dd>Unmodified</dd>\n            <dt class=\"add\"></dt><dd>Added</dd>\n            <dt class=\"rem\"></dt><dd>Removed</dd>\n          </dl>\n        </div>\n        <div class=\"diff\">\n  <ul class=\"entries\">\n      <li class=\"entry\">\n        <h2 id=\"file0\">\n          <a href=\"/LUCICodeRepository/nomaticIM/changeset/228/vendor/current/libgaim/protocols/oscar/peer.c\" title=\"Show the changeset 228 restricted to vendor/current/libgaim/protocols/oscar/peer.c\">vendor/current/libgaim/protocols/oscar/peer.c</a>\n        </h2>\n        <table class=\"trac-diff inline\" summary=\"Differences\" cellspacing=\"0\">\n              <colgroup><col class=\"lineno\" /><col class=\"lineno\" /><col class=\"content\" /></colgroup>\n              <thead>\n                <tr>\n                  <th title=\"Revision 65\">\n                    <a title=\"Show revision 65 of this file in browser\" href=\"/LUCICodeRepository/nomaticIM/browser/vendor/current/libgaim/protocols/oscar/peer.c?rev=65#L140\">\n                      r65</a>\n                  </th>\n                  <th title=\"Revision 228\">\n                    <a title=\"Show revision 228 of this file in browser\" href=\"/LUCICodeRepository/nomaticIM/browser/vendor/current/libgaim/protocols/oscar/peer.c?rev=228#L140\">\n                      r228</a>\n                  </th>\n                  <td>\u00a0</td>\n                </tr>\n              </thead>\n            <tbody class=\"unmod\">\n                  <tr>\n                          <th>140</th><th>140</th><td class=\"l\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; peer_oft_close(conn);</span>\u00a0</td>\n                  </tr><tr>\n                          <th>141</th><th>141</th><td class=\"l\"><span></span>\u00a0</td>\n                  </tr>\n            </tbody><tbody class=\"mod\">\n                      <tr class=\"first\">\n                        <th>142</th><th>\u00a0</th><td class=\"l\"><span>&nbsp; &nbsp; &nbsp; &nbsp; if (conn-&gt;connect_data != NULL)</span>\u00a0</td>\n                      </tr><tr>\n                        <th>143</th><th>\u00a0</th><td class=\"l\"><span>&nbsp; &nbsp; &nbsp; &nbsp; {</span>\u00a0</td>\n                      </tr><tr>\n                        <th>144</th><th>\u00a0</th><td class=\"l\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; gaim_proxy_connect_cancel(conn-&gt;connect_data);</span>\u00a0</td>\n                      </tr><tr>\n                        <th>145</th><th>\u00a0</th><td class=\"l\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; conn-&gt;connect_data = NULL;</span>\u00a0</td>\n                      </tr>\n                      <tr>\n                        <th>\u00a0</th><th>142</th><td class=\"r\"><span>&nbsp; &nbsp; &nbsp; &nbsp; if (conn-&gt;verified_connect_data != NULL)</span>\u00a0</td>\n                      </tr><tr>\n                        <th>\u00a0</th><th>143</th><td class=\"r\"><span>&nbsp; &nbsp; &nbsp; &nbsp; {</span>\u00a0</td>\n                      </tr><tr>\n                        <th>\u00a0</th><th>144</th><td class=\"r\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; gaim_proxy_connect_cancel(conn-&gt;verified_connect_data);</span>\u00a0</td>\n                      </tr><tr>\n                        <th>\u00a0</th><th>145</th><td class=\"r\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; conn-&gt;verified_connect_data = NULL;</span>\u00a0</td>\n                      </tr><tr>\n                        <th>\u00a0</th><th>146</th><td class=\"r\"><span>&nbsp; &nbsp; &nbsp; &nbsp; }</span>\u00a0</td>\n                      </tr><tr>\n                        <th>\u00a0</th><th>147</th><td class=\"r\"><span></span>\u00a0</td>\n                      </tr><tr>\n                        <th>\u00a0</th><th>148</th><td class=\"r\"><span>&nbsp; &nbsp; &nbsp; &nbsp; if (conn-&gt;client_connect_data != NULL)</span>\u00a0</td>\n                      </tr><tr>\n                        <th>\u00a0</th><th>149</th><td class=\"r\"><span>&nbsp; &nbsp; &nbsp; &nbsp; {</span>\u00a0</td>\n                      </tr><tr>\n                        <th>\u00a0</th><th>150</th><td class=\"r\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; gaim_proxy_connect_cancel(conn-&gt;client_connect_data);</span>\u00a0</td>\n                      </tr><tr class=\"last\">\n                        <th>\u00a0</th><th>151</th><td class=\"r\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; conn-&gt;client_connect_data = NULL;</span>\u00a0</td>\n                      </tr>\n            </tbody><tbody class=\"unmod\">\n                  <tr>\n                          <th>146</th><th>152</th><td class=\"l\"><span>&nbsp; &nbsp; &nbsp; &nbsp; }</span>\u00a0</td>\n                  </tr><tr>\n                          <th>147</th><th>153</th><td class=\"l\"><span></span>\u00a0</td>\n                  </tr>\n            </tbody>\n              <tbody class=\"skipped\">\n                <tr>\n                  <th><a href=\"/LUCICodeRepository/nomaticIM/browser/vendor/current/libgaim/protocols/oscar/peer.c?rev=65#L200\">\u2026</a></th>\n                  <th><a href=\"/LUCICodeRepository/nomaticIM/browser/vendor/current/libgaim/protocols/oscar/peer.c?rev=228#L206\">\u2026</a></th>\n                  <td>\u00a0</td>\n                </tr>\n              </tbody>\n            <tbody class=\"unmod\">\n                  <tr>\n                          <th>200</th><th>206</th><td class=\"l\"><span></span>\u00a0</td>\n                  </tr><tr>\n                          <th>201</th><th>207</th><td class=\"l\"><span>&nbsp; &nbsp; &nbsp; &nbsp; peer_connection_close(conn);</span>\u00a0</td>\n                  </tr>\n            </tbody><tbody class=\"add\">\n                  <tr class=\"first\">\n                          <th>\u00a0</th><th>208</th><td class=\"r\"><ins></ins>\u00a0</td>\n                  </tr><tr>\n                          <th>\u00a0</th><th>209</th><td class=\"r\"><ins>&nbsp; &nbsp; &nbsp; &nbsp; if (conn-&gt;checksum_data != NULL)</ins>\u00a0</td>\n                  </tr><tr class=\"last\">\n                          <th>\u00a0</th><th>210</th><td class=\"r\"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; peer_oft_checksum_destroy(conn-&gt;checksum_data);</ins>\u00a0</td>\n                  </tr>\n            </tbody><tbody class=\"unmod\">\n                  <tr>\n                          <th>202</th><th>211</th><td class=\"l\"><span></span>\u00a0</td>\n                  </tr><tr>\n                          <th>203</th><th>212</th><td class=\"l\"><span>&nbsp; &nbsp; &nbsp; &nbsp; if (conn-&gt;xfer != NULL)</span>\u00a0</td>\n                  </tr>\n            </tbody>\n              <tbody class=\"skipped\">\n                <tr>\n                  <th><a href=\"/LUCICodeRepository/nomaticIM/browser/vendor/current/libgaim/protocols/oscar/peer.c?rev=65#L225\">\u2026</a></th>\n                  <th><a href=\"/LUCICodeRepository/nomaticIM/browser/vendor/current/libgaim/protocols/oscar/peer.c?rev=228#L234\">\u2026</a></th>\n                  <td>\u00a0</td>\n                </tr>\n              </tbody>\n            <tbody class=\"unmod\">\n                  <tr>\n                          <th>225</th><th>234</th><td class=\"l\"><span>&nbsp; &nbsp; &nbsp; &nbsp; g_free(conn-&gt;clientip);</span>\u00a0</td>\n                  </tr><tr>\n                          <th>226</th><th>235</th><td class=\"l\"><span>&nbsp; &nbsp; &nbsp; &nbsp; g_free(conn-&gt;verifiedip);</span>\u00a0</td>\n                  </tr>\n            </tbody><tbody class=\"add\">\n                  <tr class=\"last first\">\n                          <th>\u00a0</th><th>236</th><td class=\"r\"><ins>&nbsp; &nbsp; &nbsp; &nbsp; g_free(conn-&gt;xferdata.name);</ins>\u00a0</td>\n                  </tr>\n            </tbody><tbody class=\"unmod\">\n                  <tr>\n                          <th>227</th><th>237</th><td class=\"l\"><span>&nbsp; &nbsp; &nbsp; &nbsp; gaim_circ_buffer_destroy(conn-&gt;buffer_outgoing);</span>\u00a0</td>\n                  </tr><tr>\n                          <th>228</th><th>238</th><td class=\"l\"><span></span>\u00a0</td>\n                  </tr>\n            </tbody>\n              <tbody class=\"skipped\">\n                <tr>\n                  <th><a href=\"/LUCICodeRepository/nomaticIM/browser/vendor/current/libgaim/protocols/oscar/peer.c?rev=65#L283\">\u2026</a></th>\n                  <th><a href=\"/LUCICodeRepository/nomaticIM/browser/vendor/current/libgaim/protocols/oscar/peer.c?rev=228#L293\">\u2026</a></th>\n                  <td>\u00a0</td>\n                </tr>\n              </tbody>\n            <tbody class=\"unmod\">\n                  <tr>\n                          <th>283</th><th>293</th><td class=\"l\"><span>&nbsp; &nbsp; &nbsp; &nbsp; PeerConnection *conn;</span>\u00a0</td>\n                  </tr><tr>\n                          <th>284</th><th>294</th><td class=\"l\"><span>&nbsp; &nbsp; &nbsp; &nbsp; ssize_t read;</span>\u00a0</td>\n                  </tr>\n            </tbody><tbody class=\"rem\">\n                  <tr class=\"last first\">\n                          <th>285</th><th>\u00a0</th><td class=\"l\"><del>&nbsp; &nbsp; &nbsp; &nbsp; guint8 header[6];</del>\u00a0</td>\n                  </tr>\n            </tbody><tbody class=\"unmod\">\n                  <tr>\n                          <th>286</th><th>295</th><td class=\"l\"><span></span>\u00a0</td>\n                  </tr><tr>\n                          <th>287</th><th>296</th><td class=\"l\"><span>&nbsp; &nbsp; &nbsp; &nbsp; conn = data;</span>\u00a0</td>\n                  </tr>\n            </tbody>\n              <tbody class=\"skipped\">\n                <tr>\n                  <th><a href=\"/LUCICodeRepository/nomaticIM/browser/vendor/current/libgaim/protocols/oscar/peer.c?rev=65#L290\">\u2026</a></th>\n                  <th><a href=\"/LUCICodeRepository/nomaticIM/browser/vendor/current/libgaim/protocols/oscar/peer.c?rev=228#L299\">\u2026</a></th>\n                  <td>\u00a0</td>\n                </tr>\n              </tbody>\n            <tbody class=\"unmod\">\n                  <tr>\n                          <th>290</th><th>299</th><td class=\"l\"><span>&nbsp; &nbsp; &nbsp; &nbsp; if (conn-&gt;buffer_incoming.data == NULL)</span>\u00a0</td>\n                  </tr><tr>\n                          <th>291</th><th>300</th><td class=\"l\"><span>&nbsp; &nbsp; &nbsp; &nbsp; {</span>\u00a0</td>\n                  </tr>\n            </tbody><tbody class=\"mod\">\n                      <tr class=\"first\">\n                        <th>292</th><th>\u00a0</th><td class=\"l\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; /* Peek at the first 6 bytes to get the length */</span>\u00a0</td>\n                      </tr><tr>\n                        <th>293</th><th>\u00a0</th><td class=\"l\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; read = recv(conn-&gt;fd, &amp;header, 6, MSG_PEEK);</span>\u00a0</td>\n                      </tr>\n                      <tr>\n                        <th>\u00a0</th><th>301</th><td class=\"r\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; /* Read the first 6 bytes (magic string and frame length) */</span>\u00a0</td>\n                      </tr><tr>\n                        <th>\u00a0</th><th>302</th><td class=\"r\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; read = recv(conn-&gt;fd, conn-&gt;header + conn-&gt;header_received,</span>\u00a0</td>\n                      </tr><tr class=\"last\">\n                        <th>\u00a0</th><th>303</th><td class=\"r\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 6 - conn-&gt;header_received, 0);</span>\u00a0</td>\n                      </tr>\n            </tbody><tbody class=\"unmod\">\n                  <tr>\n                          <th>294</th><th>304</th><td class=\"l\"><span></span>\u00a0</td>\n                  </tr><tr>\n                          <th>295</th><th>305</th><td class=\"l\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; /* Check if the remote user closed the connection */</span>\u00a0</td>\n                  </tr>\n            </tbody>\n              <tbody class=\"skipped\">\n                <tr>\n                  <th><a href=\"/LUCICodeRepository/nomaticIM/browser/vendor/current/libgaim/protocols/oscar/peer.c?rev=65#L315\">\u2026</a></th>\n                  <th><a href=\"/LUCICodeRepository/nomaticIM/browser/vendor/current/libgaim/protocols/oscar/peer.c?rev=228#L325\">\u2026</a></th>\n                  <td>\u00a0</td>\n                </tr>\n              </tbody>\n            <tbody class=\"unmod\">\n                  <tr>\n                          <th>315</th><th>325</th><td class=\"l\"><span></span>\u00a0</td>\n                  </tr><tr>\n                          <th>316</th><th>326</th><td class=\"l\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; /* If we don't even have the first 6 bytes then do nothing */</span>\u00a0</td>\n                  </tr>\n            </tbody><tbody class=\"mod\">\n                      <tr class=\"first\">\n                        <th>317</th><th>\u00a0</th><td class=\"l\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (read &lt; 6)</span>\u00a0</td>\n                      </tr>\n                      <tr>\n                        <th>\u00a0</th><th>327</th><td class=\"r\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; conn-&gt;header_received += read;</span>\u00a0</td>\n                      </tr><tr class=\"last\">\n                        <th>\u00a0</th><th>328</th><td class=\"r\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (conn-&gt;header_received &lt; 6)</span>\u00a0</td>\n                      </tr>\n            </tbody><tbody class=\"unmod\">\n                  <tr>\n                          <th>318</th><th>329</th><td class=\"l\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return;</span>\u00a0</td>\n                  </tr><tr>\n                          <th>319</th><th>330</th><td class=\"l\"><span></span>\u00a0</td>\n                  </tr>\n            </tbody><tbody class=\"rem\">\n                  <tr class=\"first\">\n                          <th>320</th><th>\u00a0</th><td class=\"l\"><del>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; /* Read the first 6 bytes (magic string and frame length) */</del>\u00a0</td>\n                  </tr><tr>\n                          <th>321</th><th>\u00a0</th><td class=\"l\"><del>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; read = recv(conn-&gt;fd, &amp;header, 6, 0);</del>\u00a0</td>\n                  </tr><tr class=\"last\">\n                          <th>322</th><th>\u00a0</th><td class=\"l\"><del></del>\u00a0</td>\n                  </tr>\n            </tbody><tbody class=\"unmod\">\n                  <tr>\n                          <th>323</th><th>331</th><td class=\"l\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; /* All ODC/OFT frames must start with a magic string */</span>\u00a0</td>\n                  </tr>\n            </tbody><tbody class=\"mod\">\n                      <tr class=\"first\">\n                        <th>324</th><th>\u00a0</th><td class=\"l\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (memcmp(conn-&gt;magic, <del></del>header, 4))</span>\u00a0</td>\n                      </tr>\n                      <tr class=\"last\">\n                        <th>\u00a0</th><th>332</th><td class=\"r\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (memcmp(conn-&gt;magic, <ins>conn-&gt;</ins>header, 4))</span>\u00a0</td>\n                      </tr>\n            </tbody><tbody class=\"unmod\">\n                  <tr>\n                          <th>325</th><th>333</th><td class=\"l\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {</span>\u00a0</td>\n                  </tr><tr>\n                          <th>326</th><th>334</th><td class=\"l\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; gaim_debug_warning(\"oscar\", \"Expecting magic string to \"</span>\u00a0</td>\n                  </tr>\n            </tbody>\n              <tbody class=\"skipped\">\n                <tr>\n                  <th><a href=\"/LUCICodeRepository/nomaticIM/browser/vendor/current/libgaim/protocols/oscar/peer.c?rev=65#L328\">\u2026</a></th>\n                  <th><a href=\"/LUCICodeRepository/nomaticIM/browser/vendor/current/libgaim/protocols/oscar/peer.c?rev=228#L336\">\u2026</a></th>\n                  <td>\u00a0</td>\n                </tr>\n              </tbody>\n            <tbody class=\"unmod\">\n                  <tr>\n                          <th>328</th><th>336</th><td class=\"l\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; \"Closing connection.\\n\",</span>\u00a0</td>\n                  </tr><tr>\n                          <th>329</th><th>337</th><td class=\"l\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; conn-&gt;magic[0], conn-&gt;magic[1], conn-&gt;magic[2],</span>\u00a0</td>\n                  </tr>\n            </tbody><tbody class=\"mod\">\n                      <tr class=\"first\">\n                        <th>330</th><th>\u00a0</th><td class=\"l\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; conn-&gt;magic[3], header[0], header[1], header[2], header[3]);</span>\u00a0</td>\n                      </tr>\n                      <tr>\n                        <th>\u00a0</th><th>338</th><td class=\"r\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; conn-&gt;magic[3], conn-&gt;header[0], conn-&gt;header[1],</span>\u00a0</td>\n                      </tr><tr class=\"last\">\n                        <th>\u00a0</th><th>339</th><td class=\"r\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; conn-&gt;header[2], conn-&gt;header[3]);</span>\u00a0</td>\n                      </tr>\n            </tbody><tbody class=\"unmod\">\n                  <tr>\n                          <th>331</th><th>340</th><td class=\"l\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; peer_connection_destroy(conn, OSCAR_DISCONNECT_INVALID_DATA, NULL);</span>\u00a0</td>\n                  </tr><tr>\n                          <th>332</th><th>341</th><td class=\"l\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return;</span>\u00a0</td>\n                  </tr>\n            </tbody>\n              <tbody class=\"skipped\">\n                <tr>\n                  <th><a href=\"/LUCICodeRepository/nomaticIM/browser/vendor/current/libgaim/protocols/oscar/peer.c?rev=65#L334\">\u2026</a></th>\n                  <th><a href=\"/LUCICodeRepository/nomaticIM/browser/vendor/current/libgaim/protocols/oscar/peer.c?rev=228#L343\">\u2026</a></th>\n                  <td>\u00a0</td>\n                </tr>\n              </tbody>\n            <tbody class=\"unmod\">\n                  <tr>\n                          <th>334</th><th>343</th><td class=\"l\"><span></span>\u00a0</td>\n                  </tr><tr>\n                          <th>335</th><th>344</th><td class=\"l\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; /* Initialize a new temporary ByteStream for incoming data */</span>\u00a0</td>\n                  </tr>\n            </tbody><tbody class=\"mod\">\n                      <tr class=\"first\">\n                        <th>336</th><th>\u00a0</th><td class=\"l\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; conn-&gt;buffer_incoming.len = aimutil_get16(&amp;<del></del>header[4]) - 6;</span>\u00a0</td>\n                      </tr>\n                      <tr class=\"last\">\n                        <th>\u00a0</th><th>345</th><td class=\"r\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; conn-&gt;buffer_incoming.len = aimutil_get16(&amp;<ins>conn-&gt;</ins>header[4]) - 6;</span>\u00a0</td>\n                      </tr>\n            </tbody><tbody class=\"unmod\">\n                  <tr>\n                          <th>337</th><th>346</th><td class=\"l\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; conn-&gt;buffer_incoming.data = g_new(guint8, conn-&gt;buffer_incoming.len);</span>\u00a0</td>\n                  </tr><tr>\n                          <th>338</th><th>347</th><td class=\"l\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; conn-&gt;buffer_incoming.offset = 0;</span>\u00a0</td>\n                  </tr>\n            </tbody>\n              <tbody class=\"skipped\">\n                <tr>\n                  <th><a href=\"/LUCICodeRepository/nomaticIM/browser/vendor/current/libgaim/protocols/oscar/peer.c?rev=65#L379\">\u2026</a></th>\n                  <th><a href=\"/LUCICodeRepository/nomaticIM/browser/vendor/current/libgaim/protocols/oscar/peer.c?rev=228#L388\">\u2026</a></th>\n                  <td>\u00a0</td>\n                </tr>\n              </tbody>\n            <tbody class=\"unmod\">\n                  <tr>\n                          <th>379</th><th>388</th><td class=\"l\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; peer_oft_recv_frame(conn, &amp;conn-&gt;buffer_incoming);</span>\u00a0</td>\n                  </tr><tr>\n                          <th>380</th><th>389</th><td class=\"l\"><span>&nbsp; &nbsp; &nbsp; &nbsp; }</span>\u00a0</td>\n                  </tr>\n            </tbody><tbody class=\"add\">\n                  <tr class=\"last first\">\n                          <th>\u00a0</th><th>390</th><td class=\"r\"><ins></ins>\u00a0</td>\n                  </tr>\n            </tbody><tbody class=\"unmod\">\n                  <tr>\n                          <th>381</th><th>391</th><td class=\"l\"><span>&nbsp; &nbsp; &nbsp; &nbsp; g_free(conn-&gt;buffer_incoming.data);</span>\u00a0</td>\n                  </tr><tr>\n                          <th>382</th><th>392</th><td class=\"l\"><span>&nbsp; &nbsp; &nbsp; &nbsp; conn-&gt;buffer_incoming.data = NULL;</span>\u00a0</td>\n                  </tr>\n            </tbody><tbody class=\"add\">\n                  <tr class=\"first\">\n                          <th>\u00a0</th><th>393</th><td class=\"r\"><ins></ins>\u00a0</td>\n                  </tr><tr class=\"last\">\n                          <th>\u00a0</th><th>394</th><td class=\"r\"><ins>&nbsp; &nbsp; &nbsp; &nbsp; conn-&gt;header_received = 0;</ins>\u00a0</td>\n                  </tr>\n            </tbody><tbody class=\"unmod\">\n                  <tr>\n                          <th>383</th><th>395</th><td class=\"l\"><span>}</span>\u00a0</td>\n                  </tr><tr>\n                          <th>384</th><th>396</th><td class=\"l\"><span></span>\u00a0</td>\n                  </tr>\n            </tbody>\n              <tbody class=\"skipped\">\n                <tr>\n                  <th><a href=\"/LUCICodeRepository/nomaticIM/browser/vendor/current/libgaim/protocols/oscar/peer.c?rev=65#L416\">\u2026</a></th>\n                  <th><a href=\"/LUCICodeRepository/nomaticIM/browser/vendor/current/libgaim/protocols/oscar/peer.c?rev=228#L428\">\u2026</a></th>\n                  <td>\u00a0</td>\n                </tr>\n              </tbody>\n            <tbody class=\"unmod\">\n                  <tr>\n                          <th>416</th><th>428</th><td class=\"l\"><span></span>\u00a0</td>\n                  </tr><tr>\n                          <th>417</th><th>429</th><td class=\"l\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (conn-&gt;ready)</span>\u00a0</td>\n                  </tr>\n            </tbody><tbody class=\"add\">\n                  <tr class=\"first\">\n                          <th>\u00a0</th><th>430</th><td class=\"r\"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {</ins>\u00a0</td>\n                  </tr><tr>\n                          <th>\u00a0</th><th>431</th><td class=\"r\"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; gaim_input_remove(conn-&gt;watcher_outgoing);</ins>\u00a0</td>\n                  </tr><tr>\n                          <th>\u00a0</th><th>432</th><td class=\"r\"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; conn-&gt;watcher_outgoing = 0;</ins>\u00a0</td>\n                  </tr><tr>\n                          <th>\u00a0</th><th>433</th><td class=\"r\"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; close(conn-&gt;fd);</ins>\u00a0</td>\n                  </tr><tr class=\"last\">\n                          <th>\u00a0</th><th>434</th><td class=\"r\"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; conn-&gt;fd = -1;</ins>\u00a0</td>\n                  </tr>\n            </tbody><tbody class=\"unmod\">\n                  <tr>\n                          <th>418</th><th>435</th><td class=\"l\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; peer_connection_schedule_destroy(conn,</span>\u00a0</td>\n                  </tr><tr>\n                          <th>419</th><th>436</th><td class=\"l\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; OSCAR_DISCONNECT_LOST_CONNECTION, NULL);</span>\u00a0</td>\n                  </tr>\n            </tbody><tbody class=\"add\">\n                  <tr class=\"last first\">\n                          <th>\u00a0</th><th>437</th><td class=\"r\"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</ins>\u00a0</td>\n                  </tr>\n            </tbody><tbody class=\"unmod\">\n                  <tr>\n                          <th>420</th><th>438</th><td class=\"l\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; else</span>\u00a0</td>\n                  </tr><tr>\n                          <th>421</th><th>439</th><td class=\"l\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {</span>\u00a0</td>\n                  </tr>\n            </tbody>\n              <tbody class=\"skipped\">\n                <tr>\n                  <th><a href=\"/LUCICodeRepository/nomaticIM/browser/vendor/current/libgaim/protocols/oscar/peer.c?rev=65#L445\">\u2026</a></th>\n                  <th><a href=\"/LUCICodeRepository/nomaticIM/browser/vendor/current/libgaim/protocols/oscar/peer.c?rev=228#L463\">\u2026</a></th>\n                  <td>\u00a0</td>\n                </tr>\n              </tbody>\n            <tbody class=\"unmod\">\n                  <tr>\n                          <th>445</th><th>463</th><td class=\"l\"><span></span>\u00a0</td>\n                  </tr><tr>\n                          <th>446</th><th>464</th><td class=\"l\"><span>&nbsp; &nbsp; &nbsp; &nbsp; /* If we haven't already started writing stuff, then start the cycle */</span>\u00a0</td>\n                  </tr>\n            </tbody><tbody class=\"mod\">\n                      <tr class=\"first\">\n                        <th>447</th><th>\u00a0</th><td class=\"l\"><span>&nbsp; &nbsp; &nbsp; &nbsp; if (<del>conn-&gt;watcher_outgoing == 0</del>)</span>\u00a0</td>\n                      </tr>\n                      <tr class=\"last\">\n                        <th>\u00a0</th><th>465</th><td class=\"r\"><span>&nbsp; &nbsp; &nbsp; &nbsp; if (<ins>(conn-&gt;watcher_outgoing == 0) &amp;&amp; (conn-&gt;fd != -1)</ins>)</span>\u00a0</td>\n                      </tr>\n            </tbody><tbody class=\"unmod\">\n                  <tr>\n                          <th>448</th><th>466</th><td class=\"l\"><span>&nbsp; &nbsp; &nbsp; &nbsp; {</span>\u00a0</td>\n                  </tr><tr>\n                          <th>449</th><th>467</th><td class=\"l\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; conn-&gt;watcher_outgoing = gaim_input_add(conn-&gt;fd,</span>\u00a0</td>\n                  </tr>\n            </tbody>\n              <tbody class=\"skipped\">\n                <tr>\n                  <th><a href=\"/LUCICodeRepository/nomaticIM/browser/vendor/current/libgaim/protocols/oscar/peer.c?rev=65#L498\">\u2026</a></th>\n                  <th><a href=\"/LUCICodeRepository/nomaticIM/browser/vendor/current/libgaim/protocols/oscar/peer.c?rev=228#L516\">\u2026</a></th>\n                  <td>\u00a0</td>\n                </tr>\n              </tbody>\n            <tbody class=\"unmod\">\n                  <tr>\n                          <th>498</th><th>516</th><td class=\"l\"><span>&nbsp;*/</span>\u00a0</td>\n                  </tr><tr>\n                          <th>499</th><th>517</th><td class=\"l\"><span>static void</span>\u00a0</td>\n                  </tr>\n            </tbody><tbody class=\"mod\">\n                      <tr class=\"first\">\n                        <th>500</th><th>\u00a0</th><td class=\"l\"><span>peer_connection_<del>established_cb(gpointer data, gint source, const gchar *error_message</del>)</span>\u00a0</td>\n                      </tr>\n                      <tr class=\"last\">\n                        <th>\u00a0</th><th>518</th><td class=\"r\"><span>peer_connection_<ins>common_established_cb(gpointer data, gint source, const gchar *error_message, gboolean verified</ins>)</span>\u00a0</td>\n                      </tr>\n            </tbody><tbody class=\"unmod\">\n                  <tr>\n                          <th>501</th><th>519</th><td class=\"l\"><span>{</span>\u00a0</td>\n                  </tr><tr>\n                          <th>502</th><th>520</th><td class=\"l\"><span>&nbsp; &nbsp; &nbsp; &nbsp; PeerConnection *conn;</span>\u00a0</td>\n                  </tr>\n            </tbody>\n              <tbody class=\"skipped\">\n                <tr>\n                  <th><a href=\"/LUCICodeRepository/nomaticIM/browser/vendor/current/libgaim/protocols/oscar/peer.c?rev=65#L504\">\u2026</a></th>\n                  <th><a href=\"/LUCICodeRepository/nomaticIM/browser/vendor/current/libgaim/protocols/oscar/peer.c?rev=228#L522\">\u2026</a></th>\n                  <td>\u00a0</td>\n                </tr>\n              </tbody>\n            <tbody class=\"unmod\">\n                  <tr>\n                          <th>504</th><th>522</th><td class=\"l\"><span>&nbsp; &nbsp; &nbsp; &nbsp; conn = data;</span>\u00a0</td>\n                  </tr><tr>\n                          <th>505</th><th>523</th><td class=\"l\"><span></span>\u00a0</td>\n                  </tr>\n            </tbody><tbody class=\"mod\">\n                      <tr class=\"first\">\n                        <th>506</th><th>\u00a0</th><td class=\"l\"><span>&nbsp; &nbsp; &nbsp; &nbsp; conn-&gt;connect_data = NULL;</span>\u00a0</td>\n                      </tr>\n                      <tr>\n                        <th>\u00a0</th><th>524</th><td class=\"r\"><span>&nbsp; &nbsp; &nbsp; &nbsp; if (verified)</span>\u00a0</td>\n                      </tr><tr>\n                        <th>\u00a0</th><th>525</th><td class=\"r\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; conn-&gt;verified_connect_data = NULL;</span>\u00a0</td>\n                      </tr><tr>\n                        <th>\u00a0</th><th>526</th><td class=\"r\"><span>&nbsp; &nbsp; &nbsp; &nbsp; else</span>\u00a0</td>\n                      </tr><tr>\n                        <th>\u00a0</th><th>527</th><td class=\"r\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; conn-&gt;client_connect_data = NULL;</span>\u00a0</td>\n                      </tr><tr>\n                        <th>\u00a0</th><th>528</th><td class=\"r\"><span></span>\u00a0</td>\n                      </tr><tr>\n                        <th>\u00a0</th><th>529</th><td class=\"r\"><span>&nbsp; &nbsp; &nbsp; &nbsp; if (source &lt; 0)</span>\u00a0</td>\n                      </tr><tr>\n                        <th>\u00a0</th><th>530</th><td class=\"r\"><span>&nbsp; &nbsp; &nbsp; &nbsp; {</span>\u00a0</td>\n                      </tr><tr>\n                        <th>\u00a0</th><th>531</th><td class=\"r\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if ((conn-&gt;verified_connect_data == NULL) &amp;&amp;</span>\u00a0</td>\n                      </tr><tr>\n                        <th>\u00a0</th><th>532</th><td class=\"r\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (conn-&gt;client_connect_data == NULL))</span>\u00a0</td>\n                      </tr><tr>\n                        <th>\u00a0</th><th>533</th><td class=\"r\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {</span>\u00a0</td>\n                      </tr><tr>\n                        <th>\u00a0</th><th>534</th><td class=\"r\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; /* Our parallel connection attemps have both failed. */</span>\u00a0</td>\n                      </tr><tr>\n                        <th>\u00a0</th><th>535</th><td class=\"r\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; peer_connection_trynext(conn);</span>\u00a0</td>\n                      </tr><tr>\n                        <th>\u00a0</th><th>536</th><td class=\"r\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</span>\u00a0</td>\n                      </tr><tr>\n                        <th>\u00a0</th><th>537</th><td class=\"r\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return;</span>\u00a0</td>\n                      </tr><tr>\n                        <th>\u00a0</th><th>538</th><td class=\"r\"><span>&nbsp; &nbsp; &nbsp; &nbsp; }</span>\u00a0</td>\n                      </tr><tr class=\"last\">\n                        <th>\u00a0</th><th>539</th><td class=\"r\"><span></span>\u00a0</td>\n                      </tr>\n            </tbody><tbody class=\"unmod\">\n                  <tr>\n                          <th>507</th><th>540</th><td class=\"l\"><span>&nbsp; &nbsp; &nbsp; &nbsp; gaim_timeout_remove(conn-&gt;connect_timeout_timer);</span>\u00a0</td>\n                  </tr><tr>\n                          <th>508</th><th>541</th><td class=\"l\"><span>&nbsp; &nbsp; &nbsp; &nbsp; conn-&gt;connect_timeout_timer = 0;</span>\u00a0</td>\n                  </tr><tr>\n                          <th>509</th><th>542</th><td class=\"l\"><span></span>\u00a0</td>\n                  </tr>\n            </tbody><tbody class=\"mod\">\n                      <tr class=\"first\">\n                        <th>510</th><th>\u00a0</th><td class=\"l\"><span>&nbsp; &nbsp; &nbsp; &nbsp; if (source &lt; 0)</span>\u00a0</td>\n                      </tr><tr>\n                        <th>511</th><th>\u00a0</th><td class=\"l\"><span>&nbsp; &nbsp; &nbsp; &nbsp; {</span>\u00a0</td>\n                      </tr><tr>\n                        <th>512</th><th>\u00a0</th><td class=\"l\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; peer_connection_trynext(conn);</span>\u00a0</td>\n                      </tr><tr>\n                        <th>513</th><th>\u00a0</th><td class=\"l\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return;</span>\u00a0</td>\n                      </tr>\n                      <tr>\n                        <th>\u00a0</th><th>543</th><td class=\"r\"><span>&nbsp; &nbsp; &nbsp; &nbsp; if (conn-&gt;client_connect_data != NULL)</span>\u00a0</td>\n                      </tr><tr>\n                        <th>\u00a0</th><th>544</th><td class=\"r\"><span>&nbsp; &nbsp; &nbsp; &nbsp; {</span>\u00a0</td>\n                      </tr><tr>\n                        <th>\u00a0</th><th>545</th><td class=\"r\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; gaim_proxy_connect_cancel(conn-&gt;client_connect_data);</span>\u00a0</td>\n                      </tr><tr>\n                        <th>\u00a0</th><th>546</th><td class=\"r\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; conn-&gt;client_connect_data = NULL;</span>\u00a0</td>\n                      </tr><tr>\n                        <th>\u00a0</th><th>547</th><td class=\"r\"><span>&nbsp; &nbsp; &nbsp; &nbsp; }</span>\u00a0</td>\n                      </tr><tr>\n                        <th>\u00a0</th><th>548</th><td class=\"r\"><span></span>\u00a0</td>\n                      </tr><tr>\n                        <th>\u00a0</th><th>549</th><td class=\"r\"><span>&nbsp; &nbsp; &nbsp; &nbsp; if (conn-&gt;verified_connect_data != NULL)</span>\u00a0</td>\n                      </tr><tr>\n                        <th>\u00a0</th><th>550</th><td class=\"r\"><span>&nbsp; &nbsp; &nbsp; &nbsp; {</span>\u00a0</td>\n                      </tr><tr>\n                        <th>\u00a0</th><th>551</th><td class=\"r\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; gaim_proxy_connect_cancel(conn-&gt;verified_connect_data);</span>\u00a0</td>\n                      </tr><tr class=\"last\">\n                        <th>\u00a0</th><th>552</th><td class=\"r\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; conn-&gt;verified_connect_data = NULL;</span>\u00a0</td>\n                      </tr>\n            </tbody><tbody class=\"unmod\">\n                  <tr>\n                          <th>514</th><th>553</th><td class=\"l\"><span>&nbsp; &nbsp; &nbsp; &nbsp; }</span>\u00a0</td>\n                  </tr><tr>\n                          <th>515</th><th>554</th><td class=\"l\"><span></span>\u00a0</td>\n                  </tr>\n            </tbody>\n              <tbody class=\"skipped\">\n                <tr>\n                  <th><a href=\"/LUCICodeRepository/nomaticIM/browser/vendor/current/libgaim/protocols/oscar/peer.c?rev=65#L517\">\u2026</a></th>\n                  <th><a href=\"/LUCICodeRepository/nomaticIM/browser/vendor/current/libgaim/protocols/oscar/peer.c?rev=228#L556\">\u2026</a></th>\n                  <td>\u00a0</td>\n                </tr>\n              </tbody>\n            <tbody class=\"unmod\">\n                  <tr>\n                          <th>517</th><th>556</th><td class=\"l\"><span></span>\u00a0</td>\n                  </tr><tr>\n                          <th>518</th><th>557</th><td class=\"l\"><span>&nbsp; &nbsp; &nbsp; &nbsp; peer_connection_finalize_connection(conn);</span>\u00a0</td>\n                  </tr>\n            </tbody><tbody class=\"add\">\n                  <tr class=\"first\">\n                          <th>\u00a0</th><th>558</th><td class=\"r\"><ins>}</ins>\u00a0</td>\n                  </tr><tr>\n                          <th>\u00a0</th><th>559</th><td class=\"r\"><ins></ins>\u00a0</td>\n                  </tr><tr>\n                          <th>\u00a0</th><th>560</th><td class=\"r\"><ins>static void</ins>\u00a0</td>\n                  </tr><tr>\n                          <th>\u00a0</th><th>561</th><td class=\"r\"><ins>peer_connection_verified_established_cb(gpointer data, gint source, const gchar *error_message)</ins>\u00a0</td>\n                  </tr><tr>\n                          <th>\u00a0</th><th>562</th><td class=\"r\"><ins>{</ins>\u00a0</td>\n                  </tr><tr>\n                          <th>\u00a0</th><th>563</th><td class=\"r\"><ins>&nbsp; &nbsp; &nbsp; &nbsp; peer_connection_common_established_cb(data, source, error_message, TRUE);</ins>\u00a0</td>\n                  </tr><tr>\n                          <th>\u00a0</th><th>564</th><td class=\"r\"><ins>}</ins>\u00a0</td>\n                  </tr><tr>\n                          <th>\u00a0</th><th>565</th><td class=\"r\"><ins></ins>\u00a0</td>\n                  </tr><tr>\n                          <th>\u00a0</th><th>566</th><td class=\"r\"><ins>static void</ins>\u00a0</td>\n                  </tr><tr>\n                          <th>\u00a0</th><th>567</th><td class=\"r\"><ins>peer_connection_client_established_cb(gpointer data, gint source, const gchar *error_message)</ins>\u00a0</td>\n                  </tr><tr>\n                          <th>\u00a0</th><th>568</th><td class=\"r\"><ins>{</ins>\u00a0</td>\n                  </tr><tr class=\"last\">\n                          <th>\u00a0</th><th>569</th><td class=\"r\"><ins>&nbsp; &nbsp; &nbsp; &nbsp; peer_connection_common_established_cb(data, source, error_message, FALSE);</ins>\u00a0</td>\n                  </tr>\n            </tbody><tbody class=\"unmod\">\n                  <tr>\n                          <th>519</th><th>570</th><td class=\"l\"><span>}</span>\u00a0</td>\n                  </tr><tr>\n                          <th>520</th><th>571</th><td class=\"l\"><span></span>\u00a0</td>\n                  </tr>\n            </tbody>\n              <tbody class=\"skipped\">\n                <tr>\n                  <th><a href=\"/LUCICodeRepository/nomaticIM/browser/vendor/current/libgaim/protocols/oscar/peer.c?rev=65#L640\">\u2026</a></th>\n                  <th><a href=\"/LUCICodeRepository/nomaticIM/browser/vendor/current/libgaim/protocols/oscar/peer.c?rev=228#L691\">\u2026</a></th>\n                  <td>\u00a0</td>\n                </tr>\n              </tbody>\n            <tbody class=\"unmod\">\n                  <tr>\n                          <th>640</th><th>691</th><td class=\"l\"><span>&nbsp;* This is a callback function used when we're connecting to a peer</span>\u00a0</td>\n                  </tr><tr>\n                          <th>641</th><th>692</th><td class=\"l\"><span>&nbsp;* using either the client IP or the verified IP and the connection</span>\u00a0</td>\n                  </tr>\n            </tbody><tbody class=\"mod\">\n                      <tr class=\"first\">\n                        <th>642</th><th>\u00a0</th><td class=\"l\"><span>&nbsp;* took longer than <del>1</del>5 seconds to complete.&nbsp; We do this because</span>\u00a0</td>\n                      </tr>\n                      <tr class=\"last\">\n                        <th>\u00a0</th><th>693</th><td class=\"r\"><span>&nbsp;* took longer than <ins></ins>5 seconds to complete.&nbsp; We do this because</span>\u00a0</td>\n                      </tr>\n            </tbody><tbody class=\"unmod\">\n                  <tr>\n                          <th>643</th><th>694</th><td class=\"l\"><span>&nbsp;* waiting for the OS to time out the connection attempt is not</span>\u00a0</td>\n                  </tr><tr>\n                          <th>644</th><th>695</th><td class=\"l\"><span>&nbsp;* practical--the default timeout on many OSes can be 3 minutes or</span>\u00a0</td>\n                  </tr>\n            </tbody>\n              <tbody class=\"skipped\">\n                <tr>\n                  <th><a href=\"/LUCICodeRepository/nomaticIM/browser/vendor/current/libgaim/protocols/oscar/peer.c?rev=65#L654\">\u2026</a></th>\n                  <th><a href=\"/LUCICodeRepository/nomaticIM/browser/vendor/current/libgaim/protocols/oscar/peer.c?rev=228#L705\">\u2026</a></th>\n                  <td>\u00a0</td>\n                </tr>\n              </tbody>\n            <tbody class=\"unmod\">\n                  <tr>\n                          <th>654</th><th>705</th><td class=\"l\"><span>&nbsp;* with very high lag but decent throughput who are transferring</span>\u00a0</td>\n                  </tr><tr>\n                          <th>655</th><th>706</th><td class=\"l\"><span>&nbsp;* large files.&nbsp; But we don't care about those people.</span>\u00a0</td>\n                  </tr>\n            </tbody><tbody class=\"add\">\n                  <tr class=\"first\">\n                          <th>\u00a0</th><th>707</th><td class=\"r\"><ins>&nbsp;*</ins>\u00a0</td>\n                  </tr><tr>\n                          <th>\u00a0</th><th>708</th><td class=\"r\"><ins>&nbsp;* I (Sean) changed the timeout from 15 to 5 seconds, as 60 seconds is</ins>\u00a0</td>\n                  </tr><tr>\n                          <th>\u00a0</th><th>709</th><td class=\"r\"><ins>&nbsp;* too long for a user to wait to send a file. I'm also parallelizing</ins>\u00a0</td>\n                  </tr><tr>\n                          <th>\u00a0</th><th>710</th><td class=\"r\"><ins>&nbsp;* requests when possible. The longest we should have to wait now is 10</ins>\u00a0</td>\n                  </tr><tr class=\"last\">\n                          <th>\u00a0</th><th>711</th><td class=\"r\"><ins>&nbsp;* seconds. We shouldn't make it shorter than this.</ins>\u00a0</td>\n                  </tr>\n            </tbody><tbody class=\"unmod\">\n                  <tr>\n                          <th>656</th><th>712</th><td class=\"l\"><span>&nbsp;*/</span>\u00a0</td>\n                  </tr><tr>\n                          <th>657</th><th>713</th><td class=\"l\"><span>static gboolean</span>\u00a0</td>\n                  </tr>\n            </tbody>\n              <tbody class=\"skipped\">\n                <tr>\n                  <th><a href=\"/LUCICodeRepository/nomaticIM/browser/vendor/current/libgaim/protocols/oscar/peer.c?rev=65#L662\">\u2026</a></th>\n                  <th><a href=\"/LUCICodeRepository/nomaticIM/browser/vendor/current/libgaim/protocols/oscar/peer.c?rev=228#L718\">\u2026</a></th>\n                  <td>\u00a0</td>\n                </tr>\n              </tbody>\n            <tbody class=\"unmod\">\n                  <tr>\n                          <th>662</th><th>718</th><td class=\"l\"><span>&nbsp; &nbsp; &nbsp; &nbsp; conn = data;</span>\u00a0</td>\n                  </tr><tr>\n                          <th>663</th><th>719</th><td class=\"l\"><span></span>\u00a0</td>\n                  </tr>\n            </tbody><tbody class=\"mod\">\n                      <tr class=\"first\">\n                        <th>664</th><th>\u00a0</th><td class=\"l\"><span>&nbsp; &nbsp; &nbsp; &nbsp; gaim_debug_info(\"oscar\", \"Peer connection timed out after <del>1</del>5 seconds.&nbsp; \"</span>\u00a0</td>\n                      </tr>\n                      <tr class=\"last\">\n                        <th>\u00a0</th><th>720</th><td class=\"r\"><span>&nbsp; &nbsp; &nbsp; &nbsp; gaim_debug_info(\"oscar\", \"Peer connection timed out after <ins></ins>5 seconds.&nbsp; \"</span>\u00a0</td>\n                      </tr>\n            </tbody><tbody class=\"unmod\">\n                  <tr>\n                          <th>665</th><th>721</th><td class=\"l\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; \"Trying next method...\\n\");</span>\u00a0</td>\n                  </tr>\n            </tbody><tbody class=\"rem\">\n                  <tr class=\"first\">\n                          <th>666</th><th>\u00a0</th><td class=\"l\"><del></del>\u00a0</td>\n                  </tr><tr class=\"last\">\n                          <th>667</th><th>\u00a0</th><td class=\"l\"><del>&nbsp; &nbsp; &nbsp; &nbsp; peer_connection_close(conn);</del>\u00a0</td>\n                  </tr>\n            </tbody><tbody class=\"unmod\">\n                  <tr>\n                          <th>668</th><th>722</th><td class=\"l\"><span></span>\u00a0</td>\n                  </tr><tr>\n                          <th>669</th><th>723</th><td class=\"l\"><span>&nbsp; &nbsp; &nbsp; &nbsp; peer_connection_trynext(conn);</span>\u00a0</td>\n                  </tr>\n            </tbody>\n              <tbody class=\"skipped\">\n                <tr>\n                  <th><a href=\"/LUCICodeRepository/nomaticIM/browser/vendor/current/libgaim/protocols/oscar/peer.c?rev=65#L690\">\u2026</a></th>\n                  <th><a href=\"/LUCICodeRepository/nomaticIM/browser/vendor/current/libgaim/protocols/oscar/peer.c?rev=228#L744\">\u2026</a></th>\n                  <td>\u00a0</td>\n                </tr>\n              </tbody>\n            <tbody class=\"unmod\">\n                  <tr>\n                          <th>690</th><th>744</th><td class=\"l\"><span></span>\u00a0</td>\n                  </tr><tr>\n                          <th>691</th><th>745</th><td class=\"l\"><span>&nbsp; &nbsp; &nbsp; &nbsp; /*</span>\u00a0</td>\n                  </tr>\n            </tbody><tbody class=\"mod\">\n                      <tr class=\"first\">\n                        <th>692</th><th>\u00a0</th><td class=\"l\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;* 1. Attempt to connect to the remote user using their verifiedip.</span>\u00a0</td>\n                      </tr>\n                      <tr>\n                        <th>\u00a0</th><th>746</th><td class=\"r\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;* 1. Attempt to connect to the remote user using their verifiedip and clientip.</span>\u00a0</td>\n                      </tr><tr>\n                        <th>\u00a0</th><th>747</th><td class=\"r\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;*&nbsp; &nbsp; We try these at the same time and use whichever succeeds first, so we don't</span>\u00a0</td>\n                      </tr><tr class=\"last\">\n                        <th>\u00a0</th><th>748</th><td class=\"r\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;*&nbsp; &nbsp; have to wait for a timeout.</span>\u00a0</td>\n                      </tr>\n            </tbody><tbody class=\"unmod\">\n                  <tr>\n                          <th>693</th><th>749</th><td class=\"l\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;*/</span>\u00a0</td>\n                  </tr>\n            </tbody><tbody class=\"mod\">\n                      <tr class=\"first\">\n                        <th>694</th><th>\u00a0</th><td class=\"l\"><span>&nbsp; &nbsp; &nbsp; &nbsp; if (!(conn-&gt;flags &amp; PEER_CONNECTION_FLAG_TRIED_<del>VERIFIEDIP</del>) &amp;&amp;</span>\u00a0</td>\n                      </tr>\n                      <tr class=\"last\">\n                        <th>\u00a0</th><th>750</th><td class=\"r\"><span>&nbsp; &nbsp; &nbsp; &nbsp; if (!(conn-&gt;flags &amp; PEER_CONNECTION_FLAG_TRIED_<ins>DIRECT</ins>) &amp;&amp;</span>\u00a0</td>\n                      </tr>\n            </tbody><tbody class=\"unmod\">\n                  <tr>\n                          <th>695</th><th>751</th><td class=\"l\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (conn-&gt;verifiedip != NULL) &amp;&amp; (conn-&gt;port != 0) &amp;&amp; (!conn-&gt;use_proxy))</span>\u00a0</td>\n                  </tr><tr>\n                          <th>696</th><th>752</th><td class=\"l\"><span>&nbsp; &nbsp; &nbsp; &nbsp; {</span>\u00a0</td>\n                  </tr>\n            </tbody><tbody class=\"mod\">\n                      <tr class=\"first\">\n                        <th>697</th><th>\u00a0</th><td class=\"l\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; conn-&gt;flags |= PEER_CONNECTION_FLAG_TRIED_<del>VERIFIEDIP</del>;</span>\u00a0</td>\n                      </tr>\n                      <tr class=\"last\">\n                        <th>\u00a0</th><th>753</th><td class=\"r\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; conn-&gt;flags |= PEER_CONNECTION_FLAG_TRIED_<ins>DIRECT</ins>;</span>\u00a0</td>\n                      </tr>\n            </tbody><tbody class=\"unmod\">\n                  <tr>\n                          <th>698</th><th>754</th><td class=\"l\"><span></span>\u00a0</td>\n                  </tr><tr>\n                          <th>699</th><th>755</th><td class=\"l\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (conn-&gt;type == OSCAR_CAPABILITY_DIRECTIM)</span>\u00a0</td>\n                  </tr>\n            </tbody>\n              <tbody class=\"skipped\">\n                <tr>\n                  <th><a href=\"/LUCICodeRepository/nomaticIM/browser/vendor/current/libgaim/protocols/oscar/peer.c?rev=65#L709\">\u2026</a></th>\n                  <th><a href=\"/LUCICodeRepository/nomaticIM/browser/vendor/current/libgaim/protocols/oscar/peer.c?rev=228#L765\">\u2026</a></th>\n                  <td>\u00a0</td>\n                </tr>\n              </tbody>\n            <tbody class=\"unmod\">\n                  <tr>\n                          <th>709</th><th>765</th><td class=\"l\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</span>\u00a0</td>\n                  </tr><tr>\n                          <th>710</th><th>766</th><td class=\"l\"><span></span>\u00a0</td>\n                  </tr>\n            </tbody><tbody class=\"mod\">\n                      <tr class=\"first\">\n                        <th>711</th><th>\u00a0</th><td class=\"l\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; conn-&gt;<del>connect_data = gaim_proxy_connect(</del>account,</span>\u00a0</td>\n                      </tr>\n                      <tr class=\"last\">\n                        <th>\u00a0</th><th>767</th><td class=\"r\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; conn-&gt;<ins>verified_connect_data = gaim_proxy_connect(NULL, </ins>account,</span>\u00a0</td>\n                      </tr>\n            </tbody><tbody class=\"unmod\">\n                  <tr>\n                          <th>712</th><th>768</th><td class=\"l\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; conn-&gt;verifiedip, conn-&gt;port,</span>\u00a0</td>\n                  </tr>\n            </tbody><tbody class=\"mod\">\n                      <tr class=\"first\">\n                        <th>713</th><th>\u00a0</th><td class=\"l\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; peer_connection_established_cb, conn);</span>\u00a0</td>\n                      </tr><tr>\n                        <th>714</th><th>\u00a0</th><td class=\"l\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (conn-&gt;connect_data != NULL)</span>\u00a0</td>\n                      </tr>\n                      <tr>\n                        <th>\u00a0</th><th>769</th><td class=\"r\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; peer_connection_verified_established_cb, conn);</span>\u00a0</td>\n                      </tr><tr>\n                        <th>\u00a0</th><th>770</th><td class=\"r\"><span></span>\u00a0</td>\n                      </tr><tr>\n                        <th>\u00a0</th><th>771</th><td class=\"r\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if ((conn-&gt;verifiedip == NULL) ||</span>\u00a0</td>\n                      </tr><tr>\n                        <th>\u00a0</th><th>772</th><td class=\"r\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; strcmp(conn-&gt;verifiedip, conn-&gt;clientip))</span>\u00a0</td>\n                      </tr><tr>\n                        <th>\u00a0</th><th>773</th><td class=\"r\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {</span>\u00a0</td>\n                      </tr><tr>\n                        <th>\u00a0</th><th>774</th><td class=\"r\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; conn-&gt;client_connect_data = gaim_proxy_connect(NULL, account,</span>\u00a0</td>\n                      </tr><tr>\n                        <th>\u00a0</th><th>775</th><td class=\"r\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; conn-&gt;clientip, conn-&gt;port,</span>\u00a0</td>\n                      </tr><tr>\n                        <th>\u00a0</th><th>776</th><td class=\"r\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; peer_connection_client_established_cb, conn);</span>\u00a0</td>\n                      </tr><tr>\n                        <th>\u00a0</th><th>777</th><td class=\"r\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</span>\u00a0</td>\n                      </tr><tr>\n                        <th>\u00a0</th><th>778</th><td class=\"r\"><span></span>\u00a0</td>\n                      </tr><tr>\n                        <th>\u00a0</th><th>779</th><td class=\"r\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if ((conn-&gt;verified_connect_data != NULL) ||</span>\u00a0</td>\n                      </tr><tr class=\"last\">\n                        <th>\u00a0</th><th>780</th><td class=\"r\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (conn-&gt;client_connect_data != NULL))</span>\u00a0</td>\n                      </tr>\n            </tbody><tbody class=\"unmod\">\n                  <tr>\n                          <th>715</th><th>781</th><td class=\"l\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {</span>\u00a0</td>\n                  </tr><tr>\n                          <th>716</th><th>782</th><td class=\"l\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; /* Connecting... */</span>\u00a0</td>\n                  </tr>\n            </tbody><tbody class=\"mod\">\n                      <tr class=\"first\">\n                        <th>717</th><th>\u00a0</th><td class=\"l\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; conn-&gt;connect_timeout_timer = gaim_timeout_add(<del>1</del>5000,</span>\u00a0</td>\n                      </tr>\n                      <tr class=\"last\">\n                        <th>\u00a0</th><th>783</th><td class=\"r\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; conn-&gt;connect_timeout_timer = gaim_timeout_add(<ins></ins>5000,</span>\u00a0</td>\n                      </tr>\n            </tbody><tbody class=\"unmod\">\n                  <tr>\n                          <th>718</th><th>784</th><td class=\"l\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; peer_connection_tooktoolong, conn);</span>\u00a0</td>\n                  </tr><tr>\n                          <th>719</th><th>785</th><td class=\"l\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return;</span>\u00a0</td>\n                  </tr>\n            </tbody>\n              <tbody class=\"skipped\">\n                <tr>\n                  <th><a href=\"/LUCICodeRepository/nomaticIM/browser/vendor/current/libgaim/protocols/oscar/peer.c?rev=65#L722\">\u2026</a></th>\n                  <th><a href=\"/LUCICodeRepository/nomaticIM/browser/vendor/current/libgaim/protocols/oscar/peer.c?rev=228#L788\">\u2026</a></th>\n                  <td>\u00a0</td>\n                </tr>\n              </tbody>\n            <tbody class=\"unmod\">\n                  <tr>\n                          <th>722</th><th>788</th><td class=\"l\"><span></span>\u00a0</td>\n                  </tr><tr>\n                          <th>723</th><th>789</th><td class=\"l\"><span>&nbsp; &nbsp; &nbsp; &nbsp; /*</span>\u00a0</td>\n                  </tr>\n            </tbody><tbody class=\"mod\">\n                      <tr class=\"first\">\n                        <th>724</th><th>\u00a0</th><td class=\"l\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;* 2. Attempt to connect to the remote user using their clientip.</span>\u00a0</td>\n                      </tr><tr>\n                        <th>725</th><th>\u00a0</th><td class=\"l\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;*/</span>\u00a0</td>\n                      </tr><tr>\n                        <th>726</th><th>\u00a0</th><td class=\"l\"><span>&nbsp; &nbsp; &nbsp; &nbsp; if (!(conn-&gt;flags &amp; PEER_CONNECTION_FLAG_TRIED_CLIENTIP) &amp;&amp;</span>\u00a0</td>\n                      </tr><tr>\n                        <th>727</th><th>\u00a0</th><td class=\"l\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (conn-&gt;clientip != NULL) &amp;&amp; (conn-&gt;port != 0) &amp;&amp; (!conn-&gt;use_proxy))</span>\u00a0</td>\n                      </tr><tr>\n                        <th>728</th><th>\u00a0</th><td class=\"l\"><span>&nbsp; &nbsp; &nbsp; &nbsp; {</span>\u00a0</td>\n                      </tr><tr>\n                        <th>729</th><th>\u00a0</th><td class=\"l\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; conn-&gt;flags |= PEER_CONNECTION_FLAG_TRIED_CLIENTIP;</span>\u00a0</td>\n                      </tr><tr>\n                        <th>730</th><th>\u00a0</th><td class=\"l\"><span></span>\u00a0</td>\n                      </tr><tr>\n                        <th>731</th><th>\u00a0</th><td class=\"l\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if ((conn-&gt;verifiedip == NULL) ||</span>\u00a0</td>\n                      </tr><tr>\n                        <th>732</th><th>\u00a0</th><td class=\"l\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; strcmp(conn-&gt;verifiedip, conn-&gt;clientip))</span>\u00a0</td>\n                      </tr><tr>\n                        <th>733</th><th>\u00a0</th><td class=\"l\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {</span>\u00a0</td>\n                      </tr><tr>\n                        <th>734</th><th>\u00a0</th><td class=\"l\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (conn-&gt;type == OSCAR_CAPABILITY_DIRECTIM)</span>\u00a0</td>\n                      </tr><tr>\n                        <th>735</th><th>\u00a0</th><td class=\"l\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {</span>\u00a0</td>\n                      </tr><tr>\n                        <th>736</th><th>\u00a0</th><td class=\"l\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; gchar *tmp;</span>\u00a0</td>\n                      </tr><tr>\n                        <th>737</th><th>\u00a0</th><td class=\"l\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; GaimConversation *conv;</span>\u00a0</td>\n                      </tr><tr>\n                        <th>738</th><th>\u00a0</th><td class=\"l\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; tmp = g_strdup_printf(_(\"Attempting to connect to %s:%hu.\"),</span>\u00a0</td>\n                      </tr><tr>\n                        <th>739</th><th>\u00a0</th><td class=\"l\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; conn-&gt;clientip, conn-&gt;port);</span>\u00a0</td>\n                      </tr><tr>\n                        <th>740</th><th>\u00a0</th><td class=\"l\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; conv = gaim_conversation_new(GAIM_CONV_TYPE_IM, account, conn-&gt;sn);</span>\u00a0</td>\n                      </tr><tr>\n                        <th>741</th><th>\u00a0</th><td class=\"l\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; gaim_conversation_write(conv, NULL, tmp,</span>\u00a0</td>\n                      </tr><tr>\n                        <th>742</th><th>\u00a0</th><td class=\"l\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; GAIM_MESSAGE_SYSTEM, time(NULL));</span>\u00a0</td>\n                      </tr><tr>\n                        <th>743</th><th>\u00a0</th><td class=\"l\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; g_free(tmp);</span>\u00a0</td>\n                      </tr><tr>\n                        <th>744</th><th>\u00a0</th><td class=\"l\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</span>\u00a0</td>\n                      </tr><tr>\n                        <th>745</th><th>\u00a0</th><td class=\"l\"><span></span>\u00a0</td>\n                      </tr><tr>\n                        <th>746</th><th>\u00a0</th><td class=\"l\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; conn-&gt;connect_data = gaim_proxy_connect(account,</span>\u00a0</td>\n                      </tr><tr>\n                        <th>747</th><th>\u00a0</th><td class=\"l\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; conn-&gt;clientip, conn-&gt;port,</span>\u00a0</td>\n                      </tr><tr>\n                        <th>748</th><th>\u00a0</th><td class=\"l\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; peer_connection_established_cb, conn);</span>\u00a0</td>\n                      </tr><tr>\n                        <th>749</th><th>\u00a0</th><td class=\"l\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (conn-&gt;connect_data != NULL)</span>\u00a0</td>\n                      </tr><tr>\n                        <th>750</th><th>\u00a0</th><td class=\"l\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {</span>\u00a0</td>\n                      </tr><tr>\n                        <th>751</th><th>\u00a0</th><td class=\"l\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; /* Connecting... */</span>\u00a0</td>\n                      </tr><tr>\n                        <th>752</th><th>\u00a0</th><td class=\"l\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; conn-&gt;connect_timeout_timer = gaim_timeout_add(15000,</span>\u00a0</td>\n                      </tr><tr>\n                        <th>753</th><th>\u00a0</th><td class=\"l\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; peer_connection_tooktoolong, conn);</span>\u00a0</td>\n                      </tr><tr>\n                        <th>754</th><th>\u00a0</th><td class=\"l\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return;</span>\u00a0</td>\n                      </tr><tr>\n                        <th>755</th><th>\u00a0</th><td class=\"l\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</span>\u00a0</td>\n                      </tr><tr>\n                        <th>756</th><th>\u00a0</th><td class=\"l\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</span>\u00a0</td>\n                      </tr><tr>\n                        <th>757</th><th>\u00a0</th><td class=\"l\"><span>&nbsp; &nbsp; &nbsp; &nbsp; }</span>\u00a0</td>\n                      </tr><tr>\n                        <th>758</th><th>\u00a0</th><td class=\"l\"><span></span>\u00a0</td>\n                      </tr><tr>\n                        <th>759</th><th>\u00a0</th><td class=\"l\"><span>&nbsp; &nbsp; &nbsp; &nbsp; /*</span>\u00a0</td>\n                      </tr><tr>\n                        <th>760</th><th>\u00a0</th><td class=\"l\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;* 3. Attempt to have the remote user connect to us (using both</span>\u00a0</td>\n                      </tr>\n                      <tr class=\"last\">\n                        <th>\u00a0</th><th>790</th><td class=\"r\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;* 2. Attempt to have the remote user connect to us (using both</span>\u00a0</td>\n                      </tr>\n            </tbody><tbody class=\"unmod\">\n                  <tr>\n                          <th>761</th><th>791</th><td class=\"l\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;*&nbsp; &nbsp; our verifiedip and our clientip).</span>\u00a0</td>\n                  </tr><tr>\n                          <th>762</th><th>792</th><td class=\"l\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;*/</span>\u00a0</td>\n                  </tr>\n            </tbody>\n              <tbody class=\"skipped\">\n                <tr>\n                  <th><a href=\"/LUCICodeRepository/nomaticIM/browser/vendor/current/libgaim/protocols/oscar/peer.c?rev=65#L782\">\u2026</a></th>\n                  <th><a href=\"/LUCICodeRepository/nomaticIM/browser/vendor/current/libgaim/protocols/oscar/peer.c?rev=228#L812\">\u2026</a></th>\n                  <td>\u00a0</td>\n                </tr>\n              </tbody>\n            <tbody class=\"unmod\">\n                  <tr>\n                          <th>782</th><th>812</th><td class=\"l\"><span></span>\u00a0</td>\n                  </tr><tr>\n                          <th>783</th><th>813</th><td class=\"l\"><span>&nbsp; &nbsp; &nbsp; &nbsp; /*</span>\u00a0</td>\n                  </tr>\n            </tbody><tbody class=\"mod\">\n                      <tr class=\"first\">\n                        <th>784</th><th>\u00a0</th><td class=\"l\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;* <del>4</del>. Attempt to have both users connect to an intermediate proxy</span>\u00a0</td>\n                      </tr>\n                      <tr class=\"last\">\n                        <th>\u00a0</th><th>814</th><td class=\"r\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;* <ins>3</ins>. Attempt to have both users connect to an intermediate proxy</span>\u00a0</td>\n                      </tr>\n            </tbody><tbody class=\"unmod\">\n                  <tr>\n                          <th>785</th><th>815</th><td class=\"l\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;*&nbsp; &nbsp; server.</span>\u00a0</td>\n                  </tr><tr>\n                          <th>786</th><th>816</th><td class=\"l\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;*/</span>\u00a0</td>\n                  </tr>\n            </tbody>\n              <tbody class=\"skipped\">\n                <tr>\n                  <th><a href=\"/LUCICodeRepository/nomaticIM/browser/vendor/current/libgaim/protocols/oscar/peer.c?rev=65#L808\">\u2026</a></th>\n                  <th><a href=\"/LUCICodeRepository/nomaticIM/browser/vendor/current/libgaim/protocols/oscar/peer.c?rev=228#L838\">\u2026</a></th>\n                  <td>\u00a0</td>\n                </tr>\n              </tbody>\n            <tbody class=\"unmod\">\n                  <tr>\n                          <th>808</th><th>838</th><td class=\"l\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</span>\u00a0</td>\n                  </tr><tr>\n                          <th>809</th><th>839</th><td class=\"l\"><span></span>\u00a0</td>\n                  </tr>\n            </tbody><tbody class=\"mod\">\n                      <tr class=\"first\">\n                        <th>810</th><th>\u00a0</th><td class=\"l\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; conn-&gt;<del>connect_data = gaim_proxy_connect(</del>account,</span>\u00a0</td>\n                      </tr>\n                      <tr class=\"last\">\n                        <th>\u00a0</th><th>840</th><td class=\"r\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; conn-&gt;<ins>verified_connect_data = gaim_proxy_connect(NULL, </ins>account,</span>\u00a0</td>\n                      </tr>\n            </tbody><tbody class=\"unmod\">\n                  <tr>\n                          <th>811</th><th>841</th><td class=\"l\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (conn-&gt;proxyip != NULL) ? conn-&gt;proxyip : PEER_PROXY_SERVER,</span>\u00a0</td>\n                  </tr><tr>\n                          <th>812</th><th>842</th><td class=\"l\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; PEER_PROXY_PORT,</span>\u00a0</td>\n                  </tr><tr>\n                          <th>813</th><th>843</th><td class=\"l\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; peer_proxy_connection_established_cb, conn);</span>\u00a0</td>\n                  </tr>\n            </tbody><tbody class=\"mod\">\n                      <tr class=\"first\">\n                        <th>814</th><th>\u00a0</th><td class=\"l\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (conn-&gt;<del></del>connect_data != NULL)</span>\u00a0</td>\n                      </tr>\n                      <tr class=\"last\">\n                        <th>\u00a0</th><th>844</th><td class=\"r\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (conn-&gt;<ins>verified_</ins>connect_data != NULL)</span>\u00a0</td>\n                      </tr>\n            </tbody><tbody class=\"unmod\">\n                  <tr>\n                          <th>815</th><th>845</th><td class=\"l\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {</span>\u00a0</td>\n                  </tr><tr>\n                          <th>816</th><th>846</th><td class=\"l\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; /* Connecting... */</span>\u00a0</td>\n                  </tr>\n            </tbody>\n              <tbody class=\"skipped\">\n                <tr>\n                  <th><a href=\"/LUCICodeRepository/nomaticIM/browser/vendor/current/libgaim/protocols/oscar/peer.c?rev=65#L996\">\u2026</a></th>\n                  <th><a href=\"/LUCICodeRepository/nomaticIM/browser/vendor/current/libgaim/protocols/oscar/peer.c?rev=228#L1026\">\u2026</a></th>\n                  <td>\u00a0</td>\n                </tr>\n              </tbody>\n            <tbody class=\"unmod\">\n                  <tr>\n                          <th>996</th><th>1026</th><td class=\"l\"><span></span>\u00a0</td>\n                  </tr><tr>\n                          <th>997</th><th>1027</th><td class=\"l\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; conn-&gt;xfer = gaim_xfer_new(account, GAIM_XFER_RECEIVE, sn);</span>\u00a0</td>\n                  </tr>\n            </tbody><tbody class=\"mod\">\n                      <tr class=\"first\">\n                        <th>998</th><th>\u00a0</th><td class=\"l\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; conn-&gt;xfer-&gt;data = conn;</span>\u00a0</td>\n                      </tr><tr>\n                        <th>999</th><th>\u00a0</th><td class=\"l\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; gaim_xfer_ref(conn-&gt;xfer);</span>\u00a0</td>\n                      </tr><tr>\n                        <th>1000</th><th>\u00a0</th><td class=\"l\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; gaim_xfer_set_size(conn-&gt;xfer, args-&gt;info.sendfile.totsize);</span>\u00a0</td>\n                      </tr><tr>\n                        <th>1001</th><th>\u00a0</th><td class=\"l\"><span></span>\u00a0</td>\n                      </tr><tr>\n                        <th>1002</th><th>\u00a0</th><td class=\"l\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; /* Set the file name */</span>\u00a0</td>\n                      </tr><tr>\n                        <th>1003</th><th>\u00a0</th><td class=\"l\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (g_utf8_validate(args-&gt;info.sendfile.filename, -1, NULL))</span>\u00a0</td>\n                      </tr><tr>\n                        <th>1004</th><th>\u00a0</th><td class=\"l\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; filename = g_strdup(args-&gt;info.sendfile.filename);</span>\u00a0</td>\n                      </tr><tr>\n                        <th>1005</th><th>\u00a0</th><td class=\"l\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; else</span>\u00a0</td>\n                      </tr><tr>\n                        <th>1006</th><th>\u00a0</th><td class=\"l\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; filename = gaim_utf8_salvage(args-&gt;info.sendfile.filename);</span>\u00a0</td>\n                      </tr><tr>\n                        <th>1007</th><th>\u00a0</th><td class=\"l\"><span></span>\u00a0</td>\n                      </tr><tr>\n                        <th>1008</th><th>\u00a0</th><td class=\"l\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (args-&gt;info.sendfile.subtype == AIM_OFT_SUBTYPE_SEND_DIR)</span>\u00a0</td>\n                      </tr><tr>\n                        <th>1009</th><th>\u00a0</th><td class=\"l\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {</span>\u00a0</td>\n                      </tr>\n                      <tr>\n                        <th>\u00a0</th><th>1028</th><td class=\"r\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (conn-&gt;xfer)</span>\u00a0</td>\n                      </tr><tr>\n                        <th>\u00a0</th><th>1029</th><td class=\"r\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {</span>\u00a0</td>\n                      </tr><tr>\n                        <th>\u00a0</th><th>1030</th><td class=\"r\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; conn-&gt;xfer-&gt;data = conn;</span>\u00a0</td>\n                      </tr><tr>\n                        <th>\u00a0</th><th>1031</th><td class=\"r\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; gaim_xfer_ref(conn-&gt;xfer);</span>\u00a0</td>\n                      </tr><tr>\n                        <th>\u00a0</th><th>1032</th><td class=\"r\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; gaim_xfer_set_size(conn-&gt;xfer, args-&gt;info.sendfile.totsize);</span>\u00a0</td>\n                      </tr><tr>\n                        <th>\u00a0</th><th>1033</th><td class=\"r\"><span></span>\u00a0</td>\n                      </tr><tr>\n                        <th>\u00a0</th><th>1034</th><td class=\"r\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; /* Set the file name */</span>\u00a0</td>\n                      </tr><tr>\n                        <th>\u00a0</th><th>1035</th><td class=\"r\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (g_utf8_validate(args-&gt;info.sendfile.filename, -1, NULL))</span>\u00a0</td>\n                      </tr><tr>\n                        <th>\u00a0</th><th>1036</th><td class=\"r\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; filename = g_strdup(args-&gt;info.sendfile.filename);</span>\u00a0</td>\n                      </tr><tr>\n                        <th>\u00a0</th><th>1037</th><td class=\"r\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; else</span>\u00a0</td>\n                      </tr><tr>\n                        <th>\u00a0</th><th>1038</th><td class=\"r\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; filename = gaim_utf8_salvage(args-&gt;info.sendfile.filename);</span>\u00a0</td>\n                      </tr><tr>\n                        <th>\u00a0</th><th>1039</th><td class=\"r\"><span></span>\u00a0</td>\n                      </tr><tr>\n                        <th>\u00a0</th><th>1040</th><td class=\"r\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (args-&gt;info.sendfile.subtype == AIM_OFT_SUBTYPE_SEND_DIR)</span>\u00a0</td>\n                      </tr><tr>\n                        <th>\u00a0</th><th>1041</th><td class=\"r\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {</span>\u00a0</td>\n                      </tr><tr>\n                        <th>\u00a0</th><th>1042</th><td class=\"r\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; /*</span>\u00a0</td>\n                      </tr><tr>\n                        <th>\u00a0</th><th>1043</th><td class=\"r\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;* If they are sending us a directory then the last character</span>\u00a0</td>\n                      </tr><tr>\n                        <th>\u00a0</th><th>1044</th><td class=\"r\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;* of the file name will be an asterisk.&nbsp; We don't want to</span>\u00a0</td>\n                      </tr><tr>\n                        <th>\u00a0</th><th>1045</th><td class=\"r\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;* save stuff to a directory named \"*\" so we remove the</span>\u00a0</td>\n                      </tr><tr>\n                        <th>\u00a0</th><th>1046</th><td class=\"r\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;* asterisk from the file name.</span>\u00a0</td>\n                      </tr><tr>\n                        <th>\u00a0</th><th>1047</th><td class=\"r\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;*/</span>\u00a0</td>\n                      </tr><tr>\n                        <th>\u00a0</th><th>1048</th><td class=\"r\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; char *tmp = strrchr(filename, '\\\\');</span>\u00a0</td>\n                      </tr><tr>\n                        <th>\u00a0</th><th>1049</th><td class=\"r\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if ((tmp != NULL) &amp;&amp; (tmp[1] == '*'))</span>\u00a0</td>\n                      </tr><tr>\n                        <th>\u00a0</th><th>1050</th><td class=\"r\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; tmp[0] = '\\0';</span>\u00a0</td>\n                      </tr><tr>\n                        <th>\u00a0</th><th>1051</th><td class=\"r\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</span>\u00a0</td>\n                      </tr><tr>\n                        <th>\u00a0</th><th>1052</th><td class=\"r\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; gaim_xfer_set_filename(conn-&gt;xfer, filename);</span>\u00a0</td>\n                      </tr><tr>\n                        <th>\u00a0</th><th>1053</th><td class=\"r\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; g_free(filename);</span>\u00a0</td>\n                      </tr><tr class=\"last\">\n                        <th>\u00a0</th><th>1054</th><td class=\"r\"><span></span>\u00a0</td>\n                      </tr>\n            </tbody><tbody class=\"unmod\">\n                  <tr>\n                          <th>1010</th><th>1055</th><td class=\"l\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; /*</span>\u00a0</td>\n                  </tr>\n            </tbody><tbody class=\"mod\">\n                      <tr class=\"first\">\n                        <th>1011</th><th>\u00a0</th><td class=\"l\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;* If they are sending us a directory then the last character</span>\u00a0</td>\n                      </tr><tr>\n                        <th>1012</th><th>\u00a0</th><td class=\"l\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;* of the file name will be an asterisk.&nbsp; We don't want to</span>\u00a0</td>\n                      </tr><tr>\n                        <th>1013</th><th>\u00a0</th><td class=\"l\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;* save stuff to a directory named \"*\" so we remove the</span>\u00a0</td>\n                      </tr><tr>\n                        <th>1014</th><th>\u00a0</th><td class=\"l\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;* asterisk from the file name.</span>\u00a0</td>\n                      </tr>\n                      <tr>\n                        <th>\u00a0</th><th>1056</th><td class=\"r\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;* Set the message, unless this is the dummy message from an</span>\u00a0</td>\n                      </tr><tr>\n                        <th>\u00a0</th><th>1057</th><td class=\"r\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;* ICQ client or an empty message from an AIM client.</span>\u00a0</td>\n                      </tr><tr class=\"last\">\n                        <th>\u00a0</th><th>1058</th><td class=\"r\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;* TODO: Maybe we should strip HTML and then see if strlen&gt;0?</span>\u00a0</td>\n                      </tr>\n            </tbody><tbody class=\"unmod\">\n                  <tr>\n                          <th>1015</th><th>1059</th><td class=\"l\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;*/</span>\u00a0</td>\n                  </tr>\n            </tbody><tbody class=\"mod\">\n                      <tr class=\"first\">\n                        <th>1016</th><th>\u00a0</th><td class=\"l\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; char *tmp = strrchr(filename, '\\\\');</span>\u00a0</td>\n                      </tr><tr>\n                        <th>1017</th><th>\u00a0</th><td class=\"l\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if ((tmp != NULL) &amp;&amp; (tmp[1] == '*'))</span>\u00a0</td>\n                      </tr><tr>\n                        <th>1018</th><th>\u00a0</th><td class=\"l\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; tmp[0] = '\\0';</span>\u00a0</td>\n                      </tr><tr>\n                        <th>1019</th><th>\u00a0</th><td class=\"l\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</span>\u00a0</td>\n                      </tr><tr>\n                        <th>1020</th><th>\u00a0</th><td class=\"l\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; gaim_xfer_set_filename(conn-&gt;xfer, filename);</span>\u00a0</td>\n                      </tr><tr>\n                        <th>1021</th><th>\u00a0</th><td class=\"l\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; g_free(filename);</span>\u00a0</td>\n                      </tr><tr>\n                        <th>1022</th><th>\u00a0</th><td class=\"l\"><span></span>\u00a0</td>\n                      </tr><tr>\n                        <th>1023</th><th>\u00a0</th><td class=\"l\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; /*</span>\u00a0</td>\n                      </tr><tr>\n                        <th>1024</th><th>\u00a0</th><td class=\"l\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;* Set the message (unless this is the dummy message from an</span>\u00a0</td>\n                      </tr><tr>\n                        <th>1025</th><th>\u00a0</th><td class=\"l\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;* ICQ client or an empty message from an AIM client.</span>\u00a0</td>\n                      </tr><tr>\n                        <th>1026</th><th>\u00a0</th><td class=\"l\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;* TODO: Maybe we should strip HTML and then see if strlen&gt;0?</span>\u00a0</td>\n                      </tr><tr>\n                        <th>1027</th><th>\u00a0</th><td class=\"l\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;*/</span>\u00a0</td>\n                      </tr><tr>\n                        <th>1028</th><th>\u00a0</th><td class=\"l\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if ((message != NULL) &amp;&amp;</span>\u00a0</td>\n                      </tr><tr>\n                        <th>1029</th><th>\u00a0</th><td class=\"l\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (g_ascii_strncasecmp(message, \"&lt;ICQ_COOL_FT&gt;\", 13) != 0) &amp;&amp;</span>\u00a0</td>\n                      </tr><tr>\n                        <th>1030</th><th>\u00a0</th><td class=\"l\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (g_ascii_strcasecmp(message, \"&lt;HTML&gt;\") != 0))</span>\u00a0</td>\n                      </tr><tr>\n                        <th>1031</th><th>\u00a0</th><td class=\"l\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {</span>\u00a0</td>\n                      </tr><tr>\n                        <th>1032</th><th>\u00a0</th><td class=\"l\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; gaim_xfer_set_message(conn-&gt;xfer, message);</span>\u00a0</td>\n                      </tr><tr>\n                        <th>1033</th><th>\u00a0</th><td class=\"l\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</span>\u00a0</td>\n                      </tr><tr>\n                        <th>1034</th><th>\u00a0</th><td class=\"l\"><span></span>\u00a0</td>\n                      </tr><tr>\n                        <th>1035</th><th>\u00a0</th><td class=\"l\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; /* Setup our I/O op functions */</span>\u00a0</td>\n                      </tr><tr>\n                        <th>1036</th><th>\u00a0</th><td class=\"l\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; gaim_xfer_set_init_fnc(conn-&gt;xfer, peer_oft_recvcb_init);</span>\u00a0</td>\n                      </tr><tr>\n                        <th>1037</th><th>\u00a0</th><td class=\"l\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; gaim_xfer_set_end_fnc(conn-&gt;xfer, peer_oft_recvcb_end);</span>\u00a0</td>\n                      </tr><tr>\n                        <th>1038</th><th>\u00a0</th><td class=\"l\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; gaim_xfer_set_request_denied_fnc(conn-&gt;xfer, peer_oft_cb_generic_cancel);</span>\u00a0</td>\n                      </tr><tr>\n                        <th>1039</th><th>\u00a0</th><td class=\"l\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; gaim_xfer_set_cancel_recv_fnc(conn-&gt;xfer, peer_oft_cb_generic_cancel);</span>\u00a0</td>\n                      </tr><tr>\n                        <th>1040</th><th>\u00a0</th><td class=\"l\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; gaim_xfer_set_ack_fnc(conn-&gt;xfer, peer_oft_recvcb_ack_recv);</span>\u00a0</td>\n                      </tr><tr>\n                        <th>1041</th><th>\u00a0</th><td class=\"l\"><span></span>\u00a0</td>\n                      </tr><tr>\n                        <th>1042</th><th>\u00a0</th><td class=\"l\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; /* Now perform the request */</span>\u00a0</td>\n                      </tr><tr>\n                        <th>1043</th><th>\u00a0</th><td class=\"l\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; gaim_xfer_request(conn-&gt;xfer);</span>\u00a0</td>\n                      </tr>\n                      <tr>\n                        <th>\u00a0</th><th>1060</th><td class=\"r\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if ((message != NULL) &amp;&amp;</span>\u00a0</td>\n                      </tr><tr>\n                        <th>\u00a0</th><th>1061</th><td class=\"r\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (g_ascii_strncasecmp(message, \"&lt;ICQ_COOL_FT&gt;\", 13) != 0) &amp;&amp;</span>\u00a0</td>\n                      </tr><tr>\n                        <th>\u00a0</th><th>1062</th><td class=\"r\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (g_ascii_strcasecmp(message, \"&lt;HTML&gt;\") != 0))</span>\u00a0</td>\n                      </tr><tr>\n                        <th>\u00a0</th><th>1063</th><td class=\"r\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {</span>\u00a0</td>\n                      </tr><tr>\n                        <th>\u00a0</th><th>1064</th><td class=\"r\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; gaim_xfer_set_message(conn-&gt;xfer, message);</span>\u00a0</td>\n                      </tr><tr>\n                        <th>\u00a0</th><th>1065</th><td class=\"r\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</span>\u00a0</td>\n                      </tr><tr>\n                        <th>\u00a0</th><th>1066</th><td class=\"r\"><span></span>\u00a0</td>\n                      </tr><tr>\n                        <th>\u00a0</th><th>1067</th><td class=\"r\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; /* Setup our I/O op functions */</span>\u00a0</td>\n                      </tr><tr>\n                        <th>\u00a0</th><th>1068</th><td class=\"r\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; gaim_xfer_set_init_fnc(conn-&gt;xfer, peer_oft_recvcb_init);</span>\u00a0</td>\n                      </tr><tr>\n                        <th>\u00a0</th><th>1069</th><td class=\"r\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; gaim_xfer_set_end_fnc(conn-&gt;xfer, peer_oft_recvcb_end);</span>\u00a0</td>\n                      </tr><tr>\n                        <th>\u00a0</th><th>1070</th><td class=\"r\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; gaim_xfer_set_request_denied_fnc(conn-&gt;xfer, peer_oft_cb_generic_cancel);</span>\u00a0</td>\n                      </tr><tr>\n                        <th>\u00a0</th><th>1071</th><td class=\"r\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; gaim_xfer_set_cancel_recv_fnc(conn-&gt;xfer, peer_oft_cb_generic_cancel);</span>\u00a0</td>\n                      </tr><tr>\n                        <th>\u00a0</th><th>1072</th><td class=\"r\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; gaim_xfer_set_ack_fnc(conn-&gt;xfer, peer_oft_recvcb_ack_recv);</span>\u00a0</td>\n                      </tr><tr>\n                        <th>\u00a0</th><th>1073</th><td class=\"r\"><span></span>\u00a0</td>\n                      </tr><tr>\n                        <th>\u00a0</th><th>1074</th><td class=\"r\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; /* Now perform the request */</span>\u00a0</td>\n                      </tr><tr>\n                        <th>\u00a0</th><th>1075</th><td class=\"r\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; gaim_xfer_request(conn-&gt;xfer);</span>\u00a0</td>\n                      </tr><tr class=\"last\">\n                        <th>\u00a0</th><th>1076</th><td class=\"r\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</span>\u00a0</td>\n                      </tr>\n            </tbody><tbody class=\"unmod\">\n                  <tr>\n                          <th>1044</th><th>1077</th><td class=\"l\"><span>&nbsp; &nbsp; &nbsp; &nbsp; }</span>\u00a0</td>\n                  </tr><tr>\n                          <th>1045</th><th>1078</th><td class=\"l\"><span>}</span>\u00a0</td>\n                  </tr>\n            </tbody>\n        </table>\n      </li>\n  </ul>\n</div>\n        <div id=\"help\"><strong>Note:</strong> See <a href=\"/LUCICodeRepository/nomaticIM/wiki/TracChangeset\">TracChangeset</a>\n          for help on using the changeset viewer.</div>\n      </div>\n    </div>\n    <div id=\"altlinks\">\n      <h3>Download in other formats:</h3>\n      <ul>\n        <li class=\"first\">\n          <a rel=\"nofollow\" href=\"?format=diff&amp;new=228\" class=\"diff\">Unified Diff</a>\n        </li><li class=\"last\">\n          <a rel=\"nofollow\" href=\"?format=zip&amp;new=228\" class=\"zip\">Zip Archive</a>\n        </li>\n      </ul>\n    </div>\n    </div>\n    <div id=\"footer\" lang=\"en\" xml:lang=\"en\"><hr />\n      <a id=\"tracpowered\" href=\"http://trac.edgewall.org/\"><img src=\"/LUCICodeRepository/nomaticIM/chrome/common/trac_logo_mini.png\" height=\"30\" width=\"107\" alt=\"Trac Powered\" /></a>\n      <p class=\"left\">Powered by <a href=\"/LUCICodeRepository/nomaticIM/about\"><strong>Trac 1.0.1</strong></a><br />\n        By <a href=\"http://www.edgewall.org/\">Edgewall Software</a>.</p>\n      <p class=\"right\">All content copyright 2007-2008 by LUCI <br /><a href=\"http://luci.ics.uci.edu/\">http://luci.ics.uci.edu/</a></p>\n    </div>\n\t\t<div id=\"sitefooter\">\n\t\t\t<script src=\"http://www.google-analytics.com/urchin.js\" type=\"text/javascript\">\n\t\t\t</script>\n\t\t\t<script type=\"text/javascript\">\n\t\t\t\t_uacct = \"UA-338915-2\";\n\t\t\t\turchinTracker();\n\t\t\t</script>\n\t\t</div>\n\t</body>\n</html>", "id": 40202.0}