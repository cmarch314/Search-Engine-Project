{"text": "Powered by Flamingo Project Fuzzy Keyword Search on Spatial Data The purpose of this demo is to show our solution on how to find relevant answers to mistyped spatial keyword queries It is built using a multimedia metadata collection extracted from Flickr pages called CoPhIR Test Collection We processed the dataset to extract the photos taken in the U S based on their latitude and longitude values Moreover we used the keywords in the title description and tags of a photo as its textual attribute The final dataset had about two million objects Each record had a URL corresponding to the photo or a page including the photo The total data size was about 4 MB Fuzzy Keyword Search on Spatial Data Using the GeoNames Dataset KeywordsLocation Try these Search for girardilli choclates near San Francisco Search for colesium near Los Angeles Search for desnyland hotels near Anaheim Search for google selicon valley near 16 Amphitheatre Parkway Mountain View CA 94 43 For questions about this demo please contact Sattam Alsubaiee ", "_id": "http://jujube.ics.uci.edu/localsearch/fuzzysearch/flickrdemo/", "title": "fuzzy keyword search on spatial data", "html": "<html>\n<head>\n<title>Fuzzy Keyword Search on Spatial Data</title>\n<link rel=\"stylesheet\" type=\"text/css\" href=\"index.css\"/>\n<script src=\"http://maps.google.com/maps?file=api&v=2&key=ABQIAAAAGSAHmR8vkzIZ0Rksq36K2BSkTToH5jpzxmsWG1Lk3cY4JgplhBTmRDKUqcC8Znbt4goQPJxhs3B7fA\" type=\"text/javascript\"></script>\n<script src=\"../ClusterMarker.js\"></script>\n<script type=\"text/javascript\">\n\tvar map;\n\tvar http;\n\tvar cntrPntLat;\n\tvar cntrPntLng;\n\tvar addrsMsg = \"We couldn't understand the location!\";\n\tvar mapType;\n\tvar cluster;\n\tvar startCommunicationTime;\n\tvar stopCommunicationTime;\n\tvar startClientPreprocessingTime;\n\tvar stopClientPreprocessingTime;\n\tvar keywordsSuggestion = \"e.g., ghirardelli chocolates or girardilli choclates\";\n\tvar locationSuggestion = \"e.g., san fransisco, ca\";\n\n\n\tfunction createMarker(point, title, description, tag, kwds, url)\n\t{\n\t\tvar keys = kwds.split(\" \");\n\t\tvar regex = prepareRegex(keys);\t\t\n\t\tvar marker = new GMarker(point, {title:title});\n\n\t\ttitle = highlight(title , regex);\n\t\tdescription = highlight(description , regex);\n\t\ttag = highlight(tag , regex);\n\n\t\tvar firstTab = \"<div class=\\\"infowindow-title\\\">\" + title + \"</div>\" + description;\n\t\tvar secondTab = \"Tags: \" + tag + \"<br><br><a href=\" + url + \">Click here to see the photo</a>\";\n\t\t\n\n\t\tGEvent.addListener(marker, 'click', function() {marker.openInfoWindowTabsHtml([new GInfoWindowTab(\"Description\", \"<div class=\\\"infowindow\\\">\" + firstTab + \"</div>\"), new GInfoWindowTab(\"Tags & URL\", \"<div class=\\\"infowindow\\\">\" + secondTab + \"</div>\")]);});\n\n\t\treturn marker;\n\t};\n\n\tfunction createTabbedMarker(point,html1,html2,label1,label2)\n\t{\n\t\tvar marker = new GMarker(point);\n\t\tGEvent.addListener(marker, \"click\", function() {marker.openInfoWindowTabsHtml([new GInfoWindowTab(label1,html1), new GInfoWindowTab(label2,html2)]);});\n\t\treturn marker;\n\t}\n\n\tfunction onStateChange()\n\t{\n\t\tif (http.readyState == 4)\n\t\t{\n\t\t\tif (http.status == 200)\n\t\t\t{\n\t\t\t\tstopCommunicationTime = (new Date).getTime();\n\t\t\t\tvar startDrawingTime = stopCommunicationTime;\n\t\t\t\tvar objects = http.responseText.split(\"=+=\");\t\n\n\t\t\t\tif (objects.length > 1)\n\t\t\t\t{\n\t\t\t\t\tvar markersArray = [];\n\t\t\t\t\tfor(var i = 0; i < (objects.length) - 1; ++i)\n\t\t\t\t\t{\n\t\t\t\t\t\tvar coordsKwdsUrl = objects[i].split(\"|+|\");\n\t\t\t\t\t\tvar coords = coordsKwdsUrl[0].split(\",\");\n\t\t\t\t\t\tvar title = coordsKwdsUrl[1] + \" \";\n\t\t\t\t\t\tvar description = coordsKwdsUrl[2] + \" \";\n\t\t\t\t\t\tvar tag = coordsKwdsUrl[3] + \" \";\n\t\t\t\t\t\tvar kwds = \" \" + coordsKwdsUrl[4];\n\t\t\t\t\t\tvar url = coordsKwdsUrl[5];\n\n\t\t\t\t\t\ttitle = title.replace(/[\\r\\n]+/g, \"\");\n\t\t\t\t\t\tdescription = description.replace(/[\\r\\n]+/g, \"\");\n\t\t\t\t\t\ttag = tag.replace(/[\\r\\n]+/g, \"\");\n\t\t\t\t\t\tkwds = kwds.replace(/[\\r\\n]+/g, \"\");\n\n\t\t\t\t\t\tvar rand = (Math.random() * 4);\n\t\t\t\t\t\tif (rand > 3.0)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tpoint = new GLatLng(parseFloat(coords[0]) + Math.random() / 5000, parseFloat(coords[1]) + Math.random() / 5000);\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse if (rand > 2.0)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tpoint = new GLatLng(parseFloat(coords[0]) - Math.random() / 5000, parseFloat(coords[1]) - Math.random() / 5000);\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse if (rand > 1.0)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tpoint = new GLatLng(parseFloat(coords[0]) + Math.random() / 5000, parseFloat(coords[1]) - Math.random() / 5000);\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tpoint = new GLatLng(parseFloat(coords[0]) - Math.random() / 5000, parseFloat(coords[1]) + Math.random() / 5000);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tvar marker = createMarker(point, title, description, tag, kwds, url);\n\n\t\t\t\t\t\tmarkersArray.push(marker);\n\t\t\t\t\t}\n\n\t\t\t\t\tcluster.addMarkers(markersArray);\n\t\t\t\t\tcluster.fitMapToMarkers();\t\t\t\t\t\n\n\t\t\t\t\tvar stopDrawingTime = (new Date).getTime();\n\t\t\t\t\tstopClientPreprocessingTime = startCommunicationTime;\n\t\t\t\t\tvar clientPreprocessingTime = stopClientPreprocessingTime - startClientPreprocessingTime;\n\t\t\t\t\tvar searchTime = parseFloat(objects[(objects.length) - 1]);\n\t\t\t\t\tvar drawingTime = stopDrawingTime - startDrawingTime;\n\t\t\t\t\tvar communicationTime = stopCommunicationTime - startCommunicationTime;\n\t\t\t\t\tif (communicationTime > 0)\n\t\t\t\t\t{\n\t\t\t\t\t\tcommunicationTime -= searchTime;\n\t\t\t\t\t}\n\t\t\t\t\tvar totalTime = clientPreprocessingTime + searchTime + drawingTime + communicationTime;\n\t\t\t\t\tdocument.getElementById(\"msg\").innerHTML = \"We found \" + ((objects.length) - 1) + \" matches!\";\n\t\t\t\t\tdocument.getElementById(\"stats\").innerHTML = \"<small>(Client's preprocessing time: \" + clientPreprocessingTime + \"ms, Search time: \" + searchTime.toFixed(2) + \"ms, Drawing time: \" + parseFloat(drawingTime) + \"ms, Communication time: \" + communicationTime.toFixed(2) + \"ms, Total time: \" + totalTime.toFixed(0) + \"ms)</small>\";\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tdocument.getElementById(\"msg\").innerHTML = \"We couldn't find any results matching!\";\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tfunction checkInput()\n\t{\n\t\tif ((document.getElementById(\"kwds\").value == keywordsSuggestion || document.getElementById(\"kwds\").value == \"\") && document.getElementById(\"addrs\").value != locationSuggestion)\n\t\t{\n\t\t\tvar geocoder = new GClientGeocoder();\n\t\t\tvar address = document.getElementById(\"addrs\").value;\n\t\t\tgeocoder.getLocations(address, addAddressToMap);\n\t\t\treturn false;\n\t\t}\n\t\tif (document.getElementById(\"kwds\").value != keywordsSuggestion && document.getElementById(\"addrs\").value != locationSuggestion)\n\t\t{\n\t\t\treturn true;\n\t\t}\n\t}\n\n\tfunction prepareRegex(keys)\n\t{\n\t\tvar regex = \"([^A-Za-z0-9_&</])(\\\\b\";\n\t\tvar j = 0;\n\n\t\tfor(var k = 0; k < keys.length; ++k)\n\t\t{\n\t\t\tif(keys[k].length)\n\t\t\t{\n\t\t\t        keys[k] = keys[k].replace(/,/g, \"\");\n\t\t\t        keys[k] = keys[k].replace(/\\?/g, \"\");\n\t\t\t\tkeys[k] = keys[k].replace(/\\./g, \"\");\n\t\t\t\tif(j && j < (keys.length - 1))\n\t\t\t\t{\n\t\t\t\t\tregex += \"\\\\b|\\\\b\";\n\t\t\t\t}\n\t\t\t\tregex += keys[k].replace(/\\W/g, function(sub){return \"\\\\\" + sub;});\n\t\t\t\t++j;\n\t\t\t}\n\t\t}\n\t\tregex += \"\\\\b)\";\n\t\tregex = regex.replace(/[\\r\\n]+/g, \"\");\n\t\treturn new RegExp(regex, \"gi\");\n\t}\n\n\tfunction highlight(string, regexp)\n\t{\n\t\tif(regexp == null)\n\t\t\treturn string;\n\t\tstring = \" \" + string; \n\t\tvar nstr = string.replace(regexp, function(sub, m1, m2)\n\t\t\t\t\t\t{\n\t\t\t\t\t\treturn m1 + \"<b>\" + m2 + \"</b>\";\n\t\t\t\t\t\t});\n\t\treturn nstr;\n\t}\n\n\tfunction startSearch()\n\t{\n\t\tstartClientPreprocessingTime = (new Date).getTime();\n\t\tcluster.removeMarkers();\n\t\tmap.clearOverlays();\n\n\t\tdocument.getElementById(\"msg\").innerHTML = \"&nbsp;\";\n\t\tdocument.getElementById(\"stats\").innerHTML = \"&nbsp;\";\n\t\tif (checkInput() == true)\n\t\t{\n\t\t\tif (window.XMLHttpRequest)\n\t\t\t{\n\t\t\t\thttp = new XMLHttpRequest();\n\t\t\t}\n\t\t\telse if (window.ActiveXObject)\n\t\t\t{\n\t\t\t\thttp = new ActiveXObject(\"Microsoft.XMLHTTP\");\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tdocument.getElementById(\"msg\").innerHTML =\"Your browser does not support XMLHTTP!\";\n\t\t\t}\n\t\t\thttp.onreadystatechange = onStateChange;\n\t\t\t\n\t\t\tvar geocoder = new GClientGeocoder();\n\t\t\tgeocoder.getLatLng(document.getElementById(\"addrs\").value,\n\t\t\t\tfunction(point)\n\t\t\t\t{\n\t\t\t\t\tif (!point)\n\t\t\t\t\t{\n\t\t\t\t\t\tdocument.getElementById(\"msg\").innerHTML = addrsMsg;\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tcntrPntLat = point.lat();\n\t\t\t\t\t\tcntrPntLng = point.lng();\n\t\t\t\t\t\tvar query = \"/localsearch/fuzzysearch/flickr?kwds=\" + document.getElementById(\"kwds\").value + \"&lat=\" + cntrPntLat+ \"&lng=\" + cntrPntLng;\t\n\t\t\t\t\t\tstartCommunicationTime = (new Date).getTime();\n\t\t\t\t\t\thttp.open(\"get\", query);\n\t\t\t\t\t\thttp.send(null);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t);\n\t\t}\n\t\tvar currentType = map.getCurrentMapType().getName(true);\n\t\tif (currentType == \"Map\")\n\t\t{\n\t\t\tmapType = G_NORMAL_MAP;\n\t\t}\n\t\telse if (currentType == \"Sat\")\n\t\t{\n\t\t\tmapType = G_SATELLITE_MAP;\n\t\t}\n\t\telse if (currentType == \"Hyb\")\n\t\t{\n\t\t\tmapType = G_HYBRID_MAP;\n\t\t}\n\t\telse if (currentType == \"Ter\")\n\t\t{\n\t\t\tmapType = G_PHYSICAL_MAP;\n\t\t}\n\t}\n\n\tfunction addAddressToMap(response)\n\t{\n\t\tif (!response || response.Status.code != 200)\n\t\t{\n\t\t\tdocument.getElementById(\"msg\").innerHTML = addrsMsg;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tplace = response.Placemark[0];\n\t\t\tpoint = new GLatLng(place.Point.coordinates[1], place.Point.coordinates[0]);\n\t\t\tvar marker = createMarker(point, place.address);\n\t\t\tmap.addOverlay(marker);\n\t\t\tmap.setCenter(point, 10, G_NORMAL_MAP);\n\t\t}\n\t}\n\n\tfunction load()\n\t{\n\t\tif (GBrowserIsCompatible())\n\t\t{\n\t\t\tmap = new GMap2(document.getElementById(\"map\"));\n\t\t\tmap.addControl(new GLargeMapControl());\n\t\t\tmap.addControl(new GMapTypeControl());\n\t\t\tmap.addControl(new GScaleControl());\n\t\t\tmap.setCenter(new GLatLng(37.0625, -95.6770), 4, G_NORMAL_MAP);\n\t\t\tmap.enableScrollWheelZoom();\n\t\t\tmap.addMapType(G_PHYSICAL_MAP);\n\t\t\tcluster = new ClusterMarker(map);\n\t\t\tcluster.clusterMarkerTitle = 'Click to zoom in and see %count objects';\n\t\t}\n         \tdocument.getElementById(\"kwds\").value = \"\";\n\t\tdocument.getElementById(\"addrs\").value = \"\";\n\t\taddKeywordsSuggestion();\n\t\taddLocationSuggestion();\n\t}\n\t\n\tfunction checkEnter(e)\n\t{\n\t\tvar characterCode;\n\t\tif(e && e.which)\n\t\t{\n\t\t\te = e;\n\t\t\tcharacterCode = e.which;\n\t\t}\n\t\telse\n\t\t{\n\t\t\te = event;\n\t\t\tcharacterCode = e.keyCode;\n\t\t}\t \n\t\tif(characterCode == 13)\n\t\t{\n\t\t\tstartSearch();\n\t\t}\n\t}\n\n\tfunction startExample(kwds, addrs)\n\t{\n\t\tdocument.getElementById(\"kwds\").value = kwds;\n\t\tdocument.getElementById(\"addrs\").value = addrs;\n\t\tdocument.getElementById(\"kwds\").style.color = '#000000';\n\t\tdocument.getElementById(\"addrs\").style.color = '#000000';\n\t\t\n\t\tstartSearch();\n\t}\n\n\tfunction addKeywordsSuggestion()\n\t{\n\t\tif (document.getElementById(\"kwds\").value == \"\")\n\t\t{ \n\t\t\tdocument.getElementById(\"kwds\").value = keywordsSuggestion;\n\t\t\tdocument.getElementById(\"kwds\").style.color = '#A8A8A8';\n\t\t}\n\t}\n\t\n\tfunction addLocationSuggestion()\n\t{\n\t\tif (document.getElementById(\"addrs\").value == \"\")\n\t\t{\n\t\t\tdocument.getElementById(\"addrs\").value = locationSuggestion;\n\t\t\tdocument.getElementById(\"addrs\").style.color = '#A8A8A8';\n\t\t}\n\t}\n\n\tfunction removeKeywordsSuggestion()\n\t{\n\t\tif (document.getElementById(\"kwds\").value == keywordsSuggestion)\n\t\t{\n\t\t\tdocument.getElementById(\"kwds\").value = \"\";\n\t\t\tdocument.getElementById(\"kwds\").style.color = '#000000';\n\t\t}\n\t}\n\t\n\tfunction removeLocationSuggestion()\n\t{\n\t\tif (document.getElementById(\"addrs\").value == locationSuggestion)\n\t\t{\n\t\t\tdocument.getElementById(\"addrs\").value = \"\";\n\t\t\tdocument.getElementById(\"addrs\").style.color = '#000000';\n\t\t}\n\t}\n\n</script>\n</head>\n\n<body onload=\"load()\" onunload=\"GUnload()\">\n<div id=\"container\">\n<div id = \"links\" style=\"position:absolute;right:13px;top:7px;\"><a href='http://flamingo.ics.uci.edu/'>Powered by Flamingo Project</a></div> \n<div id=\"body\"> \n<div id=\"header\"> \n\t<h1>Fuzzy Keyword Search on Spatial Data</h1>\n</div>\n</div>\n\t<br/>\n\t<div id=\"body\"> \n\tThe purpose of this demo is to show our solution on how to find relevant answers to mistyped spatial-keyword queries. It is built using a multimedia metadata collection extracted from Flickr pages, called <a href=\"http://cophir.isti.cnr.it/\">CoPhIR Test Collection</a> We processed the dataset to extract the photos taken in the U.S. based on their latitude and longitude values. Moreover, we used the keywords in the title, description, and tags of a photo as its textual attribute. The final dataset had about two million objects. Each record had a URL corresponding to the photo or a page including the photo. The total data size was about 400MB. \n<br><br>\n<a href='http://jujube.ics.uci.edu/localsearch/fuzzysearch/geonamesdemo/'>Fuzzy Keyword Search on Spatial Data Using the GeoNames Dataset</a>\n\t</div>\n\t<div id=\"body\"> \n\t<div class=\"break\"></div> \n\t</div>\n\t<table>\n\t<tr>\n\t<td>Keywords</td>\n\t<td><input type=\"text\" id=\"kwds\" name=\"kwds\" class=\"textbox-standard\" onKeyPress=\"checkEnter(event)\" onblur=\"addKeywordsSuggestion()\" onfocus=\"removeKeywordsSuggestion()\"/></td>\n\t</tr>\n\t<tr> \n\t<td>Location</td>\n\t<td><input type=\"text\" id=\"addrs\" name=\"addrs\" class=\"textbox-standard\" onKeyPress=\"checkEnter(event)\" onblur=\"addLocationSuggestion()\" onfocus=\"removeLocationSuggestion()\"/></td>\n\t</tr>\n\t</table>\n\t<input type=\"button\" name=\"button\" value=\"Search\" onClick=\"startSearch()\">\n\t<br/>\n\t<br/>\n\n\t<div id=\"msg\">&nbsp;</div>\n\t\n\t<div id=\"map\"></div>\n\t<br/>\n\t<div id=\"examples\">\n\t<b>Try these:</b><br/>\n\t<a href=\"javascript:void(0)\" onclick=\"startExample('girardilli choclates', 'San Francisco');return false;\">Search for \"girardilli choclates\" near San Francisco</a><br/>\n\t<a href=\"javascript:void(0)\" onclick=\"startExample('colesium', 'Los Angeles');return false;\">Search for \"colesium\" near Los Angeles</a><br/>\n\t<a href=\"javascript:void(0)\" onclick=\"startExample('desnyland hotels', 'Anaheim');return false;\">Search for \"desnyland hotels\" near Anaheim</a><br/>\n\t<a href=\"javascript:void(0)\" onclick=\"startExample('google selicon valley', '1600 Amphitheatre Parkway Mountain View, CA 94043');return false;\">Search for \"google selicon valley\" near 1600 Amphitheatre Parkway Mountain View, CA 94043</a><br/>\n\t</div>\n\t<br/>\n\t<hr/>\n\t<div id=\"stats\" >&nbsp;</div>\n\t<div id=\"body\"> \n\t<div class=\"break\"></div> \n\t</div>\n          <div id = \"links\" >For questions about this demo, please\n            contact <a href=\"http://www.ics.uci.edu/~salsubai/\">Sattam Alsubaiee.</a> \n          </div> \n</div>\n</body>\n</html>\n\n", "id": 2692.0}