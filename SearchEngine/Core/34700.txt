{"text": "Search LoginPreferencesHelp GuideAbout Trac WikiTimelineRoadmapBrowse SourceView TicketsSearch wiki TracRepositoryAdmin Context Navigation Start PageIndexHistory Repository Administration Quick start Specifying repositories In trac ini In the database Repository synchronization Mercurial Repositories Explicit synchronization Per request synchronization Migration from a single repository setup Subversion Migration from a single repository setup Mercurial Troubleshooting My trac post commit hook doesn t work anymore Quick start Manage repositories in the Repository admin panel with trac admin or in the repositories section of trac ini Set up a call to trac admin ENV changeset added REPO REV in the post commit hook of each repository Additionally add a call to trac admin ENV changeset modified REPO REV in the post revprop change hook of repositories allowing revision property changes Set the trac repository sync per request option to an empty value to disable per request syncing Make sure the user under which your Subversion hooks are run has write access to the Trac environment or use a tool like sudo to temporarily elevate privileges Specifying repositories Starting with 12 Trac can handle more than one repository per environment The pre 12 way of specifying the repository with the repository dir and repository type options in the trac section of trac ini is still supported but two new mechanisms allow including additional repositories into an environment It is also possible to define aliases of repositories that act as pointers to real repositories This can be useful when renaming a repository to avoid breaking all the links to the old name A number of attributes can be associated with each repository which define the repository s location type name and how it is displayed in the source browser The following attributes are supported Attribute Description alias A repository having an alias attribute is an alias to a real repository All TracLinks referencing the alias resolve to the aliased repository Note that multiple indirection is not supported so an alias must always point to a real repository The alias and dir attributes are mutually exclusive description The text specified in the description attribute is displayed below the top level entry for the repository in the source browser It supports WikiFormatting dir The dir attribute specifies the location of the repository in the filesystem It corresponds to the value previously specified in the option trac repository dir The alias and dir attributes are mutually exclusive hidden When set to true the repository is hidden from the repository index page in the source browser Browsing the repository is still possible and links referencing the repository remain valid name The name attribute specifies the leading path element to the repository type The type attribute sets the type of version control system used by the repository Trac supports Subversion out of the box and plugins add support for many other systems If type is not specified it defaults to the value of the trac repository type option url The url attribute specifies the root URL to be used for checking out from the repository When specified a Repository URL link is added to the context navigation links in the source browser that can be copied into the tool used for creating the working copy The name attribute and one of alias or dir are mandatory All others are optional After adding a repository the cache for that repository must be re synchronized once with the trac admin ENV repository resync command repository resync repos Re synchronize Trac with a repository In trac ini Repositories and repository attributes can be specified in the repositories section of trac ini Every attribute consists of a key structured as name attribute and the corresponding value separated with an equal sign The name of the default repository is empty The main advantage of specifying repositories in trac ini is that they can be inherited from a global configuration see the global configuration section of TracIni One drawback is that due to limitations in the ConfigParser class used to parse trac ini the repository name is always all lowercase The following example defines two Subversion repositories named project and lib and a hidden alias to project as the default repository This is a typical use case where a Trac environment previously had a single repository the project repository and was converted to multiple repositories The alias ensures that links predating the change continue to resolve to the project repository repositories project dir var repos project project description This is the main project repository project type svn project url http example com svn project lib dir var repos lib lib description This is the secondary library code lib type svn lib url http example com svn lib alias project hidden true Note that name alias target makes name an alias for the target repo not the other way around In the database Repositories can also be specified in the database using either the Repositories admin panel under Version Control or the trac admin ENV repository commands The admin panel shows the list of all repositories defined in the Trac environment It allows adding repositories and aliases editing repository attributes and removing repositories Note that repositories defined in trac ini are displayed but cannot be edited The following trac admin commands can be used to perform repository operations from the command line repository add repos dir type Add a repository repos located at dir and optionally specify its type repository alias name target Create an alias name for the repository target repository remove repos Remove the repository repos repository set repos key value Set the attribute key to value for the repository repos Note that the default repository has an empty name so it will likely need to be quoted when running trac admin from a shell Alternatively the name default can be used instead for example when running trac admin in interactive mode Repository synchronization Prior to 12 Trac synchronized its cache with the repository on every HTTP request This approach is not very efficient and not practical anymore with multiple repositories For this reason explicit synchronization through post commit hooks was added There is also new functionality in the form of a repository listener extension point IRepositoryChangeListener that is triggered by the post commit hook when a changeset is added or modified and can be used by plugins to perform actions on commit Mercurial Repositories Please note that at the time of writing no initial resynchronization or any hooks are necessary for Mercurial repositories see 9485 for more information Explicit synchronization This is the preferred method of repository synchronization It requires setting the trac repository sync per request option in trac ini to an empty value and adding a call to trac admin in the post commit hook of each repository Additionally if a repository allows changing revision metadata a call to trac admin must be added to the post revprop change hook as well changeset added repos rev Notify Trac that one or more changesets have been added to a repository changeset modified repos rev Notify Trac that metadata on one or more changesets in a repository has been modified The repos argument can be either a repository name use default for the default repository or the path to the repository Note that you may have to set the environment variable PYTHON EGG CACHE to the same value as was used for the web server configuration before calling trac admin if you changed it from its default location See Trac Plugins for more information The following examples are complete post commit and post revprop change scripts for Subversion They should be edited for the specific environment marked executable where applicable and placed in the hooks directory of each repository On Unix post commit bin sh export PYTHON EGG CACHE path to dir usr bin trac admin path to env changeset added 1 2 On Windows post commit cmd C Python26 Scripts trac admin exe C path to env changeset added 1 2 The post revprop change hook for Subversion is very similar On Unix post revprop change bin sh export PYTHON EGG CACHE path to dir usr bin trac admin path to env changeset modified 1 2 On Windows post revprop change cmd C Python26 Scripts trac admin exe C path to env changeset modified 1 2 The Unix variants above assume that the user running the Subversion commit has write access to the Trac environment which is the case in the standard configuration where both the repository and Trac are served by the web server If you access the repository through another means for example svn ssh you may have to run trac admin with different privileges for example by using sudo Note that calling trac admin in your Subversion hooks can slow down the commit and log editing operations on the client side You might want to use the contrib trac svn hook script which starts trac admin in an asynchronous way The script also comes with a number of safety checks and usage advices which should make it easier to set up and test your hooks There s no equivalent trac svn hook bat for Windows yet but the script can be run by Cygwin s bash See the section about hooks in the Subversion book for more information Other repository types will require different hook setups Please see the plugin documentation for specific instructions Per request synchronization If the post commit hooks are not available the environment can be set up for per request synchronization In that case the trac repository sync per request option in trac ini must be set to a comma separated list of repository names to be synchronized Note that in this case the changeset listener extension point is not called and therefore plugins using it will not work correctly Migration from a single repository setup Subversion The following procedure illustrates a typical migration from a Subversion single repository setup to multiple repositories Remove the default repository specification from the trac repository dir option Add the main repository as a named repository Re synchronize the main repository Set up post commit and post revprop change hooks on the main repository and set trac repository sync per request to an empty value Add a hidden alias to the main repository as the default repository This ensures that all links predating the migration still resolve to the main repository Repeat steps 2 3 and 4 to add other named repositories as needed Migration from a single repository setup Mercurial The following procedure illustrates a typical migration from a Mercurial single repository setup to multiple repositories Please note that at the time of writing no initial resynchronization or any hooks are necessary for Mercurial repositories see 9485 for more information Upgrade to the latest version of the TracMercurial plugin Remove the default repository specification from the trac repository dir option Add the main repository as a named repository Add a hidden alias to the main repository as the default repository This ensures that all links predating the migration still resolve to the main repository Repeat step 3 to add other named repositories as needed Troubleshooting My trac post commit hook doesn t work anymore You must now use the optional components from tracopt ticket commit updater which you can activate through the Plugins panel in the Administrative part of the web interface or by directly modifying the components section in the trac ini Be sure to use explicit synchronization as explained above Last modified 3 years ago Last modified on Jan 3 2 12 12 53 27 PM Download in other formats Plain Text Powered by Trac 1 1 By Edgewall Software All content copyright 2 7 2 8 by LUCI http luci ics uci edu ", "_id": "http://djp3-pc2.ics.uci.edu/LUCICodeRepository/nomaticIM/wiki/TracRepositoryAdmin", "title": "\n      tracrepositoryadmin \u2013 nomatic*im\n    ", "html": "<!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Strict//EN\" \"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd\">\n<html xmlns=\"http://www.w3.org/1999/xhtml\">\n  \n  \n\n  \n\n\n  <head>\n\t\t<title>\n      TracRepositoryAdmin \u2013 Nomatic*IM\n    </title><meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\" /><meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge\" /><link rel=\"search\" href=\"/LUCICodeRepository/nomaticIM/search\" /><link rel=\"help\" href=\"/LUCICodeRepository/nomaticIM/wiki/TracGuide\" /><link rel=\"alternate\" href=\"/LUCICodeRepository/nomaticIM/wiki/TracRepositoryAdmin?format=txt\" type=\"text/x-trac-wiki\" title=\"Plain Text\" /><link rel=\"start\" href=\"/LUCICodeRepository/nomaticIM/wiki\" /><link rel=\"stylesheet\" href=\"/LUCICodeRepository/nomaticIM/chrome/common/css/trac.css\" type=\"text/css\" /><link rel=\"stylesheet\" href=\"/LUCICodeRepository/nomaticIM/chrome/common/css/wiki.css\" type=\"text/css\" /><link rel=\"shortcut icon\" href=\"http://luci.ics.uci.edu/logo32by32.gif\" type=\"image/gif\" /><link rel=\"icon\" href=\"http://luci.ics.uci.edu/logo32by32.gif\" type=\"image/gif\" /><link type=\"application/opensearchdescription+xml\" rel=\"search\" href=\"/LUCICodeRepository/nomaticIM/search/opensearch\" title=\"Search Nomatic*IM\" /><script type=\"text/javascript\" charset=\"utf-8\" src=\"/LUCICodeRepository/nomaticIM/chrome/common/js/jquery.js\"></script><script type=\"text/javascript\" charset=\"utf-8\" src=\"/LUCICodeRepository/nomaticIM/chrome/common/js/babel.js\"></script><script type=\"text/javascript\" charset=\"utf-8\" src=\"/LUCICodeRepository/nomaticIM/chrome/common/js/messages/en_US.js\"></script><script type=\"text/javascript\" charset=\"utf-8\" src=\"/LUCICodeRepository/nomaticIM/chrome/common/js/trac.js\"></script><script type=\"text/javascript\" charset=\"utf-8\" src=\"/LUCICodeRepository/nomaticIM/chrome/common/js/search.js\"></script><script type=\"text/javascript\" charset=\"utf-8\" src=\"/LUCICodeRepository/nomaticIM/chrome/common/js/folding.js\"></script><meta name=\"ROBOTS\" content=\"NOINDEX, NOFOLLOW\" /><link rel=\"alternate\" type=\"application/x-wiki\" href=\"/LUCICodeRepository/nomaticIM/wiki/TracRepositoryAdmin?action=edit\" title=\"Edit this page\" /><script type=\"text/javascript\">\n      jQuery(document).ready(function($) {\n        $(\"#content\").find(\"h1,h2,h3,h4,h5,h6\").addAnchor(_(\"Link to this section\"));\n        $(\"#content\").find(\".wikianchor\").each(function() {\n          $(this).addAnchor(babel.format(_(\"Link to #%(id)s\"), {id: $(this).attr('id')}));\n        });\n        $(\".foldable\").enableFolding(true, true);\n      });\n    </script>\n\t</head>\n  <body>\n    <div id=\"banner\">\n      <div id=\"header\">\n        <a id=\"logo\" href=\"http://luci.ics.uci.edu/#code\"><img src=\"http://luci.ics.uci.edu/blog/archives/LUCIhorzTight.jpg\" alt=\"LUCI Code Repository\" /></a>\n      </div>\n      <form id=\"search\" action=\"/LUCICodeRepository/nomaticIM/search\" method=\"get\">\n        <div>\n          <label for=\"proj-search\">Search:</label>\n          <input type=\"text\" id=\"proj-search\" name=\"q\" size=\"18\" value=\"\" />\n          <input type=\"submit\" value=\"Search\" />\n        </div>\n      </form>\n      <div id=\"metanav\" class=\"nav\">\n    <ul>\n      <li class=\"first\"><a href=\"/LUCICodeRepository/nomaticIM/login\">Login</a></li><li><a href=\"/LUCICodeRepository/nomaticIM/prefs\">Preferences</a></li><li><a href=\"/LUCICodeRepository/nomaticIM/wiki/TracGuide\">Help/Guide</a></li><li class=\"last\"><a href=\"/LUCICodeRepository/nomaticIM/about\">About Trac</a></li>\n    </ul>\n  </div>\n    </div>\n    <div id=\"mainnav\" class=\"nav\">\n    <ul>\n      <li class=\"first active\"><a href=\"/LUCICodeRepository/nomaticIM/wiki\">Wiki</a></li><li><a href=\"/LUCICodeRepository/nomaticIM/timeline\">Timeline</a></li><li><a href=\"/LUCICodeRepository/nomaticIM/roadmap\">Roadmap</a></li><li><a href=\"/LUCICodeRepository/nomaticIM/browser\">Browse Source</a></li><li><a href=\"/LUCICodeRepository/nomaticIM/report\">View Tickets</a></li><li class=\"last\"><a href=\"/LUCICodeRepository/nomaticIM/search\">Search</a></li>\n    </ul>\n  </div>\n    <div id=\"main\">\n      <div id=\"pagepath\" class=\"noprint\">\n  <a class=\"pathentry first\" title=\"View WikiStart\" href=\"/LUCICodeRepository/nomaticIM/wiki\">wiki:</a><a class=\"pathentry\" href=\"/LUCICodeRepository/nomaticIM/wiki/TracRepositoryAdmin\" title=\"View TracRepositoryAdmin\">TracRepositoryAdmin</a>\n</div>\n      <div id=\"ctxtnav\" class=\"nav\">\n        <h2>Context Navigation</h2>\n        <ul>\n          <li class=\"first\"><a href=\"/LUCICodeRepository/nomaticIM/wiki/WikiStart\">Start Page</a></li><li><a href=\"/LUCICodeRepository/nomaticIM/wiki/TitleIndex\">Index</a></li><li class=\"last\"><a href=\"/LUCICodeRepository/nomaticIM/wiki/TracRepositoryAdmin?action=history\">History</a></li>\n        </ul>\n        <hr />\n      </div>\n    <div id=\"content\" class=\"wiki\">\n      <div class=\"wikipage searchable\">\n        \n          <div id=\"wikipage\" class=\"trac-content\"><h1 id=\"RepositoryAdministration\">Repository Administration</h1>\n<p>\n</p><div class=\"wiki-toc\">\n    <ol>\n      <li>\n        <a href=\"#QuickStart\">Quick start</a>\n      </li>\n      <li>\n        <a href=\"#Repositories\">Specifying repositories</a>\n        <ol>\n          <li>\n            <a href=\"#ReposTracIni\">In <tt>trac.ini</tt></a>\n          </li>\n          <li>\n            <a href=\"#ReposDatabase\">In the database</a>\n          </li>\n        </ol>\n      </li>\n      <li>\n        <a href=\"#Synchronization\">Repository synchronization</a>\n        <ol>\n          <li>\n            <a href=\"#MercurialRepositories\">Mercurial Repositories</a>\n          </li>\n          <li>\n            <a href=\"#ExplicitSync\">Explicit synchronization</a>\n          </li>\n          <li>\n            <a href=\"#PerRequestSync\">Per-request synchronization</a>\n          </li>\n        </ol>\n      </li>\n      <li>\n        <a href=\"#Migration\">Migration from a single-repository setup (Subversion)</a>\n      </li>\n      <li>\n        <a href=\"#MigrationMercurial\">Migration from a single-repository setup (Mercurial)</a>\n      </li>\n      <li>\n        <a href=\"#Troubleshooting\">Troubleshooting</a>\n        <ol>\n          <li>\n            <a href=\"#trac-post-commit-hook\">My trac-post-commit-hook doesn't work anymore</a>\n          </li>\n        </ol>\n      </li>\n    </ol>\n</div><p>\n</p>\n<h2 id=\"QuickStart\">Quick start</h2>\n<ul><li>Manage repositories in the \"Repository\" admin panel, with <tt>trac-admin</tt> or in the <tt>[repositories]</tt> section of <a class=\"wiki\" href=\"/LUCICodeRepository/nomaticIM/wiki/TracIni#repositories-section\">trac.ini</a>.\n</li><li>Set up a call to <tt>trac-admin $ENV changeset added $REPO $REV</tt> in the post-commit hook of each repository. Additionally, add a call to <tt>trac-admin $ENV changeset modified $REPO $REV</tt> in the post-revprop-change hook of repositories allowing revision property changes.\n</li><li>Set the <tt>[trac] repository_sync_per_request</tt> option to an empty value to disable per-request syncing.\n</li><li>Make sure the user under which your Subversion hooks are run has write access to the Trac environment, or use a tool like <tt>sudo</tt> to temporarily elevate privileges.\n</li></ul><h2 id=\"Repositories\">Specifying repositories</h2>\n<p>\nStarting with 0.12, Trac can handle more than one repository per environment. The pre-0.12 way of specifying the repository with the <tt>repository_dir</tt> and <tt>repository_type</tt> options in the <tt>[trac]</tt> section of <a class=\"wiki\" href=\"/LUCICodeRepository/nomaticIM/wiki/TracIni\">trac.ini</a> is still supported, but two new mechanisms allow including additional repositories into an environment.\n</p>\n<p>\nIt is also possible to define aliases of repositories, that act as \"pointers\" to real repositories. This can be useful when renaming a repository, to avoid breaking all the links to the old name.\n</p>\n<p>\nA number of attributes can be associated with each repository, which define the repository's location, type, name and how it is displayed in the source browser. The following attributes are supported:\n</p>\n<table class=\"wiki\">\n<tr><th style=\"text-align: left\"><strong>Attribute</strong> </th><th style=\"text-align: left\"><strong>Description</strong> \n</th></tr><tr><td style=\"text-align: left\"><tt>alias</tt> \n</td><td style=\"text-align: left\">A repository having an <tt>alias</tt> attribute is an alias to a real repository. All <a class=\"wiki\" href=\"/LUCICodeRepository/nomaticIM/wiki/TracLinks\">TracLinks</a> referencing the alias resolve to the aliased repository. Note that multiple indirection is not supported, so an alias must always point to a real repository. The <tt>alias</tt> and <tt>dir</tt> attributes are mutually exclusive. \n</td></tr><tr><td style=\"text-align: left\"><tt>description</tt> \n</td><td style=\"text-align: left\">The text specified in the <tt>description</tt> attribute is displayed below the top-level entry for the repository in the source browser. It supports <a class=\"wiki\" href=\"/LUCICodeRepository/nomaticIM/wiki/WikiFormatting\">WikiFormatting</a>. \n</td></tr><tr><td style=\"text-align: left\"><tt>dir</tt> \n</td><td style=\"text-align: left\">The <tt>dir</tt> attribute specifies the location of the repository in the filesystem. It corresponds to the value previously specified in the option <tt>[trac] repository_dir</tt>. The <tt>alias</tt> and <tt>dir</tt> attributes are mutually exclusive. \n</td></tr><tr><td style=\"text-align: left\"><tt>hidden</tt> </td><td style=\"text-align: left\">When set to <tt>true</tt>, the repository is hidden from the repository index page in the source browser. Browsing the repository is still possible, and links referencing the repository remain valid. \n</td></tr><tr><td style=\"text-align: left\"><tt>name</tt> </td><td style=\"text-align: left\">The <tt>name</tt> attribute specifies the leading path element to the repository. \n</td></tr><tr><td style=\"text-align: left\"><tt>type</tt> </td><td style=\"text-align: left\">The <tt>type</tt> attribute sets the type of version control system used by the repository. Trac supports Subversion out-of-the-box, and plugins add support for many other systems. If <tt>type</tt> is not specified, it defaults to the value of the <tt>[trac] repository_type</tt> option. \n</td></tr><tr><td style=\"text-align: left\"><tt>url</tt> </td><td style=\"text-align: left\">The <tt>url</tt> attribute specifies the root URL to be used for checking out from the repository. When specified, a \"Repository URL\" link is added to the context navigation links in the source browser, that can be copied into the tool used for creating the working copy. \n</td></tr></table>\n<p>\nThe <tt>name</tt> attribute and one of <tt>alias</tt> or <tt>dir</tt> are mandatory. All others are optional.\n</p>\n<p>\nAfter adding a repository, the cache for that repository must be re-synchronized once with the <tt>trac-admin $ENV repository resync</tt> command.\n</p>\n<dl class=\"wiki\"><dt><tt>repository resync &lt;repos&gt;</tt></dt><dd>\nRe-synchronize Trac with a repository.\n</dd></dl>\n<h3 id=\"ReposTracIni\">In <tt>trac.ini</tt></h3>\n<p>\nRepositories and repository attributes can be specified in the <tt>[repositories]</tt> section of <a class=\"wiki\" href=\"/LUCICodeRepository/nomaticIM/wiki/TracIni#repositories-section\">trac.ini</a>. Every attribute consists of a key structured as <tt>{name}.{attribute}</tt> and the corresponding value separated with an equal sign (<tt>=</tt>). The name of the default repository is empty.\n</p>\n<p>\nThe main advantage of specifying repositories in <tt>trac.ini</tt> is that they can be inherited from a global configuration (see the <a class=\"wiki\" href=\"/LUCICodeRepository/nomaticIM/wiki/TracIni#GlobalConfiguration\">global configuration</a> section of <a class=\"wiki\" href=\"/LUCICodeRepository/nomaticIM/wiki/TracIni\">TracIni</a>). One drawback is that, due to limitations in the <tt>ConfigParser</tt> class used to parse <tt>trac.ini</tt>, the repository name is always all-lowercase.\n</p>\n<p>\nThe following example defines two Subversion repositories named <tt>project</tt> and <tt>lib</tt>, and a hidden alias to <tt>project</tt> as the default repository. This is a typical use case where a Trac environment previously had a single repository (the <tt>project</tt> repository), and was converted to multiple repositories. The alias ensures that links predating the change continue to resolve to the <tt>project</tt> repository.\n</p>\n<div class=\"code\"><pre><span class=\"k\">[repositories]</span>\n<span class=\"na\">project.dir</span> <span class=\"o\">=</span> <span class=\"s\">/var/repos/project</span>\n<span class=\"na\">project.description</span> <span class=\"o\">=</span> <span class=\"s\">This is the ''main'' project repository.</span>\n<span class=\"na\">project.type</span> <span class=\"o\">=</span> <span class=\"s\">svn</span>\n<span class=\"na\">project.url</span> <span class=\"o\">=</span> <span class=\"s\">http://example.com/svn/project</span>\n<span class=\"na\">lib.dir</span> <span class=\"o\">=</span> <span class=\"s\">/var/repos/lib</span>\n<span class=\"na\">lib.description</span> <span class=\"o\">=</span> <span class=\"s\">This is the secondary library code.</span>\n<span class=\"na\">lib.type</span> <span class=\"o\">=</span> <span class=\"s\">svn</span>\n<span class=\"na\">lib.url</span> <span class=\"o\">=</span> <span class=\"s\">http://example.com/svn/lib</span>\n<span class=\"na\">.alias</span> <span class=\"o\">=</span> <span class=\"s\">project</span>\n<span class=\"na\">.hidden</span> <span class=\"o\">=</span> <span class=\"s\">true</span>\n</pre></div><p>\nNote that <tt>name.alias = target</tt> makes <tt>name</tt> an alias for the <tt>target</tt> repo, not the other way around.\n</p>\n<h3 id=\"ReposDatabase\">In the database</h3>\n<p>\nRepositories can also be specified in the database, using either the \"Repositories\" admin panel under \"Version Control\", or the <tt>trac-admin $ENV repository</tt> commands.\n</p>\n<p>\nThe admin panel shows the list of all repositories defined in the Trac environment. It allows adding repositories and aliases, editing repository attributes and removing repositories. Note that repositories defined in <tt>trac.ini</tt> are displayed but cannot be edited.\n</p>\n<p>\nThe following <a class=\"wiki\" href=\"/LUCICodeRepository/nomaticIM/wiki/TracAdmin\">trac-admin</a> commands can be used to perform repository operations from the command line.\n</p>\n<dl class=\"wiki\"><dt><tt>repository add &lt;repos&gt; &lt;dir&gt; [type]</tt></dt><dd>\nAdd a repository <tt>&lt;repos&gt;</tt> located at <tt>&lt;dir&gt;</tt>, and optionally specify its type.\n</dd></dl>\n<dl class=\"wiki\"><dt><tt>repository alias &lt;name&gt; &lt;target&gt;</tt></dt><dd>\nCreate an alias <tt>&lt;name&gt;</tt> for the repository <tt>&lt;target&gt;</tt>.\n</dd></dl>\n<dl class=\"wiki\"><dt><tt>repository remove &lt;repos&gt;</tt></dt><dd>\nRemove the repository <tt>&lt;repos&gt;</tt>.\n</dd></dl>\n<dl class=\"wiki\"><dt><tt>repository set &lt;repos&gt; &lt;key&gt; &lt;value&gt;</tt></dt><dd>\nSet the attribute <tt>&lt;key&gt;</tt> to <tt>&lt;value&gt;</tt> for the repository <tt>&lt;repos&gt;</tt>. \n</dd></dl>\n<p>\nNote that the default repository has an empty name, so it will likely need to be quoted when running <tt>trac-admin</tt> from a shell. Alternatively, the name \"<tt>(default)</tt>\" can be used instead, for example when running <tt>trac-admin</tt> in interactive mode.\n</p>\n<h2 id=\"Synchronization\">Repository synchronization</h2>\n<p>\nPrior to 0.12, Trac synchronized its cache with the repository on every HTTP request. This approach is not very efficient and not practical anymore with multiple repositories. For this reason, explicit synchronization through post-commit hooks was added. \n</p>\n<p>\nThere is also new functionality in the form of a repository listener extension point <em>(IRepositoryChangeListener)</em> that is triggered by the post-commit hook when a changeset is added or modified, and can be used by plugins to perform actions on commit.\n</p>\n<h3 id=\"MercurialRepositories\">Mercurial Repositories</h3>\n<p>\nPlease note that at the time of writing, no initial resynchronization or any hooks are necessary for Mercurial repositories - see <a class=\"ext-link\" href=\"http://trac.edgewall.org/intertrac/%239485\" title=\"#9485 in Trac project trac\"><span class=\"icon\">\u200b</span>#9485</a> for more information. \n</p>\n<h3 id=\"ExplicitSync\">Explicit synchronization</h3>\n<p>\nThis is the preferred method of repository synchronization. It requires setting the <tt>[trac]  repository_sync_per_request</tt> option in <a class=\"wiki\" href=\"/LUCICodeRepository/nomaticIM/wiki/TracIni#trac-section\">trac.ini</a> to an empty value, and adding a call to <tt>trac-admin</tt> in the post-commit hook of each repository. Additionally, if a repository allows changing revision metadata, a call to <tt>trac-admin</tt> must be added to the post-revprop-change hook as well.\n</p>\n<dl class=\"wiki\"><dt><tt>changeset added &lt;repos&gt; &lt;rev&gt; [\u2026]</tt></dt><dd>\nNotify Trac that one or more changesets have been added to a repository.\n</dd></dl>\n<dl class=\"wiki\"><dt><tt>changeset modified &lt;repos&gt; &lt;rev&gt; [\u2026]</tt></dt><dd>\nNotify Trac that metadata on one or more changesets in a repository has been modified.\n</dd></dl>\n<p>\nThe <tt>&lt;repos&gt;</tt> argument can be either a repository name (use \"<tt>(default)</tt>\" for the default repository) or the path to the repository.\n</p>\n<p>\nNote that you may have to set the environment variable PYTHON_EGG_CACHE to the same value as was used for the web server configuration before calling trac-admin, if you changed it from its default location. See <a class=\"wiki\" href=\"/LUCICodeRepository/nomaticIM/wiki/TracPlugins\">Trac Plugins</a> for more information.\n</p>\n<p>\nThe following examples are complete post-commit and post-revprop-change scripts for Subversion. They should be edited for the specific environment, marked executable (where applicable) and placed in the <tt>hooks</tt> directory of each repository. On Unix (<tt>post-commit</tt>):\n</p>\n<div class=\"code\"><pre><span class=\"c\">#!/bin/sh\n</span><span class=\"nb\">export </span><span class=\"nv\">PYTHON_EGG_CACHE</span><span class=\"o\">=</span><span class=\"s2\">\"/path/to/dir\"</span>\n/usr/bin/trac-admin /path/to/env changeset added <span class=\"s2\">\"$1\"</span> <span class=\"s2\">\"$2\"</span>\n</pre></div><p>\nOn Windows (<tt>post-commit.cmd</tt>):\n</p>\n<div class=\"code\"><pre><span class=\"p\">@</span>C:\\Python<span class=\"m\">26</span>\\Scripts\\trac-admin.exe C:\\path\\to\\env change<span class=\"k\">set</span> <span class=\"nv\">added</span> <span class=\"s2\">\"%1\"</span> <span class=\"s2\">\"%2\"</span>\n</pre></div><p>\nThe post-revprop-change hook for Subversion is very similar. On Unix (<tt>post-revprop-change</tt>):\n</p>\n<div class=\"code\"><pre><span class=\"c\">#!/bin/sh\n</span><span class=\"nb\">export </span><span class=\"nv\">PYTHON_EGG_CACHE</span><span class=\"o\">=</span><span class=\"s2\">\"/path/to/dir\"</span>\n/usr/bin/trac-admin /path/to/env changeset modified <span class=\"s2\">\"$1\"</span> <span class=\"s2\">\"$2\"</span>\n</pre></div><p>\nOn Windows (<tt>post-revprop-change.cmd</tt>):\n</p>\n<div class=\"code\"><pre><span class=\"p\">@</span>C:\\Python<span class=\"m\">26</span>\\Scripts\\trac-admin.exe C:\\path\\to\\env change<span class=\"k\">set</span> <span class=\"nv\">modified</span> <span class=\"s2\">\"%1\"</span> <span class=\"s2\">\"%2\"</span>\n</pre></div><p>\nThe Unix variants above assume that the user running the Subversion commit has write access to the Trac environment, which is the case in the standard configuration where both the repository and Trac are served by the web server. If you access the repository through another means, for example <tt>svn+ssh://</tt>, you may have to run <tt>trac-admin</tt> with different privileges, for example by using <tt>sudo</tt>.\n</p>\n<p>\nNote that calling <tt>trac-admin</tt> in your Subversion hooks can slow down the commit and log editing operations on the client side. You might want to use the <a class=\"ext-link\" href=\"http://trac.edgewall.org/intertrac/source%3Atrunk/contrib/trac-svn-hook\" title=\"source:trunk/contrib/trac-svn-hook in Trac project trac\"><span class=\"icon\">\u200b</span>contrib/trac-svn-hook</a> script which starts <tt>trac-admin</tt> in an asynchronous way. The script also comes with a number of safety checks and usage advices which should make it easier to set up and test your hooks. There's no equivalent <tt>trac-svn-hook.bat</tt> for Windows yet, but the script can be run by Cygwin's bash.\n</p>\n<p>\nSee the <a class=\"ext-link\" href=\"http://svnbook.red-bean.com/en/1.5/svn.reposadmin.create.html#svn.reposadmin.create.hooks\"><span class=\"icon\">\u200b</span>section about hooks</a> in the Subversion book for more information. Other repository types will require different hook setups. Please see the plugin documentation for specific instructions.\n</p>\n<h3 id=\"PerRequestSync\">Per-request synchronization</h3>\n<p>\nIf the post-commit hooks are not available, the environment can be set up for per-request synchronization. In that case, the <tt>[trac] repository_sync_per_request</tt> option in <a class=\"wiki\" href=\"/LUCICodeRepository/nomaticIM/wiki/TracIni#trac-section\">trac.ini</a> must be set to a comma-separated list of repository names to be synchronized.\n</p>\n<p>\nNote that in this case, the changeset listener extension point is not called, and therefore plugins using it will not work correctly.\n</p>\n<h2 id=\"Migration\">Migration from a single-repository setup (Subversion)</h2>\n<p>\nThe following procedure illustrates a typical migration from a Subversion single-repository setup to multiple repositories.\n</p>\n<ol><li>Remove the default repository specification from the <tt>[trac] repository_dir</tt> option.\n</li><li>Add the \"main\" repository as a named repository.\n</li><li>Re-synchronize the main repository.\n</li><li>Set up post-commit and post-revprop-change hooks on the main repository, and set <tt>[trac] repository_sync_per_request</tt> to an empty value.\n</li><li>Add a hidden alias to the main repository as the default repository. This ensures that all links predating the migration still resolve to the main repository.\n</li><li>Repeat steps 2, 3 and 4 to add other (named) repositories as needed.\n</li></ol><h2 id=\"MigrationMercurial\">Migration from a single-repository setup (Mercurial)</h2>\n<p>\nThe following procedure illustrates a typical migration from a Mercurial single-repository setup to multiple repositories. Please note that at the time of writing, no initial resynchronization or any hooks are necessary for Mercurial repositories - see <a class=\"missing ticket\">#9485</a> for more information.\n</p>\n<ol><li>Upgrade to the latest version of the <a class=\"missing wiki\">TracMercurial?</a> plugin.\n</li><li>Remove the default repository specification from the <tt>[trac] repository_dir</tt> option.\n</li><li>Add the \"main\" repository as a named repository.\n</li><li>Add a hidden alias to the main repository as the default repository. This ensures that all links predating the migration still resolve to the main repository.\n</li><li>Repeat step 3 to add other (named) repositories as needed.\n</li></ol><h2 id=\"Troubleshooting\">Troubleshooting</h2>\n<h3 id=\"trac-post-commit-hook\">My trac-post-commit-hook doesn't work anymore</h3>\n<p>\nYou must now use the optional components from <tt>tracopt.ticket.commit_updater.*</tt>, which you can activate through the Plugins panel in the Administrative part of the web interface, or by directly modifying the <a class=\"wiki\" href=\"/LUCICodeRepository/nomaticIM/wiki/TracIni#components-section\">[components]</a> section in the trac.ini. Be sure to use <a class=\"wiki\" href=\"/LUCICodeRepository/nomaticIM/wiki/TracRepositoryAdmin#ExplicitSync\">explicit synchronization</a> as explained above.\n</p>\n</div>\n          \n          <div class=\"trac-modifiedby\">\n            <span><a href=\"/LUCICodeRepository/nomaticIM/wiki/TracRepositoryAdmin?action=diff&amp;version=1\" title=\"Version 1 by trac\">Last modified</a> <a class=\"timeline\" href=\"/LUCICodeRepository/nomaticIM/timeline?from=2012-01-03T12%3A53%3A27-08%3A00&amp;precision=second\" title=\"See timeline at Jan 3, 2012, 12:53:27 PM\">3 years ago</a></span>\n            <span class=\"trac-print\">Last modified on Jan 3, 2012, 12:53:27 PM</span>\n          </div>\n        \n        \n      </div>\n      \n    <div id=\"attachments\">\n    </div>\n\n          <div class=\"buttons\">\n              <form method=\"get\" action=\"/LUCICodeRepository/nomaticIM/wiki/TracRepositoryAdmin\" id=\"modifypage\">\n                <div>\n                  <input type=\"hidden\" name=\"action\" value=\"edit\" />\n                      <input type=\"submit\" value=\"Edit this page\" />\n                </div>\n              </form>\n                <form method=\"get\" action=\"/LUCICodeRepository/nomaticIM/attachment/wiki/TracRepositoryAdmin/\" id=\"attachfile\">\n  <div>\n    <input type=\"hidden\" name=\"action\" value=\"new\" />\n    <input type=\"submit\" name=\"attachfilebutton\" value=\"Attach file\" />\n  </div>\n</form>\n          </div>\n    </div>\n    <script type=\"text/javascript\">\n        jQuery.loadStyleSheet(\"/LUCICodeRepository/nomaticIM/pygments/trac.css\", \"text/css\");\n    </script>\n    <div id=\"altlinks\">\n      <h3>Download in other formats:</h3>\n      <ul>\n        <li class=\"last first\">\n          <a rel=\"nofollow\" href=\"/LUCICodeRepository/nomaticIM/wiki/TracRepositoryAdmin?format=txt\">Plain Text</a>\n        </li>\n      </ul>\n    </div>\n    </div>\n    <div id=\"footer\" lang=\"en\" xml:lang=\"en\"><hr />\n      <a id=\"tracpowered\" href=\"http://trac.edgewall.org/\"><img src=\"/LUCICodeRepository/nomaticIM/chrome/common/trac_logo_mini.png\" height=\"30\" width=\"107\" alt=\"Trac Powered\" /></a>\n      <p class=\"left\">Powered by <a href=\"/LUCICodeRepository/nomaticIM/about\"><strong>Trac 1.0.1</strong></a><br />\n        By <a href=\"http://www.edgewall.org/\">Edgewall Software</a>.</p>\n      <p class=\"right\">All content copyright 2007-2008 by LUCI <br /><a href=\"http://luci.ics.uci.edu/\">http://luci.ics.uci.edu/</a></p>\n    </div>\n\t\t<div id=\"sitefooter\">\n\t\t\t<script src=\"http://www.google-analytics.com/urchin.js\" type=\"text/javascript\">\n\t\t\t</script>\n\t\t\t<script type=\"text/javascript\">\n\t\t\t\t_uacct = \"UA-338915-2\";\n\t\t\t\turchinTracker();\n\t\t\t</script>\n\t\t</div>\n\t</body>\n</html>", "id": 34700.0}