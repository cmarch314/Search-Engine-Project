{"text": "Search LoginPreferencesHelp GuideAbout Trac WikiTimelineRoadmapBrowse SourceView TicketsSearch Context Navigation Previous ChangesetNext Changeset Changeset 317 View differences inlineside by side Show lines around each change Show the changes in full context Ignore Blank lines Case changes White space changes Timestamp Apr 1 2 7 3 5 36 PM 8 years ago Author skaufman1Message Work continues on the Gaim plugin packet ID s on both plugin and service have been changed Location nomatic trunk Files 5 edited plugins gaim src nomatic c modified 2 diffs plugins gaim src nomatic h modified 1 diff plugins gaim src service c modified 4 diffs plugins gaim src service h modified 3 diffs service edu uci ics luci nomatic service NomaticService java modified 1 diff Legend UnmodifiedAddedRemoved nomatic trunk plugins gaim src nomatic c r315 r317 1111 1212static NomaticService s service NULL 13 14 15 This is a callback function that gets called if an error 16 occurs with the NomaticService 17 18void service error cb NomaticService service void data 19 GaimPlugin plugin GaimPlugin data 2 char error get error 21 gaim debug error nomatic Service error s n error 22 gaim notify error plugin Nomatic 23 An error occurred in communication with the service 24 error 25 free error 26 1327 1428 3 44 else 3145 s service service 46 nomatic service set error callback service service error cb data 3247 3348 nomatic trunk plugins gaim src nomatic h r316 r317 33 44 define NOMATIC SERVICE PROTOCOL VERSION 1 5 define NOMATIC SERVICE TIMEOUT 6 6 define NOMATIC SERVICE PING FREQ NOMATIC SERVICE TIMEOUT 25 57 68 define DEFAULT NOMATIC SERVICE PORT 55863 nomatic trunk plugins gaim src service c r316 r317 5353 5454 serviceObj malloc sizeof NomaticService 55 serviceObj error malloc sizeof NSError 56 serviceObj to be freed FALSE 57 TODO The connection should happen asynchronously 5558 serviceObj conn gnet conn new socket socket gconn cb serviceObj 5659 gnet conn ref serviceObj conn 6 gnet conn timeout serviceObj conn NOMATIC SERVICE TIMEOUT 61 g timeout add NOMATIC SERVICE PING FREQ ping timeout cb serviceObj 5762 5863 nomatic service send login serviceObj 64 serviceObj waiting for login response TRUE 5965 6 66out 6773 6874 75void nomatic service set error callback NomaticService service 76 service error callback error cb 77 void data 78 79 service error cb error cb 8 service error data data 81 82 6983void nomatic service free NomaticService service 7 84 7387 7488 else 75 TODO Disconnect too 76 if service conn NULL 89 if service conn NULL 9 Send logout packet 91 if gnet conn is connected service conn 92 nomatic service send logout service 93 gnet conn disconnect service conn 94 95 Dereference connection to free it 7796 gnet conn unref service conn 78 free service 97 98 service to be freed TRUE 7999 8 1 841 4 851 5 1 6void nomatic service really free NomaticService service 1 7 1 8 Delete the NomaticService object 1 9 free service error 11 free service 111 112 86113void gconn cb GConn conn GConnEvent event gpointer user data 87114 88115 NomaticService service NomaticService user data 89 9 116 117 switch event type 118 case GNET CONN ERROR 119 set error An unexpected error occurred 12 service error cb service service error data 121 nomatic service free service 122 break 123 case GNET CONN CLOSE 124 set error The connection to the service was closed unexpectedly 125 service error cb service service error data 126 nomatic service free service 127 break 128 case GNET CONN TIMEOUT 129 set error The connection to the service timed out 13 service error cb service service error data 131 nomatic service free service 132 break 133 case GNET CONN READ 134 if event length 1 135 Then we re reading a packet header 136 switch event buffer 137 case x 1 OK 138 if service waiting for login response 139 service waiting for login response FALSE 14 break 141 case x 2 ERROR 142 TODO Have this pass along the message attached to the packet 143 if service waiting for login response 144 service waiting for login response FALSE 145 set error The service rejected the plugin s attempt to log on 146 service error cb service service error data 147 nomatic service free service 148 149 else 15 set error An unexpected error occurred in communication with the service 151 service error cb service service error data 152 nomatic service free service 153 154 break 155 156 157 break 158 159 16 161gboolean ping timeout cb gpointer data 162 163 NomaticService service NomaticService data 164 g assert service conn NULL 165 g assert service to be freed gnet conn is connected service conn 166 if service to be freed gnet conn is connected service conn 167 nomatic service send ping service 168 return TRUE 169 17 else 171 nomatic service really free service 172 return FALSE 173 174 175 176 x 1 177 unsigned byte protocol version 91178void nomatic service send login NomaticService service 92179 9318 char buffer 2 94 gnet pack 2b buffer sizeof buffer x 1 181 gnet pack 2B buffer sizeof buffer x 1 95182 NOMATIC SERVICE PROTOCOL VERSION 183 gnet conn write service conn buffer sizeof buffer 184 185 186 x 2 187void nomatic service send ping NomaticService service 188 189 char buffer 1 19 gnet pack B buffer sizeof buffer x 2 191 gnet conn write service conn buffer sizeof buffer 192 193 194 x 3 195void nomatic service send logout NomaticService service 196 197 char buffer 1 198 gnet pack B buffer sizeof buffer x 3 96199 gnet conn write service conn buffer sizeof buffer 972 nomatic trunk plugins gaim src service h r315 r317 99 1 1 11 Service struct 11 Service struct all fields are considered private 1212typedef struct 1313 GConn conn 14 gboolean waiting for login response 15 struct NSError error 16 gboolean to be freed 1417 NomaticService 1518 1619 Callback definitions 172 typedef void service get callback NomaticService void 21typedef void service error callback NomaticService void 22 23 Error struct mostly to solve recursion problem 24typedef struct NSError 25 service error callback cb 26 void data 27 NSError 1828 1929 2636 2737 28 Deletes the passed NomaticService cleans up and free memory 38 Sets the error callback for a Nomatic service object In the 39 event of an error the service will be free d immediately after 4 the error callback returns 41 42void nomatic service set error callback NomaticService service 43 service error callback error cb 44 void data 45 46 47 Deletes the passed NomaticService cleans up and frees memory 48 but not necessarily immediately 2949 3 5 void nomatic service free NomaticService service 3555 3656 57void nomatic service really free NomaticService service 58 3759void nomatic service send login NomaticService service 386 61void nomatic service send ping NomaticService service 62 63void nomatic service send logout NomaticService service 64 3965void gconn cb GConn conn GConnEvent event gpointer user data 66 67gboolean ping timeout cb gpointer data 4 68 4169 nomatic trunk service edu uci ics luci nomatic service NomaticService java r3 9 r317 2525 static final int PROTOCOL VERSION 1 2626 27 static final int OK 1 28 static final int NOT OK 1 27 static final int OK x 1 28 static final int NOT OK x 2 2929 3 3 static final int MESSAGE LOG ON 1 Note See TracChangeset for help on using the changeset viewer Download in other formats Unified Diff Zip Archive Powered by Trac 1 1 By Edgewall Software All content copyright 2 7 2 8 by LUCI http luci ics uci edu ", "_id": "http://djp3-pc2.ics.uci.edu/LUCICodeRepository/nomaticIM/changeset/317", "title": "\n      changeset 317 \u2013 nomatic*im\n    ", "html": "<!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Strict//EN\" \"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd\">\n<html xmlns=\"http://www.w3.org/1999/xhtml\">\n  \n  \n\n  \n\n\n  <head>\n\t\t<title>\n      Changeset 317 \u2013 Nomatic*IM\n    </title><meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\" /><meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge\" /><link rel=\"search\" href=\"/LUCICodeRepository/nomaticIM/search\" /><link rel=\"prev\" href=\"/LUCICodeRepository/nomaticIM/changeset/316\" title=\"Changeset 316\" /><link rel=\"last\" href=\"/LUCICodeRepository/nomaticIM/changeset/1312\" title=\"Changeset 1312\" /><link rel=\"help\" href=\"/LUCICodeRepository/nomaticIM/wiki/TracGuide\" /><link rel=\"alternate\" href=\"?format=diff&amp;new=317\" type=\"text/plain\" class=\"diff\" title=\"Unified Diff\" /><link rel=\"alternate\" href=\"?format=zip&amp;new=317\" type=\"application/zip\" class=\"zip\" title=\"Zip Archive\" /><link rel=\"next\" href=\"/LUCICodeRepository/nomaticIM/changeset/318\" title=\"Changeset 318\" /><link rel=\"start\" href=\"/LUCICodeRepository/nomaticIM/wiki\" /><link rel=\"stylesheet\" href=\"/LUCICodeRepository/nomaticIM/chrome/common/css/trac.css\" type=\"text/css\" /><link rel=\"stylesheet\" href=\"/LUCICodeRepository/nomaticIM/chrome/common/css/changeset.css\" type=\"text/css\" /><link rel=\"stylesheet\" href=\"/LUCICodeRepository/nomaticIM/chrome/common/css/diff.css\" type=\"text/css\" /><link rel=\"stylesheet\" href=\"/LUCICodeRepository/nomaticIM/chrome/common/css/code.css\" type=\"text/css\" /><link rel=\"first\" href=\"/LUCICodeRepository/nomaticIM/changeset/1\" title=\"Changeset 1\" /><link rel=\"shortcut icon\" href=\"http://luci.ics.uci.edu/logo32by32.gif\" type=\"image/gif\" /><link rel=\"icon\" href=\"http://luci.ics.uci.edu/logo32by32.gif\" type=\"image/gif\" /><link type=\"application/opensearchdescription+xml\" rel=\"search\" href=\"/LUCICodeRepository/nomaticIM/search/opensearch\" title=\"Search Nomatic*IM\" /><script type=\"text/javascript\" charset=\"utf-8\" src=\"/LUCICodeRepository/nomaticIM/chrome/common/js/jquery.js\"></script><script type=\"text/javascript\" charset=\"utf-8\" src=\"/LUCICodeRepository/nomaticIM/chrome/common/js/babel.js\"></script><script type=\"text/javascript\" charset=\"utf-8\" src=\"/LUCICodeRepository/nomaticIM/chrome/common/js/messages/en_US.js\"></script><script type=\"text/javascript\" charset=\"utf-8\" src=\"/LUCICodeRepository/nomaticIM/chrome/common/js/trac.js\"></script><script type=\"text/javascript\" charset=\"utf-8\" src=\"/LUCICodeRepository/nomaticIM/chrome/common/js/search.js\"></script><script type=\"text/javascript\" charset=\"utf-8\" src=\"/LUCICodeRepository/nomaticIM/chrome/common/js/diff.js\"></script><script type=\"text/javascript\">\n      jQuery(document).ready(function($) {\n        $(\".trac-toggledeleted\").show().click(function() {\n                  $(this).siblings().find(\".trac-deleted\").toggle();\n                  return false;\n        }).click();\n        $(\"#content\").find(\"li.entry h2 a\").parent().addAnchor(_(\"Link to this diff\"));\n      });\n    </script>\n\t</head>\n  <body>\n    <div id=\"banner\">\n      <div id=\"header\">\n        <a id=\"logo\" href=\"http://luci.ics.uci.edu/#code\"><img src=\"http://luci.ics.uci.edu/blog/archives/LUCIhorzTight.jpg\" alt=\"LUCI Code Repository\" /></a>\n      </div>\n      <form id=\"search\" action=\"/LUCICodeRepository/nomaticIM/search\" method=\"get\">\n        <div>\n          <label for=\"proj-search\">Search:</label>\n          <input type=\"text\" id=\"proj-search\" name=\"q\" size=\"18\" value=\"\" />\n          <input type=\"submit\" value=\"Search\" />\n        </div>\n      </form>\n      <div id=\"metanav\" class=\"nav\">\n    <ul>\n      <li class=\"first\"><a href=\"/LUCICodeRepository/nomaticIM/login\">Login</a></li><li><a href=\"/LUCICodeRepository/nomaticIM/prefs\">Preferences</a></li><li><a href=\"/LUCICodeRepository/nomaticIM/wiki/TracGuide\">Help/Guide</a></li><li class=\"last\"><a href=\"/LUCICodeRepository/nomaticIM/about\">About Trac</a></li>\n    </ul>\n  </div>\n    </div>\n    <div id=\"mainnav\" class=\"nav\">\n    <ul>\n      <li class=\"first\"><a href=\"/LUCICodeRepository/nomaticIM/wiki\">Wiki</a></li><li><a href=\"/LUCICodeRepository/nomaticIM/timeline\">Timeline</a></li><li><a href=\"/LUCICodeRepository/nomaticIM/roadmap\">Roadmap</a></li><li class=\"active\"><a href=\"/LUCICodeRepository/nomaticIM/browser\">Browse Source</a></li><li><a href=\"/LUCICodeRepository/nomaticIM/report\">View Tickets</a></li><li class=\"last\"><a href=\"/LUCICodeRepository/nomaticIM/search\">Search</a></li>\n    </ul>\n  </div>\n    <div id=\"main\">\n      <div id=\"ctxtnav\" class=\"nav\">\n        <h2>Context Navigation</h2>\n        <ul>\n          <li class=\"first\"><span>&larr; <a class=\"prev\" href=\"/LUCICodeRepository/nomaticIM/changeset/316\" title=\"Changeset 316\">Previous Changeset</a></span></li><li class=\"last\"><span><a class=\"next\" href=\"/LUCICodeRepository/nomaticIM/changeset/318\" title=\"Changeset 318\">Next Changeset</a> &rarr;</span></li>\n        </ul>\n        <hr />\n      </div>\n    <div id=\"content\" class=\"changeset\">\n      <div id=\"title\">\n            <h1>Changeset 317</h1>\n      </div>\n      <form id=\"prefs\" action=\"\">\n        <div>\n          \n  <label for=\"style\">View differences</label>\n  <select id=\"style\" name=\"style\">\n    <option selected=\"selected\" value=\"inline\">inline</option>\n    <option value=\"sidebyside\">side by side</option>\n  </select>\n  <div class=\"field\">\n    <label><input type=\"radio\" name=\"contextall\" value=\"0\" checked=\"checked\" />\n             Show</label>\n      <label><input type=\"text\" name=\"contextlines\" id=\"contextlines\" size=\"2\" maxlength=\"3\" value=\"2\" />\n             lines around each change</label><br />\n    <label><input type=\"radio\" name=\"contextall\" value=\"1\" />\n           Show the changes in full context</label>\n  </div>\n  <fieldset id=\"ignore\">\n    <legend>Ignore:</legend>\n    <div class=\"field\">\n      <input type=\"checkbox\" id=\"ignoreblanklines\" name=\"ignoreblanklines\" />\n      <label for=\"ignoreblanklines\">Blank lines</label>\n    </div>\n    <div class=\"field\">\n      <input type=\"checkbox\" id=\"ignorecase\" name=\"ignorecase\" />\n      <label for=\"ignorecase\">Case changes</label>\n    </div>\n    <div class=\"field\">\n      <input type=\"checkbox\" id=\"ignorewhitespace\" name=\"ignorewhitespace\" />\n      <label for=\"ignorewhitespace\">White space changes</label>\n    </div>\n  </fieldset>\n  <div class=\"buttons\">\n    <input type=\"submit\" name=\"update\" value=\"Update\" />\n  </div>\n\n        </div>\n      </form>\n      <dl id=\"overview\">\n          <dt class=\"property time\">Timestamp:</dt>\n          <dd class=\"time\">\n             Apr 10, 2007, 3:50:36 PM\n             (<a class=\"timeline\" href=\"/LUCICodeRepository/nomaticIM/timeline?from=2007-04-10T15%3A50%3A36-07%3A00&amp;precision=second\" title=\"See timeline at Apr 10, 2007, 3:50:36 PM\">8 years</a> ago)\n          </dd>\n          <dt class=\"property author\">Author:</dt>\n          <dd class=\"author\">skaufman1</dd>\n          <dt class=\"property message\">Message:</dt>\n          <dd class=\"message searchable\">\n            \n            \n              <p>\nWork continues on the Gaim plugin; packet ID's on both plugin and service have been changed<br />\n</p>\n\n            \n            \n          </dd>\n          <dt class=\"property location\">Location:</dt>\n          <dd class=\"searchable\"><a href=\"/LUCICodeRepository/nomaticIM/browser/nomatic/trunk?rev=317\">nomatic/trunk</a></dd>\n        <dt class=\"property files\">\n          Files:\n        </dt>\n        <dd class=\"files\">\n          <div class=\"legend\" id=\"file-legend\">\n            <dl>\n              <dt class=\"mod\"></dt><dd>5 edited</dd>\n            </dl>\n          </div>\n          <br />\n          <ul>\n            <li>\n          <div class=\"mod\"> </div>\n            <a title=\"Show entry in browser\" href=\"/LUCICodeRepository/nomaticIM/browser/nomatic/trunk/plugins/gaim/src/nomatic.c?rev=317\">\n              plugins/gaim/src/nomatic.c\n            </a>\n          <span class=\"comment\">(modified)</span>\n              (<a title=\"Show differences\" href=\"#file0\">2 diffs</a>)\n            </li><li>\n          <div class=\"mod\"> </div>\n            <a title=\"Show entry in browser\" href=\"/LUCICodeRepository/nomaticIM/browser/nomatic/trunk/plugins/gaim/src/nomatic.h?rev=317\">\n              plugins/gaim/src/nomatic.h\n            </a>\n          <span class=\"comment\">(modified)</span>\n              (<a title=\"Show differences\" href=\"#file1\">1 diff</a>)\n            </li><li>\n          <div class=\"mod\"> </div>\n            <a title=\"Show entry in browser\" href=\"/LUCICodeRepository/nomaticIM/browser/nomatic/trunk/plugins/gaim/src/service.c?rev=317\">\n              plugins/gaim/src/service.c\n            </a>\n          <span class=\"comment\">(modified)</span>\n              (<a title=\"Show differences\" href=\"#file2\">4 diffs</a>)\n            </li><li>\n          <div class=\"mod\"> </div>\n            <a title=\"Show entry in browser\" href=\"/LUCICodeRepository/nomaticIM/browser/nomatic/trunk/plugins/gaim/src/service.h?rev=317\">\n              plugins/gaim/src/service.h\n            </a>\n          <span class=\"comment\">(modified)</span>\n              (<a title=\"Show differences\" href=\"#file3\">3 diffs</a>)\n            </li><li>\n          <div class=\"mod\"> </div>\n            <a title=\"Show entry in browser\" href=\"/LUCICodeRepository/nomaticIM/browser/nomatic/trunk/service/edu/uci/ics/luci/nomatic/service/NomaticService.java?rev=317\">\n              service/edu/uci/ics/luci/nomatic/service/NomaticService.java\n            </a>\n          <span class=\"comment\">(modified)</span>\n              (<a title=\"Show differences\" href=\"#file4\">1 diff</a>)\n            </li>\n          </ul>\n        </dd>\n      </dl>\n      <div class=\"diff\">\n        <div class=\"legend\" id=\"diff-legend\">\n          <h3>Legend:</h3>\n          <dl>\n            <dt class=\"unmod\"></dt><dd>Unmodified</dd>\n            <dt class=\"add\"></dt><dd>Added</dd>\n            <dt class=\"rem\"></dt><dd>Removed</dd>\n          </dl>\n        </div>\n        <div class=\"diff\">\n  <ul class=\"entries\">\n      <li class=\"entry\">\n        <h2 id=\"file0\">\n          <a href=\"/LUCICodeRepository/nomaticIM/changeset/317/nomatic/trunk/plugins/gaim/src/nomatic.c\" title=\"Show the changeset 317 restricted to nomatic/trunk/plugins/gaim/src/nomatic.c\">nomatic/trunk/plugins/gaim/src/nomatic.c</a>\n        </h2>\n        <table class=\"trac-diff inline\" summary=\"Differences\" cellspacing=\"0\">\n              <colgroup><col class=\"lineno\" /><col class=\"lineno\" /><col class=\"content\" /></colgroup>\n              <thead>\n                <tr>\n                  <th title=\"Revision 315\">\n                    <a title=\"Show revision 315 of this file in browser\" href=\"/LUCICodeRepository/nomaticIM/browser/nomatic/trunk/plugins/gaim/src/nomatic.c?rev=315#L11\">\n                      r315</a>\n                  </th>\n                  <th title=\"Revision 317\">\n                    <a title=\"Show revision 317 of this file in browser\" href=\"/LUCICodeRepository/nomaticIM/browser/nomatic/trunk/plugins/gaim/src/nomatic.c?rev=317#L11\">\n                      r317</a>\n                  </th>\n                  <td>\u00a0</td>\n                </tr>\n              </thead>\n            <tbody class=\"unmod\">\n                  <tr>\n                          <th>11</th><th>11</th><td class=\"l\"><span></span>\u00a0</td>\n                  </tr><tr>\n                          <th>12</th><th>12</th><td class=\"l\"><span>static NomaticService *s_service = NULL;</span>\u00a0</td>\n                  </tr>\n            </tbody><tbody class=\"add\">\n                  <tr class=\"first\">\n                          <th>\u00a0</th><th>13</th><td class=\"r\"><ins></ins>\u00a0</td>\n                  </tr><tr>\n                          <th>\u00a0</th><th>14</th><td class=\"r\"><ins>/*</ins>\u00a0</td>\n                  </tr><tr>\n                          <th>\u00a0</th><th>15</th><td class=\"r\"><ins>&nbsp;* This is a callback function that gets called if an error</ins>\u00a0</td>\n                  </tr><tr>\n                          <th>\u00a0</th><th>16</th><td class=\"r\"><ins>&nbsp;* occurs with the NomaticService.</ins>\u00a0</td>\n                  </tr><tr>\n                          <th>\u00a0</th><th>17</th><td class=\"r\"><ins>&nbsp;*/</ins>\u00a0</td>\n                  </tr><tr>\n                          <th>\u00a0</th><th>18</th><td class=\"r\"><ins>void service_error_cb (NomaticService *service, void *data) {</ins>\u00a0</td>\n                  </tr><tr>\n                          <th>\u00a0</th><th>19</th><td class=\"r\"><ins>&nbsp; &nbsp; &nbsp; &nbsp; GaimPlugin *plugin = (GaimPlugin*) data;</ins>\u00a0</td>\n                  </tr><tr>\n                          <th>\u00a0</th><th>20</th><td class=\"r\"><ins>&nbsp; &nbsp; &nbsp; &nbsp; char *error = get_error();</ins>\u00a0</td>\n                  </tr><tr>\n                          <th>\u00a0</th><th>21</th><td class=\"r\"><ins>&nbsp; &nbsp; &nbsp; &nbsp; gaim_debug_error(\"nomatic\", \"Service error: %s\\n\", error);</ins>\u00a0</td>\n                  </tr><tr>\n                          <th>\u00a0</th><th>22</th><td class=\"r\"><ins>&nbsp; &nbsp; &nbsp; &nbsp; gaim_notify_error(plugin, \"Nomatic\",</ins>\u00a0</td>\n                  </tr><tr>\n                          <th>\u00a0</th><th>23</th><td class=\"r\"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; \"An error occurred in communication with the service.\",</ins>\u00a0</td>\n                  </tr><tr>\n                          <th>\u00a0</th><th>24</th><td class=\"r\"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; error);</ins>\u00a0</td>\n                  </tr><tr>\n                          <th>\u00a0</th><th>25</th><td class=\"r\"><ins>&nbsp; &nbsp; &nbsp; &nbsp; free(error);</ins>\u00a0</td>\n                  </tr><tr class=\"last\">\n                          <th>\u00a0</th><th>26</th><td class=\"r\"><ins>}</ins>\u00a0</td>\n                  </tr>\n            </tbody><tbody class=\"unmod\">\n                  <tr>\n                          <th>13</th><th>27</th><td class=\"l\"><span></span>\u00a0</td>\n                  </tr><tr>\n                          <th>14</th><th>28</th><td class=\"l\"><span>/*</span>\u00a0</td>\n                  </tr>\n            </tbody>\n              <tbody class=\"skipped\">\n                <tr>\n                  <th><a href=\"/LUCICodeRepository/nomaticIM/browser/nomatic/trunk/plugins/gaim/src/nomatic.c?rev=315#L30\">\u2026</a></th>\n                  <th><a href=\"/LUCICodeRepository/nomaticIM/browser/nomatic/trunk/plugins/gaim/src/nomatic.c?rev=317#L44\">\u2026</a></th>\n                  <td>\u00a0</td>\n                </tr>\n              </tbody>\n            <tbody class=\"unmod\">\n                  <tr>\n                          <th>30</th><th>44</th><td class=\"l\"><span>&nbsp; &nbsp; &nbsp; &nbsp; else {</span>\u00a0</td>\n                  </tr><tr>\n                          <th>31</th><th>45</th><td class=\"l\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; s_service = service;</span>\u00a0</td>\n                  </tr>\n            </tbody><tbody class=\"add\">\n                  <tr class=\"last first\">\n                          <th>\u00a0</th><th>46</th><td class=\"r\"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; nomatic_service_set_error_callback(service, service_error_cb, data);</ins>\u00a0</td>\n                  </tr>\n            </tbody><tbody class=\"unmod\">\n                  <tr>\n                          <th>32</th><th>47</th><td class=\"l\"><span>&nbsp; &nbsp; &nbsp; &nbsp; }</span>\u00a0</td>\n                  </tr><tr>\n                          <th>33</th><th>48</th><td class=\"l\"><span>}</span>\u00a0</td>\n                  </tr>\n            </tbody>\n        </table>\n      </li>\n      <li class=\"entry\">\n        <h2 id=\"file1\">\n          <a href=\"/LUCICodeRepository/nomaticIM/changeset/317/nomatic/trunk/plugins/gaim/src/nomatic.h\" title=\"Show the changeset 317 restricted to nomatic/trunk/plugins/gaim/src/nomatic.h\">nomatic/trunk/plugins/gaim/src/nomatic.h</a>\n        </h2>\n        <table class=\"trac-diff inline\" summary=\"Differences\" cellspacing=\"0\">\n              <colgroup><col class=\"lineno\" /><col class=\"lineno\" /><col class=\"content\" /></colgroup>\n              <thead>\n                <tr>\n                  <th title=\"Revision 316\">\n                    <a title=\"Show revision 316 of this file in browser\" href=\"/LUCICodeRepository/nomaticIM/browser/nomatic/trunk/plugins/gaim/src/nomatic.h?rev=316#L3\">\n                      r316</a>\n                  </th>\n                  <th title=\"Revision 317\">\n                    <a title=\"Show revision 317 of this file in browser\" href=\"/LUCICodeRepository/nomaticIM/browser/nomatic/trunk/plugins/gaim/src/nomatic.h?rev=317#L3\">\n                      r317</a>\n                  </th>\n                  <td>\u00a0</td>\n                </tr>\n              </thead>\n            <tbody class=\"unmod\">\n                  <tr>\n                          <th>3</th><th>3</th><td class=\"l\"><span></span>\u00a0</td>\n                  </tr><tr>\n                          <th>4</th><th>4</th><td class=\"l\"><span>#define NOMATIC_SERVICE_PROTOCOL_VERSION 1</span>\u00a0</td>\n                  </tr>\n            </tbody><tbody class=\"add\">\n                  <tr class=\"first\">\n                          <th>\u00a0</th><th>5</th><td class=\"r\"><ins>#define NOMATIC_SERVICE_TIMEOUT 60000</ins>\u00a0</td>\n                  </tr><tr class=\"last\">\n                          <th>\u00a0</th><th>6</th><td class=\"r\"><ins>#define NOMATIC_SERVICE_PING_FREQ (NOMATIC_SERVICE_TIMEOUT*0.25)</ins>\u00a0</td>\n                  </tr>\n            </tbody><tbody class=\"unmod\">\n                  <tr>\n                          <th>5</th><th>7</th><td class=\"l\"><span></span>\u00a0</td>\n                  </tr><tr>\n                          <th>6</th><th>8</th><td class=\"l\"><span>#define DEFAULT_NOMATIC_SERVICE_PORT 55863</span>\u00a0</td>\n                  </tr>\n            </tbody>\n        </table>\n      </li>\n      <li class=\"entry\">\n        <h2 id=\"file2\">\n          <a href=\"/LUCICodeRepository/nomaticIM/changeset/317/nomatic/trunk/plugins/gaim/src/service.c\" title=\"Show the changeset 317 restricted to nomatic/trunk/plugins/gaim/src/service.c\">nomatic/trunk/plugins/gaim/src/service.c</a>\n        </h2>\n        <table class=\"trac-diff inline\" summary=\"Differences\" cellspacing=\"0\">\n              <colgroup><col class=\"lineno\" /><col class=\"lineno\" /><col class=\"content\" /></colgroup>\n              <thead>\n                <tr>\n                  <th title=\"Revision 316\">\n                    <a title=\"Show revision 316 of this file in browser\" href=\"/LUCICodeRepository/nomaticIM/browser/nomatic/trunk/plugins/gaim/src/service.c?rev=316#L53\">\n                      r316</a>\n                  </th>\n                  <th title=\"Revision 317\">\n                    <a title=\"Show revision 317 of this file in browser\" href=\"/LUCICodeRepository/nomaticIM/browser/nomatic/trunk/plugins/gaim/src/service.c?rev=317#L53\">\n                      r317</a>\n                  </th>\n                  <td>\u00a0</td>\n                </tr>\n              </thead>\n            <tbody class=\"unmod\">\n                  <tr>\n                          <th>53</th><th>53</th><td class=\"l\"><span>&nbsp; &nbsp; &nbsp; &nbsp; </span>\u00a0</td>\n                  </tr><tr>\n                          <th>54</th><th>54</th><td class=\"l\"><span>&nbsp; &nbsp; &nbsp; &nbsp; serviceObj = malloc(sizeof(NomaticService));</span>\u00a0</td>\n                  </tr>\n            </tbody><tbody class=\"add\">\n                  <tr class=\"first\">\n                          <th>\u00a0</th><th>55</th><td class=\"r\"><ins>&nbsp; &nbsp; &nbsp; &nbsp; serviceObj-&gt;error = malloc(sizeof(NSError));</ins>\u00a0</td>\n                  </tr><tr>\n                          <th>\u00a0</th><th>56</th><td class=\"r\"><ins>&nbsp; &nbsp; &nbsp; &nbsp; serviceObj-&gt;to_be_freed = FALSE;</ins>\u00a0</td>\n                  </tr><tr class=\"last\">\n                          <th>\u00a0</th><th>57</th><td class=\"r\"><ins>&nbsp; &nbsp; &nbsp; &nbsp; /* TODO: The connection should happen asynchronously */</ins>\u00a0</td>\n                  </tr>\n            </tbody><tbody class=\"unmod\">\n                  <tr>\n                          <th>55</th><th>58</th><td class=\"l\"><span>&nbsp; &nbsp; &nbsp; &nbsp; serviceObj-&gt;conn = gnet_conn_new_socket(socket, gconn_cb, serviceObj);</span>\u00a0</td>\n                  </tr><tr>\n                          <th>56</th><th>59</th><td class=\"l\"><span>&nbsp; &nbsp; &nbsp; &nbsp; gnet_conn_ref(serviceObj-&gt;conn);</span>\u00a0</td>\n                  </tr>\n            </tbody><tbody class=\"add\">\n                  <tr class=\"first\">\n                          <th>\u00a0</th><th>60</th><td class=\"r\"><ins>&nbsp; &nbsp; &nbsp; &nbsp; gnet_conn_timeout(serviceObj-&gt;conn, NOMATIC_SERVICE_TIMEOUT);</ins>\u00a0</td>\n                  </tr><tr class=\"last\">\n                          <th>\u00a0</th><th>61</th><td class=\"r\"><ins>&nbsp; &nbsp; &nbsp; &nbsp; g_timeout_add(NOMATIC_SERVICE_PING_FREQ, ping_timeout_cb, serviceObj);</ins>\u00a0</td>\n                  </tr>\n            </tbody><tbody class=\"unmod\">\n                  <tr>\n                          <th>57</th><th>62</th><td class=\"l\"><span>&nbsp; &nbsp; &nbsp; &nbsp; </span>\u00a0</td>\n                  </tr><tr>\n                          <th>58</th><th>63</th><td class=\"l\"><span>&nbsp; &nbsp; &nbsp; &nbsp; nomatic_service_send_login(serviceObj);</span>\u00a0</td>\n                  </tr>\n            </tbody><tbody class=\"add\">\n                  <tr class=\"last first\">\n                          <th>\u00a0</th><th>64</th><td class=\"r\"><ins>&nbsp; &nbsp; &nbsp; &nbsp; serviceObj-&gt;waiting_for_login_response = TRUE;</ins>\u00a0</td>\n                  </tr>\n            </tbody><tbody class=\"unmod\">\n                  <tr>\n                          <th>59</th><th>65</th><td class=\"l\"><span>&nbsp; &nbsp; &nbsp; &nbsp; </span>\u00a0</td>\n                  </tr><tr>\n                          <th>60</th><th>66</th><td class=\"l\"><span>out:</span>\u00a0</td>\n                  </tr>\n            </tbody>\n              <tbody class=\"skipped\">\n                <tr>\n                  <th><a href=\"/LUCICodeRepository/nomaticIM/browser/nomatic/trunk/plugins/gaim/src/service.c?rev=316#L67\">\u2026</a></th>\n                  <th><a href=\"/LUCICodeRepository/nomaticIM/browser/nomatic/trunk/plugins/gaim/src/service.c?rev=317#L73\">\u2026</a></th>\n                  <td>\u00a0</td>\n                </tr>\n              </tbody>\n            <tbody class=\"unmod\">\n                  <tr>\n                          <th>67</th><th>73</th><td class=\"l\"><span>}</span>\u00a0</td>\n                  </tr><tr>\n                          <th>68</th><th>74</th><td class=\"l\"><span></span>\u00a0</td>\n                  </tr>\n            </tbody><tbody class=\"add\">\n                  <tr class=\"first\">\n                          <th>\u00a0</th><th>75</th><td class=\"r\"><ins>void nomatic_service_set_error_callback(NomaticService *service,</ins>\u00a0</td>\n                  </tr><tr>\n                          <th>\u00a0</th><th>76</th><td class=\"r\"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; service_error_callback error_cb,</ins>\u00a0</td>\n                  </tr><tr>\n                          <th>\u00a0</th><th>77</th><td class=\"r\"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; void *data)</ins>\u00a0</td>\n                  </tr><tr>\n                          <th>\u00a0</th><th>78</th><td class=\"r\"><ins>{</ins>\u00a0</td>\n                  </tr><tr>\n                          <th>\u00a0</th><th>79</th><td class=\"r\"><ins>&nbsp; &nbsp; &nbsp; &nbsp; service-&gt;error-&gt;cb = error_cb;</ins>\u00a0</td>\n                  </tr><tr>\n                          <th>\u00a0</th><th>80</th><td class=\"r\"><ins>&nbsp; &nbsp; &nbsp; &nbsp; service-&gt;error-&gt;data = data;</ins>\u00a0</td>\n                  </tr><tr>\n                          <th>\u00a0</th><th>81</th><td class=\"r\"><ins>}</ins>\u00a0</td>\n                  </tr><tr class=\"last\">\n                          <th>\u00a0</th><th>82</th><td class=\"r\"><ins></ins>\u00a0</td>\n                  </tr>\n            </tbody><tbody class=\"unmod\">\n                  <tr>\n                          <th>69</th><th>83</th><td class=\"l\"><span>void nomatic_service_free(NomaticService *service)</span>\u00a0</td>\n                  </tr><tr>\n                          <th>70</th><th>84</th><td class=\"l\"><span>{</span>\u00a0</td>\n                  </tr>\n            </tbody>\n              <tbody class=\"skipped\">\n                <tr>\n                  <th><a href=\"/LUCICodeRepository/nomaticIM/browser/nomatic/trunk/plugins/gaim/src/service.c?rev=316#L73\">\u2026</a></th>\n                  <th><a href=\"/LUCICodeRepository/nomaticIM/browser/nomatic/trunk/plugins/gaim/src/service.c?rev=317#L87\">\u2026</a></th>\n                  <td>\u00a0</td>\n                </tr>\n              </tbody>\n            <tbody class=\"unmod\">\n                  <tr>\n                          <th>73</th><th>87</th><td class=\"l\"><span>&nbsp; &nbsp; &nbsp; &nbsp; }</span>\u00a0</td>\n                  </tr><tr>\n                          <th>74</th><th>88</th><td class=\"l\"><span>&nbsp; &nbsp; &nbsp; &nbsp; else {</span>\u00a0</td>\n                  </tr>\n            </tbody><tbody class=\"mod\">\n                      <tr class=\"first\">\n                        <th>75</th><th>\u00a0</th><td class=\"l\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; /* TODO: Disconnect, too */</span>\u00a0</td>\n                      </tr><tr>\n                        <th>76</th><th>\u00a0</th><td class=\"l\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (service-&gt;conn != NULL)</span>\u00a0</td>\n                      </tr>\n                      <tr>\n                        <th>\u00a0</th><th>89</th><td class=\"r\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (service-&gt;conn != NULL) {</span>\u00a0</td>\n                      </tr><tr>\n                        <th>\u00a0</th><th>90</th><td class=\"r\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; /* Send logout packet */</span>\u00a0</td>\n                      </tr><tr>\n                        <th>\u00a0</th><th>91</th><td class=\"r\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (gnet_conn_is_connected(service-&gt;conn)) {</span>\u00a0</td>\n                      </tr><tr>\n                        <th>\u00a0</th><th>92</th><td class=\"r\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; nomatic_service_send_logout(service);</span>\u00a0</td>\n                      </tr><tr>\n                        <th>\u00a0</th><th>93</th><td class=\"r\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; gnet_conn_disconnect(service-&gt;conn);</span>\u00a0</td>\n                      </tr><tr>\n                        <th>\u00a0</th><th>94</th><td class=\"r\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</span>\u00a0</td>\n                      </tr><tr class=\"last\">\n                        <th>\u00a0</th><th>95</th><td class=\"r\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; /* Dereference connection to free it */</span>\u00a0</td>\n                      </tr>\n            </tbody><tbody class=\"unmod\">\n                  <tr>\n                          <th>77</th><th>96</th><td class=\"l\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; gnet_conn_unref(service-&gt;conn);</span>\u00a0</td>\n                  </tr>\n            </tbody><tbody class=\"mod\">\n                      <tr class=\"first\">\n                        <th>78</th><th>\u00a0</th><td class=\"l\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; free(service);</span>\u00a0</td>\n                      </tr>\n                      <tr>\n                        <th>\u00a0</th><th>97</th><td class=\"r\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</span>\u00a0</td>\n                      </tr><tr class=\"last\">\n                        <th>\u00a0</th><th>98</th><td class=\"r\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; service-&gt;to_be_freed = TRUE;</span>\u00a0</td>\n                      </tr>\n            </tbody><tbody class=\"unmod\">\n                  <tr>\n                          <th>79</th><th>99</th><td class=\"l\"><span>&nbsp; &nbsp; &nbsp; &nbsp; }</span>\u00a0</td>\n                  </tr><tr>\n                          <th>80</th><th>100</th><td class=\"l\"><span>}</span>\u00a0</td>\n                  </tr>\n            </tbody>\n              <tbody class=\"skipped\">\n                <tr>\n                  <th><a href=\"/LUCICodeRepository/nomaticIM/browser/nomatic/trunk/plugins/gaim/src/service.c?rev=316#L84\">\u2026</a></th>\n                  <th><a href=\"/LUCICodeRepository/nomaticIM/browser/nomatic/trunk/plugins/gaim/src/service.c?rev=317#L104\">\u2026</a></th>\n                  <td>\u00a0</td>\n                </tr>\n              </tbody>\n            <tbody class=\"unmod\">\n                  <tr>\n                          <th>84</th><th>104</th><td class=\"l\"><span>&nbsp;****************/</span>\u00a0</td>\n                  </tr><tr>\n                          <th>85</th><th>105</th><td class=\"l\"><span></span>\u00a0</td>\n                  </tr>\n            </tbody><tbody class=\"add\">\n                  <tr class=\"first\">\n                          <th>\u00a0</th><th>106</th><td class=\"r\"><ins>void nomatic_service_really_free(NomaticService *service)</ins>\u00a0</td>\n                  </tr><tr>\n                          <th>\u00a0</th><th>107</th><td class=\"r\"><ins>{</ins>\u00a0</td>\n                  </tr><tr>\n                          <th>\u00a0</th><th>108</th><td class=\"r\"><ins>&nbsp; &nbsp; &nbsp; &nbsp; /* Delete the NomaticService object */</ins>\u00a0</td>\n                  </tr><tr>\n                          <th>\u00a0</th><th>109</th><td class=\"r\"><ins>&nbsp; &nbsp; &nbsp; &nbsp; free(service-&gt;error);</ins>\u00a0</td>\n                  </tr><tr>\n                          <th>\u00a0</th><th>110</th><td class=\"r\"><ins>&nbsp; &nbsp; &nbsp; &nbsp; free(service);</ins>\u00a0</td>\n                  </tr><tr>\n                          <th>\u00a0</th><th>111</th><td class=\"r\"><ins>}</ins>\u00a0</td>\n                  </tr><tr class=\"last\">\n                          <th>\u00a0</th><th>112</th><td class=\"r\"><ins></ins>\u00a0</td>\n                  </tr>\n            </tbody><tbody class=\"unmod\">\n                  <tr>\n                          <th>86</th><th>113</th><td class=\"l\"><span>void gconn_cb(GConn *conn, GConnEvent *event, gpointer user_data)</span>\u00a0</td>\n                  </tr><tr>\n                          <th>87</th><th>114</th><td class=\"l\"><span>{</span>\u00a0</td>\n                  </tr><tr>\n                          <th>88</th><th>115</th><td class=\"l\"><span>&nbsp; &nbsp; &nbsp; &nbsp; NomaticService *service = (NomaticService*) user_data;</span>\u00a0</td>\n                  </tr>\n            </tbody><tbody class=\"mod\">\n                      <tr class=\"first\">\n                        <th>89</th><th>\u00a0</th><td class=\"l\"><span>}</span>\u00a0</td>\n                      </tr><tr>\n                        <th>90</th><th>\u00a0</th><td class=\"l\"><span></span>\u00a0</td>\n                      </tr>\n                      <tr>\n                        <th>\u00a0</th><th>116</th><td class=\"r\"><span>&nbsp; &nbsp; &nbsp; &nbsp; </span>\u00a0</td>\n                      </tr><tr>\n                        <th>\u00a0</th><th>117</th><td class=\"r\"><span>&nbsp; &nbsp; &nbsp; &nbsp; switch (event-&gt;type) {</span>\u00a0</td>\n                      </tr><tr>\n                        <th>\u00a0</th><th>118</th><td class=\"r\"><span>&nbsp; &nbsp; &nbsp; &nbsp; case GNET_CONN_ERROR:</span>\u00a0</td>\n                      </tr><tr>\n                        <th>\u00a0</th><th>119</th><td class=\"r\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; set_error(\"An unexpected error occurred.\");</span>\u00a0</td>\n                      </tr><tr>\n                        <th>\u00a0</th><th>120</th><td class=\"r\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (service-&gt;error-&gt;cb)(service, service-&gt;error-&gt;data);</span>\u00a0</td>\n                      </tr><tr>\n                        <th>\u00a0</th><th>121</th><td class=\"r\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; nomatic_service_free(service);</span>\u00a0</td>\n                      </tr><tr>\n                        <th>\u00a0</th><th>122</th><td class=\"r\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; break;</span>\u00a0</td>\n                      </tr><tr>\n                        <th>\u00a0</th><th>123</th><td class=\"r\"><span>&nbsp; &nbsp; &nbsp; &nbsp; case GNET_CONN_CLOSE:</span>\u00a0</td>\n                      </tr><tr>\n                        <th>\u00a0</th><th>124</th><td class=\"r\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; set_error(\"The connection to the service was closed unexpectedly.\");</span>\u00a0</td>\n                      </tr><tr>\n                        <th>\u00a0</th><th>125</th><td class=\"r\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (service-&gt;error-&gt;cb)(service, service-&gt;error-&gt;data);</span>\u00a0</td>\n                      </tr><tr>\n                        <th>\u00a0</th><th>126</th><td class=\"r\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; nomatic_service_free(service);</span>\u00a0</td>\n                      </tr><tr>\n                        <th>\u00a0</th><th>127</th><td class=\"r\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; break;</span>\u00a0</td>\n                      </tr><tr>\n                        <th>\u00a0</th><th>128</th><td class=\"r\"><span>&nbsp; &nbsp; &nbsp; &nbsp; case GNET_CONN_TIMEOUT:</span>\u00a0</td>\n                      </tr><tr>\n                        <th>\u00a0</th><th>129</th><td class=\"r\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; set_error(\"The connection to the service timed out.\");</span>\u00a0</td>\n                      </tr><tr>\n                        <th>\u00a0</th><th>130</th><td class=\"r\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (service-&gt;error-&gt;cb)(service, service-&gt;error-&gt;data);</span>\u00a0</td>\n                      </tr><tr>\n                        <th>\u00a0</th><th>131</th><td class=\"r\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; nomatic_service_free(service);</span>\u00a0</td>\n                      </tr><tr>\n                        <th>\u00a0</th><th>132</th><td class=\"r\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; break;</span>\u00a0</td>\n                      </tr><tr>\n                        <th>\u00a0</th><th>133</th><td class=\"r\"><span>&nbsp; &nbsp; &nbsp; &nbsp; case GNET_CONN_READ:</span>\u00a0</td>\n                      </tr><tr>\n                        <th>\u00a0</th><th>134</th><td class=\"r\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (event-&gt;length == 1) {</span>\u00a0</td>\n                      </tr><tr>\n                        <th>\u00a0</th><th>135</th><td class=\"r\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; /* Then we're reading a packet header */</span>\u00a0</td>\n                      </tr><tr>\n                        <th>\u00a0</th><th>136</th><td class=\"r\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; switch (event-&gt;buffer[0]) {</span>\u00a0</td>\n                      </tr><tr>\n                        <th>\u00a0</th><th>137</th><td class=\"r\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; case 0x01: /* OK */</span>\u00a0</td>\n                      </tr><tr>\n                        <th>\u00a0</th><th>138</th><td class=\"r\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (service-&gt;waiting_for_login_response)</span>\u00a0</td>\n                      </tr><tr>\n                        <th>\u00a0</th><th>139</th><td class=\"r\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; service-&gt;waiting_for_login_response = FALSE;</span>\u00a0</td>\n                      </tr><tr>\n                        <th>\u00a0</th><th>140</th><td class=\"r\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; break;</span>\u00a0</td>\n                      </tr><tr>\n                        <th>\u00a0</th><th>141</th><td class=\"r\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; case 0x02: /* ERROR */</span>\u00a0</td>\n                      </tr><tr>\n                        <th>\u00a0</th><th>142</th><td class=\"r\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; /* TODO: Have this pass along the message attached to the packet. */</span>\u00a0</td>\n                      </tr><tr>\n                        <th>\u00a0</th><th>143</th><td class=\"r\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (service-&gt;waiting_for_login_response) {</span>\u00a0</td>\n                      </tr><tr>\n                        <th>\u00a0</th><th>144</th><td class=\"r\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; service-&gt;waiting_for_login_response = FALSE;</span>\u00a0</td>\n                      </tr><tr>\n                        <th>\u00a0</th><th>145</th><td class=\"r\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; set_error(\"The service rejected the plugin's attempt to log on.\");</span>\u00a0</td>\n                      </tr><tr>\n                        <th>\u00a0</th><th>146</th><td class=\"r\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (service-&gt;error-&gt;cb)(service, service-&gt;error-&gt;data);</span>\u00a0</td>\n                      </tr><tr>\n                        <th>\u00a0</th><th>147</th><td class=\"r\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; nomatic_service_free(service);</span>\u00a0</td>\n                      </tr><tr>\n                        <th>\u00a0</th><th>148</th><td class=\"r\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</span>\u00a0</td>\n                      </tr><tr>\n                        <th>\u00a0</th><th>149</th><td class=\"r\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; else {</span>\u00a0</td>\n                      </tr><tr>\n                        <th>\u00a0</th><th>150</th><td class=\"r\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; set_error(\"An unexpected error occurred in communication with the service.\");</span>\u00a0</td>\n                      </tr><tr>\n                        <th>\u00a0</th><th>151</th><td class=\"r\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (service-&gt;error-&gt;cb)(service, service-&gt;error-&gt;data);</span>\u00a0</td>\n                      </tr><tr>\n                        <th>\u00a0</th><th>152</th><td class=\"r\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; nomatic_service_free(service);&nbsp; </span>\u00a0</td>\n                      </tr><tr>\n                        <th>\u00a0</th><th>153</th><td class=\"r\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</span>\u00a0</td>\n                      </tr><tr>\n                        <th>\u00a0</th><th>154</th><td class=\"r\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; break;</span>\u00a0</td>\n                      </tr><tr>\n                        <th>\u00a0</th><th>155</th><td class=\"r\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</span>\u00a0</td>\n                      </tr><tr>\n                        <th>\u00a0</th><th>156</th><td class=\"r\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</span>\u00a0</td>\n                      </tr><tr>\n                        <th>\u00a0</th><th>157</th><td class=\"r\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; break;</span>\u00a0</td>\n                      </tr><tr>\n                        <th>\u00a0</th><th>158</th><td class=\"r\"><span>&nbsp; &nbsp; &nbsp; &nbsp; }</span>\u00a0</td>\n                      </tr><tr>\n                        <th>\u00a0</th><th>159</th><td class=\"r\"><span>}</span>\u00a0</td>\n                      </tr><tr>\n                        <th>\u00a0</th><th>160</th><td class=\"r\"><span></span>\u00a0</td>\n                      </tr><tr>\n                        <th>\u00a0</th><th>161</th><td class=\"r\"><span>gboolean ping_timeout_cb(gpointer data)</span>\u00a0</td>\n                      </tr><tr>\n                        <th>\u00a0</th><th>162</th><td class=\"r\"><span>{</span>\u00a0</td>\n                      </tr><tr>\n                        <th>\u00a0</th><th>163</th><td class=\"r\"><span>&nbsp; &nbsp; &nbsp; &nbsp; NomaticService *service = (NomaticService*) data;</span>\u00a0</td>\n                      </tr><tr>\n                        <th>\u00a0</th><th>164</th><td class=\"r\"><span>&nbsp; &nbsp; &nbsp; &nbsp; g_assert(service-&gt;conn != NULL);</span>\u00a0</td>\n                      </tr><tr>\n                        <th>\u00a0</th><th>165</th><td class=\"r\"><span>&nbsp; &nbsp; &nbsp; &nbsp; g_assert(service-&gt;to_be_freed != gnet_conn_is_connected(service-&gt;conn));</span>\u00a0</td>\n                      </tr><tr>\n                        <th>\u00a0</th><th>166</th><td class=\"r\"><span>&nbsp; &nbsp; &nbsp; &nbsp; if (!service-&gt;to_be_freed &amp;&amp; gnet_conn_is_connected(service-&gt;conn)) {</span>\u00a0</td>\n                      </tr><tr>\n                        <th>\u00a0</th><th>167</th><td class=\"r\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; nomatic_service_send_ping(service);</span>\u00a0</td>\n                      </tr><tr>\n                        <th>\u00a0</th><th>168</th><td class=\"r\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return TRUE;</span>\u00a0</td>\n                      </tr><tr>\n                        <th>\u00a0</th><th>169</th><td class=\"r\"><span>&nbsp; &nbsp; &nbsp; &nbsp; }</span>\u00a0</td>\n                      </tr><tr>\n                        <th>\u00a0</th><th>170</th><td class=\"r\"><span>&nbsp; &nbsp; &nbsp; &nbsp; else {</span>\u00a0</td>\n                      </tr><tr>\n                        <th>\u00a0</th><th>171</th><td class=\"r\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; nomatic_service_really_free(service);</span>\u00a0</td>\n                      </tr><tr>\n                        <th>\u00a0</th><th>172</th><td class=\"r\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return FALSE;</span>\u00a0</td>\n                      </tr><tr>\n                        <th>\u00a0</th><th>173</th><td class=\"r\"><span>&nbsp; &nbsp; &nbsp; &nbsp; }</span>\u00a0</td>\n                      </tr><tr>\n                        <th>\u00a0</th><th>174</th><td class=\"r\"><span>}</span>\u00a0</td>\n                      </tr><tr>\n                        <th>\u00a0</th><th>175</th><td class=\"r\"><span></span>\u00a0</td>\n                      </tr><tr>\n                        <th>\u00a0</th><th>176</th><td class=\"r\"><span>/* 0x01</span>\u00a0</td>\n                      </tr><tr class=\"last\">\n                        <th>\u00a0</th><th>177</th><td class=\"r\"><span>&nbsp; &nbsp;unsigned byte: protocol version */</span>\u00a0</td>\n                      </tr>\n            </tbody><tbody class=\"unmod\">\n                  <tr>\n                          <th>91</th><th>178</th><td class=\"l\"><span>void nomatic_service_send_login(NomaticService *service)</span>\u00a0</td>\n                  </tr><tr>\n                          <th>92</th><th>179</th><td class=\"l\"><span>{</span>\u00a0</td>\n                  </tr><tr>\n                          <th>93</th><th>180</th><td class=\"l\"><span>&nbsp; &nbsp; &nbsp; &nbsp; char buffer[2];</span>\u00a0</td>\n                  </tr>\n            </tbody><tbody class=\"mod\">\n                      <tr class=\"first\">\n                        <th>94</th><th>\u00a0</th><td class=\"l\"><span>&nbsp; &nbsp; &nbsp; &nbsp; gnet_pack(\"!2<del>b</del>\", buffer, sizeof(buffer), 0x01,</span>\u00a0</td>\n                      </tr>\n                      <tr class=\"last\">\n                        <th>\u00a0</th><th>181</th><td class=\"r\"><span>&nbsp; &nbsp; &nbsp; &nbsp; gnet_pack(\"!2<ins>B</ins>\", buffer, sizeof(buffer), 0x01,</span>\u00a0</td>\n                      </tr>\n            </tbody><tbody class=\"unmod\">\n                  <tr>\n                          <th>95</th><th>182</th><td class=\"l\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; NOMATIC_SERVICE_PROTOCOL_VERSION);</span>\u00a0</td>\n                  </tr>\n            </tbody><tbody class=\"add\">\n                  <tr class=\"first\">\n                          <th>\u00a0</th><th>183</th><td class=\"r\"><ins>&nbsp; &nbsp; &nbsp; &nbsp; gnet_conn_write(service-&gt;conn, buffer, sizeof(buffer));</ins>\u00a0</td>\n                  </tr><tr>\n                          <th>\u00a0</th><th>184</th><td class=\"r\"><ins>}</ins>\u00a0</td>\n                  </tr><tr>\n                          <th>\u00a0</th><th>185</th><td class=\"r\"><ins></ins>\u00a0</td>\n                  </tr><tr>\n                          <th>\u00a0</th><th>186</th><td class=\"r\"><ins>/* 0x02 */</ins>\u00a0</td>\n                  </tr><tr>\n                          <th>\u00a0</th><th>187</th><td class=\"r\"><ins>void nomatic_service_send_ping(NomaticService *service)</ins>\u00a0</td>\n                  </tr><tr>\n                          <th>\u00a0</th><th>188</th><td class=\"r\"><ins>{</ins>\u00a0</td>\n                  </tr><tr>\n                          <th>\u00a0</th><th>189</th><td class=\"r\"><ins>&nbsp; &nbsp; &nbsp; &nbsp; char buffer[1];</ins>\u00a0</td>\n                  </tr><tr>\n                          <th>\u00a0</th><th>190</th><td class=\"r\"><ins>&nbsp; &nbsp; &nbsp; &nbsp; gnet_pack(\"!B\", buffer, sizeof(buffer), 0x02);</ins>\u00a0</td>\n                  </tr><tr>\n                          <th>\u00a0</th><th>191</th><td class=\"r\"><ins>&nbsp; &nbsp; &nbsp; &nbsp; gnet_conn_write(service-&gt;conn, buffer, sizeof(buffer)); </ins>\u00a0</td>\n                  </tr><tr>\n                          <th>\u00a0</th><th>192</th><td class=\"r\"><ins>}</ins>\u00a0</td>\n                  </tr><tr>\n                          <th>\u00a0</th><th>193</th><td class=\"r\"><ins></ins>\u00a0</td>\n                  </tr><tr>\n                          <th>\u00a0</th><th>194</th><td class=\"r\"><ins>/* 0x03 */</ins>\u00a0</td>\n                  </tr><tr>\n                          <th>\u00a0</th><th>195</th><td class=\"r\"><ins>void nomatic_service_send_logout(NomaticService *service)</ins>\u00a0</td>\n                  </tr><tr>\n                          <th>\u00a0</th><th>196</th><td class=\"r\"><ins>{</ins>\u00a0</td>\n                  </tr><tr>\n                          <th>\u00a0</th><th>197</th><td class=\"r\"><ins>&nbsp; &nbsp; &nbsp; &nbsp; char buffer[1];</ins>\u00a0</td>\n                  </tr><tr class=\"last\">\n                          <th>\u00a0</th><th>198</th><td class=\"r\"><ins>&nbsp; &nbsp; &nbsp; &nbsp; gnet_pack(\"!B\", buffer, sizeof(buffer), 0x03);</ins>\u00a0</td>\n                  </tr>\n            </tbody><tbody class=\"unmod\">\n                  <tr>\n                          <th>96</th><th>199</th><td class=\"l\"><span>&nbsp; &nbsp; &nbsp; &nbsp; gnet_conn_write(service-&gt;conn, buffer, sizeof(buffer));</span>\u00a0</td>\n                  </tr><tr>\n                          <th>97</th><th>200</th><td class=\"l\"><span>}</span>\u00a0</td>\n                  </tr>\n            </tbody>\n        </table>\n      </li>\n      <li class=\"entry\">\n        <h2 id=\"file3\">\n          <a href=\"/LUCICodeRepository/nomaticIM/changeset/317/nomatic/trunk/plugins/gaim/src/service.h\" title=\"Show the changeset 317 restricted to nomatic/trunk/plugins/gaim/src/service.h\">nomatic/trunk/plugins/gaim/src/service.h</a>\n        </h2>\n        <table class=\"trac-diff inline\" summary=\"Differences\" cellspacing=\"0\">\n              <colgroup><col class=\"lineno\" /><col class=\"lineno\" /><col class=\"content\" /></colgroup>\n              <thead>\n                <tr>\n                  <th title=\"Revision 315\">\n                    <a title=\"Show revision 315 of this file in browser\" href=\"/LUCICodeRepository/nomaticIM/browser/nomatic/trunk/plugins/gaim/src/service.h?rev=315#L9\">\n                      r315</a>\n                  </th>\n                  <th title=\"Revision 317\">\n                    <a title=\"Show revision 317 of this file in browser\" href=\"/LUCICodeRepository/nomaticIM/browser/nomatic/trunk/plugins/gaim/src/service.h?rev=317#L9\">\n                      r317</a>\n                  </th>\n                  <td>\u00a0</td>\n                </tr>\n              </thead>\n            <tbody class=\"unmod\">\n                  <tr>\n                          <th>9</th><th>9</th><td class=\"l\"><span>&nbsp;****************/</span>\u00a0</td>\n                  </tr><tr>\n                          <th>10</th><th>10</th><td class=\"l\"><span></span>\u00a0</td>\n                  </tr>\n            </tbody><tbody class=\"mod\">\n                      <tr class=\"first\">\n                        <th>11</th><th>\u00a0</th><td class=\"l\"><span>/* Service struct<del></del> */</span>\u00a0</td>\n                      </tr>\n                      <tr class=\"last\">\n                        <th>\u00a0</th><th>11</th><td class=\"r\"><span>/* Service struct<ins>; all fields are considered private</ins> */</span>\u00a0</td>\n                      </tr>\n            </tbody><tbody class=\"unmod\">\n                  <tr>\n                          <th>12</th><th>12</th><td class=\"l\"><span>typedef struct {</span>\u00a0</td>\n                  </tr><tr>\n                          <th>13</th><th>13</th><td class=\"l\"><span>&nbsp; &nbsp; &nbsp; &nbsp; GConn *conn;</span>\u00a0</td>\n                  </tr>\n            </tbody><tbody class=\"add\">\n                  <tr class=\"first\">\n                          <th>\u00a0</th><th>14</th><td class=\"r\"><ins>&nbsp; &nbsp; &nbsp; &nbsp; gboolean waiting_for_login_response;</ins>\u00a0</td>\n                  </tr><tr>\n                          <th>\u00a0</th><th>15</th><td class=\"r\"><ins>&nbsp; &nbsp; &nbsp; &nbsp; struct _NSError * error;</ins>\u00a0</td>\n                  </tr><tr class=\"last\">\n                          <th>\u00a0</th><th>16</th><td class=\"r\"><ins>&nbsp; &nbsp; &nbsp; &nbsp; gboolean to_be_freed;</ins>\u00a0</td>\n                  </tr>\n            </tbody><tbody class=\"unmod\">\n                  <tr>\n                          <th>14</th><th>17</th><td class=\"l\"><span>} NomaticService;</span>\u00a0</td>\n                  </tr><tr>\n                          <th>15</th><th>18</th><td class=\"l\"><span></span>\u00a0</td>\n                  </tr><tr>\n                          <th>16</th><th>19</th><td class=\"l\"><span>/* Callback definitions */</span>\u00a0</td>\n                  </tr><tr>\n                          <th>17</th><th>20</th><td class=\"l\"><span>typedef void (*service_get_callback)(NomaticService*, void*);</span>\u00a0</td>\n                  </tr>\n            </tbody><tbody class=\"add\">\n                  <tr class=\"first\">\n                          <th>\u00a0</th><th>21</th><td class=\"r\"><ins>typedef void (*service_error_callback)(NomaticService*, void*);</ins>\u00a0</td>\n                  </tr><tr>\n                          <th>\u00a0</th><th>22</th><td class=\"r\"><ins></ins>\u00a0</td>\n                  </tr><tr>\n                          <th>\u00a0</th><th>23</th><td class=\"r\"><ins>/* Error struct (mostly to solve recursion problem) */</ins>\u00a0</td>\n                  </tr><tr>\n                          <th>\u00a0</th><th>24</th><td class=\"r\"><ins>typedef struct _NSError {</ins>\u00a0</td>\n                  </tr><tr>\n                          <th>\u00a0</th><th>25</th><td class=\"r\"><ins>&nbsp; &nbsp; &nbsp; &nbsp; service_error_callback cb;</ins>\u00a0</td>\n                  </tr><tr>\n                          <th>\u00a0</th><th>26</th><td class=\"r\"><ins>&nbsp; &nbsp; &nbsp; &nbsp; void *data;</ins>\u00a0</td>\n                  </tr><tr class=\"last\">\n                          <th>\u00a0</th><th>27</th><td class=\"r\"><ins>} NSError;</ins>\u00a0</td>\n                  </tr>\n            </tbody><tbody class=\"unmod\">\n                  <tr>\n                          <th>18</th><th>28</th><td class=\"l\"><span></span>\u00a0</td>\n                  </tr><tr>\n                          <th>19</th><th>29</th><td class=\"l\"><span></span>\u00a0</td>\n                  </tr>\n            </tbody>\n              <tbody class=\"skipped\">\n                <tr>\n                  <th><a href=\"/LUCICodeRepository/nomaticIM/browser/nomatic/trunk/plugins/gaim/src/service.h?rev=315#L26\">\u2026</a></th>\n                  <th><a href=\"/LUCICodeRepository/nomaticIM/browser/nomatic/trunk/plugins/gaim/src/service.h?rev=317#L36\">\u2026</a></th>\n                  <td>\u00a0</td>\n                </tr>\n              </tbody>\n            <tbody class=\"unmod\">\n                  <tr>\n                          <th>26</th><th>36</th><td class=\"l\"><span></span>\u00a0</td>\n                  </tr><tr>\n                          <th>27</th><th>37</th><td class=\"l\"><span>/*</span>\u00a0</td>\n                  </tr>\n            </tbody><tbody class=\"mod\">\n                      <tr class=\"first\">\n                        <th>28</th><th>\u00a0</th><td class=\"l\"><span>&nbsp;* Deletes the passed NomaticService, cleans up, and free memory.</span>\u00a0</td>\n                      </tr>\n                      <tr>\n                        <th>\u00a0</th><th>38</th><td class=\"r\"><span>&nbsp;* Sets the error callback for a Nomatic service object. In the</span>\u00a0</td>\n                      </tr><tr>\n                        <th>\u00a0</th><th>39</th><td class=\"r\"><span>&nbsp;* event of an error, the service will be free'd immediately after</span>\u00a0</td>\n                      </tr><tr>\n                        <th>\u00a0</th><th>40</th><td class=\"r\"><span>&nbsp;* the error callback returns.</span>\u00a0</td>\n                      </tr><tr>\n                        <th>\u00a0</th><th>41</th><td class=\"r\"><span>&nbsp;*/</span>\u00a0</td>\n                      </tr><tr>\n                        <th>\u00a0</th><th>42</th><td class=\"r\"><span>void nomatic_service_set_error_callback(NomaticService *service,</span>\u00a0</td>\n                      </tr><tr>\n                        <th>\u00a0</th><th>43</th><td class=\"r\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; service_error_callback error_cb,</span>\u00a0</td>\n                      </tr><tr>\n                        <th>\u00a0</th><th>44</th><td class=\"r\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; void *data);</span>\u00a0</td>\n                      </tr><tr>\n                        <th>\u00a0</th><th>45</th><td class=\"r\"><span></span>\u00a0</td>\n                      </tr><tr>\n                        <th>\u00a0</th><th>46</th><td class=\"r\"><span>/*</span>\u00a0</td>\n                      </tr><tr>\n                        <th>\u00a0</th><th>47</th><td class=\"r\"><span>&nbsp;* Deletes the passed NomaticService, cleans up, and frees memory,</span>\u00a0</td>\n                      </tr><tr class=\"last\">\n                        <th>\u00a0</th><th>48</th><td class=\"r\"><span>&nbsp;* but not necessarily immediately.</span>\u00a0</td>\n                      </tr>\n            </tbody><tbody class=\"unmod\">\n                  <tr>\n                          <th>29</th><th>49</th><td class=\"l\"><span>&nbsp;*/</span>\u00a0</td>\n                  </tr><tr>\n                          <th>30</th><th>50</th><td class=\"l\"><span>void nomatic_service_free(NomaticService *service);</span>\u00a0</td>\n                  </tr>\n            </tbody>\n              <tbody class=\"skipped\">\n                <tr>\n                  <th><a href=\"/LUCICodeRepository/nomaticIM/browser/nomatic/trunk/plugins/gaim/src/service.h?rev=315#L35\">\u2026</a></th>\n                  <th><a href=\"/LUCICodeRepository/nomaticIM/browser/nomatic/trunk/plugins/gaim/src/service.h?rev=317#L55\">\u2026</a></th>\n                  <td>\u00a0</td>\n                </tr>\n              </tbody>\n            <tbody class=\"unmod\">\n                  <tr>\n                          <th>35</th><th>55</th><td class=\"l\"><span>&nbsp;****************/</span>\u00a0</td>\n                  </tr><tr>\n                          <th>36</th><th>56</th><td class=\"l\"><span></span>\u00a0</td>\n                  </tr>\n            </tbody><tbody class=\"add\">\n                  <tr class=\"first\">\n                          <th>\u00a0</th><th>57</th><td class=\"r\"><ins>void nomatic_service_really_free(NomaticService *service);</ins>\u00a0</td>\n                  </tr><tr class=\"last\">\n                          <th>\u00a0</th><th>58</th><td class=\"r\"><ins></ins>\u00a0</td>\n                  </tr>\n            </tbody><tbody class=\"unmod\">\n                  <tr>\n                          <th>37</th><th>59</th><td class=\"l\"><span>void nomatic_service_send_login(NomaticService *service);</span>\u00a0</td>\n                  </tr><tr>\n                          <th>38</th><th>60</th><td class=\"l\"><span></span>\u00a0</td>\n                  </tr>\n            </tbody><tbody class=\"add\">\n                  <tr class=\"first\">\n                          <th>\u00a0</th><th>61</th><td class=\"r\"><ins>void nomatic_service_send_ping(NomaticService *service);</ins>\u00a0</td>\n                  </tr><tr>\n                          <th>\u00a0</th><th>62</th><td class=\"r\"><ins></ins>\u00a0</td>\n                  </tr><tr>\n                          <th>\u00a0</th><th>63</th><td class=\"r\"><ins>void nomatic_service_send_logout(NomaticService *service);</ins>\u00a0</td>\n                  </tr><tr class=\"last\">\n                          <th>\u00a0</th><th>64</th><td class=\"r\"><ins></ins>\u00a0</td>\n                  </tr>\n            </tbody><tbody class=\"unmod\">\n                  <tr>\n                          <th>39</th><th>65</th><td class=\"l\"><span>void gconn_cb(GConn *conn, GConnEvent *event, gpointer user_data);</span>\u00a0</td>\n                  </tr>\n            </tbody><tbody class=\"add\">\n                  <tr class=\"first\">\n                          <th>\u00a0</th><th>66</th><td class=\"r\"><ins></ins>\u00a0</td>\n                  </tr><tr class=\"last\">\n                          <th>\u00a0</th><th>67</th><td class=\"r\"><ins>gboolean ping_timeout_cb(gpointer data);</ins>\u00a0</td>\n                  </tr>\n            </tbody><tbody class=\"unmod\">\n                  <tr>\n                          <th>40</th><th>68</th><td class=\"l\"><span></span>\u00a0</td>\n                  </tr><tr>\n                          <th>41</th><th>69</th><td class=\"l\"><span>/*</span>\u00a0</td>\n                  </tr>\n            </tbody>\n        </table>\n      </li>\n      <li class=\"entry\">\n        <h2 id=\"file4\">\n          <a href=\"/LUCICodeRepository/nomaticIM/changeset/317/nomatic/trunk/service/edu/uci/ics/luci/nomatic/service/NomaticService.java\" title=\"Show the changeset 317 restricted to nomatic/trunk/service/edu/uci/ics/luci/nomatic/service/NomaticService.java\">nomatic/trunk/service/edu/uci/ics/luci/nomatic/service/NomaticService.java</a>\n        </h2>\n        <table class=\"trac-diff inline\" summary=\"Differences\" cellspacing=\"0\">\n              <colgroup><col class=\"lineno\" /><col class=\"lineno\" /><col class=\"content\" /></colgroup>\n              <thead>\n                <tr>\n                  <th title=\"Revision 309\">\n                    <a title=\"Show revision 309 of this file in browser\" href=\"/LUCICodeRepository/nomaticIM/browser/nomatic/trunk/service/edu/uci/ics/luci/nomatic/service/NomaticService.java?rev=309#L25\">\n                      r309</a>\n                  </th>\n                  <th title=\"Revision 317\">\n                    <a title=\"Show revision 317 of this file in browser\" href=\"/LUCICodeRepository/nomaticIM/browser/nomatic/trunk/service/edu/uci/ics/luci/nomatic/service/NomaticService.java?rev=317#L25\">\n                      r317</a>\n                  </th>\n                  <td>\u00a0</td>\n                </tr>\n              </thead>\n            <tbody class=\"unmod\">\n                  <tr>\n                          <th>25</th><th>25</th><td class=\"l\"><span>&nbsp; &nbsp; &nbsp; &nbsp; static final int PROTOCOL_VERSION = 1;</span>\u00a0</td>\n                  </tr><tr>\n                          <th>26</th><th>26</th><td class=\"l\"><span></span>\u00a0</td>\n                  </tr>\n            </tbody><tbody class=\"mod\">\n                      <tr class=\"first\">\n                        <th>27</th><th>\u00a0</th><td class=\"l\"><span>&nbsp; &nbsp; &nbsp; &nbsp; static final int OK = <del></del>1;</span>\u00a0</td>\n                      </tr><tr>\n                        <th>28</th><th>\u00a0</th><td class=\"l\"><span>&nbsp; &nbsp; &nbsp; &nbsp; static final int NOT_OK = <del>-1</del>;</span>\u00a0</td>\n                      </tr>\n                      <tr>\n                        <th>\u00a0</th><th>27</th><td class=\"r\"><span>&nbsp; &nbsp; &nbsp; &nbsp; static final int OK = <ins>0x0</ins>1;</span>\u00a0</td>\n                      </tr><tr class=\"last\">\n                        <th>\u00a0</th><th>28</th><td class=\"r\"><span>&nbsp; &nbsp; &nbsp; &nbsp; static final int NOT_OK = <ins>0x02</ins>;</span>\u00a0</td>\n                      </tr>\n            </tbody><tbody class=\"unmod\">\n                  <tr>\n                          <th>29</th><th>29</th><td class=\"l\"><span>&nbsp; &nbsp; &nbsp; &nbsp; </span>\u00a0</td>\n                  </tr><tr>\n                          <th>30</th><th>30</th><td class=\"l\"><span>&nbsp; &nbsp; &nbsp; &nbsp; static final int MESSAGE_LOG_ON = 1;</span>\u00a0</td>\n                  </tr>\n            </tbody>\n        </table>\n      </li>\n  </ul>\n</div>\n        <div id=\"help\"><strong>Note:</strong> See <a href=\"/LUCICodeRepository/nomaticIM/wiki/TracChangeset\">TracChangeset</a>\n          for help on using the changeset viewer.</div>\n      </div>\n    </div>\n    <div id=\"altlinks\">\n      <h3>Download in other formats:</h3>\n      <ul>\n        <li class=\"first\">\n          <a rel=\"nofollow\" href=\"?format=diff&amp;new=317\" class=\"diff\">Unified Diff</a>\n        </li><li class=\"last\">\n          <a rel=\"nofollow\" href=\"?format=zip&amp;new=317\" class=\"zip\">Zip Archive</a>\n        </li>\n      </ul>\n    </div>\n    </div>\n    <div id=\"footer\" lang=\"en\" xml:lang=\"en\"><hr />\n      <a id=\"tracpowered\" href=\"http://trac.edgewall.org/\"><img src=\"/LUCICodeRepository/nomaticIM/chrome/common/trac_logo_mini.png\" height=\"30\" width=\"107\" alt=\"Trac Powered\" /></a>\n      <p class=\"left\">Powered by <a href=\"/LUCICodeRepository/nomaticIM/about\"><strong>Trac 1.0.1</strong></a><br />\n        By <a href=\"http://www.edgewall.org/\">Edgewall Software</a>.</p>\n      <p class=\"right\">All content copyright 2007-2008 by LUCI <br /><a href=\"http://luci.ics.uci.edu/\">http://luci.ics.uci.edu/</a></p>\n    </div>\n\t\t<div id=\"sitefooter\">\n\t\t\t<script src=\"http://www.google-analytics.com/urchin.js\" type=\"text/javascript\">\n\t\t\t</script>\n\t\t\t<script type=\"text/javascript\">\n\t\t\t\t_uacct = \"UA-338915-2\";\n\t\t\t\turchinTracker();\n\t\t\t</script>\n\t\t</div>\n\t</body>\n</html>", "id": 45695.0}