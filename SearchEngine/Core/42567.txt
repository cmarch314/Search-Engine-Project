{"text": "Search LoginPreferencesHelp GuideAbout Trac WikiTimelineRoadmapBrowse SourceView TicketsSearch Context Navigation Previous RevisionNext Revision BlameRevision Log source nomatic tags NomaticIM 5 buddy bots src oscar bot nomatic oscar bot py View diff against View revision Visit trunk Last change on this file was 868 checked in by cbaker 7 years ago avoiding people changing how their screenname is formated resulting in extra entries in the database File size 4 3 KB Line 1 usr bin python23import re4import MySQLdb56from twisted words protocols import oscar7from twisted internet import protocol reactor891 WATCH LIST FILE LOCATION watch list txt 1112class SQL Connection 13 14 def init self username password database 15 self db MySQLdb connect user username passwd password db database 16 self cursor self db cursor 1718 def add user self username 19 Add a user to the users table if they don t already exist 2 21 sql select id from nomaticIM 1 imbotUsers where 22 screenname s username23 24 self cursor execute sql 25 results self cursor fetchall 26 print looking for s found username results2728 if results is 29 this user isn t already in the database3 sql insert into nomaticIM 1 imbotUsers screenname values31 s username32 self cursor execute sql 33 self db commit 3435 def log event self screenname signon 36 37 make sure the signon parameter is a boolean38 true is signon false is signff 39 if not type signon is type True 4 raise Exception signon parameter is expected to be a boolean 4142 sql INSERT INTO nomaticIM 1 imbotConnection user id signon 43 VALUES SELECT id FROM nomaticIM 1 imbotUsers WHERE screenname s 44 s screenname signon 4546 try 47 self cursor execute sql 48 self db commit 49 except MySQLdb OperationalError 5 tried to log a buddy that does not exist in the users table51 pass52535455class Bot oscar BOSConnection 56 57 reload request re compile reload 58 PROFILE This is the bot s profile 59 6 capabilities oscar CAP CHAT 61 62 63 def init self username cookie 64 oscar BOSConnection init self username cookie 65 self sql conn SQL Connection imbot imbot nomatic 66 67 def load watch list self 68 file open WATCH LIST FILE LOCATION 69 7 for line in file 71 if line is not None and line is not 72 line line strip 73 if line not in self watch list 74 username line lower 75 if username not in self watch list 76 self watch list append username 77 self sql conn add user username 78 79 print watch list loaded self watch list8 81 def initDone self 82 print Connected 83 84 self requestSelfInfo addCallback self gotSelfInfo 85 self requestSSI addCallback self gotBuddyList 86 87 load the users we re supposed to be watching88 from a file89 self watch list 9 self load watch list 91 92 93 def gotSelfInfo self user 94 self name user name95 self self user user96 97 def gotBuddyList self l 98 self activateSSI 99 self setProfile self PROFILE 1 self setIdleTime 1 1 self buddylist l1 2 self clientReady 1 3 1 4 def receiveMessage self user multiparts flags 1 5 matcher re search self reload request multiparts 1 6 if matcher 1 7 self load watch list 1 8 1 9 def updateBuddy self user 11 if self simplifyScreenname user name in self watch list 111 print event user name online True 112 self sql conn log event self simplifyScreenname user name True 113114 def simplifyScreenname self string 115 ret 116 for piece in string split 117 ret piece118 119 return ret lower 12 121 def offlineBuddy self user 122 if user name in self watch list 123 print event user name online False 124 self sql conn log event user name False 125126127class OA oscar OscarAuthenticator 128 BOSClass Bot12913 131132if name main 133 134 SN nomaticbot1 135 PASS nompass321 136 137 if SN isdigit 138 icqMode 1139 hostport login icq com 5238 14 else 141 hostport login oscar aol com 519 142 icqMode 143 144 protocol ClientCreator reactor OA SN PASS icq icqMode connectTCP hostport 145 reactor run 14614714814915 Note See TracBrowser for help on using the repository browser Download in other formats Plain Text Original Format Powered by Trac 1 1 By Edgewall Software All content copyright 2 7 2 8 by LUCI http luci ics uci edu ", "_id": "http://djp3-pc2.ics.uci.edu/LUCICodeRepository/nomaticIM/browser/nomatic/tags/NomaticIM-0.0.5/buddy_bots/src/oscar_bot/nomatic_oscar_bot.py", "title": "\n      nomatic_oscar_bot.py in nomatic/tags/nomaticim-0.0.5/buddy_bots/src/oscar_bot\n     \u2013 nomatic*im\n    ", "html": "<!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Strict//EN\" \"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd\">\n<html xmlns=\"http://www.w3.org/1999/xhtml\">\n  \n  \n\n  \n\n\n  <head>\n\t\t<title>\n      nomatic_oscar_bot.py in nomatic/tags/NomaticIM-0.0.5/buddy_bots/src/oscar_bot\n     \u2013 Nomatic*IM\n    </title><meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\" /><meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge\" /><link rel=\"search\" href=\"/LUCICodeRepository/nomaticIM/search\" /><link rel=\"help\" href=\"/LUCICodeRepository/nomaticIM/wiki/TracGuide\" /><link rel=\"alternate\" href=\"/LUCICodeRepository/nomaticIM/browser/nomatic/tags/NomaticIM-0.0.5/buddy_bots/src/oscar_bot/nomatic_oscar_bot.py?format=txt\" type=\"text/plain\" title=\"Plain Text\" /><link rel=\"alternate\" href=\"/LUCICodeRepository/nomaticIM/export/1312/nomatic/tags/NomaticIM-0.0.5/buddy_bots/src/oscar_bot/nomatic_oscar_bot.py\" type=\"application/x-python; charset=iso-8859-15\" title=\"Original Format\" /><link rel=\"start\" href=\"/LUCICodeRepository/nomaticIM/wiki\" /><link rel=\"stylesheet\" href=\"/LUCICodeRepository/nomaticIM/chrome/common/css/trac.css\" type=\"text/css\" /><link rel=\"stylesheet\" href=\"/LUCICodeRepository/nomaticIM/chrome/common/css/code.css\" type=\"text/css\" /><link rel=\"stylesheet\" href=\"/LUCICodeRepository/nomaticIM/pygments/trac.css\" type=\"text/css\" /><link rel=\"stylesheet\" href=\"/LUCICodeRepository/nomaticIM/chrome/common/css/browser.css\" type=\"text/css\" /><link rel=\"prev\" href=\"/LUCICodeRepository/nomaticIM/browser/nomatic/trunk/buddy_bots/src/oscar_bot/nomatic_oscar_bot.py?rev=867\" title=\"Revision 867\" /><link rel=\"shortcut icon\" href=\"http://luci.ics.uci.edu/logo32by32.gif\" type=\"image/gif\" /><link rel=\"icon\" href=\"http://luci.ics.uci.edu/logo32by32.gif\" type=\"image/gif\" /><link type=\"application/opensearchdescription+xml\" rel=\"search\" href=\"/LUCICodeRepository/nomaticIM/search/opensearch\" title=\"Search Nomatic*IM\" /><script type=\"text/javascript\" charset=\"utf-8\" src=\"/LUCICodeRepository/nomaticIM/chrome/common/js/jquery.js\"></script><script type=\"text/javascript\" charset=\"utf-8\" src=\"/LUCICodeRepository/nomaticIM/chrome/common/js/babel.js\"></script><script type=\"text/javascript\" charset=\"utf-8\" src=\"/LUCICodeRepository/nomaticIM/chrome/common/js/messages/en_US.js\"></script><script type=\"text/javascript\" charset=\"utf-8\" src=\"/LUCICodeRepository/nomaticIM/chrome/common/js/trac.js\"></script><script type=\"text/javascript\" charset=\"utf-8\" src=\"/LUCICodeRepository/nomaticIM/chrome/common/js/search.js\"></script><script type=\"text/javascript\" src=\"/LUCICodeRepository/nomaticIM/chrome/common/js/folding.js\"></script><script type=\"text/javascript\">\n      jQuery(document).ready(function($) {\n        $(\".trac-toggledeleted\").show().click(function() {\n                  $(this).siblings().find(\".trac-deleted\").toggle();\n                  return false;\n        }).click();\n        $(\"#jumploc input\").hide();\n        $(\"#jumploc select\").change(function () {\n          this.parentNode.parentNode.submit();\n        });\n          $('#preview table.code').enableCollapsibleColumns($('#preview table.code thead th.content'));\n      });\n    </script>\n\t</head>\n  <body>\n    <div id=\"banner\">\n      <div id=\"header\">\n        <a id=\"logo\" href=\"http://luci.ics.uci.edu/#code\"><img src=\"http://luci.ics.uci.edu/blog/archives/LUCIhorzTight.jpg\" alt=\"LUCI Code Repository\" /></a>\n      </div>\n      <form id=\"search\" action=\"/LUCICodeRepository/nomaticIM/search\" method=\"get\">\n        <div>\n          <label for=\"proj-search\">Search:</label>\n          <input type=\"text\" id=\"proj-search\" name=\"q\" size=\"18\" value=\"\" />\n          <input type=\"submit\" value=\"Search\" />\n        </div>\n      </form>\n      <div id=\"metanav\" class=\"nav\">\n    <ul>\n      <li class=\"first\"><a href=\"/LUCICodeRepository/nomaticIM/login\">Login</a></li><li><a href=\"/LUCICodeRepository/nomaticIM/prefs\">Preferences</a></li><li><a href=\"/LUCICodeRepository/nomaticIM/wiki/TracGuide\">Help/Guide</a></li><li class=\"last\"><a href=\"/LUCICodeRepository/nomaticIM/about\">About Trac</a></li>\n    </ul>\n  </div>\n    </div>\n    <div id=\"mainnav\" class=\"nav\">\n    <ul>\n      <li class=\"first\"><a href=\"/LUCICodeRepository/nomaticIM/wiki\">Wiki</a></li><li><a href=\"/LUCICodeRepository/nomaticIM/timeline\">Timeline</a></li><li><a href=\"/LUCICodeRepository/nomaticIM/roadmap\">Roadmap</a></li><li class=\"active\"><a href=\"/LUCICodeRepository/nomaticIM/browser\">Browse Source</a></li><li><a href=\"/LUCICodeRepository/nomaticIM/report\">View Tickets</a></li><li class=\"last\"><a href=\"/LUCICodeRepository/nomaticIM/search\">Search</a></li>\n    </ul>\n  </div>\n    <div id=\"main\">\n      <div id=\"ctxtnav\" class=\"nav\">\n        <h2>Context Navigation</h2>\n        <ul>\n          <li class=\"first\"><span>&larr; <a class=\"prev\" href=\"/LUCICodeRepository/nomaticIM/browser/nomatic/trunk/buddy_bots/src/oscar_bot/nomatic_oscar_bot.py?rev=867\" title=\"Revision 867\">Previous Revision</a></span></li><li><span class=\"missing\">Next Revision &rarr;</span></li><li><a href=\"/LUCICodeRepository/nomaticIM/browser/nomatic/trunk/buddy_bots/src/oscar_bot/nomatic_oscar_bot.py?annotate=blame\" title=\"Annotate each line with the last changed revision (this can be time consuming...)\">Blame</a></li><li class=\"last\"><a href=\"/LUCICodeRepository/nomaticIM/log/nomatic/tags/NomaticIM-0.0.5/buddy_bots/src/oscar_bot/nomatic_oscar_bot.py\">Revision Log</a></li>\n        </ul>\n        <hr />\n      </div>\n    <div id=\"content\" class=\"browser\">\n        <h1>\n          \n<a class=\"pathentry first\" href=\"/LUCICodeRepository/nomaticIM/browser?order=name\" title=\"Go to repository root\">source:</a>\n<a class=\"pathentry\" href=\"/LUCICodeRepository/nomaticIM/browser/nomatic?order=name\" title=\"View nomatic\">nomatic</a><span class=\"pathentry sep\">/</span><a class=\"pathentry\" href=\"/LUCICodeRepository/nomaticIM/browser/nomatic/tags?order=name\" title=\"View tags\">tags</a><span class=\"pathentry sep\">/</span><a class=\"pathentry\" href=\"/LUCICodeRepository/nomaticIM/browser/nomatic/tags/NomaticIM-0.0.5?order=name\" title=\"View NomaticIM-0.0.5\">NomaticIM-0.0.5</a><span class=\"pathentry sep\">/</span><a class=\"pathentry\" href=\"/LUCICodeRepository/nomaticIM/browser/nomatic/tags/NomaticIM-0.0.5/buddy_bots?order=name\" title=\"View buddy_bots\">buddy_bots</a><span class=\"pathentry sep\">/</span><a class=\"pathentry\" href=\"/LUCICodeRepository/nomaticIM/browser/nomatic/tags/NomaticIM-0.0.5/buddy_bots/src?order=name\" title=\"View src\">src</a><span class=\"pathentry sep\">/</span><a class=\"pathentry\" href=\"/LUCICodeRepository/nomaticIM/browser/nomatic/tags/NomaticIM-0.0.5/buddy_bots/src/oscar_bot?order=name\" title=\"View oscar_bot\">oscar_bot</a><span class=\"pathentry sep\">/</span><a class=\"pathentry\" href=\"/LUCICodeRepository/nomaticIM/browser/nomatic/tags/NomaticIM-0.0.5/buddy_bots/src/oscar_bot/nomatic_oscar_bot.py?order=name\" title=\"View nomatic_oscar_bot.py\">nomatic_oscar_bot.py</a>\n<br style=\"clear: both\" />\n\n        </h1>\n        <div id=\"diffrev\">\n          <form action=\"/LUCICodeRepository/nomaticIM/changeset\" method=\"get\">\n            <div>\n              <label title=\"Show the diff against a specific revision\">\n                View diff against: <input type=\"text\" name=\"old\" size=\"6\" />\n                <input type=\"hidden\" name=\"old_path\" value=\"nomatic/tags/NomaticIM-0.0.5/buddy_bots/src/oscar_bot/nomatic_oscar_bot.py\" />\n                <input type=\"hidden\" name=\"new\" />\n                <input type=\"hidden\" name=\"new_path\" value=\"nomatic/tags/NomaticIM-0.0.5/buddy_bots/src/oscar_bot/nomatic_oscar_bot.py\" />\n              </label>\n            </div>\n          </form>\n        </div>\n        <div id=\"jumprev\">\n          <form action=\"\" method=\"get\">\n            <div>\n              <label for=\"rev\">\n                View revision:</label>\n              <input type=\"text\" id=\"rev\" name=\"rev\" size=\"6\" />\n            </div>\n          </form>\n        </div>\n        <div id=\"jumploc\">\n          <form action=\"\" method=\"get\">\n            <div class=\"buttons\">\n              <label for=\"preselected\">Visit:</label>\n              <select id=\"preselected\" name=\"preselected\">\n                <option selected=\"selected\"></option>\n                <optgroup label=\"branches\">\n                  <option value=\"/LUCICodeRepository/nomaticIM/browser/trunk\">trunk</option>\n                </optgroup>\n              </select>\n              <input type=\"submit\" value=\"Go!\" title=\"Jump to the chosen preselected path\" />\n            </div>\n          </form>\n        </div>\n        <div class=\"trac-tags\">\n        </div>\n      <table id=\"info\" summary=\"Revision info\">\n        <tr>\n          <th>\n                <a href=\"/LUCICodeRepository/nomaticIM/changeset/868/nomatic/trunk/buddy_bots/src/oscar_bot/nomatic_oscar_bot.py\" title=\"View differences\">Last change</a>\n                  on this file was\n                  <a href=\"/LUCICodeRepository/nomaticIM/changeset/868/\" title=\"View changeset 868\">868</a>,\n                  checked in by cbaker, <a class=\"timeline\" href=\"/LUCICodeRepository/nomaticIM/timeline?from=2008-02-27T15%3A33%3A03-08%3A00&amp;precision=second\" title=\"See timeline at Feb 27, 2008, 3:33:03 PM\">7 years ago</a>\n          </th>\n        </tr>\n        <tr>\n          <td class=\"message searchable\">\n              <p>\navoiding people changing how their screenname is formated resulting in extra entries in the database<br />\n</p>\n          </td>\n        </tr>\n        <tr><td colspan=\"2\">\n            <strong>File size:</strong>\n            <span title=\"4416 bytes\">4.3 KB</span>\n          </td></tr>\n      </table>\n      <div id=\"preview\" class=\"searchable\">\n        \n  <table class=\"code\"><thead><tr><th class=\"lineno\" title=\"Line numbers\">Line</th><th class=\"content\">\u00a0</th></tr></thead><tbody><tr><th id=\"L1\"><a href=\"#L1\">1</a></th><td><span class=\"c\">#!/usr/bin/python</span></td></tr><tr><th id=\"L2\"><a href=\"#L2\">2</a></th><td></td></tr><tr><th id=\"L3\"><a href=\"#L3\">3</a></th><td><span class=\"kn\">import</span>\u00a0<span class=\"nn\">re</span></td></tr><tr><th id=\"L4\"><a href=\"#L4\">4</a></th><td><span class=\"kn\">import</span>\u00a0<span class=\"nn\">MySQLdb</span></td></tr><tr><th id=\"L5\"><a href=\"#L5\">5</a></th><td></td></tr><tr><th id=\"L6\"><a href=\"#L6\">6</a></th><td><span class=\"kn\">from</span>\u00a0<span class=\"nn\">twisted.words.protocols</span>\u00a0<span class=\"kn\">import</span>\u00a0oscar</td></tr><tr><th id=\"L7\"><a href=\"#L7\">7</a></th><td><span class=\"kn\">from</span>\u00a0<span class=\"nn\">twisted.internet</span>\u00a0<span class=\"kn\">import</span>\u00a0protocol<span class=\"p\">,</span>\u00a0reactor</td></tr><tr><th id=\"L8\"><a href=\"#L8\">8</a></th><td></td></tr><tr><th id=\"L9\"><a href=\"#L9\">9</a></th><td></td></tr><tr><th id=\"L10\"><a href=\"#L10\">10</a></th><td>WATCH_LIST_FILE_LOCATION <span class=\"o\">=</span>\u00a0<span class=\"s\">'watch_list.txt'</span></td></tr><tr><th id=\"L11\"><a href=\"#L11\">11</a></th><td></td></tr><tr><th id=\"L12\"><a href=\"#L12\">12</a></th><td><span class=\"k\">class</span>\u00a0<span class=\"nc\">SQL_Connection</span><span class=\"p\">:</span></td></tr><tr><th id=\"L13\"><a href=\"#L13\">13</a></th><td>\u00a0 \u00a0 </td></tr><tr><th id=\"L14\"><a href=\"#L14\">14</a></th><td>\u00a0 \u00a0 <span class=\"k\">def</span>\u00a0<span class=\"nf\">__init__</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span>\u00a0username<span class=\"p\">,</span>\u00a0password<span class=\"p\">,</span>\u00a0database<span class=\"p\">):</span></td></tr><tr><th id=\"L15\"><a href=\"#L15\">15</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"bp\">self</span><span class=\"o\">.</span>db <span class=\"o\">=</span>\u00a0MySQLdb<span class=\"o\">.</span>connect<span class=\"p\">(</span>user<span class=\"o\">=</span>username<span class=\"p\">,</span>\u00a0passwd<span class=\"o\">=</span>password<span class=\"p\">,</span>\u00a0db<span class=\"o\">=</span>database<span class=\"p\">)</span></td></tr><tr><th id=\"L16\"><a href=\"#L16\">16</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"bp\">self</span><span class=\"o\">.</span>cursor <span class=\"o\">=</span>\u00a0<span class=\"bp\">self</span><span class=\"o\">.</span>db<span class=\"o\">.</span>cursor<span class=\"p\">()</span></td></tr><tr><th id=\"L17\"><a href=\"#L17\">17</a></th><td></td></tr><tr><th id=\"L18\"><a href=\"#L18\">18</a></th><td>\u00a0 \u00a0 <span class=\"k\">def</span>\u00a0<span class=\"nf\">add_user</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span>\u00a0username<span class=\"p\">):</span></td></tr><tr><th id=\"L19\"><a href=\"#L19\">19</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"sd\">\"\"\"Add a user to the users table if they don't already exist\"\"\"</span></td></tr><tr><th id=\"L20\"><a href=\"#L20\">20</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 </td></tr><tr><th id=\"L21\"><a href=\"#L21\">21</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 sql <span class=\"o\">=</span>\u00a0<span class=\"s\">\"\"\"select id from nomaticIM_01_imbotUsers where </span></td></tr><tr><th id=\"L22\"><a href=\"#L22\">22</a></th><td><span class=\"s\">\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 screenname='</span><span class=\"si\">%s</span><span class=\"s\">';\"\"\"</span>\u00a0<span class=\"o\">%</span>\u00a0username</td></tr><tr><th id=\"L23\"><a href=\"#L23\">23</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 </td></tr><tr><th id=\"L24\"><a href=\"#L24\">24</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"bp\">self</span><span class=\"o\">.</span>cursor<span class=\"o\">.</span>execute<span class=\"p\">(</span>sql<span class=\"p\">)</span></td></tr><tr><th id=\"L25\"><a href=\"#L25\">25</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 results <span class=\"o\">=</span>\u00a0<span class=\"bp\">self</span><span class=\"o\">.</span>cursor<span class=\"o\">.</span>fetchall<span class=\"p\">()</span></td></tr><tr><th id=\"L26\"><a href=\"#L26\">26</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"c\">#print \"looking for %s, found\" % username, results</span></td></tr><tr><th id=\"L27\"><a href=\"#L27\">27</a></th><td></td></tr><tr><th id=\"L28\"><a href=\"#L28\">28</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">if</span>\u00a0results <span class=\"ow\">is</span>\u00a0<span class=\"p\">():</span></td></tr><tr><th id=\"L29\"><a href=\"#L29\">29</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"c\"># this user isn't already in the database</span></td></tr><tr><th id=\"L30\"><a href=\"#L30\">30</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 sql <span class=\"o\">=</span>\u00a0<span class=\"s\">\"\"\"insert into nomaticIM_01_imbotUsers(screenname) values</span></td></tr><tr><th id=\"L31\"><a href=\"#L31\">31</a></th><td><span class=\"s\">\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 ('</span><span class=\"si\">%s</span><span class=\"s\">')\"\"\"</span>\u00a0<span class=\"o\">%</span>\u00a0username</td></tr><tr><th id=\"L32\"><a href=\"#L32\">32</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"bp\">self</span><span class=\"o\">.</span>cursor<span class=\"o\">.</span>execute<span class=\"p\">(</span>sql<span class=\"p\">)</span></td></tr><tr><th id=\"L33\"><a href=\"#L33\">33</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"bp\">self</span><span class=\"o\">.</span>db<span class=\"o\">.</span>commit<span class=\"p\">()</span></td></tr><tr><th id=\"L34\"><a href=\"#L34\">34</a></th><td></td></tr><tr><th id=\"L35\"><a href=\"#L35\">35</a></th><td>\u00a0 \u00a0 <span class=\"k\">def</span>\u00a0<span class=\"nf\">log_event</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span>\u00a0screenname<span class=\"p\">,</span>\u00a0signon<span class=\"p\">):</span></td></tr><tr><th id=\"L36\"><a href=\"#L36\">36</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 </td></tr><tr><th id=\"L37\"><a href=\"#L37\">37</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"c\"># make sure the signon parameter is a boolean</span></td></tr><tr><th id=\"L38\"><a href=\"#L38\">38</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"c\"># (true is signon, false is signff)</span></td></tr><tr><th id=\"L39\"><a href=\"#L39\">39</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">if</span>\u00a0<span class=\"ow\">not</span>\u00a0<span class=\"nb\">type</span><span class=\"p\">(</span>signon<span class=\"p\">)</span>\u00a0<span class=\"ow\">is</span>\u00a0<span class=\"nb\">type</span><span class=\"p\">(</span><span class=\"bp\">True</span><span class=\"p\">):</span></td></tr><tr><th id=\"L40\"><a href=\"#L40\">40</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">raise</span>\u00a0<span class=\"ne\">Exception</span><span class=\"p\">(</span><span class=\"s\">'signon parameter is expected to be a boolean'</span><span class=\"p\">)</span></td></tr><tr><th id=\"L41\"><a href=\"#L41\">41</a></th><td></td></tr><tr><th id=\"L42\"><a href=\"#L42\">42</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 sql <span class=\"o\">=</span>\u00a0<span class=\"s\">\"\"\"INSERT INTO nomaticIM_01_imbotConnection(user_id, signon)</span></td></tr><tr><th id=\"L43\"><a href=\"#L43\">43</a></th><td><span class=\"s\">\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 VALUES ((SELECT id FROM nomaticIM_01_imbotUsers WHERE screenname='</span><span class=\"si\">%s</span><span class=\"s\">'),</span></td></tr><tr><th id=\"L44\"><a href=\"#L44\">44</a></th><td><span class=\"s\">\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 </span><span class=\"si\">%s</span><span class=\"s\">);\"\"\"</span>\u00a0 <span class=\"o\">%</span>\u00a0<span class=\"p\">(</span>screenname<span class=\"p\">,</span>\u00a0signon<span class=\"p\">)</span></td></tr><tr><th id=\"L45\"><a href=\"#L45\">45</a></th><td></td></tr><tr><th id=\"L46\"><a href=\"#L46\">46</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">try</span><span class=\"p\">:</span></td></tr><tr><th id=\"L47\"><a href=\"#L47\">47</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"bp\">self</span><span class=\"o\">.</span>cursor<span class=\"o\">.</span>execute<span class=\"p\">(</span>sql<span class=\"p\">)</span></td></tr><tr><th id=\"L48\"><a href=\"#L48\">48</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"bp\">self</span><span class=\"o\">.</span>db<span class=\"o\">.</span>commit<span class=\"p\">()</span></td></tr><tr><th id=\"L49\"><a href=\"#L49\">49</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">except</span>\u00a0MySQLdb<span class=\"o\">.</span>OperationalError<span class=\"p\">:</span></td></tr><tr><th id=\"L50\"><a href=\"#L50\">50</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"c\"># tried to log a buddy that does not exist in the users table</span></td></tr><tr><th id=\"L51\"><a href=\"#L51\">51</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">pass</span></td></tr><tr><th id=\"L52\"><a href=\"#L52\">52</a></th><td></td></tr><tr><th id=\"L53\"><a href=\"#L53\">53</a></th><td></td></tr><tr><th id=\"L54\"><a href=\"#L54\">54</a></th><td></td></tr><tr><th id=\"L55\"><a href=\"#L55\">55</a></th><td><span class=\"k\">class</span>\u00a0<span class=\"nc\">Bot</span><span class=\"p\">(</span>oscar<span class=\"o\">.</span>BOSConnection<span class=\"p\">):</span></td></tr><tr><th id=\"L56\"><a href=\"#L56\">56</a></th><td>\u00a0 \u00a0 </td></tr><tr><th id=\"L57\"><a href=\"#L57\">57</a></th><td>\u00a0 \u00a0 reload_request <span class=\"o\">=</span>\u00a0re<span class=\"o\">.</span>compile<span class=\"p\">(</span><span class=\"s\">'reload'</span><span class=\"p\">)</span></td></tr><tr><th id=\"L58\"><a href=\"#L58\">58</a></th><td>\u00a0 \u00a0 PROFILE <span class=\"o\">=</span>\u00a0<span class=\"s\">\"This is the bot's profile\"</span></td></tr><tr><th id=\"L59\"><a href=\"#L59\">59</a></th><td>\u00a0 \u00a0 </td></tr><tr><th id=\"L60\"><a href=\"#L60\">60</a></th><td>\u00a0 \u00a0 capabilities <span class=\"o\">=</span>\u00a0<span class=\"p\">[</span>oscar<span class=\"o\">.</span>CAP_CHAT<span class=\"p\">]</span></td></tr><tr><th id=\"L61\"><a href=\"#L61\">61</a></th><td>\u00a0 \u00a0 </td></tr><tr><th id=\"L62\"><a href=\"#L62\">62</a></th><td>\u00a0 \u00a0 </td></tr><tr><th id=\"L63\"><a href=\"#L63\">63</a></th><td>\u00a0 \u00a0 <span class=\"k\">def</span>\u00a0<span class=\"nf\">__init__</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span>\u00a0username<span class=\"p\">,</span>\u00a0cookie<span class=\"p\">):</span></td></tr><tr><th id=\"L64\"><a href=\"#L64\">64</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 oscar<span class=\"o\">.</span>BOSConnection<span class=\"o\">.</span>__init__<span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span>\u00a0username<span class=\"p\">,</span>\u00a0cookie<span class=\"p\">)</span></td></tr><tr><th id=\"L65\"><a href=\"#L65\">65</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"bp\">self</span><span class=\"o\">.</span>sql_conn <span class=\"o\">=</span>\u00a0SQL_Connection<span class=\"p\">(</span><span class=\"s\">'imbot'</span><span class=\"p\">,</span>\u00a0<span class=\"s\">'imbot?!'</span><span class=\"p\">,</span>\u00a0<span class=\"s\">'nomatic'</span><span class=\"p\">)</span></td></tr><tr><th id=\"L66\"><a href=\"#L66\">66</a></th><td>\u00a0 \u00a0 </td></tr><tr><th id=\"L67\"><a href=\"#L67\">67</a></th><td>\u00a0 \u00a0 <span class=\"k\">def</span>\u00a0<span class=\"nf\">_load_watch_list</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">):</span></td></tr><tr><th id=\"L68\"><a href=\"#L68\">68</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"nb\">file</span>\u00a0<span class=\"o\">=</span>\u00a0<span class=\"nb\">open</span><span class=\"p\">(</span>WATCH_LIST_FILE_LOCATION<span class=\"p\">)</span></td></tr><tr><th id=\"L69\"><a href=\"#L69\">69</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 </td></tr><tr><th id=\"L70\"><a href=\"#L70\">70</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">for</span>\u00a0line <span class=\"ow\">in</span>\u00a0<span class=\"nb\">file</span><span class=\"p\">:</span></td></tr><tr><th id=\"L71\"><a href=\"#L71\">71</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">if</span>\u00a0line <span class=\"ow\">is</span>\u00a0<span class=\"ow\">not</span>\u00a0<span class=\"bp\">None</span>\u00a0<span class=\"ow\">and</span>\u00a0line <span class=\"ow\">is</span>\u00a0<span class=\"ow\">not</span>\u00a0<span class=\"s\">\"\"</span><span class=\"p\">:</span></td></tr><tr><th id=\"L72\"><a href=\"#L72\">72</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 line <span class=\"o\">=</span>\u00a0line<span class=\"o\">.</span>strip<span class=\"p\">()</span></td></tr><tr><th id=\"L73\"><a href=\"#L73\">73</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">if</span>\u00a0line <span class=\"ow\">not</span>\u00a0<span class=\"ow\">in</span>\u00a0<span class=\"bp\">self</span><span class=\"o\">.</span>watch_list<span class=\"p\">:</span></td></tr><tr><th id=\"L74\"><a href=\"#L74\">74</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 username <span class=\"o\">=</span>\u00a0line<span class=\"o\">.</span>lower<span class=\"p\">()</span></td></tr><tr><th id=\"L75\"><a href=\"#L75\">75</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">if</span>\u00a0username <span class=\"ow\">not</span>\u00a0<span class=\"ow\">in</span>\u00a0<span class=\"bp\">self</span><span class=\"o\">.</span>watch_list<span class=\"p\">:</span></td></tr><tr><th id=\"L76\"><a href=\"#L76\">76</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"bp\">self</span><span class=\"o\">.</span>watch_list<span class=\"o\">.</span>append<span class=\"p\">(</span>username<span class=\"p\">)</span></td></tr><tr><th id=\"L77\"><a href=\"#L77\">77</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"bp\">self</span><span class=\"o\">.</span>sql_conn<span class=\"o\">.</span>add_user<span class=\"p\">(</span>username<span class=\"p\">)</span></td></tr><tr><th id=\"L78\"><a href=\"#L78\">78</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 </td></tr><tr><th id=\"L79\"><a href=\"#L79\">79</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">print</span>\u00a0<span class=\"s\">'watch list loaded:'</span><span class=\"p\">,</span>\u00a0<span class=\"bp\">self</span><span class=\"o\">.</span>watch_list</td></tr><tr><th id=\"L80\"><a href=\"#L80\">80</a></th><td>\u00a0 \u00a0 </td></tr><tr><th id=\"L81\"><a href=\"#L81\">81</a></th><td>\u00a0 \u00a0 <span class=\"k\">def</span>\u00a0<span class=\"nf\">initDone</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">):</span></td></tr><tr><th id=\"L82\"><a href=\"#L82\">82</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">print</span>\u00a0<span class=\"s\">'Connected.'</span></td></tr><tr><th id=\"L83\"><a href=\"#L83\">83</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 </td></tr><tr><th id=\"L84\"><a href=\"#L84\">84</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"bp\">self</span><span class=\"o\">.</span>requestSelfInfo<span class=\"p\">()</span><span class=\"o\">.</span>addCallback<span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span>gotSelfInfo<span class=\"p\">)</span></td></tr><tr><th id=\"L85\"><a href=\"#L85\">85</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"bp\">self</span><span class=\"o\">.</span>requestSSI<span class=\"p\">()</span><span class=\"o\">.</span>addCallback<span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span>gotBuddyList<span class=\"p\">)</span></td></tr><tr><th id=\"L86\"><a href=\"#L86\">86</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 </td></tr><tr><th id=\"L87\"><a href=\"#L87\">87</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"c\"># load the users we're supposed to be watching</span></td></tr><tr><th id=\"L88\"><a href=\"#L88\">88</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"c\"># from a file</span></td></tr><tr><th id=\"L89\"><a href=\"#L89\">89</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"bp\">self</span><span class=\"o\">.</span>watch_list <span class=\"o\">=</span>\u00a0<span class=\"p\">[]</span></td></tr><tr><th id=\"L90\"><a href=\"#L90\">90</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"bp\">self</span><span class=\"o\">.</span>_load_watch_list<span class=\"p\">()</span></td></tr><tr><th id=\"L91\"><a href=\"#L91\">91</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 </td></tr><tr><th id=\"L92\"><a href=\"#L92\">92</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 </td></tr><tr><th id=\"L93\"><a href=\"#L93\">93</a></th><td>\u00a0 \u00a0 <span class=\"k\">def</span>\u00a0<span class=\"nf\">gotSelfInfo</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span>\u00a0user<span class=\"p\">):</span></td></tr><tr><th id=\"L94\"><a href=\"#L94\">94</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"bp\">self</span><span class=\"o\">.</span>name <span class=\"o\">=</span>\u00a0user<span class=\"o\">.</span>name</td></tr><tr><th id=\"L95\"><a href=\"#L95\">95</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"bp\">self</span><span class=\"o\">.</span>self_user <span class=\"o\">=</span>\u00a0user</td></tr><tr><th id=\"L96\"><a href=\"#L96\">96</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 </td></tr><tr><th id=\"L97\"><a href=\"#L97\">97</a></th><td>\u00a0 \u00a0 <span class=\"k\">def</span>\u00a0<span class=\"nf\">gotBuddyList</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span>\u00a0l<span class=\"p\">):</span></td></tr><tr><th id=\"L98\"><a href=\"#L98\">98</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"bp\">self</span><span class=\"o\">.</span>activateSSI<span class=\"p\">()</span></td></tr><tr><th id=\"L99\"><a href=\"#L99\">99</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"bp\">self</span><span class=\"o\">.</span>setProfile<span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span>PROFILE<span class=\"p\">)</span></td></tr><tr><th id=\"L100\"><a href=\"#L100\">100</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"bp\">self</span><span class=\"o\">.</span>setIdleTime<span class=\"p\">(</span><span class=\"mi\">0</span><span class=\"p\">)</span></td></tr><tr><th id=\"L101\"><a href=\"#L101\">101</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"bp\">self</span><span class=\"o\">.</span>buddylist <span class=\"o\">=</span>\u00a0l</td></tr><tr><th id=\"L102\"><a href=\"#L102\">102</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"bp\">self</span><span class=\"o\">.</span>clientReady<span class=\"p\">()</span></td></tr><tr><th id=\"L103\"><a href=\"#L103\">103</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 </td></tr><tr><th id=\"L104\"><a href=\"#L104\">104</a></th><td>\u00a0 \u00a0 <span class=\"k\">def</span>\u00a0<span class=\"nf\">receiveMessage</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span>\u00a0user<span class=\"p\">,</span>\u00a0multiparts<span class=\"p\">,</span>\u00a0flags<span class=\"p\">):</span></td></tr><tr><th id=\"L105\"><a href=\"#L105\">105</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 matcher <span class=\"o\">=</span>\u00a0re<span class=\"o\">.</span>search<span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span>reload_request<span class=\"p\">,</span>\u00a0multiparts<span class=\"p\">[</span><span class=\"mi\">0</span><span class=\"p\">][</span><span class=\"mi\">0</span><span class=\"p\">])</span></td></tr><tr><th id=\"L106\"><a href=\"#L106\">106</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">if</span>\u00a0matcher<span class=\"p\">:</span></td></tr><tr><th id=\"L107\"><a href=\"#L107\">107</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"bp\">self</span><span class=\"o\">.</span>_load_watch_list<span class=\"p\">()</span></td></tr><tr><th id=\"L108\"><a href=\"#L108\">108</a></th><td>\u00a0 \u00a0 </td></tr><tr><th id=\"L109\"><a href=\"#L109\">109</a></th><td>\u00a0 \u00a0 <span class=\"k\">def</span>\u00a0<span class=\"nf\">updateBuddy</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span>\u00a0user<span class=\"p\">):</span></td></tr><tr><th id=\"L110\"><a href=\"#L110\">110</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">if</span>\u00a0<span class=\"bp\">self</span><span class=\"o\">.</span>simplifyScreenname<span class=\"p\">(</span>user<span class=\"o\">.</span>name<span class=\"p\">)</span>\u00a0<span class=\"ow\">in</span>\u00a0<span class=\"bp\">self</span><span class=\"o\">.</span>watch_list<span class=\"p\">:</span></td></tr><tr><th id=\"L111\"><a href=\"#L111\">111</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">print</span>\u00a0<span class=\"s\">'event:'</span><span class=\"p\">,</span>\u00a0user<span class=\"o\">.</span>name<span class=\"p\">,</span>\u00a0<span class=\"s\">'online = True'</span></td></tr><tr><th id=\"L112\"><a href=\"#L112\">112</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"bp\">self</span><span class=\"o\">.</span>sql_conn<span class=\"o\">.</span>log_event<span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span>simplifyScreenname<span class=\"p\">(</span>user<span class=\"o\">.</span>name<span class=\"p\">),</span>\u00a0<span class=\"bp\">True</span><span class=\"p\">);</span></td></tr><tr><th id=\"L113\"><a href=\"#L113\">113</a></th><td></td></tr><tr><th id=\"L114\"><a href=\"#L114\">114</a></th><td>\u00a0 \u00a0 <span class=\"k\">def</span>\u00a0<span class=\"nf\">simplifyScreenname</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span>\u00a0string<span class=\"p\">):</span></td></tr><tr><th id=\"L115\"><a href=\"#L115\">115</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 ret <span class=\"o\">=</span>\u00a0<span class=\"s\">''</span></td></tr><tr><th id=\"L116\"><a href=\"#L116\">116</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">for</span>\u00a0piece <span class=\"ow\">in</span>\u00a0string<span class=\"o\">.</span>split<span class=\"p\">():</span></td></tr><tr><th id=\"L117\"><a href=\"#L117\">117</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 ret <span class=\"o\">+=</span>\u00a0piece</td></tr><tr><th id=\"L118\"><a href=\"#L118\">118</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 </td></tr><tr><th id=\"L119\"><a href=\"#L119\">119</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">return</span>\u00a0ret<span class=\"o\">.</span>lower<span class=\"p\">()</span>\u00a0 \u00a0 </td></tr><tr><th id=\"L120\"><a href=\"#L120\">120</a></th><td>\u00a0 \u00a0 </td></tr><tr><th id=\"L121\"><a href=\"#L121\">121</a></th><td>\u00a0 \u00a0 <span class=\"k\">def</span>\u00a0<span class=\"nf\">offlineBuddy</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span>\u00a0user<span class=\"p\">):</span></td></tr><tr><th id=\"L122\"><a href=\"#L122\">122</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">if</span>\u00a0user<span class=\"o\">.</span>name <span class=\"ow\">in</span>\u00a0<span class=\"bp\">self</span><span class=\"o\">.</span>watch_list<span class=\"p\">:</span></td></tr><tr><th id=\"L123\"><a href=\"#L123\">123</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">print</span>\u00a0<span class=\"s\">'event:'</span><span class=\"p\">,</span>\u00a0user<span class=\"o\">.</span>name<span class=\"p\">,</span>\u00a0<span class=\"s\">'online = False'</span></td></tr><tr><th id=\"L124\"><a href=\"#L124\">124</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"bp\">self</span><span class=\"o\">.</span>sql_conn<span class=\"o\">.</span>log_event<span class=\"p\">(</span>user<span class=\"o\">.</span>name<span class=\"p\">,</span>\u00a0<span class=\"bp\">False</span><span class=\"p\">);</span></td></tr><tr><th id=\"L125\"><a href=\"#L125\">125</a></th><td></td></tr><tr><th id=\"L126\"><a href=\"#L126\">126</a></th><td></td></tr><tr><th id=\"L127\"><a href=\"#L127\">127</a></th><td><span class=\"k\">class</span>\u00a0<span class=\"nc\">OA</span><span class=\"p\">(</span>oscar<span class=\"o\">.</span>OscarAuthenticator<span class=\"p\">):</span></td></tr><tr><th id=\"L128\"><a href=\"#L128\">128</a></th><td>\u00a0 \u00a0BOSClass <span class=\"o\">=</span>\u00a0Bot</td></tr><tr><th id=\"L129\"><a href=\"#L129\">129</a></th><td></td></tr><tr><th id=\"L130\"><a href=\"#L130\">130</a></th><td></td></tr><tr><th id=\"L131\"><a href=\"#L131\">131</a></th><td></td></tr><tr><th id=\"L132\"><a href=\"#L132\">132</a></th><td><span class=\"k\">if</span>\u00a0__name__ <span class=\"o\">==</span>\u00a0<span class=\"s\">'__main__'</span><span class=\"p\">:</span>\u00a0 </td></tr><tr><th id=\"L133\"><a href=\"#L133\">133</a></th><td>\u00a0 \u00a0 </td></tr><tr><th id=\"L134\"><a href=\"#L134\">134</a></th><td>\u00a0 \u00a0 SN <span class=\"o\">=</span>\u00a0<span class=\"s\">\"nomaticbot1\"</span></td></tr><tr><th id=\"L135\"><a href=\"#L135\">135</a></th><td>\u00a0 \u00a0 PASS <span class=\"o\">=</span>\u00a0 <span class=\"s\">\"nompass321\"</span></td></tr><tr><th id=\"L136\"><a href=\"#L136\">136</a></th><td>\u00a0 \u00a0 </td></tr><tr><th id=\"L137\"><a href=\"#L137\">137</a></th><td>\u00a0 \u00a0 <span class=\"k\">if</span>\u00a0SN<span class=\"p\">[</span><span class=\"mi\">0</span><span class=\"p\">]</span><span class=\"o\">.</span>isdigit<span class=\"p\">():</span></td></tr><tr><th id=\"L138\"><a href=\"#L138\">138</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 icqMode <span class=\"o\">=</span>\u00a0<span class=\"mi\">1</span></td></tr><tr><th id=\"L139\"><a href=\"#L139\">139</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 hostport <span class=\"o\">=</span>\u00a0<span class=\"p\">(</span><span class=\"s\">'login.icq.com'</span><span class=\"p\">,</span>\u00a0<span class=\"mi\">5238</span><span class=\"p\">)</span></td></tr><tr><th id=\"L140\"><a href=\"#L140\">140</a></th><td>\u00a0 \u00a0 <span class=\"k\">else</span><span class=\"p\">:</span></td></tr><tr><th id=\"L141\"><a href=\"#L141\">141</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 hostport <span class=\"o\">=</span>\u00a0<span class=\"p\">(</span><span class=\"s\">'login.oscar.aol.com'</span><span class=\"p\">,</span>\u00a0<span class=\"mi\">5190</span><span class=\"p\">)</span></td></tr><tr><th id=\"L142\"><a href=\"#L142\">142</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 icqMode <span class=\"o\">=</span>\u00a0<span class=\"mi\">0</span></td></tr><tr><th id=\"L143\"><a href=\"#L143\">143</a></th><td>\u00a0 \u00a0 </td></tr><tr><th id=\"L144\"><a href=\"#L144\">144</a></th><td>\u00a0 \u00a0 protocol<span class=\"o\">.</span>ClientCreator<span class=\"p\">(</span>reactor<span class=\"p\">,</span>\u00a0OA<span class=\"p\">,</span>\u00a0SN<span class=\"p\">,</span>\u00a0PASS<span class=\"p\">,</span>\u00a0icq<span class=\"o\">=</span>icqMode<span class=\"p\">)</span><span class=\"o\">.</span>connectTCP<span class=\"p\">(</span><span class=\"o\">*</span>hostport<span class=\"p\">)</span></td></tr><tr><th id=\"L145\"><a href=\"#L145\">145</a></th><td>\u00a0 \u00a0 reactor<span class=\"o\">.</span>run<span class=\"p\">()</span></td></tr><tr><th id=\"L146\"><a href=\"#L146\">146</a></th><td></td></tr><tr><th id=\"L147\"><a href=\"#L147\">147</a></th><td></td></tr><tr><th id=\"L148\"><a href=\"#L148\">148</a></th><td></td></tr><tr><th id=\"L149\"><a href=\"#L149\">149</a></th><td></td></tr><tr><th id=\"L150\"><a href=\"#L150\">150</a></th><td></td></tr></tbody></table>\n\n      </div>\n      <div id=\"anydiff\">\n        <form action=\"/LUCICodeRepository/nomaticIM/diff\" method=\"get\">\n          <div class=\"buttons\">\n            <input type=\"hidden\" name=\"new_path\" value=\"/nomatic/tags/NomaticIM-0.0.5/buddy_bots/src/oscar_bot/nomatic_oscar_bot.py\" />\n            <input type=\"hidden\" name=\"old_path\" value=\"/nomatic/tags/NomaticIM-0.0.5/buddy_bots/src/oscar_bot/nomatic_oscar_bot.py\" />\n            <input type=\"hidden\" name=\"new_rev\" />\n            <input type=\"hidden\" name=\"old_rev\" />\n            <input type=\"submit\" value=\"View changes...\" title=\"Select paths and revs for Diff\" />\n          </div>\n        </form>\n      </div>\n      <div id=\"help\"><strong>Note:</strong> See <a href=\"/LUCICodeRepository/nomaticIM/wiki/TracBrowser\">TracBrowser</a>\n        for help on using the repository browser.</div>\n    </div>\n    <div id=\"altlinks\">\n      <h3>Download in other formats:</h3>\n      <ul>\n        <li class=\"first\">\n          <a rel=\"nofollow\" href=\"/LUCICodeRepository/nomaticIM/browser/nomatic/tags/NomaticIM-0.0.5/buddy_bots/src/oscar_bot/nomatic_oscar_bot.py?format=txt\">Plain Text</a>\n        </li><li class=\"last\">\n          <a rel=\"nofollow\" href=\"/LUCICodeRepository/nomaticIM/export/1312/nomatic/tags/NomaticIM-0.0.5/buddy_bots/src/oscar_bot/nomatic_oscar_bot.py\">Original Format</a>\n        </li>\n      </ul>\n    </div>\n    </div>\n    <div id=\"footer\" lang=\"en\" xml:lang=\"en\"><hr />\n      <a id=\"tracpowered\" href=\"http://trac.edgewall.org/\"><img src=\"/LUCICodeRepository/nomaticIM/chrome/common/trac_logo_mini.png\" height=\"30\" width=\"107\" alt=\"Trac Powered\" /></a>\n      <p class=\"left\">Powered by <a href=\"/LUCICodeRepository/nomaticIM/about\"><strong>Trac 1.0.1</strong></a><br />\n        By <a href=\"http://www.edgewall.org/\">Edgewall Software</a>.</p>\n      <p class=\"right\">All content copyright 2007-2008 by LUCI <br /><a href=\"http://luci.ics.uci.edu/\">http://luci.ics.uci.edu/</a></p>\n    </div>\n\t\t<div id=\"sitefooter\">\n\t\t\t<script src=\"http://www.google-analytics.com/urchin.js\" type=\"text/javascript\">\n\t\t\t</script>\n\t\t\t<script type=\"text/javascript\">\n\t\t\t\t_uacct = \"UA-338915-2\";\n\t\t\t\turchinTracker();\n\t\t\t</script>\n\t\t</div>\n\t</body>\n</html>", "id": 42567.0}