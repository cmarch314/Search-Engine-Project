{"text": "Search LoginPreferencesHelp GuideAbout Trac WikiTimelineRoadmapBrowse SourceView TicketsSearch Context Navigation BlameRevision Log source nomatic tags NomaticIM 5 buddy bots src twisted python log py View diff against View revision Visit trunk Last change on this file was 712 checked in by cbaker 7 years ago First draft of nomatic buddy bots oscar bot is functional if you give it good authentication credentials jabber bot is just an example from the web File size 13 KB Line 1 test case name twisted test test log 2 Copyright c 2 1 2 4 Twisted Matrix Laboratories 3 See LICENSE for details 45 Logging and metrics infrastructure 6 78from future import division91 System Imports11import sys12import time13import warnings14import datetime1516 Sibling Imports17from twisted python import util context reflect1819class ILogContext 2 Actually this interface is just a synoym for the dictionary interface 21 but it serves as a key for the default information in a log 2223 I do not inherit from Interface because the world is a cruel place 24 2526context setDefault ILogContext 27 isError 28 system 293 def callWithContext ctx func args kw 31 newCtx context get ILogContext copy 32 newCtx update ctx 33 return context call ILogContext newCtx func args kw 3435def callWithLogger logger func args kw 36 37 Utility method which wraps a function in a try except logs a failure if38 one occurrs and uses the system s logPrefix 39 4 try 41 lp logger logPrefix 42 except KeyboardInterrupt 43 raise44 except 45 lp buggy logPrefix method 46 err system lp 47 try 48 return callWithContext system lp func args kw 49 except KeyboardInterrupt 5 raise51 except 52 err system lp 5354def showwarning message category filename lineno file None 55 if file is None 56 msg warning message category reflect qual category filename filename lineno lineno 57 format filename s lineno s category s warning s 58 else 59 oldshowwarning message category filename lineno file 6 61 keepErrors 62 keptErrors 63 ignoreErrors 6465def startKeepingErrors 66 67 DEPRECATED in Twisted 2 5 68 69 Support function for testing frameworks 7 71 Start keeping errors in a buffer which can be retrieved and emptied with72 flushErrors 73 74 warnings warn log startKeepingErrors is deprecated since Twisted 2 5 75 category DeprecationWarning stacklevel 2 76 global keepErrors77 keepErrors 178798 def flushErrors errorTypes 81 82 DEPRECATED in Twisted 2 5 See L TestCase flushLoggedErrors 8384 Support function for testing frameworks 8586 Return a list of errors that occurred since the last call to flushErrors 87 This will return None unless startKeepingErrors has been called 88 899 warnings warn log flushErrors is deprecated since Twisted 2 5 91 If you need to flush errors from within a unittest 92 use TestCase flushLoggedErrors instead 93 category DeprecationWarning stacklevel 2 94 return flushErrors errorTypes 959697def flushErrors errorTypes 98 99 PRIVATE DEPRECATED DON T USE 1 1 1 global keptErrors1 2 k keptErrors1 3 keptErrors 1 4 if errorTypes 1 5 for erk in k 1 6 shouldReLog 11 7 for errT in errorTypes 1 8 if erk check errT 1 9 shouldReLog 11 if shouldReLog 111 err erk 112 return k113114def ignoreErrors types 115 DEPRECATED 116 warnings warn log ignoreErrors is deprecated since Twisted 2 5 117 category DeprecationWarning stacklevel 2 118 ignore types 11912 def ignore types 121 122 PRIVATE DEPRECATED DON T USE 123 124 for type in types 125 ignoreErrors append type 126127def clearIgnores 128 DEPRECATED 129 warnings warn log clearIgnores is deprecated since Twisted 2 5 13 category DeprecationWarning stacklevel 2 131 clearIgnores 132133def clearIgnores 134 135 PRIVATE DEPRECATED DON T USE 136 137 global ignoreErrors138 ignoreErrors 13914 141def err stuff None why None kw 142 143 Write a failure to the log 144 145 if stuff is None 146 stuff failure Failure 147 if isinstance stuff failure Failure 148 if keepErrors 149 if ignoreErrors 15 keep 151 for err in ignoreErrors 152 r stuff check err 153 if r 154 keep 155 break156 else 157 keep 1158 if keep 159 keptErrors append stuff 16 else 161 keptErrors append stuff 162 msg failure stuff why why isError 1 kw 163 elif isinstance stuff Exception 164 msg failure failure Failure stuff why why isError 1 kw 165 else 166 msg repr stuff why why isError 1 kw 167168deferr err16917 class Logger 171 172 This represents a class which may own a log Used by subclassing 173 174 def logPrefix self 175 176 Override this method to insert custom logging behavior Its177 return value will be inserted in front of every line It may178 be called more times than the number of output lines 179 18 return 181182class LogPublisher 183 Class for singleton log message publishing 184185 synchronized msg 186187 def init self 188 self observers 18919 def addObserver self other 191 Add a new observer 192193 Observers are callable objects that will be called with each new log194 message a dict 195 196 assert callable other 197 self observers append other 198199 def removeObserver self other 2 Remove an observer 2 1 self observers remove other 2 22 3 def msg self message kw 2 4 Log a new message 2 52 6 For example 2 72 8 log msg Hello world 2 921 In particular you MUST avoid the forms 211212 log msg u Hello world 213 log msg Hello world 214215 These forms work sometimes by accident and will be disabled216 entirely in the future 217 218 actualEventDict context get ILogContext or copy 219 actualEventDict update kw 22 actualEventDict message message221 actualEventDict time time time 222 for i in xrange len self observers 1 1 1 223 try 224 self observers i actualEventDict 225 except KeyboardInterrupt 226 Don t swallow keyboard interrupt 227 raise228 except UnicodeEncodeError 229 raise23 except 231 o self observers pop i 232 err failure Failure 233 Log observer s failed removing from observer list o 234235236try 237 theLogPublisher238except NameError 239 theLogPublisher LogPublisher 24 addObserver theLogPublisher addObserver241 removeObserver theLogPublisher removeObserver242 msg theLogPublisher msg243244245class FileLogObserver 246 247 Log observer that writes to a file like object 248249 type timeFormat C str or C NoneType 25 ivar timeFormat If not C None the format string passed to strftime 251 252 timeFormat None253254 def init self f 255 self write f write256 self flush f flush257258 def safeFormat self fmtString crap 259 There s a way we could make this if not safer at least more26 informative perhaps some sort of str repr wrapper objects261 could be wrapped around the things inside of crap That way262 if the event dict contains an object with a bad repr we263 can only cry about that individual object instead of the264 entire event dict 265 try 266 text fmtString crap267 except KeyboardInterrupt 268 raise269 except 27 try 271 text Invalid format string or unformattable object in log message r s fmtString crap 272 except 273 try 274 text UNFORMATTABLE OBJECT WRITTEN TO LOG with fmt r MESSAGE LOST fmtString 275 except 276 text PATHOLOGICAL ERROR IN BOTH FORMAT STRING AND MESSAGE DETAILS MESSAGE LOST 277 return text27827928 def getTimezoneOffset self 281 282 Return the current local timezone offset from UTC 283284 rtype C int 285 return The number of seconds offset from UTC West is positive 286 east is negative 287 288 if time daylight 289 return time altzone29 return time timezone291292293 def formatTime self when 294 295 Return the given UTC value formatted as a human readable string296 representing that time in the local timezone 297298 type when C int 299 param when POSIX timestamp to convert to a human readable string 3 3 1 rtype C str 3 2 3 3 if self timeFormat is not None 3 4 return time strftime self timeFormat time localtime when 3 53 6 tzOffset self getTimezoneOffset 3 7 when datetime datetime utcfromtimestamp when tzOffset 3 8 tzHour int tzOffset 6 6 3 9 tzMin int tzOffset 6 6 31 return d 2d 2d 2d 2d 3d 2d 311 when year when month when day 312 when hour when minute 313 tzHour tzMin 314315316 def emit self eventDict 317 edm eventDict message 318 if not edm 319 if eventDict isError and eventDict has key failure 32 text eventDict get why or Unhandled Error 321 n eventDict failure getTraceback 322 elif eventDict has key format 323 text self safeFormat eventDict format eventDict 324 else 325 we don t know how to log this326 return327 else 328 text join map reflect safe str edm 32933 timeStr self formatTime eventDict time 331 fmtDict system eventDict system text text replace n n t 332 msgStr self safeFormat system s text s n fmtDict 333334 util untilConcludes self write timeStr msgStr 335 util untilConcludes self flush Hoorj 336337 def start self 338 Start observing log events 339 addObserver self emit 34 341 def stop self 342 Stop observing log events 343 removeObserver self emit 344345346class StdioOnnaStick 347 Class that pretends to be stout err 348349 closed 35 softspace 351 mode wb 352 name stdio log 353354 def init self isError 355 self isError isError356 self buf 357358 def close self 359 pass36 361 def fileno self 362 return 1363364 def flush self 365 pass366367 def read self 368 raise IOError can t read from the log 36937 readline read371 readlines read372 seek read373 tell read374375 def write self data 376 d self buf data split n 377 self buf d 1 378 messages d 1 379 for message in messages 38 msg message printed 1 isError self isError 381382 def writelines self lines 383 for line in lines 384 msg line printed 1 isError self isError 385386387try 388 oldshowwarning389except NameError 39 oldshowwarning None391392393def startLogging file a kw 394 Initialize logging to a specified file 395 396 flo FileLogObserver file 397 startLoggingWithObserver flo emit a kw 398399def startLoggingWithObserver observer setStdout 1 4 Initialize logging to a specified observer If setStdout is true4 1 defaults to yes also redirect sys stdout and sys stderr4 2 to the specified file 4 3 4 4 global defaultObserver oldshowwarning4 5 if not oldshowwarning 4 6 oldshowwarning warnings showwarning4 7 warnings showwarning showwarning4 8 if defaultObserver 4 9 defaultObserver stop 41 defaultObserver None411 addObserver observer 412 msg Log opened 413 if setStdout 414 sys stdout logfile415 sys stderr logerr416417418class NullFile 419 softspace 42 def read self pass421 def write self bytes pass422 def flush self pass423 def close self pass424425426def discardLogs 427 Throw away all logs 428 429 global logfile43 logfile NullFile 431432433 Prevent logfile from being erased on reload This only works in cpython 434try 435 logfile436except NameError 437 logfile StdioOnnaStick 438 logerr StdioOnnaStick 1 43944 441class DefaultObserver 442 Default observer 443444 Will ignore all non error messages and send error messages to sys stderr 445 Will be removed when startLogging is called for the first time 446 447448 def emit self eventDict 449 if eventDict isError 45 if eventDict has key failure 451 text eventDict failure getTraceback 452 else 453 text join str m for m in eventDict message n 454 sys stderr write text 455 sys stderr flush 456457 def start self 458 addObserver self emit 45946 def stop self 461 removeObserver self emit 462463464 Some more sibling imports at the bottom and unqualified to avoid465 unresolvable circularity466import threadable failure467threadable synchronize LogPublisher 46846947 try 471 defaultObserver472except NameError 473 defaultObserver DefaultObserver 474 defaultObserver start 475 Note See TracBrowser for help on using the repository browser Download in other formats Plain Text Original Format Powered by Trac 1 1 By Edgewall Software All content copyright 2 7 2 8 by LUCI http luci ics uci edu ", "_id": "http://djp3-pc2.ics.uci.edu/LUCICodeRepository/nomaticIM/browser/nomatic/tags/NomaticIM-0.0.5/buddy_bots/src/twisted/python/log.py", "title": "\n      log.py in nomatic/tags/nomaticim-0.0.5/buddy_bots/src/twisted/python\n     \u2013 nomatic*im\n    ", "html": "<!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Strict//EN\" \"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd\">\n<html xmlns=\"http://www.w3.org/1999/xhtml\">\n  \n  \n\n  \n\n\n  <head>\n\t\t<title>\n      log.py in nomatic/tags/NomaticIM-0.0.5/buddy_bots/src/twisted/python\n     \u2013 Nomatic*IM\n    </title><meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\" /><meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge\" /><link rel=\"search\" href=\"/LUCICodeRepository/nomaticIM/search\" /><link rel=\"help\" href=\"/LUCICodeRepository/nomaticIM/wiki/TracGuide\" /><link rel=\"alternate\" href=\"/LUCICodeRepository/nomaticIM/browser/nomatic/tags/NomaticIM-0.0.5/buddy_bots/src/twisted/python/log.py?format=txt\" type=\"text/plain\" title=\"Plain Text\" /><link rel=\"alternate\" href=\"/LUCICodeRepository/nomaticIM/export/1312/nomatic/tags/NomaticIM-0.0.5/buddy_bots/src/twisted/python/log.py\" type=\"application/x-python; charset=iso-8859-15\" title=\"Original Format\" /><link rel=\"start\" href=\"/LUCICodeRepository/nomaticIM/wiki\" /><link rel=\"stylesheet\" href=\"/LUCICodeRepository/nomaticIM/chrome/common/css/trac.css\" type=\"text/css\" /><link rel=\"stylesheet\" href=\"/LUCICodeRepository/nomaticIM/chrome/common/css/code.css\" type=\"text/css\" /><link rel=\"stylesheet\" href=\"/LUCICodeRepository/nomaticIM/pygments/trac.css\" type=\"text/css\" /><link rel=\"stylesheet\" href=\"/LUCICodeRepository/nomaticIM/chrome/common/css/browser.css\" type=\"text/css\" /><link rel=\"shortcut icon\" href=\"http://luci.ics.uci.edu/logo32by32.gif\" type=\"image/gif\" /><link rel=\"icon\" href=\"http://luci.ics.uci.edu/logo32by32.gif\" type=\"image/gif\" /><link type=\"application/opensearchdescription+xml\" rel=\"search\" href=\"/LUCICodeRepository/nomaticIM/search/opensearch\" title=\"Search Nomatic*IM\" /><script type=\"text/javascript\" charset=\"utf-8\" src=\"/LUCICodeRepository/nomaticIM/chrome/common/js/jquery.js\"></script><script type=\"text/javascript\" charset=\"utf-8\" src=\"/LUCICodeRepository/nomaticIM/chrome/common/js/babel.js\"></script><script type=\"text/javascript\" charset=\"utf-8\" src=\"/LUCICodeRepository/nomaticIM/chrome/common/js/messages/en_US.js\"></script><script type=\"text/javascript\" charset=\"utf-8\" src=\"/LUCICodeRepository/nomaticIM/chrome/common/js/trac.js\"></script><script type=\"text/javascript\" charset=\"utf-8\" src=\"/LUCICodeRepository/nomaticIM/chrome/common/js/search.js\"></script><script type=\"text/javascript\" src=\"/LUCICodeRepository/nomaticIM/chrome/common/js/folding.js\"></script><script type=\"text/javascript\">\n      jQuery(document).ready(function($) {\n        $(\".trac-toggledeleted\").show().click(function() {\n                  $(this).siblings().find(\".trac-deleted\").toggle();\n                  return false;\n        }).click();\n        $(\"#jumploc input\").hide();\n        $(\"#jumploc select\").change(function () {\n          this.parentNode.parentNode.submit();\n        });\n          $('#preview table.code').enableCollapsibleColumns($('#preview table.code thead th.content'));\n      });\n    </script>\n\t</head>\n  <body>\n    <div id=\"banner\">\n      <div id=\"header\">\n        <a id=\"logo\" href=\"http://luci.ics.uci.edu/#code\"><img src=\"http://luci.ics.uci.edu/blog/archives/LUCIhorzTight.jpg\" alt=\"LUCI Code Repository\" /></a>\n      </div>\n      <form id=\"search\" action=\"/LUCICodeRepository/nomaticIM/search\" method=\"get\">\n        <div>\n          <label for=\"proj-search\">Search:</label>\n          <input type=\"text\" id=\"proj-search\" name=\"q\" size=\"18\" value=\"\" />\n          <input type=\"submit\" value=\"Search\" />\n        </div>\n      </form>\n      <div id=\"metanav\" class=\"nav\">\n    <ul>\n      <li class=\"first\"><a href=\"/LUCICodeRepository/nomaticIM/login\">Login</a></li><li><a href=\"/LUCICodeRepository/nomaticIM/prefs\">Preferences</a></li><li><a href=\"/LUCICodeRepository/nomaticIM/wiki/TracGuide\">Help/Guide</a></li><li class=\"last\"><a href=\"/LUCICodeRepository/nomaticIM/about\">About Trac</a></li>\n    </ul>\n  </div>\n    </div>\n    <div id=\"mainnav\" class=\"nav\">\n    <ul>\n      <li class=\"first\"><a href=\"/LUCICodeRepository/nomaticIM/wiki\">Wiki</a></li><li><a href=\"/LUCICodeRepository/nomaticIM/timeline\">Timeline</a></li><li><a href=\"/LUCICodeRepository/nomaticIM/roadmap\">Roadmap</a></li><li class=\"active\"><a href=\"/LUCICodeRepository/nomaticIM/browser\">Browse Source</a></li><li><a href=\"/LUCICodeRepository/nomaticIM/report\">View Tickets</a></li><li class=\"last\"><a href=\"/LUCICodeRepository/nomaticIM/search\">Search</a></li>\n    </ul>\n  </div>\n    <div id=\"main\">\n      <div id=\"ctxtnav\" class=\"nav\">\n        <h2>Context Navigation</h2>\n        <ul>\n          <li class=\"first\"><a href=\"/LUCICodeRepository/nomaticIM/browser/nomatic/trunk/buddy_bots/twisted/python/log.py?annotate=blame\" title=\"Annotate each line with the last changed revision (this can be time consuming...)\">Blame</a></li><li class=\"last\"><a href=\"/LUCICodeRepository/nomaticIM/log/nomatic/tags/NomaticIM-0.0.5/buddy_bots/src/twisted/python/log.py\">Revision Log</a></li>\n        </ul>\n        <hr />\n      </div>\n    <div id=\"content\" class=\"browser\">\n        <h1>\n          \n<a class=\"pathentry first\" href=\"/LUCICodeRepository/nomaticIM/browser?order=name\" title=\"Go to repository root\">source:</a>\n<a class=\"pathentry\" href=\"/LUCICodeRepository/nomaticIM/browser/nomatic?order=name\" title=\"View nomatic\">nomatic</a><span class=\"pathentry sep\">/</span><a class=\"pathentry\" href=\"/LUCICodeRepository/nomaticIM/browser/nomatic/tags?order=name\" title=\"View tags\">tags</a><span class=\"pathentry sep\">/</span><a class=\"pathentry\" href=\"/LUCICodeRepository/nomaticIM/browser/nomatic/tags/NomaticIM-0.0.5?order=name\" title=\"View NomaticIM-0.0.5\">NomaticIM-0.0.5</a><span class=\"pathentry sep\">/</span><a class=\"pathentry\" href=\"/LUCICodeRepository/nomaticIM/browser/nomatic/tags/NomaticIM-0.0.5/buddy_bots?order=name\" title=\"View buddy_bots\">buddy_bots</a><span class=\"pathentry sep\">/</span><a class=\"pathentry\" href=\"/LUCICodeRepository/nomaticIM/browser/nomatic/tags/NomaticIM-0.0.5/buddy_bots/src?order=name\" title=\"View src\">src</a><span class=\"pathentry sep\">/</span><a class=\"pathentry\" href=\"/LUCICodeRepository/nomaticIM/browser/nomatic/tags/NomaticIM-0.0.5/buddy_bots/src/twisted?order=name\" title=\"View twisted\">twisted</a><span class=\"pathentry sep\">/</span><a class=\"pathentry\" href=\"/LUCICodeRepository/nomaticIM/browser/nomatic/tags/NomaticIM-0.0.5/buddy_bots/src/twisted/python?order=name\" title=\"View python\">python</a><span class=\"pathentry sep\">/</span><a class=\"pathentry\" href=\"/LUCICodeRepository/nomaticIM/browser/nomatic/tags/NomaticIM-0.0.5/buddy_bots/src/twisted/python/log.py?order=name\" title=\"View log.py\">log.py</a>\n<br style=\"clear: both\" />\n\n        </h1>\n        <div id=\"diffrev\">\n          <form action=\"/LUCICodeRepository/nomaticIM/changeset\" method=\"get\">\n            <div>\n              <label title=\"Show the diff against a specific revision\">\n                View diff against: <input type=\"text\" name=\"old\" size=\"6\" />\n                <input type=\"hidden\" name=\"old_path\" value=\"nomatic/tags/NomaticIM-0.0.5/buddy_bots/src/twisted/python/log.py\" />\n                <input type=\"hidden\" name=\"new\" />\n                <input type=\"hidden\" name=\"new_path\" value=\"nomatic/tags/NomaticIM-0.0.5/buddy_bots/src/twisted/python/log.py\" />\n              </label>\n            </div>\n          </form>\n        </div>\n        <div id=\"jumprev\">\n          <form action=\"\" method=\"get\">\n            <div>\n              <label for=\"rev\">\n                View revision:</label>\n              <input type=\"text\" id=\"rev\" name=\"rev\" size=\"6\" />\n            </div>\n          </form>\n        </div>\n        <div id=\"jumploc\">\n          <form action=\"\" method=\"get\">\n            <div class=\"buttons\">\n              <label for=\"preselected\">Visit:</label>\n              <select id=\"preselected\" name=\"preselected\">\n                <option selected=\"selected\"></option>\n                <optgroup label=\"branches\">\n                  <option value=\"/LUCICodeRepository/nomaticIM/browser/trunk\">trunk</option>\n                </optgroup>\n              </select>\n              <input type=\"submit\" value=\"Go!\" title=\"Jump to the chosen preselected path\" />\n            </div>\n          </form>\n        </div>\n        <div class=\"trac-tags\">\n        </div>\n      <table id=\"info\" summary=\"Revision info\">\n        <tr>\n          <th>\n                <a href=\"/LUCICodeRepository/nomaticIM/changeset/712/nomatic/trunk/buddy_bots/twisted/python/log.py\" title=\"View differences\">Last change</a>\n                  on this file was\n                  <a href=\"/LUCICodeRepository/nomaticIM/changeset/712/\" title=\"View changeset 712\">712</a>,\n                  checked in by cbaker, <a class=\"timeline\" href=\"/LUCICodeRepository/nomaticIM/timeline?from=2008-02-16T08%3A16%3A53-08%3A00&amp;precision=second\" title=\"See timeline at Feb 16, 2008, 8:16:53 AM\">7 years ago</a>\n          </th>\n        </tr>\n        <tr>\n          <td class=\"message searchable\">\n              <p>\nFirst draft of nomatic buddy bots. oscar_bot is functional if you give it good authentication credentials, jabber_bot is just an example from the web <br />\n</p>\n          </td>\n        </tr>\n        <tr><td colspan=\"2\">\n            <strong>File size:</strong>\n            <span title=\"13343 bytes\">13.0 KB</span>\n          </td></tr>\n      </table>\n      <div id=\"preview\" class=\"searchable\">\n        \n  <table class=\"code\"><thead><tr><th class=\"lineno\" title=\"Line numbers\">Line</th><th class=\"content\">\u00a0</th></tr></thead><tbody><tr><th id=\"L1\"><a href=\"#L1\">1</a></th><td><span class=\"c\"># -*- test-case-name: twisted.test.test_log -*-</span></td></tr><tr><th id=\"L2\"><a href=\"#L2\">2</a></th><td><span class=\"c\"># Copyright (c) 2001-2004 Twisted Matrix Laboratories.</span></td></tr><tr><th id=\"L3\"><a href=\"#L3\">3</a></th><td><span class=\"c\"># See LICENSE for details.</span></td></tr><tr><th id=\"L4\"><a href=\"#L4\">4</a></th><td></td></tr><tr><th id=\"L5\"><a href=\"#L5\">5</a></th><td><span class=\"sd\">\"\"\"Logging and metrics infrastructure.</span></td></tr><tr><th id=\"L6\"><a href=\"#L6\">6</a></th><td><span class=\"sd\">\"\"\"</span></td></tr><tr><th id=\"L7\"><a href=\"#L7\">7</a></th><td></td></tr><tr><th id=\"L8\"><a href=\"#L8\">8</a></th><td><span class=\"kn\">from</span>\u00a0<span class=\"nn\">__future__</span>\u00a0<span class=\"kn\">import</span>\u00a0division</td></tr><tr><th id=\"L9\"><a href=\"#L9\">9</a></th><td></td></tr><tr><th id=\"L10\"><a href=\"#L10\">10</a></th><td><span class=\"c\"># System Imports</span></td></tr><tr><th id=\"L11\"><a href=\"#L11\">11</a></th><td><span class=\"kn\">import</span>\u00a0<span class=\"nn\">sys</span></td></tr><tr><th id=\"L12\"><a href=\"#L12\">12</a></th><td><span class=\"kn\">import</span>\u00a0<span class=\"nn\">time</span></td></tr><tr><th id=\"L13\"><a href=\"#L13\">13</a></th><td><span class=\"kn\">import</span>\u00a0<span class=\"nn\">warnings</span></td></tr><tr><th id=\"L14\"><a href=\"#L14\">14</a></th><td><span class=\"kn\">import</span>\u00a0<span class=\"nn\">datetime</span></td></tr><tr><th id=\"L15\"><a href=\"#L15\">15</a></th><td></td></tr><tr><th id=\"L16\"><a href=\"#L16\">16</a></th><td><span class=\"c\"># Sibling Imports</span></td></tr><tr><th id=\"L17\"><a href=\"#L17\">17</a></th><td><span class=\"kn\">from</span>\u00a0<span class=\"nn\">twisted.python</span>\u00a0<span class=\"kn\">import</span>\u00a0util<span class=\"p\">,</span>\u00a0context<span class=\"p\">,</span>\u00a0reflect</td></tr><tr><th id=\"L18\"><a href=\"#L18\">18</a></th><td></td></tr><tr><th id=\"L19\"><a href=\"#L19\">19</a></th><td><span class=\"k\">class</span>\u00a0<span class=\"nc\">ILogContext</span><span class=\"p\">:</span></td></tr><tr><th id=\"L20\"><a href=\"#L20\">20</a></th><td>\u00a0 \u00a0 <span class=\"sd\">\"\"\"Actually, this interface is just a synoym for the dictionary interface,</span></td></tr><tr><th id=\"L21\"><a href=\"#L21\">21</a></th><td><span class=\"sd\">\u00a0 \u00a0 but it serves as a key for the default information in a log.</span></td></tr><tr><th id=\"L22\"><a href=\"#L22\">22</a></th><td><span class=\"sd\"></span></td></tr><tr><th id=\"L23\"><a href=\"#L23\">23</a></th><td><span class=\"sd\">\u00a0 \u00a0 I do not inherit from Interface because the world is a cruel place.</span></td></tr><tr><th id=\"L24\"><a href=\"#L24\">24</a></th><td><span class=\"sd\">\u00a0 \u00a0 \"\"\"</span></td></tr><tr><th id=\"L25\"><a href=\"#L25\">25</a></th><td></td></tr><tr><th id=\"L26\"><a href=\"#L26\">26</a></th><td>context<span class=\"o\">.</span>setDefault<span class=\"p\">(</span>ILogContext<span class=\"p\">,</span></td></tr><tr><th id=\"L27\"><a href=\"#L27\">27</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0<span class=\"p\">{</span><span class=\"s\">\"isError\"</span><span class=\"p\">:</span>\u00a0<span class=\"mi\">0</span><span class=\"p\">,</span></td></tr><tr><th id=\"L28\"><a href=\"#L28\">28</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"s\">\"system\"</span><span class=\"p\">:</span>\u00a0<span class=\"s\">\"-\"</span><span class=\"p\">})</span></td></tr><tr><th id=\"L29\"><a href=\"#L29\">29</a></th><td></td></tr><tr><th id=\"L30\"><a href=\"#L30\">30</a></th><td><span class=\"k\">def</span>\u00a0<span class=\"nf\">callWithContext</span><span class=\"p\">(</span>ctx<span class=\"p\">,</span>\u00a0func<span class=\"p\">,</span>\u00a0<span class=\"o\">*</span>args<span class=\"p\">,</span>\u00a0<span class=\"o\">**</span>kw<span class=\"p\">):</span></td></tr><tr><th id=\"L31\"><a href=\"#L31\">31</a></th><td>\u00a0 \u00a0 newCtx <span class=\"o\">=</span>\u00a0context<span class=\"o\">.</span>get<span class=\"p\">(</span>ILogContext<span class=\"p\">)</span><span class=\"o\">.</span>copy<span class=\"p\">()</span></td></tr><tr><th id=\"L32\"><a href=\"#L32\">32</a></th><td>\u00a0 \u00a0 newCtx<span class=\"o\">.</span>update<span class=\"p\">(</span>ctx<span class=\"p\">)</span></td></tr><tr><th id=\"L33\"><a href=\"#L33\">33</a></th><td>\u00a0 \u00a0 <span class=\"k\">return</span>\u00a0context<span class=\"o\">.</span>call<span class=\"p\">({</span>ILogContext<span class=\"p\">:</span>\u00a0newCtx<span class=\"p\">},</span>\u00a0func<span class=\"p\">,</span>\u00a0<span class=\"o\">*</span>args<span class=\"p\">,</span>\u00a0<span class=\"o\">**</span>kw<span class=\"p\">)</span></td></tr><tr><th id=\"L34\"><a href=\"#L34\">34</a></th><td></td></tr><tr><th id=\"L35\"><a href=\"#L35\">35</a></th><td><span class=\"k\">def</span>\u00a0<span class=\"nf\">callWithLogger</span><span class=\"p\">(</span>logger<span class=\"p\">,</span>\u00a0func<span class=\"p\">,</span>\u00a0<span class=\"o\">*</span>args<span class=\"p\">,</span>\u00a0<span class=\"o\">**</span>kw<span class=\"p\">):</span></td></tr><tr><th id=\"L36\"><a href=\"#L36\">36</a></th><td>\u00a0 \u00a0 <span class=\"sd\">\"\"\"</span></td></tr><tr><th id=\"L37\"><a href=\"#L37\">37</a></th><td><span class=\"sd\">\u00a0 \u00a0 Utility method which wraps a function in a try:/except:, logs a failure if</span></td></tr><tr><th id=\"L38\"><a href=\"#L38\">38</a></th><td><span class=\"sd\">\u00a0 \u00a0 one occurrs, and uses the system's logPrefix.</span></td></tr><tr><th id=\"L39\"><a href=\"#L39\">39</a></th><td><span class=\"sd\">\u00a0 \u00a0 \"\"\"</span></td></tr><tr><th id=\"L40\"><a href=\"#L40\">40</a></th><td>\u00a0 \u00a0 <span class=\"k\">try</span><span class=\"p\">:</span></td></tr><tr><th id=\"L41\"><a href=\"#L41\">41</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 lp <span class=\"o\">=</span>\u00a0logger<span class=\"o\">.</span>logPrefix<span class=\"p\">()</span></td></tr><tr><th id=\"L42\"><a href=\"#L42\">42</a></th><td>\u00a0 \u00a0 <span class=\"k\">except</span>\u00a0<span class=\"ne\">KeyboardInterrupt</span><span class=\"p\">:</span></td></tr><tr><th id=\"L43\"><a href=\"#L43\">43</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">raise</span></td></tr><tr><th id=\"L44\"><a href=\"#L44\">44</a></th><td>\u00a0 \u00a0 <span class=\"k\">except</span><span class=\"p\">:</span></td></tr><tr><th id=\"L45\"><a href=\"#L45\">45</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 lp <span class=\"o\">=</span>\u00a0<span class=\"s\">'(buggy logPrefix method)'</span></td></tr><tr><th id=\"L46\"><a href=\"#L46\">46</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 err<span class=\"p\">(</span>system<span class=\"o\">=</span>lp<span class=\"p\">)</span></td></tr><tr><th id=\"L47\"><a href=\"#L47\">47</a></th><td>\u00a0 \u00a0 <span class=\"k\">try</span><span class=\"p\">:</span></td></tr><tr><th id=\"L48\"><a href=\"#L48\">48</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">return</span>\u00a0callWithContext<span class=\"p\">({</span><span class=\"s\">\"system\"</span><span class=\"p\">:</span>\u00a0lp<span class=\"p\">},</span>\u00a0func<span class=\"p\">,</span>\u00a0<span class=\"o\">*</span>args<span class=\"p\">,</span>\u00a0<span class=\"o\">**</span>kw<span class=\"p\">)</span></td></tr><tr><th id=\"L49\"><a href=\"#L49\">49</a></th><td>\u00a0 \u00a0 <span class=\"k\">except</span>\u00a0<span class=\"ne\">KeyboardInterrupt</span><span class=\"p\">:</span></td></tr><tr><th id=\"L50\"><a href=\"#L50\">50</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">raise</span></td></tr><tr><th id=\"L51\"><a href=\"#L51\">51</a></th><td>\u00a0 \u00a0 <span class=\"k\">except</span><span class=\"p\">:</span></td></tr><tr><th id=\"L52\"><a href=\"#L52\">52</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 err<span class=\"p\">(</span>system<span class=\"o\">=</span>lp<span class=\"p\">)</span></td></tr><tr><th id=\"L53\"><a href=\"#L53\">53</a></th><td></td></tr><tr><th id=\"L54\"><a href=\"#L54\">54</a></th><td><span class=\"k\">def</span>\u00a0<span class=\"nf\">showwarning</span><span class=\"p\">(</span>message<span class=\"p\">,</span>\u00a0category<span class=\"p\">,</span>\u00a0filename<span class=\"p\">,</span>\u00a0lineno<span class=\"p\">,</span>\u00a0<span class=\"nb\">file</span><span class=\"o\">=</span><span class=\"bp\">None</span><span class=\"p\">):</span></td></tr><tr><th id=\"L55\"><a href=\"#L55\">55</a></th><td>\u00a0 \u00a0 <span class=\"k\">if</span>\u00a0<span class=\"nb\">file</span>\u00a0<span class=\"ow\">is</span>\u00a0<span class=\"bp\">None</span><span class=\"p\">:</span></td></tr><tr><th id=\"L56\"><a href=\"#L56\">56</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 msg<span class=\"p\">(</span>warning<span class=\"o\">=</span>message<span class=\"p\">,</span>\u00a0category<span class=\"o\">=</span>reflect<span class=\"o\">.</span>qual<span class=\"p\">(</span>category<span class=\"p\">),</span>\u00a0filename<span class=\"o\">=</span>filename<span class=\"p\">,</span>\u00a0lineno<span class=\"o\">=</span>lineno<span class=\"p\">,</span></td></tr><tr><th id=\"L57\"><a href=\"#L57\">57</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 format<span class=\"o\">=</span><span class=\"s\">\"</span><span class=\"si\">%(filename)s</span><span class=\"s\">:</span><span class=\"si\">%(lineno)s</span><span class=\"s\">: </span><span class=\"si\">%(category)s</span><span class=\"s\">: </span><span class=\"si\">%(warning)s</span><span class=\"s\">\"</span><span class=\"p\">)</span></td></tr><tr><th id=\"L58\"><a href=\"#L58\">58</a></th><td>\u00a0 \u00a0 <span class=\"k\">else</span><span class=\"p\">:</span></td></tr><tr><th id=\"L59\"><a href=\"#L59\">59</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 _oldshowwarning<span class=\"p\">(</span>message<span class=\"p\">,</span>\u00a0category<span class=\"p\">,</span>\u00a0filename<span class=\"p\">,</span>\u00a0lineno<span class=\"p\">,</span>\u00a0<span class=\"nb\">file</span><span class=\"p\">)</span></td></tr><tr><th id=\"L60\"><a href=\"#L60\">60</a></th><td></td></tr><tr><th id=\"L61\"><a href=\"#L61\">61</a></th><td>_keepErrors <span class=\"o\">=</span>\u00a0<span class=\"mi\">0</span></td></tr><tr><th id=\"L62\"><a href=\"#L62\">62</a></th><td>_keptErrors <span class=\"o\">=</span>\u00a0<span class=\"p\">[]</span></td></tr><tr><th id=\"L63\"><a href=\"#L63\">63</a></th><td>_ignoreErrors <span class=\"o\">=</span>\u00a0<span class=\"p\">[]</span></td></tr><tr><th id=\"L64\"><a href=\"#L64\">64</a></th><td></td></tr><tr><th id=\"L65\"><a href=\"#L65\">65</a></th><td><span class=\"k\">def</span>\u00a0<span class=\"nf\">startKeepingErrors</span><span class=\"p\">():</span></td></tr><tr><th id=\"L66\"><a href=\"#L66\">66</a></th><td>\u00a0 \u00a0 <span class=\"sd\">\"\"\"</span></td></tr><tr><th id=\"L67\"><a href=\"#L67\">67</a></th><td><span class=\"sd\">\u00a0 \u00a0 DEPRECATED in Twisted 2.5.</span></td></tr><tr><th id=\"L68\"><a href=\"#L68\">68</a></th><td><span class=\"sd\">\u00a0 \u00a0 </span></td></tr><tr><th id=\"L69\"><a href=\"#L69\">69</a></th><td><span class=\"sd\">\u00a0 \u00a0 Support function for testing frameworks.</span></td></tr><tr><th id=\"L70\"><a href=\"#L70\">70</a></th><td><span class=\"sd\"></span></td></tr><tr><th id=\"L71\"><a href=\"#L71\">71</a></th><td><span class=\"sd\">\u00a0 \u00a0 Start keeping errors in a buffer which can be retrieved (and emptied) with</span></td></tr><tr><th id=\"L72\"><a href=\"#L72\">72</a></th><td><span class=\"sd\">\u00a0 \u00a0 flushErrors.</span></td></tr><tr><th id=\"L73\"><a href=\"#L73\">73</a></th><td><span class=\"sd\">\u00a0 \u00a0 \"\"\"</span></td></tr><tr><th id=\"L74\"><a href=\"#L74\">74</a></th><td>\u00a0 \u00a0 warnings<span class=\"o\">.</span>warn<span class=\"p\">(</span><span class=\"s\">\"log.startKeepingErrors is deprecated since Twisted 2.5\"</span><span class=\"p\">,</span></td></tr><tr><th id=\"L75\"><a href=\"#L75\">75</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 category<span class=\"o\">=</span><span class=\"ne\">DeprecationWarning</span><span class=\"p\">,</span>\u00a0stacklevel<span class=\"o\">=</span><span class=\"mi\">2</span><span class=\"p\">)</span></td></tr><tr><th id=\"L76\"><a href=\"#L76\">76</a></th><td>\u00a0 \u00a0 <span class=\"k\">global</span>\u00a0_keepErrors</td></tr><tr><th id=\"L77\"><a href=\"#L77\">77</a></th><td>\u00a0 \u00a0 _keepErrors <span class=\"o\">=</span>\u00a0<span class=\"mi\">1</span></td></tr><tr><th id=\"L78\"><a href=\"#L78\">78</a></th><td></td></tr><tr><th id=\"L79\"><a href=\"#L79\">79</a></th><td></td></tr><tr><th id=\"L80\"><a href=\"#L80\">80</a></th><td><span class=\"k\">def</span>\u00a0<span class=\"nf\">flushErrors</span><span class=\"p\">(</span><span class=\"o\">*</span>errorTypes<span class=\"p\">):</span></td></tr><tr><th id=\"L81\"><a href=\"#L81\">81</a></th><td>\u00a0 \u00a0 <span class=\"sd\">\"\"\"</span></td></tr><tr><th id=\"L82\"><a href=\"#L82\">82</a></th><td><span class=\"sd\">\u00a0 \u00a0 DEPRECATED in Twisted 2.5.\u00a0 See L{TestCase.flushLoggedErrors}.</span></td></tr><tr><th id=\"L83\"><a href=\"#L83\">83</a></th><td><span class=\"sd\"></span></td></tr><tr><th id=\"L84\"><a href=\"#L84\">84</a></th><td><span class=\"sd\">\u00a0 \u00a0 Support function for testing frameworks.</span></td></tr><tr><th id=\"L85\"><a href=\"#L85\">85</a></th><td><span class=\"sd\"></span></td></tr><tr><th id=\"L86\"><a href=\"#L86\">86</a></th><td><span class=\"sd\">\u00a0 \u00a0 Return a list of errors that occurred since the last call to flushErrors().</span></td></tr><tr><th id=\"L87\"><a href=\"#L87\">87</a></th><td><span class=\"sd\">\u00a0 \u00a0 (This will return None unless startKeepingErrors has been called.)</span></td></tr><tr><th id=\"L88\"><a href=\"#L88\">88</a></th><td><span class=\"sd\">\u00a0 \u00a0 \"\"\"</span></td></tr><tr><th id=\"L89\"><a href=\"#L89\">89</a></th><td></td></tr><tr><th id=\"L90\"><a href=\"#L90\">90</a></th><td>\u00a0 \u00a0 warnings<span class=\"o\">.</span>warn<span class=\"p\">(</span><span class=\"s\">\"log.flushErrors is deprecated since Twisted 2.5. \"</span></td></tr><tr><th id=\"L91\"><a href=\"#L91\">91</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"s\">\"If you need to flush errors from within a unittest, \"</span></td></tr><tr><th id=\"L92\"><a href=\"#L92\">92</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"s\">\"use TestCase.flushLoggedErrors instead.\"</span><span class=\"p\">,</span></td></tr><tr><th id=\"L93\"><a href=\"#L93\">93</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 category<span class=\"o\">=</span><span class=\"ne\">DeprecationWarning</span><span class=\"p\">,</span>\u00a0stacklevel<span class=\"o\">=</span><span class=\"mi\">2</span><span class=\"p\">)</span></td></tr><tr><th id=\"L94\"><a href=\"#L94\">94</a></th><td>\u00a0 \u00a0 <span class=\"k\">return</span>\u00a0_flushErrors<span class=\"p\">(</span><span class=\"o\">*</span>errorTypes<span class=\"p\">)</span></td></tr><tr><th id=\"L95\"><a href=\"#L95\">95</a></th><td></td></tr><tr><th id=\"L96\"><a href=\"#L96\">96</a></th><td></td></tr><tr><th id=\"L97\"><a href=\"#L97\">97</a></th><td><span class=\"k\">def</span>\u00a0<span class=\"nf\">_flushErrors</span><span class=\"p\">(</span><span class=\"o\">*</span>errorTypes<span class=\"p\">):</span></td></tr><tr><th id=\"L98\"><a href=\"#L98\">98</a></th><td>\u00a0 \u00a0 <span class=\"sd\">\"\"\"</span></td></tr><tr><th id=\"L99\"><a href=\"#L99\">99</a></th><td><span class=\"sd\">\u00a0 \u00a0 PRIVATE. DEPRECATED. DON'T USE.</span></td></tr><tr><th id=\"L100\"><a href=\"#L100\">100</a></th><td><span class=\"sd\">\u00a0 \u00a0 \"\"\"</span></td></tr><tr><th id=\"L101\"><a href=\"#L101\">101</a></th><td>\u00a0 \u00a0 <span class=\"k\">global</span>\u00a0_keptErrors</td></tr><tr><th id=\"L102\"><a href=\"#L102\">102</a></th><td>\u00a0 \u00a0 k <span class=\"o\">=</span>\u00a0_keptErrors</td></tr><tr><th id=\"L103\"><a href=\"#L103\">103</a></th><td>\u00a0 \u00a0 _keptErrors <span class=\"o\">=</span>\u00a0<span class=\"p\">[]</span></td></tr><tr><th id=\"L104\"><a href=\"#L104\">104</a></th><td>\u00a0 \u00a0 <span class=\"k\">if</span>\u00a0errorTypes<span class=\"p\">:</span></td></tr><tr><th id=\"L105\"><a href=\"#L105\">105</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">for</span>\u00a0erk <span class=\"ow\">in</span>\u00a0k<span class=\"p\">:</span></td></tr><tr><th id=\"L106\"><a href=\"#L106\">106</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 shouldReLog <span class=\"o\">=</span>\u00a0<span class=\"mi\">1</span></td></tr><tr><th id=\"L107\"><a href=\"#L107\">107</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">for</span>\u00a0errT <span class=\"ow\">in</span>\u00a0errorTypes<span class=\"p\">:</span></td></tr><tr><th id=\"L108\"><a href=\"#L108\">108</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">if</span>\u00a0erk<span class=\"o\">.</span>check<span class=\"p\">(</span>errT<span class=\"p\">):</span></td></tr><tr><th id=\"L109\"><a href=\"#L109\">109</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 shouldReLog <span class=\"o\">=</span>\u00a0<span class=\"mi\">0</span></td></tr><tr><th id=\"L110\"><a href=\"#L110\">110</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">if</span>\u00a0shouldReLog<span class=\"p\">:</span></td></tr><tr><th id=\"L111\"><a href=\"#L111\">111</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 err<span class=\"p\">(</span>erk<span class=\"p\">)</span></td></tr><tr><th id=\"L112\"><a href=\"#L112\">112</a></th><td>\u00a0 \u00a0 <span class=\"k\">return</span>\u00a0k</td></tr><tr><th id=\"L113\"><a href=\"#L113\">113</a></th><td></td></tr><tr><th id=\"L114\"><a href=\"#L114\">114</a></th><td><span class=\"k\">def</span>\u00a0<span class=\"nf\">ignoreErrors</span><span class=\"p\">(</span><span class=\"o\">*</span>types<span class=\"p\">):</span></td></tr><tr><th id=\"L115\"><a href=\"#L115\">115</a></th><td>\u00a0 \u00a0 <span class=\"sd\">\"\"\"DEPRECATED\"\"\"</span></td></tr><tr><th id=\"L116\"><a href=\"#L116\">116</a></th><td>\u00a0 \u00a0 warnings<span class=\"o\">.</span>warn<span class=\"p\">(</span><span class=\"s\">\"log.ignoreErrors is deprecated since Twisted 2.5\"</span><span class=\"p\">,</span></td></tr><tr><th id=\"L117\"><a href=\"#L117\">117</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 category<span class=\"o\">=</span><span class=\"ne\">DeprecationWarning</span><span class=\"p\">,</span>\u00a0stacklevel<span class=\"o\">=</span><span class=\"mi\">2</span><span class=\"p\">)</span></td></tr><tr><th id=\"L118\"><a href=\"#L118\">118</a></th><td>\u00a0 \u00a0 _ignore<span class=\"p\">(</span><span class=\"o\">*</span>types<span class=\"p\">)</span></td></tr><tr><th id=\"L119\"><a href=\"#L119\">119</a></th><td></td></tr><tr><th id=\"L120\"><a href=\"#L120\">120</a></th><td><span class=\"k\">def</span>\u00a0<span class=\"nf\">_ignore</span><span class=\"p\">(</span><span class=\"o\">*</span>types<span class=\"p\">):</span></td></tr><tr><th id=\"L121\"><a href=\"#L121\">121</a></th><td>\u00a0 \u00a0 <span class=\"sd\">\"\"\"</span></td></tr><tr><th id=\"L122\"><a href=\"#L122\">122</a></th><td><span class=\"sd\">\u00a0 \u00a0 PRIVATE. DEPRECATED. DON'T USE.</span></td></tr><tr><th id=\"L123\"><a href=\"#L123\">123</a></th><td><span class=\"sd\">\u00a0 \u00a0 \"\"\"</span></td></tr><tr><th id=\"L124\"><a href=\"#L124\">124</a></th><td>\u00a0 \u00a0 <span class=\"k\">for</span>\u00a0<span class=\"nb\">type</span>\u00a0<span class=\"ow\">in</span>\u00a0types<span class=\"p\">:</span></td></tr><tr><th id=\"L125\"><a href=\"#L125\">125</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 _ignoreErrors<span class=\"o\">.</span>append<span class=\"p\">(</span><span class=\"nb\">type</span><span class=\"p\">)</span></td></tr><tr><th id=\"L126\"><a href=\"#L126\">126</a></th><td></td></tr><tr><th id=\"L127\"><a href=\"#L127\">127</a></th><td><span class=\"k\">def</span>\u00a0<span class=\"nf\">clearIgnores</span><span class=\"p\">():</span></td></tr><tr><th id=\"L128\"><a href=\"#L128\">128</a></th><td>\u00a0 \u00a0 <span class=\"sd\">\"\"\"DEPRECATED\"\"\"</span></td></tr><tr><th id=\"L129\"><a href=\"#L129\">129</a></th><td>\u00a0 \u00a0 warnings<span class=\"o\">.</span>warn<span class=\"p\">(</span><span class=\"s\">\"log.clearIgnores is deprecated since Twisted 2.5\"</span><span class=\"p\">,</span></td></tr><tr><th id=\"L130\"><a href=\"#L130\">130</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 category<span class=\"o\">=</span><span class=\"ne\">DeprecationWarning</span><span class=\"p\">,</span>\u00a0stacklevel<span class=\"o\">=</span><span class=\"mi\">2</span><span class=\"p\">)</span></td></tr><tr><th id=\"L131\"><a href=\"#L131\">131</a></th><td>\u00a0 \u00a0 _clearIgnores<span class=\"p\">()</span></td></tr><tr><th id=\"L132\"><a href=\"#L132\">132</a></th><td></td></tr><tr><th id=\"L133\"><a href=\"#L133\">133</a></th><td><span class=\"k\">def</span>\u00a0<span class=\"nf\">_clearIgnores</span><span class=\"p\">():</span></td></tr><tr><th id=\"L134\"><a href=\"#L134\">134</a></th><td>\u00a0 \u00a0 <span class=\"sd\">\"\"\"</span></td></tr><tr><th id=\"L135\"><a href=\"#L135\">135</a></th><td><span class=\"sd\">\u00a0 \u00a0 PRIVATE. DEPRECATED. DON'T USE.</span></td></tr><tr><th id=\"L136\"><a href=\"#L136\">136</a></th><td><span class=\"sd\">\u00a0 \u00a0 \"\"\"</span></td></tr><tr><th id=\"L137\"><a href=\"#L137\">137</a></th><td>\u00a0 \u00a0 <span class=\"k\">global</span>\u00a0_ignoreErrors</td></tr><tr><th id=\"L138\"><a href=\"#L138\">138</a></th><td>\u00a0 \u00a0 _ignoreErrors <span class=\"o\">=</span>\u00a0<span class=\"p\">[]</span></td></tr><tr><th id=\"L139\"><a href=\"#L139\">139</a></th><td></td></tr><tr><th id=\"L140\"><a href=\"#L140\">140</a></th><td></td></tr><tr><th id=\"L141\"><a href=\"#L141\">141</a></th><td><span class=\"k\">def</span>\u00a0<span class=\"nf\">err</span><span class=\"p\">(</span>_stuff<span class=\"o\">=</span><span class=\"bp\">None</span><span class=\"p\">,</span>\u00a0_why<span class=\"o\">=</span><span class=\"bp\">None</span><span class=\"p\">,</span>\u00a0<span class=\"o\">**</span>kw<span class=\"p\">):</span></td></tr><tr><th id=\"L142\"><a href=\"#L142\">142</a></th><td>\u00a0 \u00a0 <span class=\"sd\">\"\"\"</span></td></tr><tr><th id=\"L143\"><a href=\"#L143\">143</a></th><td><span class=\"sd\">\u00a0 \u00a0 Write a failure to the log.</span></td></tr><tr><th id=\"L144\"><a href=\"#L144\">144</a></th><td><span class=\"sd\">\u00a0 \u00a0 \"\"\"</span></td></tr><tr><th id=\"L145\"><a href=\"#L145\">145</a></th><td>\u00a0 \u00a0 <span class=\"k\">if</span>\u00a0_stuff <span class=\"ow\">is</span>\u00a0<span class=\"bp\">None</span><span class=\"p\">:</span></td></tr><tr><th id=\"L146\"><a href=\"#L146\">146</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 _stuff <span class=\"o\">=</span>\u00a0failure<span class=\"o\">.</span>Failure<span class=\"p\">()</span></td></tr><tr><th id=\"L147\"><a href=\"#L147\">147</a></th><td>\u00a0 \u00a0 <span class=\"k\">if</span>\u00a0<span class=\"nb\">isinstance</span><span class=\"p\">(</span>_stuff<span class=\"p\">,</span>\u00a0failure<span class=\"o\">.</span>Failure<span class=\"p\">):</span></td></tr><tr><th id=\"L148\"><a href=\"#L148\">148</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">if</span>\u00a0_keepErrors<span class=\"p\">:</span></td></tr><tr><th id=\"L149\"><a href=\"#L149\">149</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">if</span>\u00a0_ignoreErrors<span class=\"p\">:</span></td></tr><tr><th id=\"L150\"><a href=\"#L150\">150</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 keep <span class=\"o\">=</span>\u00a0<span class=\"mi\">0</span></td></tr><tr><th id=\"L151\"><a href=\"#L151\">151</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">for</span>\u00a0err <span class=\"ow\">in</span>\u00a0_ignoreErrors<span class=\"p\">:</span></td></tr><tr><th id=\"L152\"><a href=\"#L152\">152</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 r <span class=\"o\">=</span>\u00a0_stuff<span class=\"o\">.</span>check<span class=\"p\">(</span>err<span class=\"p\">)</span></td></tr><tr><th id=\"L153\"><a href=\"#L153\">153</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">if</span>\u00a0r<span class=\"p\">:</span></td></tr><tr><th id=\"L154\"><a href=\"#L154\">154</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 keep <span class=\"o\">=</span>\u00a0<span class=\"mi\">0</span></td></tr><tr><th id=\"L155\"><a href=\"#L155\">155</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">break</span></td></tr><tr><th id=\"L156\"><a href=\"#L156\">156</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">else</span><span class=\"p\">:</span></td></tr><tr><th id=\"L157\"><a href=\"#L157\">157</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 keep <span class=\"o\">=</span>\u00a0<span class=\"mi\">1</span></td></tr><tr><th id=\"L158\"><a href=\"#L158\">158</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">if</span>\u00a0keep<span class=\"p\">:</span></td></tr><tr><th id=\"L159\"><a href=\"#L159\">159</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 _keptErrors<span class=\"o\">.</span>append<span class=\"p\">(</span>_stuff<span class=\"p\">)</span></td></tr><tr><th id=\"L160\"><a href=\"#L160\">160</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">else</span><span class=\"p\">:</span></td></tr><tr><th id=\"L161\"><a href=\"#L161\">161</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 _keptErrors<span class=\"o\">.</span>append<span class=\"p\">(</span>_stuff<span class=\"p\">)</span></td></tr><tr><th id=\"L162\"><a href=\"#L162\">162</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 msg<span class=\"p\">(</span>failure<span class=\"o\">=</span>_stuff<span class=\"p\">,</span>\u00a0why<span class=\"o\">=</span>_why<span class=\"p\">,</span>\u00a0isError<span class=\"o\">=</span><span class=\"mi\">1</span><span class=\"p\">,</span>\u00a0<span class=\"o\">**</span>kw<span class=\"p\">)</span></td></tr><tr><th id=\"L163\"><a href=\"#L163\">163</a></th><td>\u00a0 \u00a0 <span class=\"k\">elif</span>\u00a0<span class=\"nb\">isinstance</span><span class=\"p\">(</span>_stuff<span class=\"p\">,</span>\u00a0<span class=\"ne\">Exception</span><span class=\"p\">):</span></td></tr><tr><th id=\"L164\"><a href=\"#L164\">164</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 msg<span class=\"p\">(</span>failure<span class=\"o\">=</span>failure<span class=\"o\">.</span>Failure<span class=\"p\">(</span>_stuff<span class=\"p\">),</span>\u00a0why<span class=\"o\">=</span>_why<span class=\"p\">,</span>\u00a0isError<span class=\"o\">=</span><span class=\"mi\">1</span><span class=\"p\">,</span>\u00a0<span class=\"o\">**</span>kw<span class=\"p\">)</span></td></tr><tr><th id=\"L165\"><a href=\"#L165\">165</a></th><td>\u00a0 \u00a0 <span class=\"k\">else</span><span class=\"p\">:</span></td></tr><tr><th id=\"L166\"><a href=\"#L166\">166</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 msg<span class=\"p\">(</span><span class=\"nb\">repr</span><span class=\"p\">(</span>_stuff<span class=\"p\">),</span>\u00a0why<span class=\"o\">=</span>_why<span class=\"p\">,</span>\u00a0isError<span class=\"o\">=</span><span class=\"mi\">1</span><span class=\"p\">,</span>\u00a0<span class=\"o\">**</span>kw<span class=\"p\">)</span></td></tr><tr><th id=\"L167\"><a href=\"#L167\">167</a></th><td></td></tr><tr><th id=\"L168\"><a href=\"#L168\">168</a></th><td>deferr <span class=\"o\">=</span>\u00a0err</td></tr><tr><th id=\"L169\"><a href=\"#L169\">169</a></th><td></td></tr><tr><th id=\"L170\"><a href=\"#L170\">170</a></th><td><span class=\"k\">class</span>\u00a0<span class=\"nc\">Logger</span><span class=\"p\">:</span></td></tr><tr><th id=\"L171\"><a href=\"#L171\">171</a></th><td>\u00a0 \u00a0 <span class=\"sd\">\"\"\"</span></td></tr><tr><th id=\"L172\"><a href=\"#L172\">172</a></th><td><span class=\"sd\">\u00a0 \u00a0 This represents a class which may 'own' a log. Used by subclassing.</span></td></tr><tr><th id=\"L173\"><a href=\"#L173\">173</a></th><td><span class=\"sd\">\u00a0 \u00a0 \"\"\"</span></td></tr><tr><th id=\"L174\"><a href=\"#L174\">174</a></th><td>\u00a0 \u00a0 <span class=\"k\">def</span>\u00a0<span class=\"nf\">logPrefix</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">):</span></td></tr><tr><th id=\"L175\"><a href=\"#L175\">175</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"sd\">\"\"\"</span></td></tr><tr><th id=\"L176\"><a href=\"#L176\">176</a></th><td><span class=\"sd\">\u00a0 \u00a0 \u00a0 \u00a0 Override this method to insert custom logging behavior.\u00a0 Its</span></td></tr><tr><th id=\"L177\"><a href=\"#L177\">177</a></th><td><span class=\"sd\">\u00a0 \u00a0 \u00a0 \u00a0 return value will be inserted in front of every line.\u00a0 It may</span></td></tr><tr><th id=\"L178\"><a href=\"#L178\">178</a></th><td><span class=\"sd\">\u00a0 \u00a0 \u00a0 \u00a0 be called more times than the number of output lines.</span></td></tr><tr><th id=\"L179\"><a href=\"#L179\">179</a></th><td><span class=\"sd\">\u00a0 \u00a0 \u00a0 \u00a0 \"\"\"</span></td></tr><tr><th id=\"L180\"><a href=\"#L180\">180</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">return</span>\u00a0<span class=\"s\">'-'</span></td></tr><tr><th id=\"L181\"><a href=\"#L181\">181</a></th><td></td></tr><tr><th id=\"L182\"><a href=\"#L182\">182</a></th><td><span class=\"k\">class</span>\u00a0<span class=\"nc\">LogPublisher</span><span class=\"p\">:</span></td></tr><tr><th id=\"L183\"><a href=\"#L183\">183</a></th><td>\u00a0 \u00a0 <span class=\"sd\">\"\"\"Class for singleton log message publishing.\"\"\"</span></td></tr><tr><th id=\"L184\"><a href=\"#L184\">184</a></th><td></td></tr><tr><th id=\"L185\"><a href=\"#L185\">185</a></th><td>\u00a0 \u00a0 synchronized <span class=\"o\">=</span>\u00a0<span class=\"p\">[</span><span class=\"s\">'msg'</span><span class=\"p\">]</span></td></tr><tr><th id=\"L186\"><a href=\"#L186\">186</a></th><td></td></tr><tr><th id=\"L187\"><a href=\"#L187\">187</a></th><td>\u00a0 \u00a0 <span class=\"k\">def</span>\u00a0<span class=\"nf\">__init__</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">):</span></td></tr><tr><th id=\"L188\"><a href=\"#L188\">188</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"bp\">self</span><span class=\"o\">.</span>observers <span class=\"o\">=</span>\u00a0<span class=\"p\">[]</span></td></tr><tr><th id=\"L189\"><a href=\"#L189\">189</a></th><td></td></tr><tr><th id=\"L190\"><a href=\"#L190\">190</a></th><td>\u00a0 \u00a0 <span class=\"k\">def</span>\u00a0<span class=\"nf\">addObserver</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span>\u00a0other<span class=\"p\">):</span></td></tr><tr><th id=\"L191\"><a href=\"#L191\">191</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"sd\">\"\"\"Add a new observer.</span></td></tr><tr><th id=\"L192\"><a href=\"#L192\">192</a></th><td><span class=\"sd\"></span></td></tr><tr><th id=\"L193\"><a href=\"#L193\">193</a></th><td><span class=\"sd\">\u00a0 \u00a0 \u00a0 \u00a0 Observers are callable objects that will be called with each new log</span></td></tr><tr><th id=\"L194\"><a href=\"#L194\">194</a></th><td><span class=\"sd\">\u00a0 \u00a0 \u00a0 \u00a0 message (a dict).</span></td></tr><tr><th id=\"L195\"><a href=\"#L195\">195</a></th><td><span class=\"sd\">\u00a0 \u00a0 \u00a0 \u00a0 \"\"\"</span></td></tr><tr><th id=\"L196\"><a href=\"#L196\">196</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">assert</span>\u00a0<span class=\"nb\">callable</span><span class=\"p\">(</span>other<span class=\"p\">)</span></td></tr><tr><th id=\"L197\"><a href=\"#L197\">197</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"bp\">self</span><span class=\"o\">.</span>observers<span class=\"o\">.</span>append<span class=\"p\">(</span>other<span class=\"p\">)</span></td></tr><tr><th id=\"L198\"><a href=\"#L198\">198</a></th><td></td></tr><tr><th id=\"L199\"><a href=\"#L199\">199</a></th><td>\u00a0 \u00a0 <span class=\"k\">def</span>\u00a0<span class=\"nf\">removeObserver</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span>\u00a0other<span class=\"p\">):</span></td></tr><tr><th id=\"L200\"><a href=\"#L200\">200</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"sd\">\"\"\"Remove an observer.\"\"\"</span></td></tr><tr><th id=\"L201\"><a href=\"#L201\">201</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"bp\">self</span><span class=\"o\">.</span>observers<span class=\"o\">.</span>remove<span class=\"p\">(</span>other<span class=\"p\">)</span></td></tr><tr><th id=\"L202\"><a href=\"#L202\">202</a></th><td></td></tr><tr><th id=\"L203\"><a href=\"#L203\">203</a></th><td>\u00a0 \u00a0 <span class=\"k\">def</span>\u00a0<span class=\"nf\">msg</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span>\u00a0<span class=\"o\">*</span>message<span class=\"p\">,</span>\u00a0<span class=\"o\">**</span>kw<span class=\"p\">):</span></td></tr><tr><th id=\"L204\"><a href=\"#L204\">204</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"sd\">\"\"\"Log a new message.</span></td></tr><tr><th id=\"L205\"><a href=\"#L205\">205</a></th><td><span class=\"sd\"></span></td></tr><tr><th id=\"L206\"><a href=\"#L206\">206</a></th><td><span class=\"sd\">\u00a0 \u00a0 \u00a0 \u00a0 For example::</span></td></tr><tr><th id=\"L207\"><a href=\"#L207\">207</a></th><td><span class=\"sd\"></span></td></tr><tr><th id=\"L208\"><a href=\"#L208\">208</a></th><td><span class=\"sd\">\u00a0 \u00a0 \u00a0 \u00a0 | log.msg('Hello, world.')</span></td></tr><tr><th id=\"L209\"><a href=\"#L209\">209</a></th><td><span class=\"sd\"></span></td></tr><tr><th id=\"L210\"><a href=\"#L210\">210</a></th><td><span class=\"sd\">\u00a0 \u00a0 \u00a0 \u00a0 In particular, you MUST avoid the forms::</span></td></tr><tr><th id=\"L211\"><a href=\"#L211\">211</a></th><td><span class=\"sd\"></span></td></tr><tr><th id=\"L212\"><a href=\"#L212\">212</a></th><td><span class=\"sd\">\u00a0 \u00a0 \u00a0 \u00a0 | log.msg(u'Hello, world.')</span></td></tr><tr><th id=\"L213\"><a href=\"#L213\">213</a></th><td><span class=\"sd\">\u00a0 \u00a0 \u00a0 \u00a0 | log.msg('Hello ', 'world.')</span></td></tr><tr><th id=\"L214\"><a href=\"#L214\">214</a></th><td><span class=\"sd\"></span></td></tr><tr><th id=\"L215\"><a href=\"#L215\">215</a></th><td><span class=\"sd\">\u00a0 \u00a0 \u00a0 \u00a0 These forms work (sometimes) by accident and will be disabled</span></td></tr><tr><th id=\"L216\"><a href=\"#L216\">216</a></th><td><span class=\"sd\">\u00a0 \u00a0 \u00a0 \u00a0 entirely in the future.</span></td></tr><tr><th id=\"L217\"><a href=\"#L217\">217</a></th><td><span class=\"sd\">\u00a0 \u00a0 \u00a0 \u00a0 \"\"\"</span></td></tr><tr><th id=\"L218\"><a href=\"#L218\">218</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 actualEventDict <span class=\"o\">=</span>\u00a0<span class=\"p\">(</span>context<span class=\"o\">.</span>get<span class=\"p\">(</span>ILogContext<span class=\"p\">)</span>\u00a0<span class=\"ow\">or</span>\u00a0<span class=\"p\">{})</span><span class=\"o\">.</span>copy<span class=\"p\">()</span></td></tr><tr><th id=\"L219\"><a href=\"#L219\">219</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 actualEventDict<span class=\"o\">.</span>update<span class=\"p\">(</span>kw<span class=\"p\">)</span></td></tr><tr><th id=\"L220\"><a href=\"#L220\">220</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 actualEventDict<span class=\"p\">[</span><span class=\"s\">'message'</span><span class=\"p\">]</span>\u00a0<span class=\"o\">=</span>\u00a0message</td></tr><tr><th id=\"L221\"><a href=\"#L221\">221</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 actualEventDict<span class=\"p\">[</span><span class=\"s\">'time'</span><span class=\"p\">]</span>\u00a0<span class=\"o\">=</span>\u00a0time<span class=\"o\">.</span>time<span class=\"p\">()</span></td></tr><tr><th id=\"L222\"><a href=\"#L222\">222</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">for</span>\u00a0i <span class=\"ow\">in</span>\u00a0<span class=\"nb\">xrange</span><span class=\"p\">(</span><span class=\"nb\">len</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span>observers<span class=\"p\">)</span>\u00a0<span class=\"o\">-</span>\u00a0<span class=\"mi\">1</span><span class=\"p\">,</span>\u00a0<span class=\"o\">-</span><span class=\"mi\">1</span><span class=\"p\">,</span>\u00a0<span class=\"o\">-</span><span class=\"mi\">1</span><span class=\"p\">):</span></td></tr><tr><th id=\"L223\"><a href=\"#L223\">223</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">try</span><span class=\"p\">:</span></td></tr><tr><th id=\"L224\"><a href=\"#L224\">224</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"bp\">self</span><span class=\"o\">.</span>observers<span class=\"p\">[</span>i<span class=\"p\">](</span>actualEventDict<span class=\"p\">)</span></td></tr><tr><th id=\"L225\"><a href=\"#L225\">225</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">except</span>\u00a0<span class=\"ne\">KeyboardInterrupt</span><span class=\"p\">:</span></td></tr><tr><th id=\"L226\"><a href=\"#L226\">226</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"c\"># Don't swallow keyboard interrupt!</span></td></tr><tr><th id=\"L227\"><a href=\"#L227\">227</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">raise</span></td></tr><tr><th id=\"L228\"><a href=\"#L228\">228</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">except</span>\u00a0<span class=\"ne\">UnicodeEncodeError</span><span class=\"p\">:</span></td></tr><tr><th id=\"L229\"><a href=\"#L229\">229</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">raise</span></td></tr><tr><th id=\"L230\"><a href=\"#L230\">230</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">except</span><span class=\"p\">:</span></td></tr><tr><th id=\"L231\"><a href=\"#L231\">231</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 o <span class=\"o\">=</span>\u00a0<span class=\"bp\">self</span><span class=\"o\">.</span>observers<span class=\"o\">.</span>pop<span class=\"p\">(</span>i<span class=\"p\">)</span></td></tr><tr><th id=\"L232\"><a href=\"#L232\">232</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 err<span class=\"p\">(</span>failure<span class=\"o\">.</span>Failure<span class=\"p\">(),</span></td></tr><tr><th id=\"L233\"><a href=\"#L233\">233</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"s\">\"Log observer </span><span class=\"si\">%s</span><span class=\"s\">\u00a0failed, removing from observer list.\"</span>\u00a0<span class=\"o\">%</span>\u00a0<span class=\"p\">(</span>o<span class=\"p\">,))</span></td></tr><tr><th id=\"L234\"><a href=\"#L234\">234</a></th><td></td></tr><tr><th id=\"L235\"><a href=\"#L235\">235</a></th><td></td></tr><tr><th id=\"L236\"><a href=\"#L236\">236</a></th><td><span class=\"k\">try</span><span class=\"p\">:</span></td></tr><tr><th id=\"L237\"><a href=\"#L237\">237</a></th><td>\u00a0 \u00a0 theLogPublisher</td></tr><tr><th id=\"L238\"><a href=\"#L238\">238</a></th><td><span class=\"k\">except</span>\u00a0<span class=\"ne\">NameError</span><span class=\"p\">:</span></td></tr><tr><th id=\"L239\"><a href=\"#L239\">239</a></th><td>\u00a0 \u00a0 theLogPublisher <span class=\"o\">=</span>\u00a0LogPublisher<span class=\"p\">()</span></td></tr><tr><th id=\"L240\"><a href=\"#L240\">240</a></th><td>\u00a0 \u00a0 addObserver <span class=\"o\">=</span>\u00a0theLogPublisher<span class=\"o\">.</span>addObserver</td></tr><tr><th id=\"L241\"><a href=\"#L241\">241</a></th><td>\u00a0 \u00a0 removeObserver <span class=\"o\">=</span>\u00a0theLogPublisher<span class=\"o\">.</span>removeObserver</td></tr><tr><th id=\"L242\"><a href=\"#L242\">242</a></th><td>\u00a0 \u00a0 msg <span class=\"o\">=</span>\u00a0theLogPublisher<span class=\"o\">.</span>msg</td></tr><tr><th id=\"L243\"><a href=\"#L243\">243</a></th><td></td></tr><tr><th id=\"L244\"><a href=\"#L244\">244</a></th><td></td></tr><tr><th id=\"L245\"><a href=\"#L245\">245</a></th><td><span class=\"k\">class</span>\u00a0<span class=\"nc\">FileLogObserver</span><span class=\"p\">:</span></td></tr><tr><th id=\"L246\"><a href=\"#L246\">246</a></th><td>\u00a0 \u00a0 <span class=\"sd\">\"\"\"</span></td></tr><tr><th id=\"L247\"><a href=\"#L247\">247</a></th><td><span class=\"sd\">\u00a0 \u00a0 Log observer that writes to a file-like object.</span></td></tr><tr><th id=\"L248\"><a href=\"#L248\">248</a></th><td><span class=\"sd\"></span></td></tr><tr><th id=\"L249\"><a href=\"#L249\">249</a></th><td><span class=\"sd\">\u00a0 \u00a0 @type timeFormat: C{str} or C{NoneType}</span></td></tr><tr><th id=\"L250\"><a href=\"#L250\">250</a></th><td><span class=\"sd\">\u00a0 \u00a0 @ivar timeFormat: If not C{None}, the format string passed to strftime().</span></td></tr><tr><th id=\"L251\"><a href=\"#L251\">251</a></th><td><span class=\"sd\">\u00a0 \u00a0 \"\"\"</span></td></tr><tr><th id=\"L252\"><a href=\"#L252\">252</a></th><td>\u00a0 \u00a0 timeFormat <span class=\"o\">=</span>\u00a0<span class=\"bp\">None</span></td></tr><tr><th id=\"L253\"><a href=\"#L253\">253</a></th><td></td></tr><tr><th id=\"L254\"><a href=\"#L254\">254</a></th><td>\u00a0 \u00a0 <span class=\"k\">def</span>\u00a0<span class=\"nf\">__init__</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span>\u00a0f<span class=\"p\">):</span></td></tr><tr><th id=\"L255\"><a href=\"#L255\">255</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"bp\">self</span><span class=\"o\">.</span>write <span class=\"o\">=</span>\u00a0f<span class=\"o\">.</span>write</td></tr><tr><th id=\"L256\"><a href=\"#L256\">256</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"bp\">self</span><span class=\"o\">.</span>flush <span class=\"o\">=</span>\u00a0f<span class=\"o\">.</span>flush</td></tr><tr><th id=\"L257\"><a href=\"#L257\">257</a></th><td></td></tr><tr><th id=\"L258\"><a href=\"#L258\">258</a></th><td>\u00a0 \u00a0 <span class=\"k\">def</span>\u00a0<span class=\"nf\">_safeFormat</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span>\u00a0fmtString<span class=\"p\">,</span>\u00a0crap<span class=\"p\">):</span></td></tr><tr><th id=\"L259\"><a href=\"#L259\">259</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"c\">#There's a way we could make this if not safer at least more</span></td></tr><tr><th id=\"L260\"><a href=\"#L260\">260</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"c\">#informative: perhaps some sort of str/repr wrapper objects</span></td></tr><tr><th id=\"L261\"><a href=\"#L261\">261</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"c\">#could be wrapped around the things inside of 'crap'. That way</span></td></tr><tr><th id=\"L262\"><a href=\"#L262\">262</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"c\">#if the event dict contains an object with a bad __repr__, we</span></td></tr><tr><th id=\"L263\"><a href=\"#L263\">263</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"c\">#can only cry about that individual object instead of the</span></td></tr><tr><th id=\"L264\"><a href=\"#L264\">264</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"c\">#entire event dict.</span></td></tr><tr><th id=\"L265\"><a href=\"#L265\">265</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">try</span><span class=\"p\">:</span></td></tr><tr><th id=\"L266\"><a href=\"#L266\">266</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 text <span class=\"o\">=</span>\u00a0fmtString <span class=\"o\">%</span>\u00a0crap</td></tr><tr><th id=\"L267\"><a href=\"#L267\">267</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">except</span>\u00a0<span class=\"ne\">KeyboardInterrupt</span><span class=\"p\">:</span></td></tr><tr><th id=\"L268\"><a href=\"#L268\">268</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">raise</span></td></tr><tr><th id=\"L269\"><a href=\"#L269\">269</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">except</span><span class=\"p\">:</span></td></tr><tr><th id=\"L270\"><a href=\"#L270\">270</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">try</span><span class=\"p\">:</span></td></tr><tr><th id=\"L271\"><a href=\"#L271\">271</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 text <span class=\"o\">=</span>\u00a0<span class=\"p\">(</span><span class=\"s\">'Invalid format string or unformattable object in log message: </span><span class=\"si\">%r</span><span class=\"s\">, </span><span class=\"si\">%s</span><span class=\"s\">'</span>\u00a0<span class=\"o\">%</span>\u00a0<span class=\"p\">(</span>fmtString<span class=\"p\">,</span>\u00a0crap<span class=\"p\">))</span></td></tr><tr><th id=\"L272\"><a href=\"#L272\">272</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">except</span><span class=\"p\">:</span></td></tr><tr><th id=\"L273\"><a href=\"#L273\">273</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">try</span><span class=\"p\">:</span></td></tr><tr><th id=\"L274\"><a href=\"#L274\">274</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 text <span class=\"o\">=</span>\u00a0<span class=\"s\">'UNFORMATTABLE OBJECT WRITTEN TO LOG with fmt </span><span class=\"si\">%r</span><span class=\"s\">, MESSAGE LOST'</span>\u00a0<span class=\"o\">%</span>\u00a0<span class=\"p\">(</span>fmtString<span class=\"p\">,)</span></td></tr><tr><th id=\"L275\"><a href=\"#L275\">275</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">except</span><span class=\"p\">:</span></td></tr><tr><th id=\"L276\"><a href=\"#L276\">276</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 text <span class=\"o\">=</span>\u00a0<span class=\"s\">'PATHOLOGICAL ERROR IN BOTH FORMAT STRING AND MESSAGE DETAILS, MESSAGE LOST'</span></td></tr><tr><th id=\"L277\"><a href=\"#L277\">277</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">return</span>\u00a0text</td></tr><tr><th id=\"L278\"><a href=\"#L278\">278</a></th><td></td></tr><tr><th id=\"L279\"><a href=\"#L279\">279</a></th><td></td></tr><tr><th id=\"L280\"><a href=\"#L280\">280</a></th><td>\u00a0 \u00a0 <span class=\"k\">def</span>\u00a0<span class=\"nf\">getTimezoneOffset</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">):</span></td></tr><tr><th id=\"L281\"><a href=\"#L281\">281</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"sd\">\"\"\"</span></td></tr><tr><th id=\"L282\"><a href=\"#L282\">282</a></th><td><span class=\"sd\">\u00a0 \u00a0 \u00a0 \u00a0 Return the current local timezone offset from UTC.</span></td></tr><tr><th id=\"L283\"><a href=\"#L283\">283</a></th><td><span class=\"sd\"></span></td></tr><tr><th id=\"L284\"><a href=\"#L284\">284</a></th><td><span class=\"sd\">\u00a0 \u00a0 \u00a0 \u00a0 @rtype: C{int}</span></td></tr><tr><th id=\"L285\"><a href=\"#L285\">285</a></th><td><span class=\"sd\">\u00a0 \u00a0 \u00a0 \u00a0 @return: The number of seconds offset from UTC.\u00a0 West is positive,</span></td></tr><tr><th id=\"L286\"><a href=\"#L286\">286</a></th><td><span class=\"sd\">\u00a0 \u00a0 \u00a0 \u00a0 east is negative.</span></td></tr><tr><th id=\"L287\"><a href=\"#L287\">287</a></th><td><span class=\"sd\">\u00a0 \u00a0 \u00a0 \u00a0 \"\"\"</span></td></tr><tr><th id=\"L288\"><a href=\"#L288\">288</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">if</span>\u00a0time<span class=\"o\">.</span>daylight<span class=\"p\">:</span></td></tr><tr><th id=\"L289\"><a href=\"#L289\">289</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">return</span>\u00a0time<span class=\"o\">.</span>altzone</td></tr><tr><th id=\"L290\"><a href=\"#L290\">290</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">return</span>\u00a0time<span class=\"o\">.</span>timezone</td></tr><tr><th id=\"L291\"><a href=\"#L291\">291</a></th><td></td></tr><tr><th id=\"L292\"><a href=\"#L292\">292</a></th><td></td></tr><tr><th id=\"L293\"><a href=\"#L293\">293</a></th><td>\u00a0 \u00a0 <span class=\"k\">def</span>\u00a0<span class=\"nf\">formatTime</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span>\u00a0when<span class=\"p\">):</span></td></tr><tr><th id=\"L294\"><a href=\"#L294\">294</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"sd\">\"\"\"</span></td></tr><tr><th id=\"L295\"><a href=\"#L295\">295</a></th><td><span class=\"sd\">\u00a0 \u00a0 \u00a0 \u00a0 Return the given UTC value formatted as a human-readable string</span></td></tr><tr><th id=\"L296\"><a href=\"#L296\">296</a></th><td><span class=\"sd\">\u00a0 \u00a0 \u00a0 \u00a0 representing that time in the local timezone.</span></td></tr><tr><th id=\"L297\"><a href=\"#L297\">297</a></th><td><span class=\"sd\"></span></td></tr><tr><th id=\"L298\"><a href=\"#L298\">298</a></th><td><span class=\"sd\">\u00a0 \u00a0 \u00a0 \u00a0 @type when: C{int}</span></td></tr><tr><th id=\"L299\"><a href=\"#L299\">299</a></th><td><span class=\"sd\">\u00a0 \u00a0 \u00a0 \u00a0 @param when: POSIX timestamp to convert to a human-readable string.</span></td></tr><tr><th id=\"L300\"><a href=\"#L300\">300</a></th><td><span class=\"sd\"></span></td></tr><tr><th id=\"L301\"><a href=\"#L301\">301</a></th><td><span class=\"sd\">\u00a0 \u00a0 \u00a0 \u00a0 @rtype: C{str}</span></td></tr><tr><th id=\"L302\"><a href=\"#L302\">302</a></th><td><span class=\"sd\">\u00a0 \u00a0 \u00a0 \u00a0 \"\"\"</span></td></tr><tr><th id=\"L303\"><a href=\"#L303\">303</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">if</span>\u00a0<span class=\"bp\">self</span><span class=\"o\">.</span>timeFormat <span class=\"ow\">is</span>\u00a0<span class=\"ow\">not</span>\u00a0<span class=\"bp\">None</span><span class=\"p\">:</span></td></tr><tr><th id=\"L304\"><a href=\"#L304\">304</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">return</span>\u00a0time<span class=\"o\">.</span>strftime<span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span>timeFormat<span class=\"p\">,</span>\u00a0time<span class=\"o\">.</span>localtime<span class=\"p\">(</span>when<span class=\"p\">))</span></td></tr><tr><th id=\"L305\"><a href=\"#L305\">305</a></th><td></td></tr><tr><th id=\"L306\"><a href=\"#L306\">306</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 tzOffset <span class=\"o\">=</span>\u00a0<span class=\"o\">-</span><span class=\"bp\">self</span><span class=\"o\">.</span>getTimezoneOffset<span class=\"p\">()</span></td></tr><tr><th id=\"L307\"><a href=\"#L307\">307</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 when <span class=\"o\">=</span>\u00a0datetime<span class=\"o\">.</span>datetime<span class=\"o\">.</span>utcfromtimestamp<span class=\"p\">(</span>when <span class=\"o\">+</span>\u00a0tzOffset<span class=\"p\">)</span></td></tr><tr><th id=\"L308\"><a href=\"#L308\">308</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 tzHour <span class=\"o\">=</span>\u00a0<span class=\"nb\">int</span><span class=\"p\">(</span>tzOffset <span class=\"o\">/</span>\u00a0<span class=\"mi\">60</span>\u00a0<span class=\"o\">/</span>\u00a0<span class=\"mi\">60</span><span class=\"p\">)</span></td></tr><tr><th id=\"L309\"><a href=\"#L309\">309</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 tzMin <span class=\"o\">=</span>\u00a0<span class=\"nb\">int</span><span class=\"p\">(</span>tzOffset <span class=\"o\">/</span>\u00a0<span class=\"mi\">60</span>\u00a0<span class=\"o\">%</span>\u00a0<span class=\"mi\">60</span><span class=\"p\">)</span></td></tr><tr><th id=\"L310\"><a href=\"#L310\">310</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">return</span>\u00a0<span class=\"s\">'</span><span class=\"si\">%d</span><span class=\"s\">/</span><span class=\"si\">%02d</span><span class=\"s\">/</span><span class=\"si\">%02d</span><span class=\"s\">\u00a0</span><span class=\"si\">%02d</span><span class=\"s\">:</span><span class=\"si\">%02d</span><span class=\"s\">\u00a0</span><span class=\"si\">%+03d%02d</span><span class=\"s\">'</span>\u00a0<span class=\"o\">%</span>\u00a0<span class=\"p\">(</span></td></tr><tr><th id=\"L311\"><a href=\"#L311\">311</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 when<span class=\"o\">.</span>year<span class=\"p\">,</span>\u00a0when<span class=\"o\">.</span>month<span class=\"p\">,</span>\u00a0when<span class=\"o\">.</span>day<span class=\"p\">,</span></td></tr><tr><th id=\"L312\"><a href=\"#L312\">312</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 when<span class=\"o\">.</span>hour<span class=\"p\">,</span>\u00a0when<span class=\"o\">.</span>minute<span class=\"p\">,</span></td></tr><tr><th id=\"L313\"><a href=\"#L313\">313</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 tzHour<span class=\"p\">,</span>\u00a0tzMin<span class=\"p\">)</span></td></tr><tr><th id=\"L314\"><a href=\"#L314\">314</a></th><td></td></tr><tr><th id=\"L315\"><a href=\"#L315\">315</a></th><td></td></tr><tr><th id=\"L316\"><a href=\"#L316\">316</a></th><td>\u00a0 \u00a0 <span class=\"k\">def</span>\u00a0<span class=\"nf\">emit</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span>\u00a0eventDict<span class=\"p\">):</span></td></tr><tr><th id=\"L317\"><a href=\"#L317\">317</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 edm <span class=\"o\">=</span>\u00a0eventDict<span class=\"p\">[</span><span class=\"s\">'message'</span><span class=\"p\">]</span></td></tr><tr><th id=\"L318\"><a href=\"#L318\">318</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">if</span>\u00a0<span class=\"ow\">not</span>\u00a0edm<span class=\"p\">:</span></td></tr><tr><th id=\"L319\"><a href=\"#L319\">319</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">if</span>\u00a0eventDict<span class=\"p\">[</span><span class=\"s\">'isError'</span><span class=\"p\">]</span>\u00a0<span class=\"ow\">and</span>\u00a0eventDict<span class=\"o\">.</span>has_key<span class=\"p\">(</span><span class=\"s\">'failure'</span><span class=\"p\">):</span></td></tr><tr><th id=\"L320\"><a href=\"#L320\">320</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 text <span class=\"o\">=</span>\u00a0<span class=\"p\">((</span>eventDict<span class=\"o\">.</span>get<span class=\"p\">(</span><span class=\"s\">'why'</span><span class=\"p\">)</span>\u00a0<span class=\"ow\">or</span>\u00a0<span class=\"s\">'Unhandled Error'</span><span class=\"p\">)</span></td></tr><tr><th id=\"L321\"><a href=\"#L321\">321</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"o\">+</span>\u00a0<span class=\"s\">'</span><span class=\"se\">\\n</span><span class=\"s\">'</span>\u00a0<span class=\"o\">+</span>\u00a0eventDict<span class=\"p\">[</span><span class=\"s\">'failure'</span><span class=\"p\">]</span><span class=\"o\">.</span>getTraceback<span class=\"p\">())</span></td></tr><tr><th id=\"L322\"><a href=\"#L322\">322</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">elif</span>\u00a0eventDict<span class=\"o\">.</span>has_key<span class=\"p\">(</span><span class=\"s\">'format'</span><span class=\"p\">):</span></td></tr><tr><th id=\"L323\"><a href=\"#L323\">323</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 text <span class=\"o\">=</span>\u00a0<span class=\"bp\">self</span><span class=\"o\">.</span>_safeFormat<span class=\"p\">(</span>eventDict<span class=\"p\">[</span><span class=\"s\">'format'</span><span class=\"p\">],</span>\u00a0eventDict<span class=\"p\">)</span></td></tr><tr><th id=\"L324\"><a href=\"#L324\">324</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">else</span><span class=\"p\">:</span></td></tr><tr><th id=\"L325\"><a href=\"#L325\">325</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"c\"># we don't know how to log this</span></td></tr><tr><th id=\"L326\"><a href=\"#L326\">326</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">return</span></td></tr><tr><th id=\"L327\"><a href=\"#L327\">327</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">else</span><span class=\"p\">:</span></td></tr><tr><th id=\"L328\"><a href=\"#L328\">328</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 text <span class=\"o\">=</span>\u00a0<span class=\"s\">' '</span><span class=\"o\">.</span>join<span class=\"p\">(</span><span class=\"nb\">map</span><span class=\"p\">(</span>reflect<span class=\"o\">.</span>safe_str<span class=\"p\">,</span>\u00a0edm<span class=\"p\">))</span></td></tr><tr><th id=\"L329\"><a href=\"#L329\">329</a></th><td></td></tr><tr><th id=\"L330\"><a href=\"#L330\">330</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 timeStr <span class=\"o\">=</span>\u00a0<span class=\"bp\">self</span><span class=\"o\">.</span>formatTime<span class=\"p\">(</span>eventDict<span class=\"p\">[</span><span class=\"s\">'time'</span><span class=\"p\">])</span></td></tr><tr><th id=\"L331\"><a href=\"#L331\">331</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 fmtDict <span class=\"o\">=</span>\u00a0<span class=\"p\">{</span><span class=\"s\">'system'</span><span class=\"p\">:</span>\u00a0eventDict<span class=\"p\">[</span><span class=\"s\">'system'</span><span class=\"p\">],</span>\u00a0<span class=\"s\">'text'</span><span class=\"p\">:</span>\u00a0text<span class=\"o\">.</span>replace<span class=\"p\">(</span><span class=\"s\">\"</span><span class=\"se\">\\n</span><span class=\"s\">\"</span><span class=\"p\">,</span>\u00a0<span class=\"s\">\"</span><span class=\"se\">\\n\\t</span><span class=\"s\">\"</span><span class=\"p\">)}</span></td></tr><tr><th id=\"L332\"><a href=\"#L332\">332</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 msgStr <span class=\"o\">=</span>\u00a0<span class=\"bp\">self</span><span class=\"o\">.</span>_safeFormat<span class=\"p\">(</span><span class=\"s\">\"[</span><span class=\"si\">%(system)s</span><span class=\"s\">] </span><span class=\"si\">%(text)s</span><span class=\"se\">\\n</span><span class=\"s\">\"</span><span class=\"p\">,</span>\u00a0fmtDict<span class=\"p\">)</span></td></tr><tr><th id=\"L333\"><a href=\"#L333\">333</a></th><td></td></tr><tr><th id=\"L334\"><a href=\"#L334\">334</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 util<span class=\"o\">.</span>untilConcludes<span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span>write<span class=\"p\">,</span>\u00a0timeStr <span class=\"o\">+</span>\u00a0<span class=\"s\">\" \"</span>\u00a0<span class=\"o\">+</span>\u00a0msgStr<span class=\"p\">)</span></td></tr><tr><th id=\"L335\"><a href=\"#L335\">335</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 util<span class=\"o\">.</span>untilConcludes<span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span>flush<span class=\"p\">)</span>\u00a0 <span class=\"c\"># Hoorj!</span></td></tr><tr><th id=\"L336\"><a href=\"#L336\">336</a></th><td></td></tr><tr><th id=\"L337\"><a href=\"#L337\">337</a></th><td>\u00a0 \u00a0 <span class=\"k\">def</span>\u00a0<span class=\"nf\">start</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">):</span></td></tr><tr><th id=\"L338\"><a href=\"#L338\">338</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"sd\">\"\"\"Start observing log events.\"\"\"</span></td></tr><tr><th id=\"L339\"><a href=\"#L339\">339</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 addObserver<span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span>emit<span class=\"p\">)</span></td></tr><tr><th id=\"L340\"><a href=\"#L340\">340</a></th><td></td></tr><tr><th id=\"L341\"><a href=\"#L341\">341</a></th><td>\u00a0 \u00a0 <span class=\"k\">def</span>\u00a0<span class=\"nf\">stop</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">):</span></td></tr><tr><th id=\"L342\"><a href=\"#L342\">342</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"sd\">\"\"\"Stop observing log events.\"\"\"</span></td></tr><tr><th id=\"L343\"><a href=\"#L343\">343</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 removeObserver<span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span>emit<span class=\"p\">)</span></td></tr><tr><th id=\"L344\"><a href=\"#L344\">344</a></th><td></td></tr><tr><th id=\"L345\"><a href=\"#L345\">345</a></th><td></td></tr><tr><th id=\"L346\"><a href=\"#L346\">346</a></th><td><span class=\"k\">class</span>\u00a0<span class=\"nc\">StdioOnnaStick</span><span class=\"p\">:</span></td></tr><tr><th id=\"L347\"><a href=\"#L347\">347</a></th><td>\u00a0 \u00a0 <span class=\"sd\">\"\"\"Class that pretends to be stout/err.\"\"\"</span></td></tr><tr><th id=\"L348\"><a href=\"#L348\">348</a></th><td></td></tr><tr><th id=\"L349\"><a href=\"#L349\">349</a></th><td>\u00a0 \u00a0 closed <span class=\"o\">=</span>\u00a0<span class=\"mi\">0</span></td></tr><tr><th id=\"L350\"><a href=\"#L350\">350</a></th><td>\u00a0 \u00a0 softspace <span class=\"o\">=</span>\u00a0<span class=\"mi\">0</span></td></tr><tr><th id=\"L351\"><a href=\"#L351\">351</a></th><td>\u00a0 \u00a0 mode <span class=\"o\">=</span>\u00a0<span class=\"s\">'wb'</span></td></tr><tr><th id=\"L352\"><a href=\"#L352\">352</a></th><td>\u00a0 \u00a0 name <span class=\"o\">=</span>\u00a0<span class=\"s\">'&lt;stdio (log)&gt;'</span></td></tr><tr><th id=\"L353\"><a href=\"#L353\">353</a></th><td></td></tr><tr><th id=\"L354\"><a href=\"#L354\">354</a></th><td>\u00a0 \u00a0 <span class=\"k\">def</span>\u00a0<span class=\"nf\">__init__</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span>\u00a0isError<span class=\"o\">=</span><span class=\"mi\">0</span><span class=\"p\">):</span></td></tr><tr><th id=\"L355\"><a href=\"#L355\">355</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"bp\">self</span><span class=\"o\">.</span>isError <span class=\"o\">=</span>\u00a0isError</td></tr><tr><th id=\"L356\"><a href=\"#L356\">356</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"bp\">self</span><span class=\"o\">.</span>buf <span class=\"o\">=</span>\u00a0<span class=\"s\">''</span></td></tr><tr><th id=\"L357\"><a href=\"#L357\">357</a></th><td></td></tr><tr><th id=\"L358\"><a href=\"#L358\">358</a></th><td>\u00a0 \u00a0 <span class=\"k\">def</span>\u00a0<span class=\"nf\">close</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">):</span></td></tr><tr><th id=\"L359\"><a href=\"#L359\">359</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">pass</span></td></tr><tr><th id=\"L360\"><a href=\"#L360\">360</a></th><td></td></tr><tr><th id=\"L361\"><a href=\"#L361\">361</a></th><td>\u00a0 \u00a0 <span class=\"k\">def</span>\u00a0<span class=\"nf\">fileno</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">):</span></td></tr><tr><th id=\"L362\"><a href=\"#L362\">362</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">return</span>\u00a0<span class=\"o\">-</span><span class=\"mi\">1</span></td></tr><tr><th id=\"L363\"><a href=\"#L363\">363</a></th><td></td></tr><tr><th id=\"L364\"><a href=\"#L364\">364</a></th><td>\u00a0 \u00a0 <span class=\"k\">def</span>\u00a0<span class=\"nf\">flush</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">):</span></td></tr><tr><th id=\"L365\"><a href=\"#L365\">365</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">pass</span></td></tr><tr><th id=\"L366\"><a href=\"#L366\">366</a></th><td></td></tr><tr><th id=\"L367\"><a href=\"#L367\">367</a></th><td>\u00a0 \u00a0 <span class=\"k\">def</span>\u00a0<span class=\"nf\">read</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">):</span></td></tr><tr><th id=\"L368\"><a href=\"#L368\">368</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">raise</span>\u00a0<span class=\"ne\">IOError</span><span class=\"p\">(</span><span class=\"s\">\"can't read from the log!\"</span><span class=\"p\">)</span></td></tr><tr><th id=\"L369\"><a href=\"#L369\">369</a></th><td></td></tr><tr><th id=\"L370\"><a href=\"#L370\">370</a></th><td>\u00a0 \u00a0 readline <span class=\"o\">=</span>\u00a0read</td></tr><tr><th id=\"L371\"><a href=\"#L371\">371</a></th><td>\u00a0 \u00a0 readlines <span class=\"o\">=</span>\u00a0read</td></tr><tr><th id=\"L372\"><a href=\"#L372\">372</a></th><td>\u00a0 \u00a0 seek <span class=\"o\">=</span>\u00a0read</td></tr><tr><th id=\"L373\"><a href=\"#L373\">373</a></th><td>\u00a0 \u00a0 tell <span class=\"o\">=</span>\u00a0read</td></tr><tr><th id=\"L374\"><a href=\"#L374\">374</a></th><td></td></tr><tr><th id=\"L375\"><a href=\"#L375\">375</a></th><td>\u00a0 \u00a0 <span class=\"k\">def</span>\u00a0<span class=\"nf\">write</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span>\u00a0data<span class=\"p\">):</span></td></tr><tr><th id=\"L376\"><a href=\"#L376\">376</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 d <span class=\"o\">=</span>\u00a0<span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span>buf <span class=\"o\">+</span>\u00a0data<span class=\"p\">)</span><span class=\"o\">.</span>split<span class=\"p\">(</span><span class=\"s\">'</span><span class=\"se\">\\n</span><span class=\"s\">'</span><span class=\"p\">)</span></td></tr><tr><th id=\"L377\"><a href=\"#L377\">377</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"bp\">self</span><span class=\"o\">.</span>buf <span class=\"o\">=</span>\u00a0d<span class=\"p\">[</span><span class=\"o\">-</span><span class=\"mi\">1</span><span class=\"p\">]</span></td></tr><tr><th id=\"L378\"><a href=\"#L378\">378</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 messages <span class=\"o\">=</span>\u00a0d<span class=\"p\">[</span><span class=\"mi\">0</span><span class=\"p\">:</span><span class=\"o\">-</span><span class=\"mi\">1</span><span class=\"p\">]</span></td></tr><tr><th id=\"L379\"><a href=\"#L379\">379</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">for</span>\u00a0message <span class=\"ow\">in</span>\u00a0messages<span class=\"p\">:</span></td></tr><tr><th id=\"L380\"><a href=\"#L380\">380</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 msg<span class=\"p\">(</span>message<span class=\"p\">,</span>\u00a0printed<span class=\"o\">=</span><span class=\"mi\">1</span><span class=\"p\">,</span>\u00a0isError<span class=\"o\">=</span><span class=\"bp\">self</span><span class=\"o\">.</span>isError<span class=\"p\">)</span></td></tr><tr><th id=\"L381\"><a href=\"#L381\">381</a></th><td></td></tr><tr><th id=\"L382\"><a href=\"#L382\">382</a></th><td>\u00a0 \u00a0 <span class=\"k\">def</span>\u00a0<span class=\"nf\">writelines</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span>\u00a0lines<span class=\"p\">):</span></td></tr><tr><th id=\"L383\"><a href=\"#L383\">383</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">for</span>\u00a0line <span class=\"ow\">in</span>\u00a0lines<span class=\"p\">:</span></td></tr><tr><th id=\"L384\"><a href=\"#L384\">384</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 msg<span class=\"p\">(</span>line<span class=\"p\">,</span>\u00a0printed<span class=\"o\">=</span><span class=\"mi\">1</span><span class=\"p\">,</span>\u00a0isError<span class=\"o\">=</span><span class=\"bp\">self</span><span class=\"o\">.</span>isError<span class=\"p\">)</span></td></tr><tr><th id=\"L385\"><a href=\"#L385\">385</a></th><td></td></tr><tr><th id=\"L386\"><a href=\"#L386\">386</a></th><td></td></tr><tr><th id=\"L387\"><a href=\"#L387\">387</a></th><td><span class=\"k\">try</span><span class=\"p\">:</span></td></tr><tr><th id=\"L388\"><a href=\"#L388\">388</a></th><td>\u00a0 \u00a0 _oldshowwarning</td></tr><tr><th id=\"L389\"><a href=\"#L389\">389</a></th><td><span class=\"k\">except</span>\u00a0<span class=\"ne\">NameError</span><span class=\"p\">:</span></td></tr><tr><th id=\"L390\"><a href=\"#L390\">390</a></th><td>\u00a0 \u00a0 _oldshowwarning <span class=\"o\">=</span>\u00a0<span class=\"bp\">None</span></td></tr><tr><th id=\"L391\"><a href=\"#L391\">391</a></th><td></td></tr><tr><th id=\"L392\"><a href=\"#L392\">392</a></th><td></td></tr><tr><th id=\"L393\"><a href=\"#L393\">393</a></th><td><span class=\"k\">def</span>\u00a0<span class=\"nf\">startLogging</span><span class=\"p\">(</span><span class=\"nb\">file</span><span class=\"p\">,</span>\u00a0<span class=\"o\">*</span>a<span class=\"p\">,</span>\u00a0<span class=\"o\">**</span>kw<span class=\"p\">):</span></td></tr><tr><th id=\"L394\"><a href=\"#L394\">394</a></th><td>\u00a0 \u00a0 <span class=\"sd\">\"\"\"Initialize logging to a specified file.</span></td></tr><tr><th id=\"L395\"><a href=\"#L395\">395</a></th><td><span class=\"sd\">\u00a0 \u00a0 \"\"\"</span></td></tr><tr><th id=\"L396\"><a href=\"#L396\">396</a></th><td>\u00a0 \u00a0 flo <span class=\"o\">=</span>\u00a0FileLogObserver<span class=\"p\">(</span><span class=\"nb\">file</span><span class=\"p\">)</span></td></tr><tr><th id=\"L397\"><a href=\"#L397\">397</a></th><td>\u00a0 \u00a0 startLoggingWithObserver<span class=\"p\">(</span>flo<span class=\"o\">.</span>emit<span class=\"p\">,</span>\u00a0<span class=\"o\">*</span>a<span class=\"p\">,</span>\u00a0<span class=\"o\">**</span>kw<span class=\"p\">)</span></td></tr><tr><th id=\"L398\"><a href=\"#L398\">398</a></th><td></td></tr><tr><th id=\"L399\"><a href=\"#L399\">399</a></th><td><span class=\"k\">def</span>\u00a0<span class=\"nf\">startLoggingWithObserver</span><span class=\"p\">(</span>observer<span class=\"p\">,</span>\u00a0setStdout<span class=\"o\">=</span><span class=\"mi\">1</span><span class=\"p\">):</span></td></tr><tr><th id=\"L400\"><a href=\"#L400\">400</a></th><td>\u00a0 \u00a0 <span class=\"sd\">\"\"\"Initialize logging to a specified observer. If setStdout is true</span></td></tr><tr><th id=\"L401\"><a href=\"#L401\">401</a></th><td><span class=\"sd\">\u00a0 \u00a0 \u00a0 \u00a0(defaults to yes), also redirect sys.stdout and sys.stderr</span></td></tr><tr><th id=\"L402\"><a href=\"#L402\">402</a></th><td><span class=\"sd\">\u00a0 \u00a0 \u00a0 \u00a0to the specified file.</span></td></tr><tr><th id=\"L403\"><a href=\"#L403\">403</a></th><td><span class=\"sd\">\u00a0 \u00a0 \"\"\"</span></td></tr><tr><th id=\"L404\"><a href=\"#L404\">404</a></th><td>\u00a0 \u00a0 <span class=\"k\">global</span>\u00a0defaultObserver<span class=\"p\">,</span>\u00a0_oldshowwarning</td></tr><tr><th id=\"L405\"><a href=\"#L405\">405</a></th><td>\u00a0 \u00a0 <span class=\"k\">if</span>\u00a0<span class=\"ow\">not</span>\u00a0_oldshowwarning<span class=\"p\">:</span></td></tr><tr><th id=\"L406\"><a href=\"#L406\">406</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 _oldshowwarning <span class=\"o\">=</span>\u00a0warnings<span class=\"o\">.</span>showwarning</td></tr><tr><th id=\"L407\"><a href=\"#L407\">407</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 warnings<span class=\"o\">.</span>showwarning <span class=\"o\">=</span>\u00a0showwarning</td></tr><tr><th id=\"L408\"><a href=\"#L408\">408</a></th><td>\u00a0 \u00a0 <span class=\"k\">if</span>\u00a0defaultObserver<span class=\"p\">:</span></td></tr><tr><th id=\"L409\"><a href=\"#L409\">409</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 defaultObserver<span class=\"o\">.</span>stop<span class=\"p\">()</span></td></tr><tr><th id=\"L410\"><a href=\"#L410\">410</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 defaultObserver <span class=\"o\">=</span>\u00a0<span class=\"bp\">None</span></td></tr><tr><th id=\"L411\"><a href=\"#L411\">411</a></th><td>\u00a0 \u00a0 addObserver<span class=\"p\">(</span>observer<span class=\"p\">)</span></td></tr><tr><th id=\"L412\"><a href=\"#L412\">412</a></th><td>\u00a0 \u00a0 msg<span class=\"p\">(</span><span class=\"s\">\"Log opened.\"</span><span class=\"p\">)</span></td></tr><tr><th id=\"L413\"><a href=\"#L413\">413</a></th><td>\u00a0 \u00a0 <span class=\"k\">if</span>\u00a0setStdout<span class=\"p\">:</span></td></tr><tr><th id=\"L414\"><a href=\"#L414\">414</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 sys<span class=\"o\">.</span>stdout <span class=\"o\">=</span>\u00a0logfile</td></tr><tr><th id=\"L415\"><a href=\"#L415\">415</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 sys<span class=\"o\">.</span>stderr <span class=\"o\">=</span>\u00a0logerr</td></tr><tr><th id=\"L416\"><a href=\"#L416\">416</a></th><td></td></tr><tr><th id=\"L417\"><a href=\"#L417\">417</a></th><td></td></tr><tr><th id=\"L418\"><a href=\"#L418\">418</a></th><td><span class=\"k\">class</span>\u00a0<span class=\"nc\">NullFile</span><span class=\"p\">:</span></td></tr><tr><th id=\"L419\"><a href=\"#L419\">419</a></th><td>\u00a0 \u00a0 softspace <span class=\"o\">=</span>\u00a0<span class=\"mi\">0</span></td></tr><tr><th id=\"L420\"><a href=\"#L420\">420</a></th><td>\u00a0 \u00a0 <span class=\"k\">def</span>\u00a0<span class=\"nf\">read</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">):</span>\u00a0<span class=\"k\">pass</span></td></tr><tr><th id=\"L421\"><a href=\"#L421\">421</a></th><td>\u00a0 \u00a0 <span class=\"k\">def</span>\u00a0<span class=\"nf\">write</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span>\u00a0<span class=\"nb\">bytes</span><span class=\"p\">):</span>\u00a0<span class=\"k\">pass</span></td></tr><tr><th id=\"L422\"><a href=\"#L422\">422</a></th><td>\u00a0 \u00a0 <span class=\"k\">def</span>\u00a0<span class=\"nf\">flush</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">):</span>\u00a0<span class=\"k\">pass</span></td></tr><tr><th id=\"L423\"><a href=\"#L423\">423</a></th><td>\u00a0 \u00a0 <span class=\"k\">def</span>\u00a0<span class=\"nf\">close</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">):</span>\u00a0<span class=\"k\">pass</span></td></tr><tr><th id=\"L424\"><a href=\"#L424\">424</a></th><td></td></tr><tr><th id=\"L425\"><a href=\"#L425\">425</a></th><td></td></tr><tr><th id=\"L426\"><a href=\"#L426\">426</a></th><td><span class=\"k\">def</span>\u00a0<span class=\"nf\">discardLogs</span><span class=\"p\">():</span></td></tr><tr><th id=\"L427\"><a href=\"#L427\">427</a></th><td>\u00a0 \u00a0 <span class=\"sd\">\"\"\"Throw away all logs.</span></td></tr><tr><th id=\"L428\"><a href=\"#L428\">428</a></th><td><span class=\"sd\">\u00a0 \u00a0 \"\"\"</span></td></tr><tr><th id=\"L429\"><a href=\"#L429\">429</a></th><td>\u00a0 \u00a0 <span class=\"k\">global</span>\u00a0logfile</td></tr><tr><th id=\"L430\"><a href=\"#L430\">430</a></th><td>\u00a0 \u00a0 logfile <span class=\"o\">=</span>\u00a0NullFile<span class=\"p\">()</span></td></tr><tr><th id=\"L431\"><a href=\"#L431\">431</a></th><td></td></tr><tr><th id=\"L432\"><a href=\"#L432\">432</a></th><td></td></tr><tr><th id=\"L433\"><a href=\"#L433\">433</a></th><td><span class=\"c\"># Prevent logfile from being erased on reload.\u00a0 This only works in cpython.</span></td></tr><tr><th id=\"L434\"><a href=\"#L434\">434</a></th><td><span class=\"k\">try</span><span class=\"p\">:</span></td></tr><tr><th id=\"L435\"><a href=\"#L435\">435</a></th><td>\u00a0 \u00a0 logfile</td></tr><tr><th id=\"L436\"><a href=\"#L436\">436</a></th><td><span class=\"k\">except</span>\u00a0<span class=\"ne\">NameError</span><span class=\"p\">:</span></td></tr><tr><th id=\"L437\"><a href=\"#L437\">437</a></th><td>\u00a0 \u00a0 logfile <span class=\"o\">=</span>\u00a0StdioOnnaStick<span class=\"p\">(</span><span class=\"mi\">0</span><span class=\"p\">)</span></td></tr><tr><th id=\"L438\"><a href=\"#L438\">438</a></th><td>\u00a0 \u00a0 logerr <span class=\"o\">=</span>\u00a0StdioOnnaStick<span class=\"p\">(</span><span class=\"mi\">1</span><span class=\"p\">)</span></td></tr><tr><th id=\"L439\"><a href=\"#L439\">439</a></th><td></td></tr><tr><th id=\"L440\"><a href=\"#L440\">440</a></th><td></td></tr><tr><th id=\"L441\"><a href=\"#L441\">441</a></th><td><span class=\"k\">class</span>\u00a0<span class=\"nc\">DefaultObserver</span><span class=\"p\">:</span></td></tr><tr><th id=\"L442\"><a href=\"#L442\">442</a></th><td>\u00a0 \u00a0 <span class=\"sd\">\"\"\"Default observer.</span></td></tr><tr><th id=\"L443\"><a href=\"#L443\">443</a></th><td><span class=\"sd\"></span></td></tr><tr><th id=\"L444\"><a href=\"#L444\">444</a></th><td><span class=\"sd\">\u00a0 \u00a0 Will ignore all non-error messages and send error messages to sys.stderr.</span></td></tr><tr><th id=\"L445\"><a href=\"#L445\">445</a></th><td><span class=\"sd\">\u00a0 \u00a0 Will be removed when startLogging() is called for the first time.</span></td></tr><tr><th id=\"L446\"><a href=\"#L446\">446</a></th><td><span class=\"sd\">\u00a0 \u00a0 \"\"\"</span></td></tr><tr><th id=\"L447\"><a href=\"#L447\">447</a></th><td></td></tr><tr><th id=\"L448\"><a href=\"#L448\">448</a></th><td>\u00a0 \u00a0 <span class=\"k\">def</span>\u00a0<span class=\"nf\">_emit</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span>\u00a0eventDict<span class=\"p\">):</span></td></tr><tr><th id=\"L449\"><a href=\"#L449\">449</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">if</span>\u00a0eventDict<span class=\"p\">[</span><span class=\"s\">\"isError\"</span><span class=\"p\">]:</span></td></tr><tr><th id=\"L450\"><a href=\"#L450\">450</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">if</span>\u00a0eventDict<span class=\"o\">.</span>has_key<span class=\"p\">(</span><span class=\"s\">'failure'</span><span class=\"p\">):</span></td></tr><tr><th id=\"L451\"><a href=\"#L451\">451</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 text <span class=\"o\">=</span>\u00a0eventDict<span class=\"p\">[</span><span class=\"s\">'failure'</span><span class=\"p\">]</span><span class=\"o\">.</span>getTraceback<span class=\"p\">()</span></td></tr><tr><th id=\"L452\"><a href=\"#L452\">452</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">else</span><span class=\"p\">:</span></td></tr><tr><th id=\"L453\"><a href=\"#L453\">453</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 text <span class=\"o\">=</span>\u00a0<span class=\"s\">\" \"</span><span class=\"o\">.</span>join<span class=\"p\">([</span><span class=\"nb\">str</span><span class=\"p\">(</span>m<span class=\"p\">)</span>\u00a0<span class=\"k\">for</span>\u00a0m <span class=\"ow\">in</span>\u00a0eventDict<span class=\"p\">[</span><span class=\"s\">\"message\"</span><span class=\"p\">]])</span>\u00a0<span class=\"o\">+</span>\u00a0<span class=\"s\">\"</span><span class=\"se\">\\n</span><span class=\"s\">\"</span></td></tr><tr><th id=\"L454\"><a href=\"#L454\">454</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 sys<span class=\"o\">.</span>stderr<span class=\"o\">.</span>write<span class=\"p\">(</span>text<span class=\"p\">)</span></td></tr><tr><th id=\"L455\"><a href=\"#L455\">455</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 sys<span class=\"o\">.</span>stderr<span class=\"o\">.</span>flush<span class=\"p\">()</span></td></tr><tr><th id=\"L456\"><a href=\"#L456\">456</a></th><td></td></tr><tr><th id=\"L457\"><a href=\"#L457\">457</a></th><td>\u00a0 \u00a0 <span class=\"k\">def</span>\u00a0<span class=\"nf\">start</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">):</span></td></tr><tr><th id=\"L458\"><a href=\"#L458\">458</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 addObserver<span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span>_emit<span class=\"p\">)</span></td></tr><tr><th id=\"L459\"><a href=\"#L459\">459</a></th><td></td></tr><tr><th id=\"L460\"><a href=\"#L460\">460</a></th><td>\u00a0 \u00a0 <span class=\"k\">def</span>\u00a0<span class=\"nf\">stop</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">):</span></td></tr><tr><th id=\"L461\"><a href=\"#L461\">461</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 removeObserver<span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span>_emit<span class=\"p\">)</span></td></tr><tr><th id=\"L462\"><a href=\"#L462\">462</a></th><td></td></tr><tr><th id=\"L463\"><a href=\"#L463\">463</a></th><td></td></tr><tr><th id=\"L464\"><a href=\"#L464\">464</a></th><td><span class=\"c\"># Some more sibling imports, at the bottom and unqualified to avoid</span></td></tr><tr><th id=\"L465\"><a href=\"#L465\">465</a></th><td><span class=\"c\"># unresolvable circularity</span></td></tr><tr><th id=\"L466\"><a href=\"#L466\">466</a></th><td><span class=\"kn\">import</span>\u00a0<span class=\"nn\">threadable</span><span class=\"o\">,</span>\u00a0<span class=\"nn\">failure</span></td></tr><tr><th id=\"L467\"><a href=\"#L467\">467</a></th><td>threadable<span class=\"o\">.</span>synchronize<span class=\"p\">(</span>LogPublisher<span class=\"p\">)</span></td></tr><tr><th id=\"L468\"><a href=\"#L468\">468</a></th><td></td></tr><tr><th id=\"L469\"><a href=\"#L469\">469</a></th><td></td></tr><tr><th id=\"L470\"><a href=\"#L470\">470</a></th><td><span class=\"k\">try</span><span class=\"p\">:</span></td></tr><tr><th id=\"L471\"><a href=\"#L471\">471</a></th><td>\u00a0 \u00a0 defaultObserver</td></tr><tr><th id=\"L472\"><a href=\"#L472\">472</a></th><td><span class=\"k\">except</span>\u00a0<span class=\"ne\">NameError</span><span class=\"p\">:</span></td></tr><tr><th id=\"L473\"><a href=\"#L473\">473</a></th><td>\u00a0 \u00a0 defaultObserver <span class=\"o\">=</span>\u00a0DefaultObserver<span class=\"p\">()</span></td></tr><tr><th id=\"L474\"><a href=\"#L474\">474</a></th><td>\u00a0 \u00a0 defaultObserver<span class=\"o\">.</span>start<span class=\"p\">()</span></td></tr><tr><th id=\"L475\"><a href=\"#L475\">475</a></th><td></td></tr></tbody></table>\n\n      </div>\n      <div id=\"anydiff\">\n        <form action=\"/LUCICodeRepository/nomaticIM/diff\" method=\"get\">\n          <div class=\"buttons\">\n            <input type=\"hidden\" name=\"new_path\" value=\"/nomatic/tags/NomaticIM-0.0.5/buddy_bots/src/twisted/python/log.py\" />\n            <input type=\"hidden\" name=\"old_path\" value=\"/nomatic/tags/NomaticIM-0.0.5/buddy_bots/src/twisted/python/log.py\" />\n            <input type=\"hidden\" name=\"new_rev\" />\n            <input type=\"hidden\" name=\"old_rev\" />\n            <input type=\"submit\" value=\"View changes...\" title=\"Select paths and revs for Diff\" />\n          </div>\n        </form>\n      </div>\n      <div id=\"help\"><strong>Note:</strong> See <a href=\"/LUCICodeRepository/nomaticIM/wiki/TracBrowser\">TracBrowser</a>\n        for help on using the repository browser.</div>\n    </div>\n    <div id=\"altlinks\">\n      <h3>Download in other formats:</h3>\n      <ul>\n        <li class=\"first\">\n          <a rel=\"nofollow\" href=\"/LUCICodeRepository/nomaticIM/browser/nomatic/tags/NomaticIM-0.0.5/buddy_bots/src/twisted/python/log.py?format=txt\">Plain Text</a>\n        </li><li class=\"last\">\n          <a rel=\"nofollow\" href=\"/LUCICodeRepository/nomaticIM/export/1312/nomatic/tags/NomaticIM-0.0.5/buddy_bots/src/twisted/python/log.py\">Original Format</a>\n        </li>\n      </ul>\n    </div>\n    </div>\n    <div id=\"footer\" lang=\"en\" xml:lang=\"en\"><hr />\n      <a id=\"tracpowered\" href=\"http://trac.edgewall.org/\"><img src=\"/LUCICodeRepository/nomaticIM/chrome/common/trac_logo_mini.png\" height=\"30\" width=\"107\" alt=\"Trac Powered\" /></a>\n      <p class=\"left\">Powered by <a href=\"/LUCICodeRepository/nomaticIM/about\"><strong>Trac 1.0.1</strong></a><br />\n        By <a href=\"http://www.edgewall.org/\">Edgewall Software</a>.</p>\n      <p class=\"right\">All content copyright 2007-2008 by LUCI <br /><a href=\"http://luci.ics.uci.edu/\">http://luci.ics.uci.edu/</a></p>\n    </div>\n\t\t<div id=\"sitefooter\">\n\t\t\t<script src=\"http://www.google-analytics.com/urchin.js\" type=\"text/javascript\">\n\t\t\t</script>\n\t\t\t<script type=\"text/javascript\">\n\t\t\t\t_uacct = \"UA-338915-2\";\n\t\t\t\turchinTracker();\n\t\t\t</script>\n\t\t</div>\n\t</body>\n</html>", "id": 44465.0}