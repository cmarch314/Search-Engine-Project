{"text": "Search LoginPreferencesHelp GuideAbout Trac WikiTimelineRoadmapBrowse SourceView TicketsSearch Context Navigation BlameRevision Log source nomatic tags NomaticIM 5 buddy bots src zope interface adapter py View diff against View revision Visit trunk Last change on this file was 712 checked in by cbaker 7 years ago First draft of nomatic buddy bots oscar bot is functional if you give it good authentication credentials jabber bot is just an example from the web File size 19 7 KB Line 1 2 3 Copyright c 2 4 Zope Corporation and Contributors 4 All Rights Reserved 5 6 This software is subject to the provisions of the Zope Public License 7 Version 2 ZPL A copy of the ZPL should accompany this distribution 8 THIS SOFTWARE IS PROVIDED AS IS AND ANY AND ALL EXPRESS OR IMPLIED9 WARRANTIES ARE DISCLAIMED INCLUDING BUT NOT LIMITED TO THE IMPLIED1 WARRANTIES OF TITLE MERCHANTABILITY AGAINST INFRINGEMENT AND FITNESS11 FOR A PARTICULAR PURPOSE 12 13 14 Adapter management1516 Id adapter py 67796 2 6 5 1 13 55 44Z jim 17 1819import weakref2 from zope interface import providedBy Interface ro2122 marker object23class BaseAdapterRegistry object 2425 List of methods copied from lookup sub objects 26 delegated lookup queryMultiAdapter lookup1 queryAdapter 27 adapter hook lookupAll names 28 subscriptions subscribers 293 All registries maintain a generation that can be used by verifying31 registries32 generation 3334 def init self bases 3536 order required provided name value 37 where interfaces is really a nested key So for example 38 for order we have 39 provided name valie 4 but for order 2 we have 41 r1 r2 provided name valie 42 self adapters 4344 order required provided name value 45 where the remarks about adapters above apply46 self subscribers 4748 Set with a reference count keeping track of the interfaces49 for which we have provided components 5 self provided 5152 Looup object to perform lookup We make this a separate object to53 to make it easier in the furture to implement just the lookup54 functionality in C 55 self createLookup 5657 Cache invalidation data There are really 2 kinds of registries 58 59 Invalidating registries have caches that are invalidated6 when they or when base registies change An invalidating61 registry can only have invalidating registries as bases 6263 Verifying registies can t rely on getting invalidation message 64 so have to check the generations of base registries to determine65 if their cache data are current6667 Base registries 68 self bases bases69 7 def setBases self bases 71 self dict bases bases72 self ro ro ro self 73 self changed self 7475 bases property lambda self self dict bases 76 lambda self bases self setBases bases 77 7879 def createLookup self 8 self v lookup self LookupClass self 81 for name in self delegated 82 self dict name getattr self v lookup name 8384 def changed self originally changed 85 self generation 186 self v lookup changed originally changed 8788 def register self required provided name value 89 if value is None 9 self unregister required provided name value 91 return9293 required tuple map convert None to Interface required 94 name normalize name name 95 order len required 96 byorder self adapters97 while len byorder order 98 byorder append 99 components byorder order 1 key required provided 1 1 1 2 for k in key 1 3 d components get k 1 4 if d is None 1 5 d 1 6 components k d1 7 components d1 81 9 if components get name value 11 return111 112 components name value113114 n self provided get provided 1115 self provided provided n116 if n 1 117 self v lookup add extendor provided 118119 self changed self 12 121 def registered self required provided name u 122 required tuple map convert None to Interface required 123 name normalize name name 124 order len required 125 byorder self adapters126 if len byorder order 127 return None128129 components byorder order 13 key required provided 131 132 for k in key 133 d components get k 134 if d is None 135 return None136 components d137138 return components get name 139 14 def unregister self required provided name value None 141 required tuple map convert None to Interface required 142 order len required 143 byorder self adapters144 if order len byorder 145 return False146 components byorder order 147 key required provided 148 149 for k in key 15 d components get k 151 if d is None 152 return153 components d154155 old components get name 156 if old is None 157 return158 if value is not None and old value 159 return16 161 del components name 162 n self provided provided 1163 if n 164 del self provided provided 165 self v lookup remove extendor provided 166 else 167 self provided provided n168169 self changed self 17 171 return172173174 def subscribe self required provided value 175 required tuple map convert None to Interface required 176 name u 177 order len required 178 byorder self subscribers179 while len byorder order 18 byorder append 181 components byorder order 182 key required provided 183 184 for k in key 185 d components get k 186 if d is None 187 d 188 components k d189 components d19 191 components name components get name value 192193 if provided is not None 194 n self provided get provided 1195 self provided provided n196 if n 1 197 self v lookup add extendor provided 198199 self changed self 2 2 1 def unsubscribe self required provided value None 2 2 required tuple map convert None to Interface required 2 3 order len required 2 4 byorder self subscribers2 5 if order len byorder 2 6 return2 7 components byorder order 2 8 key required provided 2 9 21 for k in key 211 d components get k 212 if d is None 213 return214 components d215216 old components get u 217 if not old 218 return21922 if value is None 221 new 222 else 223 new tuple v for v in old if v value 224225 if new old 226 return227 228 components u new22923 if provided is not None 231 n self provided provided len new len old 232 if n 233 del self provided provided 234 self v lookup remove extendor provided 235236 self changed self 237238 XXX hack to fake out twisted s use of a private api We need to get them239 to use the new registed method 24 def get self 241 class XXXTwistedFakeOut 242 selfImplied 243 return XXXTwistedFakeOut244245246 not in mapping object 247class LookupBasePy object 248249 def init self 25 self cache 251 self mcache 252 self scache 253 254 def changed self ignored None 255 self cache clear 256 self mcache clear 257 self scache clear 258 259 def getcache self provided name 26 cache self cache get provided 261 if cache is None 262 cache 263 self cache provided cache264 if name 265 c cache get name 266 if c is None 267 c 268 cache name c269 cache c27 return cache271272 def lookup self required provided name u default None 273 cache self getcache provided name 274 if len required 1 275 result cache get required not in mapping 276 else 277 result cache get tuple required not in mapping 278279 if result is not in mapping 28 result self uncached lookup required provided name 281 if len required 1 282 cache required result283 else 284 cache tuple required result285286 if result is None 287 return default288289 return result29 291 def lookup1 self required provided name u default None 292 cache self getcache provided name 293 result cache get required not in mapping 294 if result is not in mapping 295 return self lookup required provided name default 296297 if result is None 298 return default2993 return result3 13 2 def queryAdapter self object provided name u default None 3 3 return self adapter hook provided object name default 3 43 5 def adapter hook self provided object name u default None 3 6 required providedBy object 3 7 cache self getcache provided name 3 8 factory cache get required not in mapping 3 9 if factory is not in mapping 31 factory self lookup required provided name 311312 if factory is not None 313 result factory object 314 if result is not None 315 return result316317 return default318319 def lookupAll self required provided 32 cache self mcache get provided 321 if cache is None 322 cache 323 self mcache provided cache324325 required tuple required 326 result cache get required not in mapping 327 if result is not in mapping 328 result self uncached lookupAll required provided 329 cache required result33 331 return result332333334 def subscriptions self required provided 335 cache self scache get provided 336 if cache is None 337 cache 338 self scache provided cache33934 required tuple required 341 result cache get required not in mapping 342 if result is not in mapping 343 result self uncached subscriptions required provided 344 cache required result345346 return result347 348LookupBase LookupBasePy34935 class VerifyingBasePy LookupBasePy 351352 def changed self originally changed 353 LookupBasePy changed self originally changed 354 self verify ro self registry ro 1 355 self verify generations r generation for r in self verify ro 356357 def verify self 358 if r generation for r in self verify ro 359 self verify generations 36 self changed None 361362 def getcache self provided name 363 self verify 364 return LookupBasePy getcache self provided name 365 366 def lookupAll self required provided 367 self verify 368 return LookupBasePy lookupAll self required provided 36937 def subscriptions self required provided 371 self verify 372 return LookupBasePy subscriptions self required provided 373374VerifyingBase VerifyingBasePy375376377try 378 import zope interface coptimizations379except ImportError 38 pass381else 382 from zope interface coptimizations import LookupBase VerifyingBase383384class AdapterLookupBase object 385386 def init self registry 387 self registry registry388 self required 389 self init extendors 39 super AdapterLookupBase self init 391392 def changed self ignored None 393 super AdapterLookupBase self changed None 394 for r in self required keys 395 r r 396 if r is not None 397 r unsubscribe self 398 self required clear 3994 4 1 Extendors4 2 4 34 4 When given an target interface for an adapter lookup we need to consider4 5 adapters for interfaces that extend the target interface This is4 6 what the extendors dictionary is about It tells us all of the4 7 interfaces that extend an interface for which there are adapters4 8 registered 4 941 We could separate this by order and name thus reducing the411 number of provided interfaces to search at run time The tradeoff 412 however is that we have to store more information For example 413 is the same interface is provided for multiple names and if the414 interface extends many interfaces we ll have to keep track of415 a fair bit of information for each name It s better to416 be space efficient here and be time efficient in the cache417 implementation 418419 TODO add invalidation when a provided interface changes in case42 the interface s iro has changed This is unlikely enough that421 we ll take our chances for now 422 423 def init extendors self 424 self extendors 425 for p in self registry provided 426 self add extendor p 427428 def add extendor self provided 429 extendors self extendors43 for i in provided iro 431 extendors extendors get i 432 extendors i 433 e for e in extendors if provided isOrExtends e 434 435 provided 436 437 e for e in extendors if not provided isOrExtends e 438 43944 def remove extendor self provided 441 extendors self extendors442 for i in provided iro 443 extendors i e for e in extendors get i 444 if e provided 445446447 def subscribe self required 448 refs self required449 for r in required 45 ref r weakref 451 if ref not in refs 452 r subscribe self 453 refs ref 1454455 def uncached lookup self required provided name u 456 result None457 order len required 458 for registry in self registry ro 459 byorder registry adapters46 if order len byorder 461 continue462463 extendors registry v lookup extendors get provided 464 if not extendors 465 continue466467 components byorder order 468 result lookup components required extendors name 469 order 47 if result is not None 471 break472473 self subscribe required 474475 return result476477 def queryMultiAdapter self objects provided name u default None 478 factory self lookup map providedBy objects provided name 479 if factory is None 48 return default481482 result factory objects 483 if result is None 484 return default485486 return result 487488 def uncached lookupAll self required provided 489 order len required 49 result 491 for registry in reversed self registry ro 492 byorder registry adapters493 if order len byorder 494 continue495 extendors registry v lookup extendors get provided 496 if not extendors 497 continue498 components byorder order 499 lookupAll components required extendors result order 5 5 1 self subscribe required 5 25 3 return tuple result iteritems 5 45 5 def names self required provided 5 6 return c for c in self lookupAll required provided 5 75 8 def uncached subscriptions self required provided 5 9 order len required 51 result 511 for registry in reversed self registry ro 512 byorder registry subscribers513 if order len byorder 514 continue515516 if provided is None 517 extendors provided 518 else 519 extendors registry v lookup extendors get provided 52 if extendors is None 521 continue522523 subscriptions byorder order required extendors u 524 result order 525526 self subscribe required 527528 return result52953 def subscribers self objects provided 531 subscriptions self subscriptions map providedBy objects provided 532 if provided is None 533 result 534 for subscription in subscriptions 535 subscription objects 536 else 537 result 538 for subscription in subscriptions 539 subscriber subscription objects 54 if subscriber is not None 541 result append subscriber 542 return result543544class AdapterLookup AdapterLookupBase LookupBase 545 pass546547class AdapterRegistry BaseAdapterRegistry 548549 LookupClass AdapterLookup55 551 def init self bases 552 AdapterRegisties are invalidating registries so553 we need to keep track of out invalidating subregistries 554 self v subregistries weakref WeakKeyDictionary 555556 super AdapterRegistry self init bases 557558 def addSubregistry self r 559 self v subregistries r 156 561 def removeSubregistry self r 562 if r in self v subregistries 563 del self v subregistries r 564565 def setBases self bases 566 old self dict get bases 567 for r in old 568 if r not in bases 569 r removeSubregistry self 57 for r in bases 571 if r not in old 572 r addSubregistry self 573574 super AdapterRegistry self setBases bases 575576 def changed self originally changed 577 super AdapterRegistry self changed originally changed 578579 for sub in self v subregistries keys 58 sub changed originally changed 581582583class VerifyingAdapterLookup AdapterLookupBase VerifyingBase 584 pass585586class VerifyingAdapterRegistry BaseAdapterRegistry 587588 LookupClass VerifyingAdapterLookup589 59 def convert None to Interface x 591 if x is None 592 return Interface593 else 594 return x595596def normalize name name 597 if isinstance name basestring 598 return unicode name 5996 raise TypeError name must be a regular or unicode string 6 16 2def lookup components specs provided name i l 6 3 if i l 6 4 for spec in specs i sro 6 5 comps components get spec 6 6 if comps 6 7 r lookup comps specs provided name i 1 l 6 8 if r is not None 6 9 return r61 else 611 for iface in provided 612 comps components get iface 613 if comps 614 r comps get name 615 if r is not None 616 return r617 618 return None61962 def lookupAll components specs provided result i l 621 if i l 622 for spec in reversed specs i sro 623 comps components get spec 624 if comps 625 lookupAll comps specs provided result i 1 l 626 else 627 for iface in reversed provided 628 comps components get iface 629 if comps 63 result update comps 631632def subscriptions components specs provided name result i l 633 if i l 634 for spec in reversed specs i sro 635 comps components get spec 636 if comps 637 subscriptions comps specs provided name result i 1 l 638 else 639 for iface in reversed provided 64 comps components get iface 641 if comps 642 comps comps get name 643 if comps 644 result extend comps Note See TracBrowser for help on using the repository browser Download in other formats Plain Text Original Format Powered by Trac 1 1 By Edgewall Software All content copyright 2 7 2 8 by LUCI http luci ics uci edu ", "_id": "http://djp3-pc2.ics.uci.edu/LUCICodeRepository/nomaticIM/browser/nomatic/tags/NomaticIM-0.0.5/buddy_bots/src/zope/interface/adapter.py", "title": "\n      adapter.py in nomatic/tags/nomaticim-0.0.5/buddy_bots/src/zope/interface\n     \u2013 nomatic*im\n    ", "html": "<!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Strict//EN\" \"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd\">\n<html xmlns=\"http://www.w3.org/1999/xhtml\">\n  \n  \n\n  \n\n\n  <head>\n\t\t<title>\n      adapter.py in nomatic/tags/NomaticIM-0.0.5/buddy_bots/src/zope/interface\n     \u2013 Nomatic*IM\n    </title><meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\" /><meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge\" /><link rel=\"search\" href=\"/LUCICodeRepository/nomaticIM/search\" /><link rel=\"help\" href=\"/LUCICodeRepository/nomaticIM/wiki/TracGuide\" /><link rel=\"alternate\" href=\"/LUCICodeRepository/nomaticIM/browser/nomatic/tags/NomaticIM-0.0.5/buddy_bots/src/zope/interface/adapter.py?format=txt\" type=\"text/plain\" title=\"Plain Text\" /><link rel=\"alternate\" href=\"/LUCICodeRepository/nomaticIM/export/1312/nomatic/tags/NomaticIM-0.0.5/buddy_bots/src/zope/interface/adapter.py\" type=\"application/x-python; charset=iso-8859-15\" title=\"Original Format\" /><link rel=\"start\" href=\"/LUCICodeRepository/nomaticIM/wiki\" /><link rel=\"stylesheet\" href=\"/LUCICodeRepository/nomaticIM/chrome/common/css/trac.css\" type=\"text/css\" /><link rel=\"stylesheet\" href=\"/LUCICodeRepository/nomaticIM/chrome/common/css/code.css\" type=\"text/css\" /><link rel=\"stylesheet\" href=\"/LUCICodeRepository/nomaticIM/pygments/trac.css\" type=\"text/css\" /><link rel=\"stylesheet\" href=\"/LUCICodeRepository/nomaticIM/chrome/common/css/browser.css\" type=\"text/css\" /><link rel=\"shortcut icon\" href=\"http://luci.ics.uci.edu/logo32by32.gif\" type=\"image/gif\" /><link rel=\"icon\" href=\"http://luci.ics.uci.edu/logo32by32.gif\" type=\"image/gif\" /><link type=\"application/opensearchdescription+xml\" rel=\"search\" href=\"/LUCICodeRepository/nomaticIM/search/opensearch\" title=\"Search Nomatic*IM\" /><script type=\"text/javascript\" charset=\"utf-8\" src=\"/LUCICodeRepository/nomaticIM/chrome/common/js/jquery.js\"></script><script type=\"text/javascript\" charset=\"utf-8\" src=\"/LUCICodeRepository/nomaticIM/chrome/common/js/babel.js\"></script><script type=\"text/javascript\" charset=\"utf-8\" src=\"/LUCICodeRepository/nomaticIM/chrome/common/js/messages/en_US.js\"></script><script type=\"text/javascript\" charset=\"utf-8\" src=\"/LUCICodeRepository/nomaticIM/chrome/common/js/trac.js\"></script><script type=\"text/javascript\" charset=\"utf-8\" src=\"/LUCICodeRepository/nomaticIM/chrome/common/js/search.js\"></script><script type=\"text/javascript\" src=\"/LUCICodeRepository/nomaticIM/chrome/common/js/folding.js\"></script><script type=\"text/javascript\">\n      jQuery(document).ready(function($) {\n        $(\".trac-toggledeleted\").show().click(function() {\n                  $(this).siblings().find(\".trac-deleted\").toggle();\n                  return false;\n        }).click();\n        $(\"#jumploc input\").hide();\n        $(\"#jumploc select\").change(function () {\n          this.parentNode.parentNode.submit();\n        });\n          $('#preview table.code').enableCollapsibleColumns($('#preview table.code thead th.content'));\n      });\n    </script>\n\t</head>\n  <body>\n    <div id=\"banner\">\n      <div id=\"header\">\n        <a id=\"logo\" href=\"http://luci.ics.uci.edu/#code\"><img src=\"http://luci.ics.uci.edu/blog/archives/LUCIhorzTight.jpg\" alt=\"LUCI Code Repository\" /></a>\n      </div>\n      <form id=\"search\" action=\"/LUCICodeRepository/nomaticIM/search\" method=\"get\">\n        <div>\n          <label for=\"proj-search\">Search:</label>\n          <input type=\"text\" id=\"proj-search\" name=\"q\" size=\"18\" value=\"\" />\n          <input type=\"submit\" value=\"Search\" />\n        </div>\n      </form>\n      <div id=\"metanav\" class=\"nav\">\n    <ul>\n      <li class=\"first\"><a href=\"/LUCICodeRepository/nomaticIM/login\">Login</a></li><li><a href=\"/LUCICodeRepository/nomaticIM/prefs\">Preferences</a></li><li><a href=\"/LUCICodeRepository/nomaticIM/wiki/TracGuide\">Help/Guide</a></li><li class=\"last\"><a href=\"/LUCICodeRepository/nomaticIM/about\">About Trac</a></li>\n    </ul>\n  </div>\n    </div>\n    <div id=\"mainnav\" class=\"nav\">\n    <ul>\n      <li class=\"first\"><a href=\"/LUCICodeRepository/nomaticIM/wiki\">Wiki</a></li><li><a href=\"/LUCICodeRepository/nomaticIM/timeline\">Timeline</a></li><li><a href=\"/LUCICodeRepository/nomaticIM/roadmap\">Roadmap</a></li><li class=\"active\"><a href=\"/LUCICodeRepository/nomaticIM/browser\">Browse Source</a></li><li><a href=\"/LUCICodeRepository/nomaticIM/report\">View Tickets</a></li><li class=\"last\"><a href=\"/LUCICodeRepository/nomaticIM/search\">Search</a></li>\n    </ul>\n  </div>\n    <div id=\"main\">\n      <div id=\"ctxtnav\" class=\"nav\">\n        <h2>Context Navigation</h2>\n        <ul>\n          <li class=\"first\"><a href=\"/LUCICodeRepository/nomaticIM/browser/nomatic/trunk/buddy_bots/zope/interface/adapter.py?annotate=blame\" title=\"Annotate each line with the last changed revision (this can be time consuming...)\">Blame</a></li><li class=\"last\"><a href=\"/LUCICodeRepository/nomaticIM/log/nomatic/tags/NomaticIM-0.0.5/buddy_bots/src/zope/interface/adapter.py\">Revision Log</a></li>\n        </ul>\n        <hr />\n      </div>\n    <div id=\"content\" class=\"browser\">\n        <h1>\n          \n<a class=\"pathentry first\" href=\"/LUCICodeRepository/nomaticIM/browser?order=name\" title=\"Go to repository root\">source:</a>\n<a class=\"pathentry\" href=\"/LUCICodeRepository/nomaticIM/browser/nomatic?order=name\" title=\"View nomatic\">nomatic</a><span class=\"pathentry sep\">/</span><a class=\"pathentry\" href=\"/LUCICodeRepository/nomaticIM/browser/nomatic/tags?order=name\" title=\"View tags\">tags</a><span class=\"pathentry sep\">/</span><a class=\"pathentry\" href=\"/LUCICodeRepository/nomaticIM/browser/nomatic/tags/NomaticIM-0.0.5?order=name\" title=\"View NomaticIM-0.0.5\">NomaticIM-0.0.5</a><span class=\"pathentry sep\">/</span><a class=\"pathentry\" href=\"/LUCICodeRepository/nomaticIM/browser/nomatic/tags/NomaticIM-0.0.5/buddy_bots?order=name\" title=\"View buddy_bots\">buddy_bots</a><span class=\"pathentry sep\">/</span><a class=\"pathentry\" href=\"/LUCICodeRepository/nomaticIM/browser/nomatic/tags/NomaticIM-0.0.5/buddy_bots/src?order=name\" title=\"View src\">src</a><span class=\"pathentry sep\">/</span><a class=\"pathentry\" href=\"/LUCICodeRepository/nomaticIM/browser/nomatic/tags/NomaticIM-0.0.5/buddy_bots/src/zope?order=name\" title=\"View zope\">zope</a><span class=\"pathentry sep\">/</span><a class=\"pathentry\" href=\"/LUCICodeRepository/nomaticIM/browser/nomatic/tags/NomaticIM-0.0.5/buddy_bots/src/zope/interface?order=name\" title=\"View interface\">interface</a><span class=\"pathentry sep\">/</span><a class=\"pathentry\" href=\"/LUCICodeRepository/nomaticIM/browser/nomatic/tags/NomaticIM-0.0.5/buddy_bots/src/zope/interface/adapter.py?order=name\" title=\"View adapter.py\">adapter.py</a>\n<br style=\"clear: both\" />\n\n        </h1>\n        <div id=\"diffrev\">\n          <form action=\"/LUCICodeRepository/nomaticIM/changeset\" method=\"get\">\n            <div>\n              <label title=\"Show the diff against a specific revision\">\n                View diff against: <input type=\"text\" name=\"old\" size=\"6\" />\n                <input type=\"hidden\" name=\"old_path\" value=\"nomatic/tags/NomaticIM-0.0.5/buddy_bots/src/zope/interface/adapter.py\" />\n                <input type=\"hidden\" name=\"new\" />\n                <input type=\"hidden\" name=\"new_path\" value=\"nomatic/tags/NomaticIM-0.0.5/buddy_bots/src/zope/interface/adapter.py\" />\n              </label>\n            </div>\n          </form>\n        </div>\n        <div id=\"jumprev\">\n          <form action=\"\" method=\"get\">\n            <div>\n              <label for=\"rev\">\n                View revision:</label>\n              <input type=\"text\" id=\"rev\" name=\"rev\" size=\"6\" />\n            </div>\n          </form>\n        </div>\n        <div id=\"jumploc\">\n          <form action=\"\" method=\"get\">\n            <div class=\"buttons\">\n              <label for=\"preselected\">Visit:</label>\n              <select id=\"preselected\" name=\"preselected\">\n                <option selected=\"selected\"></option>\n                <optgroup label=\"branches\">\n                  <option value=\"/LUCICodeRepository/nomaticIM/browser/trunk\">trunk</option>\n                </optgroup>\n              </select>\n              <input type=\"submit\" value=\"Go!\" title=\"Jump to the chosen preselected path\" />\n            </div>\n          </form>\n        </div>\n        <div class=\"trac-tags\">\n        </div>\n      <table id=\"info\" summary=\"Revision info\">\n        <tr>\n          <th>\n                <a href=\"/LUCICodeRepository/nomaticIM/changeset/712/nomatic/trunk/buddy_bots/zope/interface/adapter.py\" title=\"View differences\">Last change</a>\n                  on this file was\n                  <a href=\"/LUCICodeRepository/nomaticIM/changeset/712/\" title=\"View changeset 712\">712</a>,\n                  checked in by cbaker, <a class=\"timeline\" href=\"/LUCICodeRepository/nomaticIM/timeline?from=2008-02-16T08%3A16%3A53-08%3A00&amp;precision=second\" title=\"See timeline at Feb 16, 2008, 8:16:53 AM\">7 years ago</a>\n          </th>\n        </tr>\n        <tr>\n          <td class=\"message searchable\">\n              <p>\nFirst draft of nomatic buddy bots. oscar_bot is functional if you give it good authentication credentials, jabber_bot is just an example from the web <br />\n</p>\n          </td>\n        </tr>\n        <tr><td colspan=\"2\">\n            <strong>File size:</strong>\n            <span title=\"20152 bytes\">19.7 KB</span>\n          </td></tr>\n      </table>\n      <div id=\"preview\" class=\"searchable\">\n        \n  <table class=\"code\"><thead><tr><th class=\"lineno\" title=\"Line numbers\">Line</th><th class=\"content\">\u00a0</th></tr></thead><tbody><tr><th id=\"L1\"><a href=\"#L1\">1</a></th><td><span class=\"c\">##############################################################################</span></td></tr><tr><th id=\"L2\"><a href=\"#L2\">2</a></th><td><span class=\"c\">#</span></td></tr><tr><th id=\"L3\"><a href=\"#L3\">3</a></th><td><span class=\"c\"># Copyright (c) 2004 Zope Corporation and Contributors.</span></td></tr><tr><th id=\"L4\"><a href=\"#L4\">4</a></th><td><span class=\"c\"># All Rights Reserved.</span></td></tr><tr><th id=\"L5\"><a href=\"#L5\">5</a></th><td><span class=\"c\">#</span></td></tr><tr><th id=\"L6\"><a href=\"#L6\">6</a></th><td><span class=\"c\"># This software is subject to the provisions of the Zope Public License,</span></td></tr><tr><th id=\"L7\"><a href=\"#L7\">7</a></th><td><span class=\"c\"># Version 2.0 (ZPL).\u00a0 A copy of the ZPL should accompany this distribution.</span></td></tr><tr><th id=\"L8\"><a href=\"#L8\">8</a></th><td><span class=\"c\"># THIS SOFTWARE IS PROVIDED \"AS IS\" AND ANY AND ALL EXPRESS OR IMPLIED</span></td></tr><tr><th id=\"L9\"><a href=\"#L9\">9</a></th><td><span class=\"c\"># WARRANTIES ARE DISCLAIMED, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED</span></td></tr><tr><th id=\"L10\"><a href=\"#L10\">10</a></th><td><span class=\"c\"># WARRANTIES OF TITLE, MERCHANTABILITY, AGAINST INFRINGEMENT, AND FITNESS</span></td></tr><tr><th id=\"L11\"><a href=\"#L11\">11</a></th><td><span class=\"c\"># FOR A PARTICULAR PURPOSE.</span></td></tr><tr><th id=\"L12\"><a href=\"#L12\">12</a></th><td><span class=\"c\">#</span></td></tr><tr><th id=\"L13\"><a href=\"#L13\">13</a></th><td><span class=\"c\">##############################################################################</span></td></tr><tr><th id=\"L14\"><a href=\"#L14\">14</a></th><td><span class=\"sd\">\"\"\"Adapter management</span></td></tr><tr><th id=\"L15\"><a href=\"#L15\">15</a></th><td><span class=\"sd\"></span></td></tr><tr><th id=\"L16\"><a href=\"#L16\">16</a></th><td><span class=\"sd\">$Id: adapter.py 67796 2006-05-01 13:55:44Z jim $</span></td></tr><tr><th id=\"L17\"><a href=\"#L17\">17</a></th><td><span class=\"sd\">\"\"\"</span></td></tr><tr><th id=\"L18\"><a href=\"#L18\">18</a></th><td></td></tr><tr><th id=\"L19\"><a href=\"#L19\">19</a></th><td><span class=\"kn\">import</span>\u00a0<span class=\"nn\">weakref</span></td></tr><tr><th id=\"L20\"><a href=\"#L20\">20</a></th><td><span class=\"kn\">from</span>\u00a0<span class=\"nn\">zope.interface</span>\u00a0<span class=\"kn\">import</span>\u00a0providedBy<span class=\"p\">,</span>\u00a0Interface<span class=\"p\">,</span>\u00a0ro</td></tr><tr><th id=\"L21\"><a href=\"#L21\">21</a></th><td></td></tr><tr><th id=\"L22\"><a href=\"#L22\">22</a></th><td>_marker <span class=\"o\">=</span>\u00a0<span class=\"nb\">object</span></td></tr><tr><th id=\"L23\"><a href=\"#L23\">23</a></th><td><span class=\"k\">class</span>\u00a0<span class=\"nc\">BaseAdapterRegistry</span><span class=\"p\">(</span><span class=\"nb\">object</span><span class=\"p\">):</span></td></tr><tr><th id=\"L24\"><a href=\"#L24\">24</a></th><td></td></tr><tr><th id=\"L25\"><a href=\"#L25\">25</a></th><td>\u00a0 \u00a0 <span class=\"c\"># List of methods copied from lookup sub-objects:</span></td></tr><tr><th id=\"L26\"><a href=\"#L26\">26</a></th><td>\u00a0 \u00a0 _delegated <span class=\"o\">=</span>\u00a0<span class=\"p\">(</span><span class=\"s\">'lookup'</span><span class=\"p\">,</span>\u00a0<span class=\"s\">'queryMultiAdapter'</span><span class=\"p\">,</span>\u00a0<span class=\"s\">'lookup1'</span><span class=\"p\">,</span>\u00a0<span class=\"s\">'queryAdapter'</span><span class=\"p\">,</span></td></tr><tr><th id=\"L27\"><a href=\"#L27\">27</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"s\">'adapter_hook'</span><span class=\"p\">,</span>\u00a0<span class=\"s\">'lookupAll'</span><span class=\"p\">,</span>\u00a0<span class=\"s\">'names'</span><span class=\"p\">,</span></td></tr><tr><th id=\"L28\"><a href=\"#L28\">28</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"s\">'subscriptions'</span><span class=\"p\">,</span>\u00a0<span class=\"s\">'subscribers'</span><span class=\"p\">)</span></td></tr><tr><th id=\"L29\"><a href=\"#L29\">29</a></th><td></td></tr><tr><th id=\"L30\"><a href=\"#L30\">30</a></th><td>\u00a0 \u00a0 <span class=\"c\"># All registries maintain a generation that can be used by verifying</span></td></tr><tr><th id=\"L31\"><a href=\"#L31\">31</a></th><td>\u00a0 \u00a0 <span class=\"c\"># registries</span></td></tr><tr><th id=\"L32\"><a href=\"#L32\">32</a></th><td>\u00a0 \u00a0 _generation <span class=\"o\">=</span>\u00a0<span class=\"mi\">0</span></td></tr><tr><th id=\"L33\"><a href=\"#L33\">33</a></th><td></td></tr><tr><th id=\"L34\"><a href=\"#L34\">34</a></th><td>\u00a0 \u00a0 <span class=\"k\">def</span>\u00a0<span class=\"nf\">__init__</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span>\u00a0bases<span class=\"o\">=</span><span class=\"p\">()):</span></td></tr><tr><th id=\"L35\"><a href=\"#L35\">35</a></th><td></td></tr><tr><th id=\"L36\"><a href=\"#L36\">36</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"c\"># {order -&gt; {required -&gt; {provided -&gt; {name -&gt; value}}}}</span></td></tr><tr><th id=\"L37\"><a href=\"#L37\">37</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"c\"># where \"interfaces\" is really a nested key.\u00a0 So, for example:</span></td></tr><tr><th id=\"L38\"><a href=\"#L38\">38</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"c\"># for order == 0, we have:</span></td></tr><tr><th id=\"L39\"><a href=\"#L39\">39</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"c\">#\u00a0 \u00a0{provided -&gt; {name -&gt; valie}}</span></td></tr><tr><th id=\"L40\"><a href=\"#L40\">40</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"c\"># but for order == 2, we have:</span></td></tr><tr><th id=\"L41\"><a href=\"#L41\">41</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"c\">#\u00a0 \u00a0{r1 -&gt; {r2 -&gt; {provided -&gt; {name -&gt; valie}}}}</span></td></tr><tr><th id=\"L42\"><a href=\"#L42\">42</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"bp\">self</span><span class=\"o\">.</span>_adapters <span class=\"o\">=</span>\u00a0<span class=\"p\">[]</span></td></tr><tr><th id=\"L43\"><a href=\"#L43\">43</a></th><td></td></tr><tr><th id=\"L44\"><a href=\"#L44\">44</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"c\"># {order -&gt; {required -&gt; {provided -&gt; {name -&gt; [value]}}}}</span></td></tr><tr><th id=\"L45\"><a href=\"#L45\">45</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"c\"># where the remarks about adapters above apply</span></td></tr><tr><th id=\"L46\"><a href=\"#L46\">46</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"bp\">self</span><span class=\"o\">.</span>_subscribers <span class=\"o\">=</span>\u00a0<span class=\"p\">[]</span></td></tr><tr><th id=\"L47\"><a href=\"#L47\">47</a></th><td></td></tr><tr><th id=\"L48\"><a href=\"#L48\">48</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"c\"># Set, with a reference count, keeping track of the interfaces</span></td></tr><tr><th id=\"L49\"><a href=\"#L49\">49</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"c\"># for which we have provided components:</span></td></tr><tr><th id=\"L50\"><a href=\"#L50\">50</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"bp\">self</span><span class=\"o\">.</span>_provided <span class=\"o\">=</span>\u00a0<span class=\"p\">{}</span></td></tr><tr><th id=\"L51\"><a href=\"#L51\">51</a></th><td></td></tr><tr><th id=\"L52\"><a href=\"#L52\">52</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"c\"># Looup object to perform lookup.\u00a0 We make this a separate object to</span></td></tr><tr><th id=\"L53\"><a href=\"#L53\">53</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"c\"># to make it easier, in the furture, to implement just the lookup</span></td></tr><tr><th id=\"L54\"><a href=\"#L54\">54</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"c\"># functionality in C.</span></td></tr><tr><th id=\"L55\"><a href=\"#L55\">55</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"bp\">self</span><span class=\"o\">.</span>_createLookup<span class=\"p\">()</span></td></tr><tr><th id=\"L56\"><a href=\"#L56\">56</a></th><td></td></tr><tr><th id=\"L57\"><a href=\"#L57\">57</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"c\"># Cache invalidation data.\u00a0 There are really 2 kinds of registries:</span></td></tr><tr><th id=\"L58\"><a href=\"#L58\">58</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 </td></tr><tr><th id=\"L59\"><a href=\"#L59\">59</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"c\">#\u00a0 \u00a0Invalidating registries have caches that are invalidated</span></td></tr><tr><th id=\"L60\"><a href=\"#L60\">60</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"c\">#\u00a0 \u00a0 \u00a0when they or when base registies change.\u00a0 An invalidating</span></td></tr><tr><th id=\"L61\"><a href=\"#L61\">61</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"c\">#\u00a0 \u00a0 \u00a0registry can only have invalidating registries as bases.</span></td></tr><tr><th id=\"L62\"><a href=\"#L62\">62</a></th><td></td></tr><tr><th id=\"L63\"><a href=\"#L63\">63</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"c\">#\u00a0 \u00a0Verifying registies can't rely on getting invalidation message,</span></td></tr><tr><th id=\"L64\"><a href=\"#L64\">64</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"c\">#\u00a0 \u00a0 \u00a0so have to check the generations of base registries to determine</span></td></tr><tr><th id=\"L65\"><a href=\"#L65\">65</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"c\">#\u00a0 \u00a0 \u00a0if their cache data are current</span></td></tr><tr><th id=\"L66\"><a href=\"#L66\">66</a></th><td></td></tr><tr><th id=\"L67\"><a href=\"#L67\">67</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"c\"># Base registries:</span></td></tr><tr><th id=\"L68\"><a href=\"#L68\">68</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"bp\">self</span><span class=\"o\">.</span>__bases__ <span class=\"o\">=</span>\u00a0bases</td></tr><tr><th id=\"L69\"><a href=\"#L69\">69</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 </td></tr><tr><th id=\"L70\"><a href=\"#L70\">70</a></th><td>\u00a0 \u00a0 <span class=\"k\">def</span>\u00a0<span class=\"nf\">_setBases</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span>\u00a0bases<span class=\"p\">):</span></td></tr><tr><th id=\"L71\"><a href=\"#L71\">71</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"bp\">self</span><span class=\"o\">.</span>__dict__<span class=\"p\">[</span><span class=\"s\">'__bases__'</span><span class=\"p\">]</span>\u00a0<span class=\"o\">=</span>\u00a0bases</td></tr><tr><th id=\"L72\"><a href=\"#L72\">72</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"bp\">self</span><span class=\"o\">.</span>ro <span class=\"o\">=</span>\u00a0ro<span class=\"o\">.</span>ro<span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">)</span></td></tr><tr><th id=\"L73\"><a href=\"#L73\">73</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"bp\">self</span><span class=\"o\">.</span>changed<span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">)</span></td></tr><tr><th id=\"L74\"><a href=\"#L74\">74</a></th><td></td></tr><tr><th id=\"L75\"><a href=\"#L75\">75</a></th><td>\u00a0 \u00a0 __bases__ <span class=\"o\">=</span>\u00a0<span class=\"nb\">property</span><span class=\"p\">(</span><span class=\"k\">lambda</span>\u00a0<span class=\"bp\">self</span><span class=\"p\">:</span>\u00a0<span class=\"bp\">self</span><span class=\"o\">.</span>__dict__<span class=\"p\">[</span><span class=\"s\">'__bases__'</span><span class=\"p\">],</span></td></tr><tr><th id=\"L76\"><a href=\"#L76\">76</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0<span class=\"k\">lambda</span>\u00a0<span class=\"bp\">self</span><span class=\"p\">,</span>\u00a0bases<span class=\"p\">:</span>\u00a0<span class=\"bp\">self</span><span class=\"o\">.</span>_setBases<span class=\"p\">(</span>bases<span class=\"p\">),</span></td></tr><tr><th id=\"L77\"><a href=\"#L77\">77</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0<span class=\"p\">)</span></td></tr><tr><th id=\"L78\"><a href=\"#L78\">78</a></th><td></td></tr><tr><th id=\"L79\"><a href=\"#L79\">79</a></th><td>\u00a0 \u00a0 <span class=\"k\">def</span>\u00a0<span class=\"nf\">_createLookup</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">):</span></td></tr><tr><th id=\"L80\"><a href=\"#L80\">80</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"bp\">self</span><span class=\"o\">.</span>_v_lookup <span class=\"o\">=</span>\u00a0<span class=\"bp\">self</span><span class=\"o\">.</span>LookupClass<span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">)</span></td></tr><tr><th id=\"L81\"><a href=\"#L81\">81</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">for</span>\u00a0name <span class=\"ow\">in</span>\u00a0<span class=\"bp\">self</span><span class=\"o\">.</span>_delegated<span class=\"p\">:</span></td></tr><tr><th id=\"L82\"><a href=\"#L82\">82</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"bp\">self</span><span class=\"o\">.</span>__dict__<span class=\"p\">[</span>name<span class=\"p\">]</span>\u00a0<span class=\"o\">=</span>\u00a0<span class=\"nb\">getattr</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span>_v_lookup<span class=\"p\">,</span>\u00a0name<span class=\"p\">)</span></td></tr><tr><th id=\"L83\"><a href=\"#L83\">83</a></th><td></td></tr><tr><th id=\"L84\"><a href=\"#L84\">84</a></th><td>\u00a0 \u00a0 <span class=\"k\">def</span>\u00a0<span class=\"nf\">changed</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span>\u00a0originally_changed<span class=\"p\">):</span></td></tr><tr><th id=\"L85\"><a href=\"#L85\">85</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"bp\">self</span><span class=\"o\">.</span>_generation <span class=\"o\">+=</span>\u00a0<span class=\"mi\">1</span></td></tr><tr><th id=\"L86\"><a href=\"#L86\">86</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"bp\">self</span><span class=\"o\">.</span>_v_lookup<span class=\"o\">.</span>changed<span class=\"p\">(</span>originally_changed<span class=\"p\">)</span></td></tr><tr><th id=\"L87\"><a href=\"#L87\">87</a></th><td></td></tr><tr><th id=\"L88\"><a href=\"#L88\">88</a></th><td>\u00a0 \u00a0 <span class=\"k\">def</span>\u00a0<span class=\"nf\">register</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span>\u00a0required<span class=\"p\">,</span>\u00a0provided<span class=\"p\">,</span>\u00a0name<span class=\"p\">,</span>\u00a0value<span class=\"p\">):</span></td></tr><tr><th id=\"L89\"><a href=\"#L89\">89</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">if</span>\u00a0value <span class=\"ow\">is</span>\u00a0<span class=\"bp\">None</span><span class=\"p\">:</span></td></tr><tr><th id=\"L90\"><a href=\"#L90\">90</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"bp\">self</span><span class=\"o\">.</span>unregister<span class=\"p\">(</span>required<span class=\"p\">,</span>\u00a0provided<span class=\"p\">,</span>\u00a0name<span class=\"p\">,</span>\u00a0value<span class=\"p\">)</span></td></tr><tr><th id=\"L91\"><a href=\"#L91\">91</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">return</span></td></tr><tr><th id=\"L92\"><a href=\"#L92\">92</a></th><td></td></tr><tr><th id=\"L93\"><a href=\"#L93\">93</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 required <span class=\"o\">=</span>\u00a0<span class=\"nb\">tuple</span><span class=\"p\">(</span><span class=\"nb\">map</span><span class=\"p\">(</span>_convert_None_to_Interface<span class=\"p\">,</span>\u00a0required<span class=\"p\">))</span></td></tr><tr><th id=\"L94\"><a href=\"#L94\">94</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 name <span class=\"o\">=</span>\u00a0_normalize_name<span class=\"p\">(</span>name<span class=\"p\">)</span></td></tr><tr><th id=\"L95\"><a href=\"#L95\">95</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 order <span class=\"o\">=</span>\u00a0<span class=\"nb\">len</span><span class=\"p\">(</span>required<span class=\"p\">)</span></td></tr><tr><th id=\"L96\"><a href=\"#L96\">96</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 byorder <span class=\"o\">=</span>\u00a0<span class=\"bp\">self</span><span class=\"o\">.</span>_adapters</td></tr><tr><th id=\"L97\"><a href=\"#L97\">97</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">while</span>\u00a0<span class=\"nb\">len</span><span class=\"p\">(</span>byorder<span class=\"p\">)</span>\u00a0<span class=\"o\">&lt;=</span>\u00a0order<span class=\"p\">:</span></td></tr><tr><th id=\"L98\"><a href=\"#L98\">98</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 byorder<span class=\"o\">.</span>append<span class=\"p\">({})</span></td></tr><tr><th id=\"L99\"><a href=\"#L99\">99</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 components <span class=\"o\">=</span>\u00a0byorder<span class=\"p\">[</span>order<span class=\"p\">]</span></td></tr><tr><th id=\"L100\"><a href=\"#L100\">100</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 key <span class=\"o\">=</span>\u00a0required <span class=\"o\">+</span>\u00a0<span class=\"p\">(</span>provided<span class=\"p\">,)</span></td></tr><tr><th id=\"L101\"><a href=\"#L101\">101</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 </td></tr><tr><th id=\"L102\"><a href=\"#L102\">102</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">for</span>\u00a0k <span class=\"ow\">in</span>\u00a0key<span class=\"p\">:</span></td></tr><tr><th id=\"L103\"><a href=\"#L103\">103</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 d <span class=\"o\">=</span>\u00a0components<span class=\"o\">.</span>get<span class=\"p\">(</span>k<span class=\"p\">)</span></td></tr><tr><th id=\"L104\"><a href=\"#L104\">104</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">if</span>\u00a0d <span class=\"ow\">is</span>\u00a0<span class=\"bp\">None</span><span class=\"p\">:</span></td></tr><tr><th id=\"L105\"><a href=\"#L105\">105</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 d <span class=\"o\">=</span>\u00a0<span class=\"p\">{}</span></td></tr><tr><th id=\"L106\"><a href=\"#L106\">106</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 components<span class=\"p\">[</span>k<span class=\"p\">]</span>\u00a0<span class=\"o\">=</span>\u00a0d</td></tr><tr><th id=\"L107\"><a href=\"#L107\">107</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 components <span class=\"o\">=</span>\u00a0d</td></tr><tr><th id=\"L108\"><a href=\"#L108\">108</a></th><td></td></tr><tr><th id=\"L109\"><a href=\"#L109\">109</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">if</span>\u00a0components<span class=\"o\">.</span>get<span class=\"p\">(</span>name<span class=\"p\">)</span>\u00a0<span class=\"o\">==</span>\u00a0value<span class=\"p\">:</span></td></tr><tr><th id=\"L110\"><a href=\"#L110\">110</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">return</span></td></tr><tr><th id=\"L111\"><a href=\"#L111\">111</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 </td></tr><tr><th id=\"L112\"><a href=\"#L112\">112</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 components<span class=\"p\">[</span>name<span class=\"p\">]</span>\u00a0<span class=\"o\">=</span>\u00a0value</td></tr><tr><th id=\"L113\"><a href=\"#L113\">113</a></th><td></td></tr><tr><th id=\"L114\"><a href=\"#L114\">114</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 n <span class=\"o\">=</span>\u00a0<span class=\"bp\">self</span><span class=\"o\">.</span>_provided<span class=\"o\">.</span>get<span class=\"p\">(</span>provided<span class=\"p\">,</span>\u00a0<span class=\"mi\">0</span><span class=\"p\">)</span>\u00a0<span class=\"o\">+</span>\u00a0<span class=\"mi\">1</span></td></tr><tr><th id=\"L115\"><a href=\"#L115\">115</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"bp\">self</span><span class=\"o\">.</span>_provided<span class=\"p\">[</span>provided<span class=\"p\">]</span>\u00a0<span class=\"o\">=</span>\u00a0n</td></tr><tr><th id=\"L116\"><a href=\"#L116\">116</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">if</span>\u00a0n <span class=\"o\">==</span>\u00a0<span class=\"mi\">1</span><span class=\"p\">:</span></td></tr><tr><th id=\"L117\"><a href=\"#L117\">117</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"bp\">self</span><span class=\"o\">.</span>_v_lookup<span class=\"o\">.</span>add_extendor<span class=\"p\">(</span>provided<span class=\"p\">)</span></td></tr><tr><th id=\"L118\"><a href=\"#L118\">118</a></th><td></td></tr><tr><th id=\"L119\"><a href=\"#L119\">119</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"bp\">self</span><span class=\"o\">.</span>changed<span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">)</span></td></tr><tr><th id=\"L120\"><a href=\"#L120\">120</a></th><td></td></tr><tr><th id=\"L121\"><a href=\"#L121\">121</a></th><td>\u00a0 \u00a0 <span class=\"k\">def</span>\u00a0<span class=\"nf\">registered</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span>\u00a0required<span class=\"p\">,</span>\u00a0provided<span class=\"p\">,</span>\u00a0name<span class=\"o\">=</span><span class=\"s\">u''</span><span class=\"p\">):</span></td></tr><tr><th id=\"L122\"><a href=\"#L122\">122</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 required <span class=\"o\">=</span>\u00a0<span class=\"nb\">tuple</span><span class=\"p\">(</span><span class=\"nb\">map</span><span class=\"p\">(</span>_convert_None_to_Interface<span class=\"p\">,</span>\u00a0required<span class=\"p\">))</span></td></tr><tr><th id=\"L123\"><a href=\"#L123\">123</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 name <span class=\"o\">=</span>\u00a0_normalize_name<span class=\"p\">(</span>name<span class=\"p\">)</span></td></tr><tr><th id=\"L124\"><a href=\"#L124\">124</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 order <span class=\"o\">=</span>\u00a0<span class=\"nb\">len</span><span class=\"p\">(</span>required<span class=\"p\">)</span></td></tr><tr><th id=\"L125\"><a href=\"#L125\">125</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 byorder <span class=\"o\">=</span>\u00a0<span class=\"bp\">self</span><span class=\"o\">.</span>_adapters</td></tr><tr><th id=\"L126\"><a href=\"#L126\">126</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">if</span>\u00a0<span class=\"nb\">len</span><span class=\"p\">(</span>byorder<span class=\"p\">)</span>\u00a0<span class=\"o\">&lt;=</span>\u00a0order<span class=\"p\">:</span></td></tr><tr><th id=\"L127\"><a href=\"#L127\">127</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">return</span>\u00a0<span class=\"bp\">None</span></td></tr><tr><th id=\"L128\"><a href=\"#L128\">128</a></th><td></td></tr><tr><th id=\"L129\"><a href=\"#L129\">129</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 components <span class=\"o\">=</span>\u00a0byorder<span class=\"p\">[</span>order<span class=\"p\">]</span></td></tr><tr><th id=\"L130\"><a href=\"#L130\">130</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 key <span class=\"o\">=</span>\u00a0required <span class=\"o\">+</span>\u00a0<span class=\"p\">(</span>provided<span class=\"p\">,)</span></td></tr><tr><th id=\"L131\"><a href=\"#L131\">131</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 </td></tr><tr><th id=\"L132\"><a href=\"#L132\">132</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">for</span>\u00a0k <span class=\"ow\">in</span>\u00a0key<span class=\"p\">:</span></td></tr><tr><th id=\"L133\"><a href=\"#L133\">133</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 d <span class=\"o\">=</span>\u00a0components<span class=\"o\">.</span>get<span class=\"p\">(</span>k<span class=\"p\">)</span></td></tr><tr><th id=\"L134\"><a href=\"#L134\">134</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">if</span>\u00a0d <span class=\"ow\">is</span>\u00a0<span class=\"bp\">None</span><span class=\"p\">:</span></td></tr><tr><th id=\"L135\"><a href=\"#L135\">135</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">return</span>\u00a0<span class=\"bp\">None</span></td></tr><tr><th id=\"L136\"><a href=\"#L136\">136</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 components <span class=\"o\">=</span>\u00a0d</td></tr><tr><th id=\"L137\"><a href=\"#L137\">137</a></th><td></td></tr><tr><th id=\"L138\"><a href=\"#L138\">138</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">return</span>\u00a0components<span class=\"o\">.</span>get<span class=\"p\">(</span>name<span class=\"p\">)</span></td></tr><tr><th id=\"L139\"><a href=\"#L139\">139</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 </td></tr><tr><th id=\"L140\"><a href=\"#L140\">140</a></th><td>\u00a0 \u00a0 <span class=\"k\">def</span>\u00a0<span class=\"nf\">unregister</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span>\u00a0required<span class=\"p\">,</span>\u00a0provided<span class=\"p\">,</span>\u00a0name<span class=\"p\">,</span>\u00a0value<span class=\"o\">=</span><span class=\"bp\">None</span><span class=\"p\">):</span></td></tr><tr><th id=\"L141\"><a href=\"#L141\">141</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 required <span class=\"o\">=</span>\u00a0<span class=\"nb\">tuple</span><span class=\"p\">(</span><span class=\"nb\">map</span><span class=\"p\">(</span>_convert_None_to_Interface<span class=\"p\">,</span>\u00a0required<span class=\"p\">))</span></td></tr><tr><th id=\"L142\"><a href=\"#L142\">142</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 order <span class=\"o\">=</span>\u00a0<span class=\"nb\">len</span><span class=\"p\">(</span>required<span class=\"p\">)</span></td></tr><tr><th id=\"L143\"><a href=\"#L143\">143</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 byorder <span class=\"o\">=</span>\u00a0<span class=\"bp\">self</span><span class=\"o\">.</span>_adapters</td></tr><tr><th id=\"L144\"><a href=\"#L144\">144</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">if</span>\u00a0order <span class=\"o\">&gt;=</span>\u00a0<span class=\"nb\">len</span><span class=\"p\">(</span>byorder<span class=\"p\">):</span></td></tr><tr><th id=\"L145\"><a href=\"#L145\">145</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">return</span>\u00a0<span class=\"bp\">False</span></td></tr><tr><th id=\"L146\"><a href=\"#L146\">146</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 components <span class=\"o\">=</span>\u00a0byorder<span class=\"p\">[</span>order<span class=\"p\">]</span></td></tr><tr><th id=\"L147\"><a href=\"#L147\">147</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 key <span class=\"o\">=</span>\u00a0required <span class=\"o\">+</span>\u00a0<span class=\"p\">(</span>provided<span class=\"p\">,)</span></td></tr><tr><th id=\"L148\"><a href=\"#L148\">148</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 </td></tr><tr><th id=\"L149\"><a href=\"#L149\">149</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">for</span>\u00a0k <span class=\"ow\">in</span>\u00a0key<span class=\"p\">:</span></td></tr><tr><th id=\"L150\"><a href=\"#L150\">150</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 d <span class=\"o\">=</span>\u00a0components<span class=\"o\">.</span>get<span class=\"p\">(</span>k<span class=\"p\">)</span></td></tr><tr><th id=\"L151\"><a href=\"#L151\">151</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">if</span>\u00a0d <span class=\"ow\">is</span>\u00a0<span class=\"bp\">None</span><span class=\"p\">:</span></td></tr><tr><th id=\"L152\"><a href=\"#L152\">152</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">return</span></td></tr><tr><th id=\"L153\"><a href=\"#L153\">153</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 components <span class=\"o\">=</span>\u00a0d</td></tr><tr><th id=\"L154\"><a href=\"#L154\">154</a></th><td></td></tr><tr><th id=\"L155\"><a href=\"#L155\">155</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 old <span class=\"o\">=</span>\u00a0components<span class=\"o\">.</span>get<span class=\"p\">(</span>name<span class=\"p\">)</span></td></tr><tr><th id=\"L156\"><a href=\"#L156\">156</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">if</span>\u00a0old <span class=\"ow\">is</span>\u00a0<span class=\"bp\">None</span><span class=\"p\">:</span></td></tr><tr><th id=\"L157\"><a href=\"#L157\">157</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">return</span></td></tr><tr><th id=\"L158\"><a href=\"#L158\">158</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">if</span>\u00a0<span class=\"p\">(</span>value <span class=\"ow\">is</span>\u00a0<span class=\"ow\">not</span>\u00a0<span class=\"bp\">None</span><span class=\"p\">)</span>\u00a0<span class=\"ow\">and</span>\u00a0<span class=\"p\">(</span>old <span class=\"o\">!=</span>\u00a0value<span class=\"p\">):</span></td></tr><tr><th id=\"L159\"><a href=\"#L159\">159</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">return</span></td></tr><tr><th id=\"L160\"><a href=\"#L160\">160</a></th><td></td></tr><tr><th id=\"L161\"><a href=\"#L161\">161</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">del</span>\u00a0components<span class=\"p\">[</span>name<span class=\"p\">]</span></td></tr><tr><th id=\"L162\"><a href=\"#L162\">162</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 n <span class=\"o\">=</span>\u00a0<span class=\"bp\">self</span><span class=\"o\">.</span>_provided<span class=\"p\">[</span>provided<span class=\"p\">]</span>\u00a0<span class=\"o\">-</span>\u00a0<span class=\"mi\">1</span></td></tr><tr><th id=\"L163\"><a href=\"#L163\">163</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">if</span>\u00a0n <span class=\"o\">==</span>\u00a0<span class=\"mi\">0</span><span class=\"p\">:</span></td></tr><tr><th id=\"L164\"><a href=\"#L164\">164</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">del</span>\u00a0<span class=\"bp\">self</span><span class=\"o\">.</span>_provided<span class=\"p\">[</span>provided<span class=\"p\">]</span></td></tr><tr><th id=\"L165\"><a href=\"#L165\">165</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"bp\">self</span><span class=\"o\">.</span>_v_lookup<span class=\"o\">.</span>remove_extendor<span class=\"p\">(</span>provided<span class=\"p\">)</span></td></tr><tr><th id=\"L166\"><a href=\"#L166\">166</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">else</span><span class=\"p\">:</span></td></tr><tr><th id=\"L167\"><a href=\"#L167\">167</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"bp\">self</span><span class=\"o\">.</span>_provided<span class=\"p\">[</span>provided<span class=\"p\">]</span>\u00a0<span class=\"o\">=</span>\u00a0n</td></tr><tr><th id=\"L168\"><a href=\"#L168\">168</a></th><td></td></tr><tr><th id=\"L169\"><a href=\"#L169\">169</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"bp\">self</span><span class=\"o\">.</span>changed<span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">)</span></td></tr><tr><th id=\"L170\"><a href=\"#L170\">170</a></th><td></td></tr><tr><th id=\"L171\"><a href=\"#L171\">171</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">return</span></td></tr><tr><th id=\"L172\"><a href=\"#L172\">172</a></th><td></td></tr><tr><th id=\"L173\"><a href=\"#L173\">173</a></th><td></td></tr><tr><th id=\"L174\"><a href=\"#L174\">174</a></th><td>\u00a0 \u00a0 <span class=\"k\">def</span>\u00a0<span class=\"nf\">subscribe</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span>\u00a0required<span class=\"p\">,</span>\u00a0provided<span class=\"p\">,</span>\u00a0value<span class=\"p\">):</span></td></tr><tr><th id=\"L175\"><a href=\"#L175\">175</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 required <span class=\"o\">=</span>\u00a0<span class=\"nb\">tuple</span><span class=\"p\">(</span><span class=\"nb\">map</span><span class=\"p\">(</span>_convert_None_to_Interface<span class=\"p\">,</span>\u00a0required<span class=\"p\">))</span></td></tr><tr><th id=\"L176\"><a href=\"#L176\">176</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 name <span class=\"o\">=</span>\u00a0<span class=\"s\">u''</span></td></tr><tr><th id=\"L177\"><a href=\"#L177\">177</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 order <span class=\"o\">=</span>\u00a0<span class=\"nb\">len</span><span class=\"p\">(</span>required<span class=\"p\">)</span></td></tr><tr><th id=\"L178\"><a href=\"#L178\">178</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 byorder <span class=\"o\">=</span>\u00a0<span class=\"bp\">self</span><span class=\"o\">.</span>_subscribers</td></tr><tr><th id=\"L179\"><a href=\"#L179\">179</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">while</span>\u00a0<span class=\"nb\">len</span><span class=\"p\">(</span>byorder<span class=\"p\">)</span>\u00a0<span class=\"o\">&lt;=</span>\u00a0order<span class=\"p\">:</span></td></tr><tr><th id=\"L180\"><a href=\"#L180\">180</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 byorder<span class=\"o\">.</span>append<span class=\"p\">({})</span></td></tr><tr><th id=\"L181\"><a href=\"#L181\">181</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 components <span class=\"o\">=</span>\u00a0byorder<span class=\"p\">[</span>order<span class=\"p\">]</span></td></tr><tr><th id=\"L182\"><a href=\"#L182\">182</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 key <span class=\"o\">=</span>\u00a0required <span class=\"o\">+</span>\u00a0<span class=\"p\">(</span>provided<span class=\"p\">,)</span></td></tr><tr><th id=\"L183\"><a href=\"#L183\">183</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 </td></tr><tr><th id=\"L184\"><a href=\"#L184\">184</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">for</span>\u00a0k <span class=\"ow\">in</span>\u00a0key<span class=\"p\">:</span></td></tr><tr><th id=\"L185\"><a href=\"#L185\">185</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 d <span class=\"o\">=</span>\u00a0components<span class=\"o\">.</span>get<span class=\"p\">(</span>k<span class=\"p\">)</span></td></tr><tr><th id=\"L186\"><a href=\"#L186\">186</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">if</span>\u00a0d <span class=\"ow\">is</span>\u00a0<span class=\"bp\">None</span><span class=\"p\">:</span></td></tr><tr><th id=\"L187\"><a href=\"#L187\">187</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 d <span class=\"o\">=</span>\u00a0<span class=\"p\">{}</span></td></tr><tr><th id=\"L188\"><a href=\"#L188\">188</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 components<span class=\"p\">[</span>k<span class=\"p\">]</span>\u00a0<span class=\"o\">=</span>\u00a0d</td></tr><tr><th id=\"L189\"><a href=\"#L189\">189</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 components <span class=\"o\">=</span>\u00a0d</td></tr><tr><th id=\"L190\"><a href=\"#L190\">190</a></th><td></td></tr><tr><th id=\"L191\"><a href=\"#L191\">191</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 components<span class=\"p\">[</span>name<span class=\"p\">]</span>\u00a0<span class=\"o\">=</span>\u00a0components<span class=\"o\">.</span>get<span class=\"p\">(</span>name<span class=\"p\">,</span>\u00a0<span class=\"p\">())</span>\u00a0<span class=\"o\">+</span>\u00a0<span class=\"p\">(</span>value<span class=\"p\">,</span>\u00a0<span class=\"p\">)</span></td></tr><tr><th id=\"L192\"><a href=\"#L192\">192</a></th><td></td></tr><tr><th id=\"L193\"><a href=\"#L193\">193</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">if</span>\u00a0provided <span class=\"ow\">is</span>\u00a0<span class=\"ow\">not</span>\u00a0<span class=\"bp\">None</span><span class=\"p\">:</span></td></tr><tr><th id=\"L194\"><a href=\"#L194\">194</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 n <span class=\"o\">=</span>\u00a0<span class=\"bp\">self</span><span class=\"o\">.</span>_provided<span class=\"o\">.</span>get<span class=\"p\">(</span>provided<span class=\"p\">,</span>\u00a0<span class=\"mi\">0</span><span class=\"p\">)</span>\u00a0<span class=\"o\">+</span>\u00a0<span class=\"mi\">1</span></td></tr><tr><th id=\"L195\"><a href=\"#L195\">195</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"bp\">self</span><span class=\"o\">.</span>_provided<span class=\"p\">[</span>provided<span class=\"p\">]</span>\u00a0<span class=\"o\">=</span>\u00a0n</td></tr><tr><th id=\"L196\"><a href=\"#L196\">196</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">if</span>\u00a0n <span class=\"o\">==</span>\u00a0<span class=\"mi\">1</span><span class=\"p\">:</span></td></tr><tr><th id=\"L197\"><a href=\"#L197\">197</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"bp\">self</span><span class=\"o\">.</span>_v_lookup<span class=\"o\">.</span>add_extendor<span class=\"p\">(</span>provided<span class=\"p\">)</span></td></tr><tr><th id=\"L198\"><a href=\"#L198\">198</a></th><td></td></tr><tr><th id=\"L199\"><a href=\"#L199\">199</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"bp\">self</span><span class=\"o\">.</span>changed<span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">)</span></td></tr><tr><th id=\"L200\"><a href=\"#L200\">200</a></th><td></td></tr><tr><th id=\"L201\"><a href=\"#L201\">201</a></th><td>\u00a0 \u00a0 <span class=\"k\">def</span>\u00a0<span class=\"nf\">unsubscribe</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span>\u00a0required<span class=\"p\">,</span>\u00a0provided<span class=\"p\">,</span>\u00a0value<span class=\"o\">=</span><span class=\"bp\">None</span><span class=\"p\">):</span></td></tr><tr><th id=\"L202\"><a href=\"#L202\">202</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 required <span class=\"o\">=</span>\u00a0<span class=\"nb\">tuple</span><span class=\"p\">(</span><span class=\"nb\">map</span><span class=\"p\">(</span>_convert_None_to_Interface<span class=\"p\">,</span>\u00a0required<span class=\"p\">))</span></td></tr><tr><th id=\"L203\"><a href=\"#L203\">203</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 order <span class=\"o\">=</span>\u00a0<span class=\"nb\">len</span><span class=\"p\">(</span>required<span class=\"p\">)</span></td></tr><tr><th id=\"L204\"><a href=\"#L204\">204</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 byorder <span class=\"o\">=</span>\u00a0<span class=\"bp\">self</span><span class=\"o\">.</span>_subscribers</td></tr><tr><th id=\"L205\"><a href=\"#L205\">205</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">if</span>\u00a0order <span class=\"o\">&gt;=</span>\u00a0<span class=\"nb\">len</span><span class=\"p\">(</span>byorder<span class=\"p\">):</span></td></tr><tr><th id=\"L206\"><a href=\"#L206\">206</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">return</span></td></tr><tr><th id=\"L207\"><a href=\"#L207\">207</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 components <span class=\"o\">=</span>\u00a0byorder<span class=\"p\">[</span>order<span class=\"p\">]</span></td></tr><tr><th id=\"L208\"><a href=\"#L208\">208</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 key <span class=\"o\">=</span>\u00a0required <span class=\"o\">+</span>\u00a0<span class=\"p\">(</span>provided<span class=\"p\">,)</span></td></tr><tr><th id=\"L209\"><a href=\"#L209\">209</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 </td></tr><tr><th id=\"L210\"><a href=\"#L210\">210</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">for</span>\u00a0k <span class=\"ow\">in</span>\u00a0key<span class=\"p\">:</span></td></tr><tr><th id=\"L211\"><a href=\"#L211\">211</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 d <span class=\"o\">=</span>\u00a0components<span class=\"o\">.</span>get<span class=\"p\">(</span>k<span class=\"p\">)</span></td></tr><tr><th id=\"L212\"><a href=\"#L212\">212</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">if</span>\u00a0d <span class=\"ow\">is</span>\u00a0<span class=\"bp\">None</span><span class=\"p\">:</span></td></tr><tr><th id=\"L213\"><a href=\"#L213\">213</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">return</span></td></tr><tr><th id=\"L214\"><a href=\"#L214\">214</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 components <span class=\"o\">=</span>\u00a0d</td></tr><tr><th id=\"L215\"><a href=\"#L215\">215</a></th><td></td></tr><tr><th id=\"L216\"><a href=\"#L216\">216</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 old <span class=\"o\">=</span>\u00a0components<span class=\"o\">.</span>get<span class=\"p\">(</span><span class=\"s\">u''</span><span class=\"p\">)</span></td></tr><tr><th id=\"L217\"><a href=\"#L217\">217</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">if</span>\u00a0<span class=\"ow\">not</span>\u00a0old<span class=\"p\">:</span></td></tr><tr><th id=\"L218\"><a href=\"#L218\">218</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">return</span></td></tr><tr><th id=\"L219\"><a href=\"#L219\">219</a></th><td></td></tr><tr><th id=\"L220\"><a href=\"#L220\">220</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">if</span>\u00a0value <span class=\"ow\">is</span>\u00a0<span class=\"bp\">None</span><span class=\"p\">:</span></td></tr><tr><th id=\"L221\"><a href=\"#L221\">221</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 new <span class=\"o\">=</span>\u00a0<span class=\"p\">()</span></td></tr><tr><th id=\"L222\"><a href=\"#L222\">222</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">else</span><span class=\"p\">:</span></td></tr><tr><th id=\"L223\"><a href=\"#L223\">223</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 new <span class=\"o\">=</span>\u00a0<span class=\"nb\">tuple</span><span class=\"p\">([</span>v <span class=\"k\">for</span>\u00a0v <span class=\"ow\">in</span>\u00a0old <span class=\"k\">if</span>\u00a0v <span class=\"o\">!=</span>\u00a0value<span class=\"p\">])</span></td></tr><tr><th id=\"L224\"><a href=\"#L224\">224</a></th><td></td></tr><tr><th id=\"L225\"><a href=\"#L225\">225</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">if</span>\u00a0new <span class=\"o\">==</span>\u00a0old<span class=\"p\">:</span></td></tr><tr><th id=\"L226\"><a href=\"#L226\">226</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">return</span></td></tr><tr><th id=\"L227\"><a href=\"#L227\">227</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 </td></tr><tr><th id=\"L228\"><a href=\"#L228\">228</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 components<span class=\"p\">[</span><span class=\"s\">u''</span><span class=\"p\">]</span>\u00a0<span class=\"o\">=</span>\u00a0new</td></tr><tr><th id=\"L229\"><a href=\"#L229\">229</a></th><td></td></tr><tr><th id=\"L230\"><a href=\"#L230\">230</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">if</span>\u00a0provided <span class=\"ow\">is</span>\u00a0<span class=\"ow\">not</span>\u00a0<span class=\"bp\">None</span><span class=\"p\">:</span></td></tr><tr><th id=\"L231\"><a href=\"#L231\">231</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 n <span class=\"o\">=</span>\u00a0<span class=\"bp\">self</span><span class=\"o\">.</span>_provided<span class=\"p\">[</span>provided<span class=\"p\">]</span>\u00a0<span class=\"o\">+</span>\u00a0<span class=\"nb\">len</span><span class=\"p\">(</span>new<span class=\"p\">)</span>\u00a0<span class=\"o\">-</span>\u00a0<span class=\"nb\">len</span><span class=\"p\">(</span>old<span class=\"p\">)</span></td></tr><tr><th id=\"L232\"><a href=\"#L232\">232</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">if</span>\u00a0n <span class=\"o\">==</span>\u00a0<span class=\"mi\">0</span><span class=\"p\">:</span></td></tr><tr><th id=\"L233\"><a href=\"#L233\">233</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">del</span>\u00a0<span class=\"bp\">self</span><span class=\"o\">.</span>_provided<span class=\"p\">[</span>provided<span class=\"p\">]</span></td></tr><tr><th id=\"L234\"><a href=\"#L234\">234</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"bp\">self</span><span class=\"o\">.</span>_v_lookup<span class=\"o\">.</span>remove_extendor<span class=\"p\">(</span>provided<span class=\"p\">)</span></td></tr><tr><th id=\"L235\"><a href=\"#L235\">235</a></th><td></td></tr><tr><th id=\"L236\"><a href=\"#L236\">236</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"bp\">self</span><span class=\"o\">.</span>changed<span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">)</span></td></tr><tr><th id=\"L237\"><a href=\"#L237\">237</a></th><td></td></tr><tr><th id=\"L238\"><a href=\"#L238\">238</a></th><td>\u00a0 \u00a0 <span class=\"c\"># XXX hack to fake out twisted's use of a private api.\u00a0 We need to get them</span></td></tr><tr><th id=\"L239\"><a href=\"#L239\">239</a></th><td>\u00a0 \u00a0 <span class=\"c\"># to use the new registed method.</span></td></tr><tr><th id=\"L240\"><a href=\"#L240\">240</a></th><td>\u00a0 \u00a0 <span class=\"k\">def</span>\u00a0<span class=\"nf\">get</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span>\u00a0_<span class=\"p\">):</span></td></tr><tr><th id=\"L241\"><a href=\"#L241\">241</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">class</span>\u00a0<span class=\"nc\">XXXTwistedFakeOut</span><span class=\"p\">:</span></td></tr><tr><th id=\"L242\"><a href=\"#L242\">242</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 selfImplied <span class=\"o\">=</span>\u00a0<span class=\"p\">{}</span></td></tr><tr><th id=\"L243\"><a href=\"#L243\">243</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">return</span>\u00a0XXXTwistedFakeOut</td></tr><tr><th id=\"L244\"><a href=\"#L244\">244</a></th><td></td></tr><tr><th id=\"L245\"><a href=\"#L245\">245</a></th><td></td></tr><tr><th id=\"L246\"><a href=\"#L246\">246</a></th><td>_not_in_mapping <span class=\"o\">=</span>\u00a0<span class=\"nb\">object</span><span class=\"p\">()</span></td></tr><tr><th id=\"L247\"><a href=\"#L247\">247</a></th><td><span class=\"k\">class</span>\u00a0<span class=\"nc\">LookupBasePy</span><span class=\"p\">(</span><span class=\"nb\">object</span><span class=\"p\">):</span></td></tr><tr><th id=\"L248\"><a href=\"#L248\">248</a></th><td></td></tr><tr><th id=\"L249\"><a href=\"#L249\">249</a></th><td>\u00a0 \u00a0 <span class=\"k\">def</span>\u00a0<span class=\"nf\">__init__</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">):</span></td></tr><tr><th id=\"L250\"><a href=\"#L250\">250</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"bp\">self</span><span class=\"o\">.</span>_cache <span class=\"o\">=</span>\u00a0<span class=\"p\">{}</span></td></tr><tr><th id=\"L251\"><a href=\"#L251\">251</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"bp\">self</span><span class=\"o\">.</span>_mcache <span class=\"o\">=</span>\u00a0<span class=\"p\">{}</span></td></tr><tr><th id=\"L252\"><a href=\"#L252\">252</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"bp\">self</span><span class=\"o\">.</span>_scache <span class=\"o\">=</span>\u00a0<span class=\"p\">{}</span></td></tr><tr><th id=\"L253\"><a href=\"#L253\">253</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 </td></tr><tr><th id=\"L254\"><a href=\"#L254\">254</a></th><td>\u00a0 \u00a0 <span class=\"k\">def</span>\u00a0<span class=\"nf\">changed</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span>\u00a0ignored<span class=\"o\">=</span><span class=\"bp\">None</span><span class=\"p\">):</span></td></tr><tr><th id=\"L255\"><a href=\"#L255\">255</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"bp\">self</span><span class=\"o\">.</span>_cache<span class=\"o\">.</span>clear<span class=\"p\">()</span></td></tr><tr><th id=\"L256\"><a href=\"#L256\">256</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"bp\">self</span><span class=\"o\">.</span>_mcache<span class=\"o\">.</span>clear<span class=\"p\">()</span></td></tr><tr><th id=\"L257\"><a href=\"#L257\">257</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"bp\">self</span><span class=\"o\">.</span>_scache<span class=\"o\">.</span>clear<span class=\"p\">()</span></td></tr><tr><th id=\"L258\"><a href=\"#L258\">258</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 </td></tr><tr><th id=\"L259\"><a href=\"#L259\">259</a></th><td>\u00a0 \u00a0 <span class=\"k\">def</span>\u00a0<span class=\"nf\">_getcache</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span>\u00a0provided<span class=\"p\">,</span>\u00a0name<span class=\"p\">):</span></td></tr><tr><th id=\"L260\"><a href=\"#L260\">260</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 cache <span class=\"o\">=</span>\u00a0<span class=\"bp\">self</span><span class=\"o\">.</span>_cache<span class=\"o\">.</span>get<span class=\"p\">(</span>provided<span class=\"p\">)</span></td></tr><tr><th id=\"L261\"><a href=\"#L261\">261</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">if</span>\u00a0cache <span class=\"ow\">is</span>\u00a0<span class=\"bp\">None</span><span class=\"p\">:</span></td></tr><tr><th id=\"L262\"><a href=\"#L262\">262</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 cache <span class=\"o\">=</span>\u00a0<span class=\"p\">{}</span></td></tr><tr><th id=\"L263\"><a href=\"#L263\">263</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"bp\">self</span><span class=\"o\">.</span>_cache<span class=\"p\">[</span>provided<span class=\"p\">]</span>\u00a0<span class=\"o\">=</span>\u00a0cache</td></tr><tr><th id=\"L264\"><a href=\"#L264\">264</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">if</span>\u00a0name<span class=\"p\">:</span></td></tr><tr><th id=\"L265\"><a href=\"#L265\">265</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 c <span class=\"o\">=</span>\u00a0cache<span class=\"o\">.</span>get<span class=\"p\">(</span>name<span class=\"p\">)</span></td></tr><tr><th id=\"L266\"><a href=\"#L266\">266</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">if</span>\u00a0c <span class=\"ow\">is</span>\u00a0<span class=\"bp\">None</span><span class=\"p\">:</span></td></tr><tr><th id=\"L267\"><a href=\"#L267\">267</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 c <span class=\"o\">=</span>\u00a0<span class=\"p\">{}</span></td></tr><tr><th id=\"L268\"><a href=\"#L268\">268</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 cache<span class=\"p\">[</span>name<span class=\"p\">]</span>\u00a0<span class=\"o\">=</span>\u00a0c</td></tr><tr><th id=\"L269\"><a href=\"#L269\">269</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 cache <span class=\"o\">=</span>\u00a0c</td></tr><tr><th id=\"L270\"><a href=\"#L270\">270</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">return</span>\u00a0cache</td></tr><tr><th id=\"L271\"><a href=\"#L271\">271</a></th><td></td></tr><tr><th id=\"L272\"><a href=\"#L272\">272</a></th><td>\u00a0 \u00a0 <span class=\"k\">def</span>\u00a0<span class=\"nf\">lookup</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span>\u00a0required<span class=\"p\">,</span>\u00a0provided<span class=\"p\">,</span>\u00a0name<span class=\"o\">=</span><span class=\"s\">u''</span><span class=\"p\">,</span>\u00a0default<span class=\"o\">=</span><span class=\"bp\">None</span><span class=\"p\">):</span></td></tr><tr><th id=\"L273\"><a href=\"#L273\">273</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 cache <span class=\"o\">=</span>\u00a0<span class=\"bp\">self</span><span class=\"o\">.</span>_getcache<span class=\"p\">(</span>provided<span class=\"p\">,</span>\u00a0name<span class=\"p\">)</span></td></tr><tr><th id=\"L274\"><a href=\"#L274\">274</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">if</span>\u00a0<span class=\"nb\">len</span><span class=\"p\">(</span>required<span class=\"p\">)</span>\u00a0<span class=\"o\">==</span>\u00a0<span class=\"mi\">1</span><span class=\"p\">:</span></td></tr><tr><th id=\"L275\"><a href=\"#L275\">275</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 result <span class=\"o\">=</span>\u00a0cache<span class=\"o\">.</span>get<span class=\"p\">(</span>required<span class=\"p\">[</span><span class=\"mi\">0</span><span class=\"p\">],</span>\u00a0_not_in_mapping<span class=\"p\">)</span></td></tr><tr><th id=\"L276\"><a href=\"#L276\">276</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">else</span><span class=\"p\">:</span></td></tr><tr><th id=\"L277\"><a href=\"#L277\">277</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 result <span class=\"o\">=</span>\u00a0cache<span class=\"o\">.</span>get<span class=\"p\">(</span><span class=\"nb\">tuple</span><span class=\"p\">(</span>required<span class=\"p\">),</span>\u00a0_not_in_mapping<span class=\"p\">)</span></td></tr><tr><th id=\"L278\"><a href=\"#L278\">278</a></th><td></td></tr><tr><th id=\"L279\"><a href=\"#L279\">279</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">if</span>\u00a0result <span class=\"ow\">is</span>\u00a0_not_in_mapping<span class=\"p\">:</span></td></tr><tr><th id=\"L280\"><a href=\"#L280\">280</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 result <span class=\"o\">=</span>\u00a0<span class=\"bp\">self</span><span class=\"o\">.</span>_uncached_lookup<span class=\"p\">(</span>required<span class=\"p\">,</span>\u00a0provided<span class=\"p\">,</span>\u00a0name<span class=\"p\">)</span></td></tr><tr><th id=\"L281\"><a href=\"#L281\">281</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">if</span>\u00a0<span class=\"nb\">len</span><span class=\"p\">(</span>required<span class=\"p\">)</span>\u00a0<span class=\"o\">==</span>\u00a0<span class=\"mi\">1</span><span class=\"p\">:</span></td></tr><tr><th id=\"L282\"><a href=\"#L282\">282</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 cache<span class=\"p\">[</span>required<span class=\"p\">[</span><span class=\"mi\">0</span><span class=\"p\">]]</span>\u00a0<span class=\"o\">=</span>\u00a0result</td></tr><tr><th id=\"L283\"><a href=\"#L283\">283</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">else</span><span class=\"p\">:</span></td></tr><tr><th id=\"L284\"><a href=\"#L284\">284</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 cache<span class=\"p\">[</span><span class=\"nb\">tuple</span><span class=\"p\">(</span>required<span class=\"p\">)]</span>\u00a0<span class=\"o\">=</span>\u00a0result</td></tr><tr><th id=\"L285\"><a href=\"#L285\">285</a></th><td></td></tr><tr><th id=\"L286\"><a href=\"#L286\">286</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">if</span>\u00a0result <span class=\"ow\">is</span>\u00a0<span class=\"bp\">None</span><span class=\"p\">:</span></td></tr><tr><th id=\"L287\"><a href=\"#L287\">287</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">return</span>\u00a0default</td></tr><tr><th id=\"L288\"><a href=\"#L288\">288</a></th><td></td></tr><tr><th id=\"L289\"><a href=\"#L289\">289</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">return</span>\u00a0result</td></tr><tr><th id=\"L290\"><a href=\"#L290\">290</a></th><td>\u00a0 \u00a0 </td></tr><tr><th id=\"L291\"><a href=\"#L291\">291</a></th><td>\u00a0 \u00a0 <span class=\"k\">def</span>\u00a0<span class=\"nf\">lookup1</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span>\u00a0required<span class=\"p\">,</span>\u00a0provided<span class=\"p\">,</span>\u00a0name<span class=\"o\">=</span><span class=\"s\">u''</span><span class=\"p\">,</span>\u00a0default<span class=\"o\">=</span><span class=\"bp\">None</span><span class=\"p\">):</span></td></tr><tr><th id=\"L292\"><a href=\"#L292\">292</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 cache <span class=\"o\">=</span>\u00a0<span class=\"bp\">self</span><span class=\"o\">.</span>_getcache<span class=\"p\">(</span>provided<span class=\"p\">,</span>\u00a0name<span class=\"p\">)</span></td></tr><tr><th id=\"L293\"><a href=\"#L293\">293</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 result <span class=\"o\">=</span>\u00a0cache<span class=\"o\">.</span>get<span class=\"p\">(</span>required<span class=\"p\">,</span>\u00a0_not_in_mapping<span class=\"p\">)</span></td></tr><tr><th id=\"L294\"><a href=\"#L294\">294</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">if</span>\u00a0result <span class=\"ow\">is</span>\u00a0_not_in_mapping<span class=\"p\">:</span></td></tr><tr><th id=\"L295\"><a href=\"#L295\">295</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">return</span>\u00a0<span class=\"bp\">self</span><span class=\"o\">.</span>lookup<span class=\"p\">((</span>required<span class=\"p\">,</span>\u00a0<span class=\"p\">),</span>\u00a0provided<span class=\"p\">,</span>\u00a0name<span class=\"p\">,</span>\u00a0default<span class=\"p\">)</span></td></tr><tr><th id=\"L296\"><a href=\"#L296\">296</a></th><td></td></tr><tr><th id=\"L297\"><a href=\"#L297\">297</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">if</span>\u00a0result <span class=\"ow\">is</span>\u00a0<span class=\"bp\">None</span><span class=\"p\">:</span></td></tr><tr><th id=\"L298\"><a href=\"#L298\">298</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">return</span>\u00a0default</td></tr><tr><th id=\"L299\"><a href=\"#L299\">299</a></th><td></td></tr><tr><th id=\"L300\"><a href=\"#L300\">300</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">return</span>\u00a0result</td></tr><tr><th id=\"L301\"><a href=\"#L301\">301</a></th><td></td></tr><tr><th id=\"L302\"><a href=\"#L302\">302</a></th><td>\u00a0 \u00a0 <span class=\"k\">def</span>\u00a0<span class=\"nf\">queryAdapter</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span>\u00a0<span class=\"nb\">object</span><span class=\"p\">,</span>\u00a0provided<span class=\"p\">,</span>\u00a0name<span class=\"o\">=</span><span class=\"s\">u''</span><span class=\"p\">,</span>\u00a0default<span class=\"o\">=</span><span class=\"bp\">None</span><span class=\"p\">):</span></td></tr><tr><th id=\"L303\"><a href=\"#L303\">303</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">return</span>\u00a0<span class=\"bp\">self</span><span class=\"o\">.</span>adapter_hook<span class=\"p\">(</span>provided<span class=\"p\">,</span>\u00a0<span class=\"nb\">object</span><span class=\"p\">,</span>\u00a0name<span class=\"p\">,</span>\u00a0default<span class=\"p\">)</span></td></tr><tr><th id=\"L304\"><a href=\"#L304\">304</a></th><td></td></tr><tr><th id=\"L305\"><a href=\"#L305\">305</a></th><td>\u00a0 \u00a0 <span class=\"k\">def</span>\u00a0<span class=\"nf\">adapter_hook</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span>\u00a0provided<span class=\"p\">,</span>\u00a0<span class=\"nb\">object</span><span class=\"p\">,</span>\u00a0name<span class=\"o\">=</span><span class=\"s\">u''</span><span class=\"p\">,</span>\u00a0default<span class=\"o\">=</span><span class=\"bp\">None</span><span class=\"p\">):</span></td></tr><tr><th id=\"L306\"><a href=\"#L306\">306</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 required <span class=\"o\">=</span>\u00a0providedBy<span class=\"p\">(</span><span class=\"nb\">object</span><span class=\"p\">)</span></td></tr><tr><th id=\"L307\"><a href=\"#L307\">307</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 cache <span class=\"o\">=</span>\u00a0<span class=\"bp\">self</span><span class=\"o\">.</span>_getcache<span class=\"p\">(</span>provided<span class=\"p\">,</span>\u00a0name<span class=\"p\">)</span></td></tr><tr><th id=\"L308\"><a href=\"#L308\">308</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 factory <span class=\"o\">=</span>\u00a0cache<span class=\"o\">.</span>get<span class=\"p\">(</span>required<span class=\"p\">,</span>\u00a0_not_in_mapping<span class=\"p\">)</span></td></tr><tr><th id=\"L309\"><a href=\"#L309\">309</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">if</span>\u00a0factory <span class=\"ow\">is</span>\u00a0_not_in_mapping<span class=\"p\">:</span></td></tr><tr><th id=\"L310\"><a href=\"#L310\">310</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 factory <span class=\"o\">=</span>\u00a0<span class=\"bp\">self</span><span class=\"o\">.</span>lookup<span class=\"p\">((</span>required<span class=\"p\">,</span>\u00a0<span class=\"p\">),</span>\u00a0provided<span class=\"p\">,</span>\u00a0name<span class=\"p\">)</span></td></tr><tr><th id=\"L311\"><a href=\"#L311\">311</a></th><td></td></tr><tr><th id=\"L312\"><a href=\"#L312\">312</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">if</span>\u00a0factory <span class=\"ow\">is</span>\u00a0<span class=\"ow\">not</span>\u00a0<span class=\"bp\">None</span><span class=\"p\">:</span></td></tr><tr><th id=\"L313\"><a href=\"#L313\">313</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 result <span class=\"o\">=</span>\u00a0factory<span class=\"p\">(</span><span class=\"nb\">object</span><span class=\"p\">)</span></td></tr><tr><th id=\"L314\"><a href=\"#L314\">314</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">if</span>\u00a0result <span class=\"ow\">is</span>\u00a0<span class=\"ow\">not</span>\u00a0<span class=\"bp\">None</span><span class=\"p\">:</span></td></tr><tr><th id=\"L315\"><a href=\"#L315\">315</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">return</span>\u00a0result</td></tr><tr><th id=\"L316\"><a href=\"#L316\">316</a></th><td></td></tr><tr><th id=\"L317\"><a href=\"#L317\">317</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">return</span>\u00a0default</td></tr><tr><th id=\"L318\"><a href=\"#L318\">318</a></th><td></td></tr><tr><th id=\"L319\"><a href=\"#L319\">319</a></th><td>\u00a0 \u00a0 <span class=\"k\">def</span>\u00a0<span class=\"nf\">lookupAll</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span>\u00a0required<span class=\"p\">,</span>\u00a0provided<span class=\"p\">):</span></td></tr><tr><th id=\"L320\"><a href=\"#L320\">320</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 cache <span class=\"o\">=</span>\u00a0<span class=\"bp\">self</span><span class=\"o\">.</span>_mcache<span class=\"o\">.</span>get<span class=\"p\">(</span>provided<span class=\"p\">)</span></td></tr><tr><th id=\"L321\"><a href=\"#L321\">321</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">if</span>\u00a0cache <span class=\"ow\">is</span>\u00a0<span class=\"bp\">None</span><span class=\"p\">:</span></td></tr><tr><th id=\"L322\"><a href=\"#L322\">322</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 cache <span class=\"o\">=</span>\u00a0<span class=\"p\">{}</span></td></tr><tr><th id=\"L323\"><a href=\"#L323\">323</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"bp\">self</span><span class=\"o\">.</span>_mcache<span class=\"p\">[</span>provided<span class=\"p\">]</span>\u00a0<span class=\"o\">=</span>\u00a0cache</td></tr><tr><th id=\"L324\"><a href=\"#L324\">324</a></th><td></td></tr><tr><th id=\"L325\"><a href=\"#L325\">325</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 required <span class=\"o\">=</span>\u00a0<span class=\"nb\">tuple</span><span class=\"p\">(</span>required<span class=\"p\">)</span></td></tr><tr><th id=\"L326\"><a href=\"#L326\">326</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 result <span class=\"o\">=</span>\u00a0cache<span class=\"o\">.</span>get<span class=\"p\">(</span>required<span class=\"p\">,</span>\u00a0_not_in_mapping<span class=\"p\">)</span></td></tr><tr><th id=\"L327\"><a href=\"#L327\">327</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">if</span>\u00a0result <span class=\"ow\">is</span>\u00a0_not_in_mapping<span class=\"p\">:</span></td></tr><tr><th id=\"L328\"><a href=\"#L328\">328</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 result <span class=\"o\">=</span>\u00a0<span class=\"bp\">self</span><span class=\"o\">.</span>_uncached_lookupAll<span class=\"p\">(</span>required<span class=\"p\">,</span>\u00a0provided<span class=\"p\">)</span></td></tr><tr><th id=\"L329\"><a href=\"#L329\">329</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 cache<span class=\"p\">[</span>required<span class=\"p\">]</span>\u00a0<span class=\"o\">=</span>\u00a0result</td></tr><tr><th id=\"L330\"><a href=\"#L330\">330</a></th><td></td></tr><tr><th id=\"L331\"><a href=\"#L331\">331</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">return</span>\u00a0result</td></tr><tr><th id=\"L332\"><a href=\"#L332\">332</a></th><td></td></tr><tr><th id=\"L333\"><a href=\"#L333\">333</a></th><td></td></tr><tr><th id=\"L334\"><a href=\"#L334\">334</a></th><td>\u00a0 \u00a0 <span class=\"k\">def</span>\u00a0<span class=\"nf\">subscriptions</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span>\u00a0required<span class=\"p\">,</span>\u00a0provided<span class=\"p\">):</span></td></tr><tr><th id=\"L335\"><a href=\"#L335\">335</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 cache <span class=\"o\">=</span>\u00a0<span class=\"bp\">self</span><span class=\"o\">.</span>_scache<span class=\"o\">.</span>get<span class=\"p\">(</span>provided<span class=\"p\">)</span></td></tr><tr><th id=\"L336\"><a href=\"#L336\">336</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">if</span>\u00a0cache <span class=\"ow\">is</span>\u00a0<span class=\"bp\">None</span><span class=\"p\">:</span></td></tr><tr><th id=\"L337\"><a href=\"#L337\">337</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 cache <span class=\"o\">=</span>\u00a0<span class=\"p\">{}</span></td></tr><tr><th id=\"L338\"><a href=\"#L338\">338</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"bp\">self</span><span class=\"o\">.</span>_scache<span class=\"p\">[</span>provided<span class=\"p\">]</span>\u00a0<span class=\"o\">=</span>\u00a0cache</td></tr><tr><th id=\"L339\"><a href=\"#L339\">339</a></th><td></td></tr><tr><th id=\"L340\"><a href=\"#L340\">340</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 required <span class=\"o\">=</span>\u00a0<span class=\"nb\">tuple</span><span class=\"p\">(</span>required<span class=\"p\">)</span></td></tr><tr><th id=\"L341\"><a href=\"#L341\">341</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 result <span class=\"o\">=</span>\u00a0cache<span class=\"o\">.</span>get<span class=\"p\">(</span>required<span class=\"p\">,</span>\u00a0_not_in_mapping<span class=\"p\">)</span></td></tr><tr><th id=\"L342\"><a href=\"#L342\">342</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">if</span>\u00a0result <span class=\"ow\">is</span>\u00a0_not_in_mapping<span class=\"p\">:</span></td></tr><tr><th id=\"L343\"><a href=\"#L343\">343</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 result <span class=\"o\">=</span>\u00a0<span class=\"bp\">self</span><span class=\"o\">.</span>_uncached_subscriptions<span class=\"p\">(</span>required<span class=\"p\">,</span>\u00a0provided<span class=\"p\">)</span></td></tr><tr><th id=\"L344\"><a href=\"#L344\">344</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 cache<span class=\"p\">[</span>required<span class=\"p\">]</span>\u00a0<span class=\"o\">=</span>\u00a0result</td></tr><tr><th id=\"L345\"><a href=\"#L345\">345</a></th><td></td></tr><tr><th id=\"L346\"><a href=\"#L346\">346</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">return</span>\u00a0result</td></tr><tr><th id=\"L347\"><a href=\"#L347\">347</a></th><td>\u00a0 \u00a0 </td></tr><tr><th id=\"L348\"><a href=\"#L348\">348</a></th><td>LookupBase <span class=\"o\">=</span>\u00a0LookupBasePy</td></tr><tr><th id=\"L349\"><a href=\"#L349\">349</a></th><td></td></tr><tr><th id=\"L350\"><a href=\"#L350\">350</a></th><td><span class=\"k\">class</span>\u00a0<span class=\"nc\">VerifyingBasePy</span><span class=\"p\">(</span>LookupBasePy<span class=\"p\">):</span></td></tr><tr><th id=\"L351\"><a href=\"#L351\">351</a></th><td></td></tr><tr><th id=\"L352\"><a href=\"#L352\">352</a></th><td>\u00a0 \u00a0 <span class=\"k\">def</span>\u00a0<span class=\"nf\">changed</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span>\u00a0originally_changed<span class=\"p\">):</span></td></tr><tr><th id=\"L353\"><a href=\"#L353\">353</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 LookupBasePy<span class=\"o\">.</span>changed<span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span>\u00a0originally_changed<span class=\"p\">)</span></td></tr><tr><th id=\"L354\"><a href=\"#L354\">354</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"bp\">self</span><span class=\"o\">.</span>_verify_ro <span class=\"o\">=</span>\u00a0<span class=\"bp\">self</span><span class=\"o\">.</span>_registry<span class=\"o\">.</span>ro<span class=\"p\">[</span><span class=\"mi\">1</span><span class=\"p\">:]</span></td></tr><tr><th id=\"L355\"><a href=\"#L355\">355</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"bp\">self</span><span class=\"o\">.</span>_verify_generations <span class=\"o\">=</span>\u00a0<span class=\"p\">[</span>r<span class=\"o\">.</span>_generation <span class=\"k\">for</span>\u00a0r <span class=\"ow\">in</span>\u00a0<span class=\"bp\">self</span><span class=\"o\">.</span>_verify_ro<span class=\"p\">]</span></td></tr><tr><th id=\"L356\"><a href=\"#L356\">356</a></th><td></td></tr><tr><th id=\"L357\"><a href=\"#L357\">357</a></th><td>\u00a0 \u00a0 <span class=\"k\">def</span>\u00a0<span class=\"nf\">_verify</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">):</span></td></tr><tr><th id=\"L358\"><a href=\"#L358\">358</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">if</span>\u00a0<span class=\"p\">([</span>r<span class=\"o\">.</span>_generation <span class=\"k\">for</span>\u00a0r <span class=\"ow\">in</span>\u00a0<span class=\"bp\">self</span><span class=\"o\">.</span>_verify_ro<span class=\"p\">]</span></td></tr><tr><th id=\"L359\"><a href=\"#L359\">359</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"o\">!=</span>\u00a0<span class=\"bp\">self</span><span class=\"o\">.</span>_verify_generations<span class=\"p\">):</span></td></tr><tr><th id=\"L360\"><a href=\"#L360\">360</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"bp\">self</span><span class=\"o\">.</span>changed<span class=\"p\">(</span><span class=\"bp\">None</span><span class=\"p\">)</span></td></tr><tr><th id=\"L361\"><a href=\"#L361\">361</a></th><td></td></tr><tr><th id=\"L362\"><a href=\"#L362\">362</a></th><td>\u00a0 \u00a0 <span class=\"k\">def</span>\u00a0<span class=\"nf\">_getcache</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span>\u00a0provided<span class=\"p\">,</span>\u00a0name<span class=\"p\">):</span></td></tr><tr><th id=\"L363\"><a href=\"#L363\">363</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"bp\">self</span><span class=\"o\">.</span>_verify<span class=\"p\">()</span></td></tr><tr><th id=\"L364\"><a href=\"#L364\">364</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">return</span>\u00a0LookupBasePy<span class=\"o\">.</span>_getcache<span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span>\u00a0provided<span class=\"p\">,</span>\u00a0name<span class=\"p\">)</span></td></tr><tr><th id=\"L365\"><a href=\"#L365\">365</a></th><td>\u00a0 \u00a0 </td></tr><tr><th id=\"L366\"><a href=\"#L366\">366</a></th><td>\u00a0 \u00a0 <span class=\"k\">def</span>\u00a0<span class=\"nf\">lookupAll</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span>\u00a0required<span class=\"p\">,</span>\u00a0provided<span class=\"p\">):</span></td></tr><tr><th id=\"L367\"><a href=\"#L367\">367</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"bp\">self</span><span class=\"o\">.</span>_verify<span class=\"p\">()</span></td></tr><tr><th id=\"L368\"><a href=\"#L368\">368</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">return</span>\u00a0LookupBasePy<span class=\"o\">.</span>lookupAll<span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span>\u00a0required<span class=\"p\">,</span>\u00a0provided<span class=\"p\">)</span></td></tr><tr><th id=\"L369\"><a href=\"#L369\">369</a></th><td></td></tr><tr><th id=\"L370\"><a href=\"#L370\">370</a></th><td>\u00a0 \u00a0 <span class=\"k\">def</span>\u00a0<span class=\"nf\">subscriptions</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span>\u00a0required<span class=\"p\">,</span>\u00a0provided<span class=\"p\">):</span></td></tr><tr><th id=\"L371\"><a href=\"#L371\">371</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"bp\">self</span><span class=\"o\">.</span>_verify<span class=\"p\">()</span></td></tr><tr><th id=\"L372\"><a href=\"#L372\">372</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">return</span>\u00a0LookupBasePy<span class=\"o\">.</span>subscriptions<span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span>\u00a0required<span class=\"p\">,</span>\u00a0provided<span class=\"p\">)</span></td></tr><tr><th id=\"L373\"><a href=\"#L373\">373</a></th><td></td></tr><tr><th id=\"L374\"><a href=\"#L374\">374</a></th><td>VerifyingBase <span class=\"o\">=</span>\u00a0VerifyingBasePy</td></tr><tr><th id=\"L375\"><a href=\"#L375\">375</a></th><td></td></tr><tr><th id=\"L376\"><a href=\"#L376\">376</a></th><td></td></tr><tr><th id=\"L377\"><a href=\"#L377\">377</a></th><td><span class=\"k\">try</span><span class=\"p\">:</span></td></tr><tr><th id=\"L378\"><a href=\"#L378\">378</a></th><td>\u00a0 \u00a0 <span class=\"kn\">import</span>\u00a0<span class=\"nn\">_zope_interface_coptimizations</span></td></tr><tr><th id=\"L379\"><a href=\"#L379\">379</a></th><td><span class=\"k\">except</span>\u00a0<span class=\"ne\">ImportError</span><span class=\"p\">:</span></td></tr><tr><th id=\"L380\"><a href=\"#L380\">380</a></th><td>\u00a0 \u00a0 <span class=\"k\">pass</span></td></tr><tr><th id=\"L381\"><a href=\"#L381\">381</a></th><td><span class=\"k\">else</span><span class=\"p\">:</span></td></tr><tr><th id=\"L382\"><a href=\"#L382\">382</a></th><td>\u00a0 \u00a0 <span class=\"kn\">from</span>\u00a0<span class=\"nn\">_zope_interface_coptimizations</span>\u00a0<span class=\"kn\">import</span>\u00a0LookupBase<span class=\"p\">,</span>\u00a0VerifyingBase</td></tr><tr><th id=\"L383\"><a href=\"#L383\">383</a></th><td></td></tr><tr><th id=\"L384\"><a href=\"#L384\">384</a></th><td><span class=\"k\">class</span>\u00a0<span class=\"nc\">AdapterLookupBase</span><span class=\"p\">(</span><span class=\"nb\">object</span><span class=\"p\">):</span></td></tr><tr><th id=\"L385\"><a href=\"#L385\">385</a></th><td></td></tr><tr><th id=\"L386\"><a href=\"#L386\">386</a></th><td>\u00a0 \u00a0 <span class=\"k\">def</span>\u00a0<span class=\"nf\">__init__</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span>\u00a0registry<span class=\"p\">):</span></td></tr><tr><th id=\"L387\"><a href=\"#L387\">387</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"bp\">self</span><span class=\"o\">.</span>_registry <span class=\"o\">=</span>\u00a0registry</td></tr><tr><th id=\"L388\"><a href=\"#L388\">388</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"bp\">self</span><span class=\"o\">.</span>_required <span class=\"o\">=</span>\u00a0<span class=\"p\">{}</span></td></tr><tr><th id=\"L389\"><a href=\"#L389\">389</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"bp\">self</span><span class=\"o\">.</span>init_extendors<span class=\"p\">()</span></td></tr><tr><th id=\"L390\"><a href=\"#L390\">390</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"nb\">super</span><span class=\"p\">(</span>AdapterLookupBase<span class=\"p\">,</span>\u00a0<span class=\"bp\">self</span><span class=\"p\">)</span><span class=\"o\">.</span>__init__<span class=\"p\">()</span></td></tr><tr><th id=\"L391\"><a href=\"#L391\">391</a></th><td></td></tr><tr><th id=\"L392\"><a href=\"#L392\">392</a></th><td>\u00a0 \u00a0 <span class=\"k\">def</span>\u00a0<span class=\"nf\">changed</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span>\u00a0ignored<span class=\"o\">=</span><span class=\"bp\">None</span><span class=\"p\">):</span></td></tr><tr><th id=\"L393\"><a href=\"#L393\">393</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"nb\">super</span><span class=\"p\">(</span>AdapterLookupBase<span class=\"p\">,</span>\u00a0<span class=\"bp\">self</span><span class=\"p\">)</span><span class=\"o\">.</span>changed<span class=\"p\">(</span><span class=\"bp\">None</span><span class=\"p\">)</span></td></tr><tr><th id=\"L394\"><a href=\"#L394\">394</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">for</span>\u00a0r <span class=\"ow\">in</span>\u00a0<span class=\"bp\">self</span><span class=\"o\">.</span>_required<span class=\"o\">.</span>keys<span class=\"p\">():</span></td></tr><tr><th id=\"L395\"><a href=\"#L395\">395</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 r <span class=\"o\">=</span>\u00a0r<span class=\"p\">()</span></td></tr><tr><th id=\"L396\"><a href=\"#L396\">396</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">if</span>\u00a0r <span class=\"ow\">is</span>\u00a0<span class=\"ow\">not</span>\u00a0<span class=\"bp\">None</span><span class=\"p\">:</span></td></tr><tr><th id=\"L397\"><a href=\"#L397\">397</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 r<span class=\"o\">.</span>unsubscribe<span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">)</span></td></tr><tr><th id=\"L398\"><a href=\"#L398\">398</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"bp\">self</span><span class=\"o\">.</span>_required<span class=\"o\">.</span>clear<span class=\"p\">()</span></td></tr><tr><th id=\"L399\"><a href=\"#L399\">399</a></th><td></td></tr><tr><th id=\"L400\"><a href=\"#L400\">400</a></th><td></td></tr><tr><th id=\"L401\"><a href=\"#L401\">401</a></th><td>\u00a0 \u00a0 <span class=\"c\"># Extendors</span></td></tr><tr><th id=\"L402\"><a href=\"#L402\">402</a></th><td>\u00a0 \u00a0 <span class=\"c\"># ---------</span></td></tr><tr><th id=\"L403\"><a href=\"#L403\">403</a></th><td></td></tr><tr><th id=\"L404\"><a href=\"#L404\">404</a></th><td>\u00a0 \u00a0 <span class=\"c\"># When given an target interface for an adapter lookup, we need to consider</span></td></tr><tr><th id=\"L405\"><a href=\"#L405\">405</a></th><td>\u00a0 \u00a0 <span class=\"c\"># adapters for interfaces that extend the target interface.\u00a0 This is</span></td></tr><tr><th id=\"L406\"><a href=\"#L406\">406</a></th><td>\u00a0 \u00a0 <span class=\"c\"># what the extendors dictionary is about.\u00a0 It tells us all of the</span></td></tr><tr><th id=\"L407\"><a href=\"#L407\">407</a></th><td>\u00a0 \u00a0 <span class=\"c\"># interfaces that extend an interface for which there are adapters</span></td></tr><tr><th id=\"L408\"><a href=\"#L408\">408</a></th><td>\u00a0 \u00a0 <span class=\"c\"># registered.</span></td></tr><tr><th id=\"L409\"><a href=\"#L409\">409</a></th><td></td></tr><tr><th id=\"L410\"><a href=\"#L410\">410</a></th><td>\u00a0 \u00a0 <span class=\"c\"># We could separate this by order and name, thus reducing the</span></td></tr><tr><th id=\"L411\"><a href=\"#L411\">411</a></th><td>\u00a0 \u00a0 <span class=\"c\"># number of provided interfaces to search at run time.\u00a0 The tradeoff,</span></td></tr><tr><th id=\"L412\"><a href=\"#L412\">412</a></th><td>\u00a0 \u00a0 <span class=\"c\"># however, is that we have to store more information.\u00a0 For example,</span></td></tr><tr><th id=\"L413\"><a href=\"#L413\">413</a></th><td>\u00a0 \u00a0 <span class=\"c\"># is the same interface is provided for multiple names and if the</span></td></tr><tr><th id=\"L414\"><a href=\"#L414\">414</a></th><td>\u00a0 \u00a0 <span class=\"c\"># interface extends many interfaces, we'll have to keep track of</span></td></tr><tr><th id=\"L415\"><a href=\"#L415\">415</a></th><td>\u00a0 \u00a0 <span class=\"c\"># a fair bit of information for each name.\u00a0 It's better to</span></td></tr><tr><th id=\"L416\"><a href=\"#L416\">416</a></th><td>\u00a0 \u00a0 <span class=\"c\"># be space efficient here and be time efficient in the cache</span></td></tr><tr><th id=\"L417\"><a href=\"#L417\">417</a></th><td>\u00a0 \u00a0 <span class=\"c\"># implementation.</span></td></tr><tr><th id=\"L418\"><a href=\"#L418\">418</a></th><td></td></tr><tr><th id=\"L419\"><a href=\"#L419\">419</a></th><td>\u00a0 \u00a0 <span class=\"c\"># TODO: add invalidation when a provided interface changes, in case</span></td></tr><tr><th id=\"L420\"><a href=\"#L420\">420</a></th><td>\u00a0 \u00a0 <span class=\"c\"># the interface's __iro__ has changed.\u00a0 This is unlikely enough that</span></td></tr><tr><th id=\"L421\"><a href=\"#L421\">421</a></th><td>\u00a0 \u00a0 <span class=\"c\"># we'll take our chances for now.</span></td></tr><tr><th id=\"L422\"><a href=\"#L422\">422</a></th><td>\u00a0 \u00a0 </td></tr><tr><th id=\"L423\"><a href=\"#L423\">423</a></th><td>\u00a0 \u00a0 <span class=\"k\">def</span>\u00a0<span class=\"nf\">init_extendors</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">):</span></td></tr><tr><th id=\"L424\"><a href=\"#L424\">424</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"bp\">self</span><span class=\"o\">.</span>_extendors <span class=\"o\">=</span>\u00a0<span class=\"p\">{}</span></td></tr><tr><th id=\"L425\"><a href=\"#L425\">425</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">for</span>\u00a0p <span class=\"ow\">in</span>\u00a0<span class=\"bp\">self</span><span class=\"o\">.</span>_registry<span class=\"o\">.</span>_provided<span class=\"p\">:</span></td></tr><tr><th id=\"L426\"><a href=\"#L426\">426</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"bp\">self</span><span class=\"o\">.</span>add_extendor<span class=\"p\">(</span>p<span class=\"p\">)</span></td></tr><tr><th id=\"L427\"><a href=\"#L427\">427</a></th><td></td></tr><tr><th id=\"L428\"><a href=\"#L428\">428</a></th><td>\u00a0 \u00a0 <span class=\"k\">def</span>\u00a0<span class=\"nf\">add_extendor</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span>\u00a0provided<span class=\"p\">):</span></td></tr><tr><th id=\"L429\"><a href=\"#L429\">429</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 _extendors <span class=\"o\">=</span>\u00a0<span class=\"bp\">self</span><span class=\"o\">.</span>_extendors</td></tr><tr><th id=\"L430\"><a href=\"#L430\">430</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">for</span>\u00a0i <span class=\"ow\">in</span>\u00a0provided<span class=\"o\">.</span>__iro__<span class=\"p\">:</span></td></tr><tr><th id=\"L431\"><a href=\"#L431\">431</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 extendors <span class=\"o\">=</span>\u00a0_extendors<span class=\"o\">.</span>get<span class=\"p\">(</span>i<span class=\"p\">,</span>\u00a0<span class=\"p\">())</span></td></tr><tr><th id=\"L432\"><a href=\"#L432\">432</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 _extendors<span class=\"p\">[</span>i<span class=\"p\">]</span>\u00a0<span class=\"o\">=</span>\u00a0<span class=\"p\">(</span></td></tr><tr><th id=\"L433\"><a href=\"#L433\">433</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"p\">[</span>e <span class=\"k\">for</span>\u00a0e <span class=\"ow\">in</span>\u00a0extendors <span class=\"k\">if</span>\u00a0provided<span class=\"o\">.</span>isOrExtends<span class=\"p\">(</span>e<span class=\"p\">)]</span></td></tr><tr><th id=\"L434\"><a href=\"#L434\">434</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"o\">+</span></td></tr><tr><th id=\"L435\"><a href=\"#L435\">435</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"p\">[</span>provided<span class=\"p\">]</span></td></tr><tr><th id=\"L436\"><a href=\"#L436\">436</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"o\">+</span>\u00a0</td></tr><tr><th id=\"L437\"><a href=\"#L437\">437</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"p\">[</span>e <span class=\"k\">for</span>\u00a0e <span class=\"ow\">in</span>\u00a0extendors <span class=\"k\">if</span>\u00a0<span class=\"ow\">not</span>\u00a0provided<span class=\"o\">.</span>isOrExtends<span class=\"p\">(</span>e<span class=\"p\">)]</span></td></tr><tr><th id=\"L438\"><a href=\"#L438\">438</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"p\">)</span></td></tr><tr><th id=\"L439\"><a href=\"#L439\">439</a></th><td></td></tr><tr><th id=\"L440\"><a href=\"#L440\">440</a></th><td>\u00a0 \u00a0 <span class=\"k\">def</span>\u00a0<span class=\"nf\">remove_extendor</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span>\u00a0provided<span class=\"p\">):</span></td></tr><tr><th id=\"L441\"><a href=\"#L441\">441</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 _extendors <span class=\"o\">=</span>\u00a0<span class=\"bp\">self</span><span class=\"o\">.</span>_extendors</td></tr><tr><th id=\"L442\"><a href=\"#L442\">442</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">for</span>\u00a0i <span class=\"ow\">in</span>\u00a0provided<span class=\"o\">.</span>__iro__<span class=\"p\">:</span></td></tr><tr><th id=\"L443\"><a href=\"#L443\">443</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 _extendors<span class=\"p\">[</span>i<span class=\"p\">]</span>\u00a0<span class=\"o\">=</span>\u00a0<span class=\"p\">[</span>e <span class=\"k\">for</span>\u00a0e <span class=\"ow\">in</span>\u00a0_extendors<span class=\"o\">.</span>get<span class=\"p\">(</span>i<span class=\"p\">,</span>\u00a0<span class=\"p\">())</span></td></tr><tr><th id=\"L444\"><a href=\"#L444\">444</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0<span class=\"k\">if</span>\u00a0e <span class=\"o\">!=</span>\u00a0provided<span class=\"p\">]</span></td></tr><tr><th id=\"L445\"><a href=\"#L445\">445</a></th><td></td></tr><tr><th id=\"L446\"><a href=\"#L446\">446</a></th><td></td></tr><tr><th id=\"L447\"><a href=\"#L447\">447</a></th><td>\u00a0 \u00a0 <span class=\"k\">def</span>\u00a0<span class=\"nf\">_subscribe</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span>\u00a0<span class=\"o\">*</span>required<span class=\"p\">):</span></td></tr><tr><th id=\"L448\"><a href=\"#L448\">448</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 _refs <span class=\"o\">=</span>\u00a0<span class=\"bp\">self</span><span class=\"o\">.</span>_required</td></tr><tr><th id=\"L449\"><a href=\"#L449\">449</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">for</span>\u00a0r <span class=\"ow\">in</span>\u00a0required<span class=\"p\">:</span></td></tr><tr><th id=\"L450\"><a href=\"#L450\">450</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 ref <span class=\"o\">=</span>\u00a0r<span class=\"o\">.</span>weakref<span class=\"p\">()</span></td></tr><tr><th id=\"L451\"><a href=\"#L451\">451</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">if</span>\u00a0ref <span class=\"ow\">not</span>\u00a0<span class=\"ow\">in</span>\u00a0_refs<span class=\"p\">:</span></td></tr><tr><th id=\"L452\"><a href=\"#L452\">452</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 r<span class=\"o\">.</span>subscribe<span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">)</span></td></tr><tr><th id=\"L453\"><a href=\"#L453\">453</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 _refs<span class=\"p\">[</span>ref<span class=\"p\">]</span>\u00a0<span class=\"o\">=</span>\u00a0<span class=\"mi\">1</span></td></tr><tr><th id=\"L454\"><a href=\"#L454\">454</a></th><td></td></tr><tr><th id=\"L455\"><a href=\"#L455\">455</a></th><td>\u00a0 \u00a0 <span class=\"k\">def</span>\u00a0<span class=\"nf\">_uncached_lookup</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span>\u00a0required<span class=\"p\">,</span>\u00a0provided<span class=\"p\">,</span>\u00a0name<span class=\"o\">=</span><span class=\"s\">u''</span><span class=\"p\">):</span></td></tr><tr><th id=\"L456\"><a href=\"#L456\">456</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 result <span class=\"o\">=</span>\u00a0<span class=\"bp\">None</span></td></tr><tr><th id=\"L457\"><a href=\"#L457\">457</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 order <span class=\"o\">=</span>\u00a0<span class=\"nb\">len</span><span class=\"p\">(</span>required<span class=\"p\">)</span></td></tr><tr><th id=\"L458\"><a href=\"#L458\">458</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">for</span>\u00a0registry <span class=\"ow\">in</span>\u00a0<span class=\"bp\">self</span><span class=\"o\">.</span>_registry<span class=\"o\">.</span>ro<span class=\"p\">:</span></td></tr><tr><th id=\"L459\"><a href=\"#L459\">459</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 byorder <span class=\"o\">=</span>\u00a0registry<span class=\"o\">.</span>_adapters</td></tr><tr><th id=\"L460\"><a href=\"#L460\">460</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">if</span>\u00a0order <span class=\"o\">&gt;=</span>\u00a0<span class=\"nb\">len</span><span class=\"p\">(</span>byorder<span class=\"p\">):</span></td></tr><tr><th id=\"L461\"><a href=\"#L461\">461</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">continue</span></td></tr><tr><th id=\"L462\"><a href=\"#L462\">462</a></th><td></td></tr><tr><th id=\"L463\"><a href=\"#L463\">463</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 extendors <span class=\"o\">=</span>\u00a0registry<span class=\"o\">.</span>_v_lookup<span class=\"o\">.</span>_extendors<span class=\"o\">.</span>get<span class=\"p\">(</span>provided<span class=\"p\">)</span></td></tr><tr><th id=\"L464\"><a href=\"#L464\">464</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">if</span>\u00a0<span class=\"ow\">not</span>\u00a0extendors<span class=\"p\">:</span></td></tr><tr><th id=\"L465\"><a href=\"#L465\">465</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">continue</span></td></tr><tr><th id=\"L466\"><a href=\"#L466\">466</a></th><td></td></tr><tr><th id=\"L467\"><a href=\"#L467\">467</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 components <span class=\"o\">=</span>\u00a0byorder<span class=\"p\">[</span>order<span class=\"p\">]</span></td></tr><tr><th id=\"L468\"><a href=\"#L468\">468</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 result <span class=\"o\">=</span>\u00a0_lookup<span class=\"p\">(</span>components<span class=\"p\">,</span>\u00a0required<span class=\"p\">,</span>\u00a0extendors<span class=\"p\">,</span>\u00a0name<span class=\"p\">,</span>\u00a0<span class=\"mi\">0</span><span class=\"p\">,</span></td></tr><tr><th id=\"L469\"><a href=\"#L469\">469</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0order<span class=\"p\">)</span></td></tr><tr><th id=\"L470\"><a href=\"#L470\">470</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">if</span>\u00a0result <span class=\"ow\">is</span>\u00a0<span class=\"ow\">not</span>\u00a0<span class=\"bp\">None</span><span class=\"p\">:</span></td></tr><tr><th id=\"L471\"><a href=\"#L471\">471</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">break</span></td></tr><tr><th id=\"L472\"><a href=\"#L472\">472</a></th><td></td></tr><tr><th id=\"L473\"><a href=\"#L473\">473</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"bp\">self</span><span class=\"o\">.</span>_subscribe<span class=\"p\">(</span><span class=\"o\">*</span>required<span class=\"p\">)</span></td></tr><tr><th id=\"L474\"><a href=\"#L474\">474</a></th><td></td></tr><tr><th id=\"L475\"><a href=\"#L475\">475</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">return</span>\u00a0result</td></tr><tr><th id=\"L476\"><a href=\"#L476\">476</a></th><td></td></tr><tr><th id=\"L477\"><a href=\"#L477\">477</a></th><td>\u00a0 \u00a0 <span class=\"k\">def</span>\u00a0<span class=\"nf\">queryMultiAdapter</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span>\u00a0objects<span class=\"p\">,</span>\u00a0provided<span class=\"p\">,</span>\u00a0name<span class=\"o\">=</span><span class=\"s\">u''</span><span class=\"p\">,</span>\u00a0default<span class=\"o\">=</span><span class=\"bp\">None</span><span class=\"p\">):</span></td></tr><tr><th id=\"L478\"><a href=\"#L478\">478</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 factory <span class=\"o\">=</span>\u00a0<span class=\"bp\">self</span><span class=\"o\">.</span>lookup<span class=\"p\">(</span><span class=\"nb\">map</span><span class=\"p\">(</span>providedBy<span class=\"p\">,</span>\u00a0objects<span class=\"p\">),</span>\u00a0provided<span class=\"p\">,</span>\u00a0name<span class=\"p\">)</span></td></tr><tr><th id=\"L479\"><a href=\"#L479\">479</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">if</span>\u00a0factory <span class=\"ow\">is</span>\u00a0<span class=\"bp\">None</span><span class=\"p\">:</span></td></tr><tr><th id=\"L480\"><a href=\"#L480\">480</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">return</span>\u00a0default</td></tr><tr><th id=\"L481\"><a href=\"#L481\">481</a></th><td></td></tr><tr><th id=\"L482\"><a href=\"#L482\">482</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 result <span class=\"o\">=</span>\u00a0factory<span class=\"p\">(</span><span class=\"o\">*</span>objects<span class=\"p\">)</span></td></tr><tr><th id=\"L483\"><a href=\"#L483\">483</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">if</span>\u00a0result <span class=\"ow\">is</span>\u00a0<span class=\"bp\">None</span><span class=\"p\">:</span></td></tr><tr><th id=\"L484\"><a href=\"#L484\">484</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">return</span>\u00a0default</td></tr><tr><th id=\"L485\"><a href=\"#L485\">485</a></th><td></td></tr><tr><th id=\"L486\"><a href=\"#L486\">486</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">return</span>\u00a0result\u00a0 \u00a0 \u00a0 \u00a0 </td></tr><tr><th id=\"L487\"><a href=\"#L487\">487</a></th><td></td></tr><tr><th id=\"L488\"><a href=\"#L488\">488</a></th><td>\u00a0 \u00a0 <span class=\"k\">def</span>\u00a0<span class=\"nf\">_uncached_lookupAll</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span>\u00a0required<span class=\"p\">,</span>\u00a0provided<span class=\"p\">):</span></td></tr><tr><th id=\"L489\"><a href=\"#L489\">489</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 order <span class=\"o\">=</span>\u00a0<span class=\"nb\">len</span><span class=\"p\">(</span>required<span class=\"p\">)</span></td></tr><tr><th id=\"L490\"><a href=\"#L490\">490</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 result <span class=\"o\">=</span>\u00a0<span class=\"p\">{}</span></td></tr><tr><th id=\"L491\"><a href=\"#L491\">491</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">for</span>\u00a0registry <span class=\"ow\">in</span>\u00a0<span class=\"nb\">reversed</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span>_registry<span class=\"o\">.</span>ro<span class=\"p\">):</span></td></tr><tr><th id=\"L492\"><a href=\"#L492\">492</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 byorder <span class=\"o\">=</span>\u00a0registry<span class=\"o\">.</span>_adapters</td></tr><tr><th id=\"L493\"><a href=\"#L493\">493</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">if</span>\u00a0order <span class=\"o\">&gt;=</span>\u00a0<span class=\"nb\">len</span><span class=\"p\">(</span>byorder<span class=\"p\">):</span></td></tr><tr><th id=\"L494\"><a href=\"#L494\">494</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">continue</span></td></tr><tr><th id=\"L495\"><a href=\"#L495\">495</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 extendors <span class=\"o\">=</span>\u00a0registry<span class=\"o\">.</span>_v_lookup<span class=\"o\">.</span>_extendors<span class=\"o\">.</span>get<span class=\"p\">(</span>provided<span class=\"p\">)</span></td></tr><tr><th id=\"L496\"><a href=\"#L496\">496</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">if</span>\u00a0<span class=\"ow\">not</span>\u00a0extendors<span class=\"p\">:</span></td></tr><tr><th id=\"L497\"><a href=\"#L497\">497</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">continue</span></td></tr><tr><th id=\"L498\"><a href=\"#L498\">498</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 components <span class=\"o\">=</span>\u00a0byorder<span class=\"p\">[</span>order<span class=\"p\">]</span></td></tr><tr><th id=\"L499\"><a href=\"#L499\">499</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 _lookupAll<span class=\"p\">(</span>components<span class=\"p\">,</span>\u00a0required<span class=\"p\">,</span>\u00a0extendors<span class=\"p\">,</span>\u00a0result<span class=\"p\">,</span>\u00a0<span class=\"mi\">0</span><span class=\"p\">,</span>\u00a0order<span class=\"p\">)</span></td></tr><tr><th id=\"L500\"><a href=\"#L500\">500</a></th><td></td></tr><tr><th id=\"L501\"><a href=\"#L501\">501</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"bp\">self</span><span class=\"o\">.</span>_subscribe<span class=\"p\">(</span><span class=\"o\">*</span>required<span class=\"p\">)</span></td></tr><tr><th id=\"L502\"><a href=\"#L502\">502</a></th><td></td></tr><tr><th id=\"L503\"><a href=\"#L503\">503</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">return</span>\u00a0<span class=\"nb\">tuple</span><span class=\"p\">(</span>result<span class=\"o\">.</span>iteritems<span class=\"p\">())</span></td></tr><tr><th id=\"L504\"><a href=\"#L504\">504</a></th><td></td></tr><tr><th id=\"L505\"><a href=\"#L505\">505</a></th><td>\u00a0 \u00a0 <span class=\"k\">def</span>\u00a0<span class=\"nf\">names</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span>\u00a0required<span class=\"p\">,</span>\u00a0provided<span class=\"p\">):</span></td></tr><tr><th id=\"L506\"><a href=\"#L506\">506</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">return</span>\u00a0<span class=\"p\">[</span>c<span class=\"p\">[</span><span class=\"mi\">0</span><span class=\"p\">]</span>\u00a0<span class=\"k\">for</span>\u00a0c <span class=\"ow\">in</span>\u00a0<span class=\"bp\">self</span><span class=\"o\">.</span>lookupAll<span class=\"p\">(</span>required<span class=\"p\">,</span>\u00a0provided<span class=\"p\">)]</span></td></tr><tr><th id=\"L507\"><a href=\"#L507\">507</a></th><td></td></tr><tr><th id=\"L508\"><a href=\"#L508\">508</a></th><td>\u00a0 \u00a0 <span class=\"k\">def</span>\u00a0<span class=\"nf\">_uncached_subscriptions</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span>\u00a0required<span class=\"p\">,</span>\u00a0provided<span class=\"p\">):</span></td></tr><tr><th id=\"L509\"><a href=\"#L509\">509</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 order <span class=\"o\">=</span>\u00a0<span class=\"nb\">len</span><span class=\"p\">(</span>required<span class=\"p\">)</span></td></tr><tr><th id=\"L510\"><a href=\"#L510\">510</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 result <span class=\"o\">=</span>\u00a0<span class=\"p\">[]</span></td></tr><tr><th id=\"L511\"><a href=\"#L511\">511</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">for</span>\u00a0registry <span class=\"ow\">in</span>\u00a0<span class=\"nb\">reversed</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span>_registry<span class=\"o\">.</span>ro<span class=\"p\">):</span></td></tr><tr><th id=\"L512\"><a href=\"#L512\">512</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 byorder <span class=\"o\">=</span>\u00a0registry<span class=\"o\">.</span>_subscribers</td></tr><tr><th id=\"L513\"><a href=\"#L513\">513</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">if</span>\u00a0order <span class=\"o\">&gt;=</span>\u00a0<span class=\"nb\">len</span><span class=\"p\">(</span>byorder<span class=\"p\">):</span></td></tr><tr><th id=\"L514\"><a href=\"#L514\">514</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">continue</span></td></tr><tr><th id=\"L515\"><a href=\"#L515\">515</a></th><td></td></tr><tr><th id=\"L516\"><a href=\"#L516\">516</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">if</span>\u00a0provided <span class=\"ow\">is</span>\u00a0<span class=\"bp\">None</span><span class=\"p\">:</span></td></tr><tr><th id=\"L517\"><a href=\"#L517\">517</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 extendors <span class=\"o\">=</span>\u00a0<span class=\"p\">(</span>provided<span class=\"p\">,</span>\u00a0<span class=\"p\">)</span></td></tr><tr><th id=\"L518\"><a href=\"#L518\">518</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">else</span><span class=\"p\">:</span></td></tr><tr><th id=\"L519\"><a href=\"#L519\">519</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 extendors <span class=\"o\">=</span>\u00a0registry<span class=\"o\">.</span>_v_lookup<span class=\"o\">.</span>_extendors<span class=\"o\">.</span>get<span class=\"p\">(</span>provided<span class=\"p\">)</span></td></tr><tr><th id=\"L520\"><a href=\"#L520\">520</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">if</span>\u00a0extendors <span class=\"ow\">is</span>\u00a0<span class=\"bp\">None</span><span class=\"p\">:</span></td></tr><tr><th id=\"L521\"><a href=\"#L521\">521</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">continue</span></td></tr><tr><th id=\"L522\"><a href=\"#L522\">522</a></th><td></td></tr><tr><th id=\"L523\"><a href=\"#L523\">523</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 _subscriptions<span class=\"p\">(</span>byorder<span class=\"p\">[</span>order<span class=\"p\">],</span>\u00a0required<span class=\"p\">,</span>\u00a0extendors<span class=\"p\">,</span>\u00a0<span class=\"s\">u''</span><span class=\"p\">,</span></td></tr><tr><th id=\"L524\"><a href=\"#L524\">524</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0result<span class=\"p\">,</span>\u00a0<span class=\"mi\">0</span><span class=\"p\">,</span>\u00a0order<span class=\"p\">)</span></td></tr><tr><th id=\"L525\"><a href=\"#L525\">525</a></th><td></td></tr><tr><th id=\"L526\"><a href=\"#L526\">526</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"bp\">self</span><span class=\"o\">.</span>_subscribe<span class=\"p\">(</span><span class=\"o\">*</span>required<span class=\"p\">)</span></td></tr><tr><th id=\"L527\"><a href=\"#L527\">527</a></th><td></td></tr><tr><th id=\"L528\"><a href=\"#L528\">528</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">return</span>\u00a0result</td></tr><tr><th id=\"L529\"><a href=\"#L529\">529</a></th><td></td></tr><tr><th id=\"L530\"><a href=\"#L530\">530</a></th><td>\u00a0 \u00a0 <span class=\"k\">def</span>\u00a0<span class=\"nf\">subscribers</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span>\u00a0objects<span class=\"p\">,</span>\u00a0provided<span class=\"p\">):</span></td></tr><tr><th id=\"L531\"><a href=\"#L531\">531</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 subscriptions <span class=\"o\">=</span>\u00a0<span class=\"bp\">self</span><span class=\"o\">.</span>subscriptions<span class=\"p\">(</span><span class=\"nb\">map</span><span class=\"p\">(</span>providedBy<span class=\"p\">,</span>\u00a0objects<span class=\"p\">),</span>\u00a0provided<span class=\"p\">)</span></td></tr><tr><th id=\"L532\"><a href=\"#L532\">532</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">if</span>\u00a0provided <span class=\"ow\">is</span>\u00a0<span class=\"bp\">None</span><span class=\"p\">:</span></td></tr><tr><th id=\"L533\"><a href=\"#L533\">533</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 result <span class=\"o\">=</span>\u00a0<span class=\"p\">()</span></td></tr><tr><th id=\"L534\"><a href=\"#L534\">534</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">for</span>\u00a0subscription <span class=\"ow\">in</span>\u00a0subscriptions<span class=\"p\">:</span></td></tr><tr><th id=\"L535\"><a href=\"#L535\">535</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 subscription<span class=\"p\">(</span><span class=\"o\">*</span>objects<span class=\"p\">)</span></td></tr><tr><th id=\"L536\"><a href=\"#L536\">536</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">else</span><span class=\"p\">:</span></td></tr><tr><th id=\"L537\"><a href=\"#L537\">537</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 result <span class=\"o\">=</span>\u00a0<span class=\"p\">[]</span></td></tr><tr><th id=\"L538\"><a href=\"#L538\">538</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">for</span>\u00a0subscription <span class=\"ow\">in</span>\u00a0subscriptions<span class=\"p\">:</span></td></tr><tr><th id=\"L539\"><a href=\"#L539\">539</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 subscriber <span class=\"o\">=</span>\u00a0subscription<span class=\"p\">(</span><span class=\"o\">*</span>objects<span class=\"p\">)</span></td></tr><tr><th id=\"L540\"><a href=\"#L540\">540</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">if</span>\u00a0subscriber <span class=\"ow\">is</span>\u00a0<span class=\"ow\">not</span>\u00a0<span class=\"bp\">None</span><span class=\"p\">:</span></td></tr><tr><th id=\"L541\"><a href=\"#L541\">541</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 result<span class=\"o\">.</span>append<span class=\"p\">(</span>subscriber<span class=\"p\">)</span></td></tr><tr><th id=\"L542\"><a href=\"#L542\">542</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">return</span>\u00a0result</td></tr><tr><th id=\"L543\"><a href=\"#L543\">543</a></th><td></td></tr><tr><th id=\"L544\"><a href=\"#L544\">544</a></th><td><span class=\"k\">class</span>\u00a0<span class=\"nc\">AdapterLookup</span><span class=\"p\">(</span>AdapterLookupBase<span class=\"p\">,</span>\u00a0LookupBase<span class=\"p\">):</span></td></tr><tr><th id=\"L545\"><a href=\"#L545\">545</a></th><td>\u00a0 \u00a0 <span class=\"k\">pass</span></td></tr><tr><th id=\"L546\"><a href=\"#L546\">546</a></th><td></td></tr><tr><th id=\"L547\"><a href=\"#L547\">547</a></th><td><span class=\"k\">class</span>\u00a0<span class=\"nc\">AdapterRegistry</span><span class=\"p\">(</span>BaseAdapterRegistry<span class=\"p\">):</span></td></tr><tr><th id=\"L548\"><a href=\"#L548\">548</a></th><td></td></tr><tr><th id=\"L549\"><a href=\"#L549\">549</a></th><td>\u00a0 \u00a0 LookupClass <span class=\"o\">=</span>\u00a0AdapterLookup</td></tr><tr><th id=\"L550\"><a href=\"#L550\">550</a></th><td></td></tr><tr><th id=\"L551\"><a href=\"#L551\">551</a></th><td>\u00a0 \u00a0 <span class=\"k\">def</span>\u00a0<span class=\"nf\">__init__</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span>\u00a0bases<span class=\"o\">=</span><span class=\"p\">()):</span></td></tr><tr><th id=\"L552\"><a href=\"#L552\">552</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"c\"># AdapterRegisties are invalidating registries, so</span></td></tr><tr><th id=\"L553\"><a href=\"#L553\">553</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"c\"># we need to keep track of out invalidating subregistries.</span></td></tr><tr><th id=\"L554\"><a href=\"#L554\">554</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"bp\">self</span><span class=\"o\">.</span>_v_subregistries <span class=\"o\">=</span>\u00a0weakref<span class=\"o\">.</span>WeakKeyDictionary<span class=\"p\">()</span></td></tr><tr><th id=\"L555\"><a href=\"#L555\">555</a></th><td></td></tr><tr><th id=\"L556\"><a href=\"#L556\">556</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"nb\">super</span><span class=\"p\">(</span>AdapterRegistry<span class=\"p\">,</span>\u00a0<span class=\"bp\">self</span><span class=\"p\">)</span><span class=\"o\">.</span>__init__<span class=\"p\">(</span>bases<span class=\"p\">)</span></td></tr><tr><th id=\"L557\"><a href=\"#L557\">557</a></th><td></td></tr><tr><th id=\"L558\"><a href=\"#L558\">558</a></th><td>\u00a0 \u00a0 <span class=\"k\">def</span>\u00a0<span class=\"nf\">_addSubregistry</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span>\u00a0r<span class=\"p\">):</span></td></tr><tr><th id=\"L559\"><a href=\"#L559\">559</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"bp\">self</span><span class=\"o\">.</span>_v_subregistries<span class=\"p\">[</span>r<span class=\"p\">]</span>\u00a0<span class=\"o\">=</span>\u00a0<span class=\"mi\">1</span></td></tr><tr><th id=\"L560\"><a href=\"#L560\">560</a></th><td></td></tr><tr><th id=\"L561\"><a href=\"#L561\">561</a></th><td>\u00a0 \u00a0 <span class=\"k\">def</span>\u00a0<span class=\"nf\">_removeSubregistry</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span>\u00a0r<span class=\"p\">):</span></td></tr><tr><th id=\"L562\"><a href=\"#L562\">562</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">if</span>\u00a0r <span class=\"ow\">in</span>\u00a0<span class=\"bp\">self</span><span class=\"o\">.</span>_v_subregistries<span class=\"p\">:</span></td></tr><tr><th id=\"L563\"><a href=\"#L563\">563</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">del</span>\u00a0<span class=\"bp\">self</span><span class=\"o\">.</span>_v_subregistries<span class=\"p\">[</span>r<span class=\"p\">]</span></td></tr><tr><th id=\"L564\"><a href=\"#L564\">564</a></th><td></td></tr><tr><th id=\"L565\"><a href=\"#L565\">565</a></th><td>\u00a0 \u00a0 <span class=\"k\">def</span>\u00a0<span class=\"nf\">_setBases</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span>\u00a0bases<span class=\"p\">):</span></td></tr><tr><th id=\"L566\"><a href=\"#L566\">566</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 old <span class=\"o\">=</span>\u00a0<span class=\"bp\">self</span><span class=\"o\">.</span>__dict__<span class=\"o\">.</span>get<span class=\"p\">(</span><span class=\"s\">'__bases__'</span><span class=\"p\">,</span>\u00a0<span class=\"p\">())</span></td></tr><tr><th id=\"L567\"><a href=\"#L567\">567</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">for</span>\u00a0r <span class=\"ow\">in</span>\u00a0old<span class=\"p\">:</span></td></tr><tr><th id=\"L568\"><a href=\"#L568\">568</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">if</span>\u00a0r <span class=\"ow\">not</span>\u00a0<span class=\"ow\">in</span>\u00a0bases<span class=\"p\">:</span></td></tr><tr><th id=\"L569\"><a href=\"#L569\">569</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 r<span class=\"o\">.</span>_removeSubregistry<span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">)</span></td></tr><tr><th id=\"L570\"><a href=\"#L570\">570</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">for</span>\u00a0r <span class=\"ow\">in</span>\u00a0bases<span class=\"p\">:</span></td></tr><tr><th id=\"L571\"><a href=\"#L571\">571</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">if</span>\u00a0r <span class=\"ow\">not</span>\u00a0<span class=\"ow\">in</span>\u00a0old<span class=\"p\">:</span></td></tr><tr><th id=\"L572\"><a href=\"#L572\">572</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 r<span class=\"o\">.</span>_addSubregistry<span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">)</span></td></tr><tr><th id=\"L573\"><a href=\"#L573\">573</a></th><td></td></tr><tr><th id=\"L574\"><a href=\"#L574\">574</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"nb\">super</span><span class=\"p\">(</span>AdapterRegistry<span class=\"p\">,</span>\u00a0<span class=\"bp\">self</span><span class=\"p\">)</span><span class=\"o\">.</span>_setBases<span class=\"p\">(</span>bases<span class=\"p\">)</span></td></tr><tr><th id=\"L575\"><a href=\"#L575\">575</a></th><td></td></tr><tr><th id=\"L576\"><a href=\"#L576\">576</a></th><td>\u00a0 \u00a0 <span class=\"k\">def</span>\u00a0<span class=\"nf\">changed</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span>\u00a0originally_changed<span class=\"p\">):</span></td></tr><tr><th id=\"L577\"><a href=\"#L577\">577</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"nb\">super</span><span class=\"p\">(</span>AdapterRegistry<span class=\"p\">,</span>\u00a0<span class=\"bp\">self</span><span class=\"p\">)</span><span class=\"o\">.</span>changed<span class=\"p\">(</span>originally_changed<span class=\"p\">)</span></td></tr><tr><th id=\"L578\"><a href=\"#L578\">578</a></th><td></td></tr><tr><th id=\"L579\"><a href=\"#L579\">579</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">for</span>\u00a0sub <span class=\"ow\">in</span>\u00a0<span class=\"bp\">self</span><span class=\"o\">.</span>_v_subregistries<span class=\"o\">.</span>keys<span class=\"p\">():</span></td></tr><tr><th id=\"L580\"><a href=\"#L580\">580</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 sub<span class=\"o\">.</span>changed<span class=\"p\">(</span>originally_changed<span class=\"p\">)</span></td></tr><tr><th id=\"L581\"><a href=\"#L581\">581</a></th><td></td></tr><tr><th id=\"L582\"><a href=\"#L582\">582</a></th><td></td></tr><tr><th id=\"L583\"><a href=\"#L583\">583</a></th><td><span class=\"k\">class</span>\u00a0<span class=\"nc\">VerifyingAdapterLookup</span><span class=\"p\">(</span>AdapterLookupBase<span class=\"p\">,</span>\u00a0VerifyingBase<span class=\"p\">):</span></td></tr><tr><th id=\"L584\"><a href=\"#L584\">584</a></th><td>\u00a0 \u00a0 <span class=\"k\">pass</span></td></tr><tr><th id=\"L585\"><a href=\"#L585\">585</a></th><td></td></tr><tr><th id=\"L586\"><a href=\"#L586\">586</a></th><td><span class=\"k\">class</span>\u00a0<span class=\"nc\">VerifyingAdapterRegistry</span><span class=\"p\">(</span>BaseAdapterRegistry<span class=\"p\">):</span></td></tr><tr><th id=\"L587\"><a href=\"#L587\">587</a></th><td></td></tr><tr><th id=\"L588\"><a href=\"#L588\">588</a></th><td>\u00a0 \u00a0 LookupClass <span class=\"o\">=</span>\u00a0VerifyingAdapterLookup</td></tr><tr><th id=\"L589\"><a href=\"#L589\">589</a></th><td>\u00a0 \u00a0 </td></tr><tr><th id=\"L590\"><a href=\"#L590\">590</a></th><td><span class=\"k\">def</span>\u00a0<span class=\"nf\">_convert_None_to_Interface</span><span class=\"p\">(</span>x<span class=\"p\">):</span></td></tr><tr><th id=\"L591\"><a href=\"#L591\">591</a></th><td>\u00a0 \u00a0 <span class=\"k\">if</span>\u00a0x <span class=\"ow\">is</span>\u00a0<span class=\"bp\">None</span><span class=\"p\">:</span></td></tr><tr><th id=\"L592\"><a href=\"#L592\">592</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">return</span>\u00a0Interface</td></tr><tr><th id=\"L593\"><a href=\"#L593\">593</a></th><td>\u00a0 \u00a0 <span class=\"k\">else</span><span class=\"p\">:</span></td></tr><tr><th id=\"L594\"><a href=\"#L594\">594</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">return</span>\u00a0x</td></tr><tr><th id=\"L595\"><a href=\"#L595\">595</a></th><td></td></tr><tr><th id=\"L596\"><a href=\"#L596\">596</a></th><td><span class=\"k\">def</span>\u00a0<span class=\"nf\">_normalize_name</span><span class=\"p\">(</span>name<span class=\"p\">):</span></td></tr><tr><th id=\"L597\"><a href=\"#L597\">597</a></th><td>\u00a0 \u00a0 <span class=\"k\">if</span>\u00a0<span class=\"nb\">isinstance</span><span class=\"p\">(</span>name<span class=\"p\">,</span>\u00a0<span class=\"nb\">basestring</span><span class=\"p\">):</span></td></tr><tr><th id=\"L598\"><a href=\"#L598\">598</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">return</span>\u00a0<span class=\"nb\">unicode</span><span class=\"p\">(</span>name<span class=\"p\">)</span></td></tr><tr><th id=\"L599\"><a href=\"#L599\">599</a></th><td></td></tr><tr><th id=\"L600\"><a href=\"#L600\">600</a></th><td>\u00a0 \u00a0 <span class=\"k\">raise</span>\u00a0<span class=\"ne\">TypeError</span><span class=\"p\">(</span><span class=\"s\">\"name must be a regular or unicode string\"</span><span class=\"p\">)</span></td></tr><tr><th id=\"L601\"><a href=\"#L601\">601</a></th><td></td></tr><tr><th id=\"L602\"><a href=\"#L602\">602</a></th><td><span class=\"k\">def</span>\u00a0<span class=\"nf\">_lookup</span><span class=\"p\">(</span>components<span class=\"p\">,</span>\u00a0specs<span class=\"p\">,</span>\u00a0provided<span class=\"p\">,</span>\u00a0name<span class=\"p\">,</span>\u00a0i<span class=\"p\">,</span>\u00a0l<span class=\"p\">):</span></td></tr><tr><th id=\"L603\"><a href=\"#L603\">603</a></th><td>\u00a0 \u00a0 <span class=\"k\">if</span>\u00a0i <span class=\"o\">&lt;</span>\u00a0l<span class=\"p\">:</span></td></tr><tr><th id=\"L604\"><a href=\"#L604\">604</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">for</span>\u00a0spec <span class=\"ow\">in</span>\u00a0specs<span class=\"p\">[</span>i<span class=\"p\">]</span><span class=\"o\">.</span>__sro__<span class=\"p\">:</span></td></tr><tr><th id=\"L605\"><a href=\"#L605\">605</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 comps <span class=\"o\">=</span>\u00a0components<span class=\"o\">.</span>get<span class=\"p\">(</span>spec<span class=\"p\">)</span></td></tr><tr><th id=\"L606\"><a href=\"#L606\">606</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">if</span>\u00a0comps<span class=\"p\">:</span></td></tr><tr><th id=\"L607\"><a href=\"#L607\">607</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 r <span class=\"o\">=</span>\u00a0_lookup<span class=\"p\">(</span>comps<span class=\"p\">,</span>\u00a0specs<span class=\"p\">,</span>\u00a0provided<span class=\"p\">,</span>\u00a0name<span class=\"p\">,</span>\u00a0i<span class=\"o\">+</span><span class=\"mi\">1</span><span class=\"p\">,</span>\u00a0l<span class=\"p\">)</span></td></tr><tr><th id=\"L608\"><a href=\"#L608\">608</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">if</span>\u00a0r <span class=\"ow\">is</span>\u00a0<span class=\"ow\">not</span>\u00a0<span class=\"bp\">None</span><span class=\"p\">:</span></td></tr><tr><th id=\"L609\"><a href=\"#L609\">609</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">return</span>\u00a0r</td></tr><tr><th id=\"L610\"><a href=\"#L610\">610</a></th><td>\u00a0 \u00a0 <span class=\"k\">else</span><span class=\"p\">:</span></td></tr><tr><th id=\"L611\"><a href=\"#L611\">611</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">for</span>\u00a0iface <span class=\"ow\">in</span>\u00a0provided<span class=\"p\">:</span></td></tr><tr><th id=\"L612\"><a href=\"#L612\">612</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 comps <span class=\"o\">=</span>\u00a0components<span class=\"o\">.</span>get<span class=\"p\">(</span>iface<span class=\"p\">)</span></td></tr><tr><th id=\"L613\"><a href=\"#L613\">613</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">if</span>\u00a0comps<span class=\"p\">:</span></td></tr><tr><th id=\"L614\"><a href=\"#L614\">614</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 r <span class=\"o\">=</span>\u00a0comps<span class=\"o\">.</span>get<span class=\"p\">(</span>name<span class=\"p\">)</span></td></tr><tr><th id=\"L615\"><a href=\"#L615\">615</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">if</span>\u00a0r <span class=\"ow\">is</span>\u00a0<span class=\"ow\">not</span>\u00a0<span class=\"bp\">None</span><span class=\"p\">:</span></td></tr><tr><th id=\"L616\"><a href=\"#L616\">616</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">return</span>\u00a0r</td></tr><tr><th id=\"L617\"><a href=\"#L617\">617</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 </td></tr><tr><th id=\"L618\"><a href=\"#L618\">618</a></th><td>\u00a0 \u00a0 <span class=\"k\">return</span>\u00a0<span class=\"bp\">None</span></td></tr><tr><th id=\"L619\"><a href=\"#L619\">619</a></th><td></td></tr><tr><th id=\"L620\"><a href=\"#L620\">620</a></th><td><span class=\"k\">def</span>\u00a0<span class=\"nf\">_lookupAll</span><span class=\"p\">(</span>components<span class=\"p\">,</span>\u00a0specs<span class=\"p\">,</span>\u00a0provided<span class=\"p\">,</span>\u00a0result<span class=\"p\">,</span>\u00a0i<span class=\"p\">,</span>\u00a0l<span class=\"p\">):</span></td></tr><tr><th id=\"L621\"><a href=\"#L621\">621</a></th><td>\u00a0 \u00a0 <span class=\"k\">if</span>\u00a0i <span class=\"o\">&lt;</span>\u00a0l<span class=\"p\">:</span></td></tr><tr><th id=\"L622\"><a href=\"#L622\">622</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">for</span>\u00a0spec <span class=\"ow\">in</span>\u00a0<span class=\"nb\">reversed</span><span class=\"p\">(</span>specs<span class=\"p\">[</span>i<span class=\"p\">]</span><span class=\"o\">.</span>__sro__<span class=\"p\">):</span></td></tr><tr><th id=\"L623\"><a href=\"#L623\">623</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 comps <span class=\"o\">=</span>\u00a0components<span class=\"o\">.</span>get<span class=\"p\">(</span>spec<span class=\"p\">)</span></td></tr><tr><th id=\"L624\"><a href=\"#L624\">624</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">if</span>\u00a0comps<span class=\"p\">:</span></td></tr><tr><th id=\"L625\"><a href=\"#L625\">625</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 _lookupAll<span class=\"p\">(</span>comps<span class=\"p\">,</span>\u00a0specs<span class=\"p\">,</span>\u00a0provided<span class=\"p\">,</span>\u00a0result<span class=\"p\">,</span>\u00a0i<span class=\"o\">+</span><span class=\"mi\">1</span><span class=\"p\">,</span>\u00a0l<span class=\"p\">)</span></td></tr><tr><th id=\"L626\"><a href=\"#L626\">626</a></th><td>\u00a0 \u00a0 <span class=\"k\">else</span><span class=\"p\">:</span></td></tr><tr><th id=\"L627\"><a href=\"#L627\">627</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">for</span>\u00a0iface <span class=\"ow\">in</span>\u00a0<span class=\"nb\">reversed</span><span class=\"p\">(</span>provided<span class=\"p\">):</span></td></tr><tr><th id=\"L628\"><a href=\"#L628\">628</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 comps <span class=\"o\">=</span>\u00a0components<span class=\"o\">.</span>get<span class=\"p\">(</span>iface<span class=\"p\">)</span></td></tr><tr><th id=\"L629\"><a href=\"#L629\">629</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">if</span>\u00a0comps<span class=\"p\">:</span></td></tr><tr><th id=\"L630\"><a href=\"#L630\">630</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 result<span class=\"o\">.</span>update<span class=\"p\">(</span>comps<span class=\"p\">)</span></td></tr><tr><th id=\"L631\"><a href=\"#L631\">631</a></th><td></td></tr><tr><th id=\"L632\"><a href=\"#L632\">632</a></th><td><span class=\"k\">def</span>\u00a0<span class=\"nf\">_subscriptions</span><span class=\"p\">(</span>components<span class=\"p\">,</span>\u00a0specs<span class=\"p\">,</span>\u00a0provided<span class=\"p\">,</span>\u00a0name<span class=\"p\">,</span>\u00a0result<span class=\"p\">,</span>\u00a0i<span class=\"p\">,</span>\u00a0l<span class=\"p\">):</span></td></tr><tr><th id=\"L633\"><a href=\"#L633\">633</a></th><td>\u00a0 \u00a0 <span class=\"k\">if</span>\u00a0i <span class=\"o\">&lt;</span>\u00a0l<span class=\"p\">:</span></td></tr><tr><th id=\"L634\"><a href=\"#L634\">634</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">for</span>\u00a0spec <span class=\"ow\">in</span>\u00a0<span class=\"nb\">reversed</span><span class=\"p\">(</span>specs<span class=\"p\">[</span>i<span class=\"p\">]</span><span class=\"o\">.</span>__sro__<span class=\"p\">):</span></td></tr><tr><th id=\"L635\"><a href=\"#L635\">635</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 comps <span class=\"o\">=</span>\u00a0components<span class=\"o\">.</span>get<span class=\"p\">(</span>spec<span class=\"p\">)</span></td></tr><tr><th id=\"L636\"><a href=\"#L636\">636</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">if</span>\u00a0comps<span class=\"p\">:</span></td></tr><tr><th id=\"L637\"><a href=\"#L637\">637</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 _subscriptions<span class=\"p\">(</span>comps<span class=\"p\">,</span>\u00a0specs<span class=\"p\">,</span>\u00a0provided<span class=\"p\">,</span>\u00a0name<span class=\"p\">,</span>\u00a0result<span class=\"p\">,</span>\u00a0i<span class=\"o\">+</span><span class=\"mi\">1</span><span class=\"p\">,</span>\u00a0l<span class=\"p\">)</span></td></tr><tr><th id=\"L638\"><a href=\"#L638\">638</a></th><td>\u00a0 \u00a0 <span class=\"k\">else</span><span class=\"p\">:</span></td></tr><tr><th id=\"L639\"><a href=\"#L639\">639</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">for</span>\u00a0iface <span class=\"ow\">in</span>\u00a0<span class=\"nb\">reversed</span><span class=\"p\">(</span>provided<span class=\"p\">):</span></td></tr><tr><th id=\"L640\"><a href=\"#L640\">640</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 comps <span class=\"o\">=</span>\u00a0components<span class=\"o\">.</span>get<span class=\"p\">(</span>iface<span class=\"p\">)</span></td></tr><tr><th id=\"L641\"><a href=\"#L641\">641</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">if</span>\u00a0comps<span class=\"p\">:</span></td></tr><tr><th id=\"L642\"><a href=\"#L642\">642</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 comps <span class=\"o\">=</span>\u00a0comps<span class=\"o\">.</span>get<span class=\"p\">(</span>name<span class=\"p\">)</span></td></tr><tr><th id=\"L643\"><a href=\"#L643\">643</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">if</span>\u00a0comps<span class=\"p\">:</span></td></tr><tr><th id=\"L644\"><a href=\"#L644\">644</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 result<span class=\"o\">.</span>extend<span class=\"p\">(</span>comps<span class=\"p\">)</span></td></tr></tbody></table>\n\n      </div>\n      <div id=\"anydiff\">\n        <form action=\"/LUCICodeRepository/nomaticIM/diff\" method=\"get\">\n          <div class=\"buttons\">\n            <input type=\"hidden\" name=\"new_path\" value=\"/nomatic/tags/NomaticIM-0.0.5/buddy_bots/src/zope/interface/adapter.py\" />\n            <input type=\"hidden\" name=\"old_path\" value=\"/nomatic/tags/NomaticIM-0.0.5/buddy_bots/src/zope/interface/adapter.py\" />\n            <input type=\"hidden\" name=\"new_rev\" />\n            <input type=\"hidden\" name=\"old_rev\" />\n            <input type=\"submit\" value=\"View changes...\" title=\"Select paths and revs for Diff\" />\n          </div>\n        </form>\n      </div>\n      <div id=\"help\"><strong>Note:</strong> See <a href=\"/LUCICodeRepository/nomaticIM/wiki/TracBrowser\">TracBrowser</a>\n        for help on using the repository browser.</div>\n    </div>\n    <div id=\"altlinks\">\n      <h3>Download in other formats:</h3>\n      <ul>\n        <li class=\"first\">\n          <a rel=\"nofollow\" href=\"/LUCICodeRepository/nomaticIM/browser/nomatic/tags/NomaticIM-0.0.5/buddy_bots/src/zope/interface/adapter.py?format=txt\">Plain Text</a>\n        </li><li class=\"last\">\n          <a rel=\"nofollow\" href=\"/LUCICodeRepository/nomaticIM/export/1312/nomatic/tags/NomaticIM-0.0.5/buddy_bots/src/zope/interface/adapter.py\">Original Format</a>\n        </li>\n      </ul>\n    </div>\n    </div>\n    <div id=\"footer\" lang=\"en\" xml:lang=\"en\"><hr />\n      <a id=\"tracpowered\" href=\"http://trac.edgewall.org/\"><img src=\"/LUCICodeRepository/nomaticIM/chrome/common/trac_logo_mini.png\" height=\"30\" width=\"107\" alt=\"Trac Powered\" /></a>\n      <p class=\"left\">Powered by <a href=\"/LUCICodeRepository/nomaticIM/about\"><strong>Trac 1.0.1</strong></a><br />\n        By <a href=\"http://www.edgewall.org/\">Edgewall Software</a>.</p>\n      <p class=\"right\">All content copyright 2007-2008 by LUCI <br /><a href=\"http://luci.ics.uci.edu/\">http://luci.ics.uci.edu/</a></p>\n    </div>\n\t\t<div id=\"sitefooter\">\n\t\t\t<script src=\"http://www.google-analytics.com/urchin.js\" type=\"text/javascript\">\n\t\t\t</script>\n\t\t\t<script type=\"text/javascript\">\n\t\t\t\t_uacct = \"UA-338915-2\";\n\t\t\t\turchinTracker();\n\t\t\t</script>\n\t\t</div>\n\t</body>\n</html>", "id": 44283.0}