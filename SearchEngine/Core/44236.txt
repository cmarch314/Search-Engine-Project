{"text": "Search LoginPreferencesHelp GuideAbout Trac WikiTimelineRoadmapBrowse SourceView TicketsSearch Context Navigation BlameRevision Log source nomatic tags NomaticIM 5 buddy bots src twisted python hook py View diff against View revision Visit trunk Last change on this file was 712 checked in by cbaker 7 years ago First draft of nomatic buddy bots oscar bot is functional if you give it good authentication credentials jabber bot is just an example from the web File size 5 1 KB Line 12 Copyright c 2 1 2 4 Twisted Matrix Laboratories 3 See LICENSE for details 4567 8I define support for hookable instance methods 91 These are methods which you can register pre call and post call external11functions to augment their functionality People familiar with more esoteric12languages may think of these as method combinations 1314This could be used to add optional preconditions user extensible callbacks15 a la emacs or a thread safety mechanism 1617The four exported calls are 1819 L addPre 2 L addPost 21 L removePre 22 L removePost 2324All have the signature class methodName callable and the callable they25take must always have the signature instance args kw unless the26particular signature of the method they hook is known 2728Hooks should typically not throw exceptions however no effort will be made by29this module to prevent them from doing so Pre hooks will always be called 3 but post hooks will only be called if the pre hooks do not raise any exceptions31 they will still be called if the main method raises an exception The return32values and exception status of the main method will be propogated assuming33none of the hooks raise an exception Hooks will be executed in the order in34which they are added 3536 3738 System Imports39import string4 41 Public Interface4243class HookError Exception 44 An error which will fire when an invariant is violated 4546def addPre klass name func 47 hook addPre klass name func None4849 Add a function to be called before the method klass name is invoked 5 5152 addHook klass name PRE func 5354def addPost klass name func 55 hook addPost klass name func None5657 Add a function to be called after the method klass name is invoked 58 59 addHook klass name POST func 6 61def removePre klass name func 62 hook removePre klass name func None6364 Remove a function previously registered with addPre so that it65 is no longer executed before klass name 66 6768 removeHook klass name PRE func 697 def removePost klass name func 71 hook removePre klass name func None7273 Remove a function previously registered with addPost so that it74 is no longer executed after klass name 75 76 removeHook klass name POST func 7778 Helper functions 798 hooked func 8182import module s8384def name s args kw 85 klazz module s klass s86 for preMethod in klazz preName s 87 preMethod args kw 88 try 89 return klazz originalName s args kw 9 finally 91 for postMethod in klazz postName s 92 postMethod args kw 93 9495 PRE hook pre s s s 96 POST hook post s s s 97 ORIG hook orig s s s 98991 def XXX k n s 1 1 string manipulation garbage 1 2 x s string replace k module k name n 1 3 return x1 41 5def PRE k n 1 6 private munging to turn a method name into a pre hook method name 1 7 return XXX k n PRE 1 81 9def POST k n 11 private munging to turn a method name into a post hook method name 111 return XXX k n POST 112113def ORIG k n 114 private munging to turn a method name into an original identifier 115 return XXX k n ORIG 116117118def addHook klass name phase func 119 private adds a hook to a method on a class 12 enhook klass name 121122 if not hasattr klass phase klass name 123 setattr klass phase klass name 124125 phaselist getattr klass phase klass name 126 phaselist append func 127128129def removeHook klass name phase func 13 private removes a hook from a method on a class 131 phaselistname phase klass name 132 if not hasattr klass ORIG klass name 133 raise HookError no hooks present 134135 phaselist getattr klass phase klass name 136 try phaselist remove func 137 except ValueError 138 raise HookError hook s not found in removal list for s 139 name klass 14 141 if not getattr klass PRE klass name and not getattr klass POST klass name 142 dehook klass name 143144def enhook klass name 145 private causes a certain method name to be hooked on a class 146 if hasattr klass ORIG klass name 147 return148149 def newfunc args kw 15 for preMethod in getattr klass PRE klass name 151 preMethod args kw 152 try 153 return getattr klass ORIG klass name args kw 154 finally 155 for postMethod in getattr klass POST klass name 156 postMethod args kw 157 try 158 newfunc func name name159 except TypeError 16 Older python s don t let you do this161 pass162163 oldfunc getattr klass name im func164 setattr klass ORIG klass name oldfunc 165 setattr klass PRE klass name 166 setattr klass POST klass name 167 setattr klass name newfunc 168169def dehook klass name 17 private causes a certain method name no longer to be hooked on a class 171172 if not hasattr klass ORIG klass name 173 raise HookError Cannot unhook 174 setattr klass name getattr klass ORIG klass name 175 delattr klass PRE klass name 176 delattr klass POST klass name 177 delattr klass ORIG klass name Note See TracBrowser for help on using the repository browser Download in other formats Plain Text Original Format Powered by Trac 1 1 By Edgewall Software All content copyright 2 7 2 8 by LUCI http luci ics uci edu ", "_id": "http://djp3-pc2.ics.uci.edu/LUCICodeRepository/nomaticIM/browser/nomatic/tags/NomaticIM-0.0.5/buddy_bots/src/twisted/python/hook.py", "title": "\n      hook.py in nomatic/tags/nomaticim-0.0.5/buddy_bots/src/twisted/python\n     \u2013 nomatic*im\n    ", "html": "<!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Strict//EN\" \"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd\">\n<html xmlns=\"http://www.w3.org/1999/xhtml\">\n  \n  \n\n  \n\n\n  <head>\n\t\t<title>\n      hook.py in nomatic/tags/NomaticIM-0.0.5/buddy_bots/src/twisted/python\n     \u2013 Nomatic*IM\n    </title><meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\" /><meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge\" /><link rel=\"search\" href=\"/LUCICodeRepository/nomaticIM/search\" /><link rel=\"help\" href=\"/LUCICodeRepository/nomaticIM/wiki/TracGuide\" /><link rel=\"alternate\" href=\"/LUCICodeRepository/nomaticIM/browser/nomatic/tags/NomaticIM-0.0.5/buddy_bots/src/twisted/python/hook.py?format=txt\" type=\"text/plain\" title=\"Plain Text\" /><link rel=\"alternate\" href=\"/LUCICodeRepository/nomaticIM/export/1312/nomatic/tags/NomaticIM-0.0.5/buddy_bots/src/twisted/python/hook.py\" type=\"application/x-python; charset=iso-8859-15\" title=\"Original Format\" /><link rel=\"start\" href=\"/LUCICodeRepository/nomaticIM/wiki\" /><link rel=\"stylesheet\" href=\"/LUCICodeRepository/nomaticIM/chrome/common/css/trac.css\" type=\"text/css\" /><link rel=\"stylesheet\" href=\"/LUCICodeRepository/nomaticIM/chrome/common/css/code.css\" type=\"text/css\" /><link rel=\"stylesheet\" href=\"/LUCICodeRepository/nomaticIM/pygments/trac.css\" type=\"text/css\" /><link rel=\"stylesheet\" href=\"/LUCICodeRepository/nomaticIM/chrome/common/css/browser.css\" type=\"text/css\" /><link rel=\"shortcut icon\" href=\"http://luci.ics.uci.edu/logo32by32.gif\" type=\"image/gif\" /><link rel=\"icon\" href=\"http://luci.ics.uci.edu/logo32by32.gif\" type=\"image/gif\" /><link type=\"application/opensearchdescription+xml\" rel=\"search\" href=\"/LUCICodeRepository/nomaticIM/search/opensearch\" title=\"Search Nomatic*IM\" /><script type=\"text/javascript\" charset=\"utf-8\" src=\"/LUCICodeRepository/nomaticIM/chrome/common/js/jquery.js\"></script><script type=\"text/javascript\" charset=\"utf-8\" src=\"/LUCICodeRepository/nomaticIM/chrome/common/js/babel.js\"></script><script type=\"text/javascript\" charset=\"utf-8\" src=\"/LUCICodeRepository/nomaticIM/chrome/common/js/messages/en_US.js\"></script><script type=\"text/javascript\" charset=\"utf-8\" src=\"/LUCICodeRepository/nomaticIM/chrome/common/js/trac.js\"></script><script type=\"text/javascript\" charset=\"utf-8\" src=\"/LUCICodeRepository/nomaticIM/chrome/common/js/search.js\"></script><script type=\"text/javascript\" src=\"/LUCICodeRepository/nomaticIM/chrome/common/js/folding.js\"></script><script type=\"text/javascript\">\n      jQuery(document).ready(function($) {\n        $(\".trac-toggledeleted\").show().click(function() {\n                  $(this).siblings().find(\".trac-deleted\").toggle();\n                  return false;\n        }).click();\n        $(\"#jumploc input\").hide();\n        $(\"#jumploc select\").change(function () {\n          this.parentNode.parentNode.submit();\n        });\n          $('#preview table.code').enableCollapsibleColumns($('#preview table.code thead th.content'));\n      });\n    </script>\n\t</head>\n  <body>\n    <div id=\"banner\">\n      <div id=\"header\">\n        <a id=\"logo\" href=\"http://luci.ics.uci.edu/#code\"><img src=\"http://luci.ics.uci.edu/blog/archives/LUCIhorzTight.jpg\" alt=\"LUCI Code Repository\" /></a>\n      </div>\n      <form id=\"search\" action=\"/LUCICodeRepository/nomaticIM/search\" method=\"get\">\n        <div>\n          <label for=\"proj-search\">Search:</label>\n          <input type=\"text\" id=\"proj-search\" name=\"q\" size=\"18\" value=\"\" />\n          <input type=\"submit\" value=\"Search\" />\n        </div>\n      </form>\n      <div id=\"metanav\" class=\"nav\">\n    <ul>\n      <li class=\"first\"><a href=\"/LUCICodeRepository/nomaticIM/login\">Login</a></li><li><a href=\"/LUCICodeRepository/nomaticIM/prefs\">Preferences</a></li><li><a href=\"/LUCICodeRepository/nomaticIM/wiki/TracGuide\">Help/Guide</a></li><li class=\"last\"><a href=\"/LUCICodeRepository/nomaticIM/about\">About Trac</a></li>\n    </ul>\n  </div>\n    </div>\n    <div id=\"mainnav\" class=\"nav\">\n    <ul>\n      <li class=\"first\"><a href=\"/LUCICodeRepository/nomaticIM/wiki\">Wiki</a></li><li><a href=\"/LUCICodeRepository/nomaticIM/timeline\">Timeline</a></li><li><a href=\"/LUCICodeRepository/nomaticIM/roadmap\">Roadmap</a></li><li class=\"active\"><a href=\"/LUCICodeRepository/nomaticIM/browser\">Browse Source</a></li><li><a href=\"/LUCICodeRepository/nomaticIM/report\">View Tickets</a></li><li class=\"last\"><a href=\"/LUCICodeRepository/nomaticIM/search\">Search</a></li>\n    </ul>\n  </div>\n    <div id=\"main\">\n      <div id=\"ctxtnav\" class=\"nav\">\n        <h2>Context Navigation</h2>\n        <ul>\n          <li class=\"first\"><a href=\"/LUCICodeRepository/nomaticIM/browser/nomatic/trunk/buddy_bots/twisted/python/hook.py?annotate=blame\" title=\"Annotate each line with the last changed revision (this can be time consuming...)\">Blame</a></li><li class=\"last\"><a href=\"/LUCICodeRepository/nomaticIM/log/nomatic/tags/NomaticIM-0.0.5/buddy_bots/src/twisted/python/hook.py\">Revision Log</a></li>\n        </ul>\n        <hr />\n      </div>\n    <div id=\"content\" class=\"browser\">\n        <h1>\n          \n<a class=\"pathentry first\" href=\"/LUCICodeRepository/nomaticIM/browser?order=name\" title=\"Go to repository root\">source:</a>\n<a class=\"pathentry\" href=\"/LUCICodeRepository/nomaticIM/browser/nomatic?order=name\" title=\"View nomatic\">nomatic</a><span class=\"pathentry sep\">/</span><a class=\"pathentry\" href=\"/LUCICodeRepository/nomaticIM/browser/nomatic/tags?order=name\" title=\"View tags\">tags</a><span class=\"pathentry sep\">/</span><a class=\"pathentry\" href=\"/LUCICodeRepository/nomaticIM/browser/nomatic/tags/NomaticIM-0.0.5?order=name\" title=\"View NomaticIM-0.0.5\">NomaticIM-0.0.5</a><span class=\"pathentry sep\">/</span><a class=\"pathentry\" href=\"/LUCICodeRepository/nomaticIM/browser/nomatic/tags/NomaticIM-0.0.5/buddy_bots?order=name\" title=\"View buddy_bots\">buddy_bots</a><span class=\"pathentry sep\">/</span><a class=\"pathentry\" href=\"/LUCICodeRepository/nomaticIM/browser/nomatic/tags/NomaticIM-0.0.5/buddy_bots/src?order=name\" title=\"View src\">src</a><span class=\"pathentry sep\">/</span><a class=\"pathentry\" href=\"/LUCICodeRepository/nomaticIM/browser/nomatic/tags/NomaticIM-0.0.5/buddy_bots/src/twisted?order=name\" title=\"View twisted\">twisted</a><span class=\"pathentry sep\">/</span><a class=\"pathentry\" href=\"/LUCICodeRepository/nomaticIM/browser/nomatic/tags/NomaticIM-0.0.5/buddy_bots/src/twisted/python?order=name\" title=\"View python\">python</a><span class=\"pathentry sep\">/</span><a class=\"pathentry\" href=\"/LUCICodeRepository/nomaticIM/browser/nomatic/tags/NomaticIM-0.0.5/buddy_bots/src/twisted/python/hook.py?order=name\" title=\"View hook.py\">hook.py</a>\n<br style=\"clear: both\" />\n\n        </h1>\n        <div id=\"diffrev\">\n          <form action=\"/LUCICodeRepository/nomaticIM/changeset\" method=\"get\">\n            <div>\n              <label title=\"Show the diff against a specific revision\">\n                View diff against: <input type=\"text\" name=\"old\" size=\"6\" />\n                <input type=\"hidden\" name=\"old_path\" value=\"nomatic/tags/NomaticIM-0.0.5/buddy_bots/src/twisted/python/hook.py\" />\n                <input type=\"hidden\" name=\"new\" />\n                <input type=\"hidden\" name=\"new_path\" value=\"nomatic/tags/NomaticIM-0.0.5/buddy_bots/src/twisted/python/hook.py\" />\n              </label>\n            </div>\n          </form>\n        </div>\n        <div id=\"jumprev\">\n          <form action=\"\" method=\"get\">\n            <div>\n              <label for=\"rev\">\n                View revision:</label>\n              <input type=\"text\" id=\"rev\" name=\"rev\" size=\"6\" />\n            </div>\n          </form>\n        </div>\n        <div id=\"jumploc\">\n          <form action=\"\" method=\"get\">\n            <div class=\"buttons\">\n              <label for=\"preselected\">Visit:</label>\n              <select id=\"preselected\" name=\"preselected\">\n                <option selected=\"selected\"></option>\n                <optgroup label=\"branches\">\n                  <option value=\"/LUCICodeRepository/nomaticIM/browser/trunk\">trunk</option>\n                </optgroup>\n              </select>\n              <input type=\"submit\" value=\"Go!\" title=\"Jump to the chosen preselected path\" />\n            </div>\n          </form>\n        </div>\n        <div class=\"trac-tags\">\n        </div>\n      <table id=\"info\" summary=\"Revision info\">\n        <tr>\n          <th>\n                <a href=\"/LUCICodeRepository/nomaticIM/changeset/712/nomatic/trunk/buddy_bots/twisted/python/hook.py\" title=\"View differences\">Last change</a>\n                  on this file was\n                  <a href=\"/LUCICodeRepository/nomaticIM/changeset/712/\" title=\"View changeset 712\">712</a>,\n                  checked in by cbaker, <a class=\"timeline\" href=\"/LUCICodeRepository/nomaticIM/timeline?from=2008-02-16T08%3A16%3A53-08%3A00&amp;precision=second\" title=\"See timeline at Feb 16, 2008, 8:16:53 AM\">7 years ago</a>\n          </th>\n        </tr>\n        <tr>\n          <td class=\"message searchable\">\n              <p>\nFirst draft of nomatic buddy bots. oscar_bot is functional if you give it good authentication credentials, jabber_bot is just an example from the web <br />\n</p>\n          </td>\n        </tr>\n        <tr><td colspan=\"2\">\n            <strong>File size:</strong>\n            <span title=\"5266 bytes\">5.1 KB</span>\n          </td></tr>\n      </table>\n      <div id=\"preview\" class=\"searchable\">\n        \n  <table class=\"code\"><thead><tr><th class=\"lineno\" title=\"Line numbers\">Line</th><th class=\"content\">\u00a0</th></tr></thead><tbody><tr><th id=\"L1\"><a href=\"#L1\">1</a></th><td></td></tr><tr><th id=\"L2\"><a href=\"#L2\">2</a></th><td><span class=\"c\"># Copyright (c) 2001-2004 Twisted Matrix Laboratories.</span></td></tr><tr><th id=\"L3\"><a href=\"#L3\">3</a></th><td><span class=\"c\"># See LICENSE for details.</span></td></tr><tr><th id=\"L4\"><a href=\"#L4\">4</a></th><td></td></tr><tr><th id=\"L5\"><a href=\"#L5\">5</a></th><td></td></tr><tr><th id=\"L6\"><a href=\"#L6\">6</a></th><td></td></tr><tr><th id=\"L7\"><a href=\"#L7\">7</a></th><td><span class=\"sd\">\"\"\"</span></td></tr><tr><th id=\"L8\"><a href=\"#L8\">8</a></th><td><span class=\"sd\">I define support for hookable instance methods.</span></td></tr><tr><th id=\"L9\"><a href=\"#L9\">9</a></th><td><span class=\"sd\"></span></td></tr><tr><th id=\"L10\"><a href=\"#L10\">10</a></th><td><span class=\"sd\">These are methods which you can register pre-call and post-call external</span></td></tr><tr><th id=\"L11\"><a href=\"#L11\">11</a></th><td><span class=\"sd\">functions to augment their functionality.\u00a0 People familiar with more esoteric</span></td></tr><tr><th id=\"L12\"><a href=\"#L12\">12</a></th><td><span class=\"sd\">languages may think of these as \\\"method combinations\\\".</span></td></tr><tr><th id=\"L13\"><a href=\"#L13\">13</a></th><td><span class=\"sd\"></span></td></tr><tr><th id=\"L14\"><a href=\"#L14\">14</a></th><td><span class=\"sd\">This could be used to add optional preconditions, user-extensible callbacks</span></td></tr><tr><th id=\"L15\"><a href=\"#L15\">15</a></th><td><span class=\"sd\">(a-la emacs) or a thread-safety mechanism.</span></td></tr><tr><th id=\"L16\"><a href=\"#L16\">16</a></th><td><span class=\"sd\"></span></td></tr><tr><th id=\"L17\"><a href=\"#L17\">17</a></th><td><span class=\"sd\">The four exported calls are:</span></td></tr><tr><th id=\"L18\"><a href=\"#L18\">18</a></th><td><span class=\"sd\"></span></td></tr><tr><th id=\"L19\"><a href=\"#L19\">19</a></th><td><span class=\"sd\">\u00a0 \u00a0- L{addPre}</span></td></tr><tr><th id=\"L20\"><a href=\"#L20\">20</a></th><td><span class=\"sd\">\u00a0 \u00a0- L{addPost}</span></td></tr><tr><th id=\"L21\"><a href=\"#L21\">21</a></th><td><span class=\"sd\">\u00a0 \u00a0- L{removePre}</span></td></tr><tr><th id=\"L22\"><a href=\"#L22\">22</a></th><td><span class=\"sd\">\u00a0 \u00a0- L{removePost}</span></td></tr><tr><th id=\"L23\"><a href=\"#L23\">23</a></th><td><span class=\"sd\"></span></td></tr><tr><th id=\"L24\"><a href=\"#L24\">24</a></th><td><span class=\"sd\">All have the signature (class, methodName, callable), and the callable they</span></td></tr><tr><th id=\"L25\"><a href=\"#L25\">25</a></th><td><span class=\"sd\">take must always have the signature (instance, *args, **kw) unless the</span></td></tr><tr><th id=\"L26\"><a href=\"#L26\">26</a></th><td><span class=\"sd\">particular signature of the method they hook is known.</span></td></tr><tr><th id=\"L27\"><a href=\"#L27\">27</a></th><td><span class=\"sd\"></span></td></tr><tr><th id=\"L28\"><a href=\"#L28\">28</a></th><td><span class=\"sd\">Hooks should typically not throw exceptions, however, no effort will be made by</span></td></tr><tr><th id=\"L29\"><a href=\"#L29\">29</a></th><td><span class=\"sd\">this module to prevent them from doing so.\u00a0 Pre-hooks will always be called,</span></td></tr><tr><th id=\"L30\"><a href=\"#L30\">30</a></th><td><span class=\"sd\">but post-hooks will only be called if the pre-hooks do not raise any exceptions</span></td></tr><tr><th id=\"L31\"><a href=\"#L31\">31</a></th><td><span class=\"sd\">(they will still be called if the main method raises an exception).\u00a0 The return</span></td></tr><tr><th id=\"L32\"><a href=\"#L32\">32</a></th><td><span class=\"sd\">values and exception status of the main method will be propogated (assuming</span></td></tr><tr><th id=\"L33\"><a href=\"#L33\">33</a></th><td><span class=\"sd\">none of the hooks raise an exception).\u00a0 Hooks will be executed in the order in</span></td></tr><tr><th id=\"L34\"><a href=\"#L34\">34</a></th><td><span class=\"sd\">which they are added.</span></td></tr><tr><th id=\"L35\"><a href=\"#L35\">35</a></th><td><span class=\"sd\"></span></td></tr><tr><th id=\"L36\"><a href=\"#L36\">36</a></th><td><span class=\"sd\">\"\"\"</span></td></tr><tr><th id=\"L37\"><a href=\"#L37\">37</a></th><td></td></tr><tr><th id=\"L38\"><a href=\"#L38\">38</a></th><td><span class=\"c\"># System Imports</span></td></tr><tr><th id=\"L39\"><a href=\"#L39\">39</a></th><td><span class=\"kn\">import</span>\u00a0<span class=\"nn\">string</span></td></tr><tr><th id=\"L40\"><a href=\"#L40\">40</a></th><td></td></tr><tr><th id=\"L41\"><a href=\"#L41\">41</a></th><td><span class=\"c\">### Public Interface</span></td></tr><tr><th id=\"L42\"><a href=\"#L42\">42</a></th><td></td></tr><tr><th id=\"L43\"><a href=\"#L43\">43</a></th><td><span class=\"k\">class</span>\u00a0<span class=\"nc\">HookError</span><span class=\"p\">(</span><span class=\"ne\">Exception</span><span class=\"p\">):</span></td></tr><tr><th id=\"L44\"><a href=\"#L44\">44</a></th><td>\u00a0 \u00a0 <span class=\"s\">\"An error which will fire when an invariant is violated.\"</span></td></tr><tr><th id=\"L45\"><a href=\"#L45\">45</a></th><td></td></tr><tr><th id=\"L46\"><a href=\"#L46\">46</a></th><td><span class=\"k\">def</span>\u00a0<span class=\"nf\">addPre</span><span class=\"p\">(</span>klass<span class=\"p\">,</span>\u00a0name<span class=\"p\">,</span>\u00a0func<span class=\"p\">):</span></td></tr><tr><th id=\"L47\"><a href=\"#L47\">47</a></th><td>\u00a0 \u00a0 <span class=\"sd\">\"\"\"hook.addPre(klass, name, func) -&gt; None</span></td></tr><tr><th id=\"L48\"><a href=\"#L48\">48</a></th><td><span class=\"sd\"></span></td></tr><tr><th id=\"L49\"><a href=\"#L49\">49</a></th><td><span class=\"sd\">\u00a0 \u00a0 Add a function to be called before the method klass.name is invoked.</span></td></tr><tr><th id=\"L50\"><a href=\"#L50\">50</a></th><td><span class=\"sd\">\u00a0 \u00a0 \"\"\"</span></td></tr><tr><th id=\"L51\"><a href=\"#L51\">51</a></th><td></td></tr><tr><th id=\"L52\"><a href=\"#L52\">52</a></th><td>\u00a0 \u00a0 _addHook<span class=\"p\">(</span>klass<span class=\"p\">,</span>\u00a0name<span class=\"p\">,</span>\u00a0PRE<span class=\"p\">,</span>\u00a0func<span class=\"p\">)</span></td></tr><tr><th id=\"L53\"><a href=\"#L53\">53</a></th><td></td></tr><tr><th id=\"L54\"><a href=\"#L54\">54</a></th><td><span class=\"k\">def</span>\u00a0<span class=\"nf\">addPost</span><span class=\"p\">(</span>klass<span class=\"p\">,</span>\u00a0name<span class=\"p\">,</span>\u00a0func<span class=\"p\">):</span></td></tr><tr><th id=\"L55\"><a href=\"#L55\">55</a></th><td>\u00a0 \u00a0 <span class=\"sd\">\"\"\"hook.addPost(klass, name, func) -&gt; None</span></td></tr><tr><th id=\"L56\"><a href=\"#L56\">56</a></th><td><span class=\"sd\"></span></td></tr><tr><th id=\"L57\"><a href=\"#L57\">57</a></th><td><span class=\"sd\">\u00a0 \u00a0 Add a function to be called after the method klass.name is invoked.</span></td></tr><tr><th id=\"L58\"><a href=\"#L58\">58</a></th><td><span class=\"sd\">\u00a0 \u00a0 \"\"\"</span></td></tr><tr><th id=\"L59\"><a href=\"#L59\">59</a></th><td>\u00a0 \u00a0 _addHook<span class=\"p\">(</span>klass<span class=\"p\">,</span>\u00a0name<span class=\"p\">,</span>\u00a0POST<span class=\"p\">,</span>\u00a0func<span class=\"p\">)</span></td></tr><tr><th id=\"L60\"><a href=\"#L60\">60</a></th><td></td></tr><tr><th id=\"L61\"><a href=\"#L61\">61</a></th><td><span class=\"k\">def</span>\u00a0<span class=\"nf\">removePre</span><span class=\"p\">(</span>klass<span class=\"p\">,</span>\u00a0name<span class=\"p\">,</span>\u00a0func<span class=\"p\">):</span></td></tr><tr><th id=\"L62\"><a href=\"#L62\">62</a></th><td>\u00a0 \u00a0 <span class=\"sd\">\"\"\"hook.removePre(klass, name, func) -&gt; None</span></td></tr><tr><th id=\"L63\"><a href=\"#L63\">63</a></th><td><span class=\"sd\"></span></td></tr><tr><th id=\"L64\"><a href=\"#L64\">64</a></th><td><span class=\"sd\">\u00a0 \u00a0 Remove a function (previously registered with addPre) so that it</span></td></tr><tr><th id=\"L65\"><a href=\"#L65\">65</a></th><td><span class=\"sd\">\u00a0 \u00a0 is no longer executed before klass.name.</span></td></tr><tr><th id=\"L66\"><a href=\"#L66\">66</a></th><td><span class=\"sd\">\u00a0 \u00a0 \"\"\"</span></td></tr><tr><th id=\"L67\"><a href=\"#L67\">67</a></th><td></td></tr><tr><th id=\"L68\"><a href=\"#L68\">68</a></th><td>\u00a0 \u00a0 _removeHook<span class=\"p\">(</span>klass<span class=\"p\">,</span>\u00a0name<span class=\"p\">,</span>\u00a0PRE<span class=\"p\">,</span>\u00a0func<span class=\"p\">)</span></td></tr><tr><th id=\"L69\"><a href=\"#L69\">69</a></th><td></td></tr><tr><th id=\"L70\"><a href=\"#L70\">70</a></th><td><span class=\"k\">def</span>\u00a0<span class=\"nf\">removePost</span><span class=\"p\">(</span>klass<span class=\"p\">,</span>\u00a0name<span class=\"p\">,</span>\u00a0func<span class=\"p\">):</span></td></tr><tr><th id=\"L71\"><a href=\"#L71\">71</a></th><td>\u00a0 \u00a0 <span class=\"sd\">\"\"\"hook.removePre(klass, name, func) -&gt; None</span></td></tr><tr><th id=\"L72\"><a href=\"#L72\">72</a></th><td><span class=\"sd\"></span></td></tr><tr><th id=\"L73\"><a href=\"#L73\">73</a></th><td><span class=\"sd\">\u00a0 \u00a0 Remove a function (previously registered with addPost) so that it</span></td></tr><tr><th id=\"L74\"><a href=\"#L74\">74</a></th><td><span class=\"sd\">\u00a0 \u00a0 is no longer executed after klass.name.</span></td></tr><tr><th id=\"L75\"><a href=\"#L75\">75</a></th><td><span class=\"sd\">\u00a0 \u00a0 \"\"\"</span></td></tr><tr><th id=\"L76\"><a href=\"#L76\">76</a></th><td>\u00a0 \u00a0 _removeHook<span class=\"p\">(</span>klass<span class=\"p\">,</span>\u00a0name<span class=\"p\">,</span>\u00a0POST<span class=\"p\">,</span>\u00a0func<span class=\"p\">)</span></td></tr><tr><th id=\"L77\"><a href=\"#L77\">77</a></th><td></td></tr><tr><th id=\"L78\"><a href=\"#L78\">78</a></th><td><span class=\"c\">### \"Helper\" functions.</span></td></tr><tr><th id=\"L79\"><a href=\"#L79\">79</a></th><td></td></tr><tr><th id=\"L80\"><a href=\"#L80\">80</a></th><td>hooked_func <span class=\"o\">=</span>\u00a0<span class=\"s\">\"\"\"</span></td></tr><tr><th id=\"L81\"><a href=\"#L81\">81</a></th><td><span class=\"s\"></span></td></tr><tr><th id=\"L82\"><a href=\"#L82\">82</a></th><td><span class=\"s\">import </span><span class=\"si\">%(module)s</span><span class=\"s\"></span></td></tr><tr><th id=\"L83\"><a href=\"#L83\">83</a></th><td><span class=\"s\"></span></td></tr><tr><th id=\"L84\"><a href=\"#L84\">84</a></th><td><span class=\"s\">def </span><span class=\"si\">%(name)s</span><span class=\"s\">(*args, **kw):</span></td></tr><tr><th id=\"L85\"><a href=\"#L85\">85</a></th><td><span class=\"s\">\u00a0 \u00a0 klazz = </span><span class=\"si\">%(module)s</span><span class=\"s\">.</span><span class=\"si\">%(klass)s</span><span class=\"s\"></span></td></tr><tr><th id=\"L86\"><a href=\"#L86\">86</a></th><td><span class=\"s\">\u00a0 \u00a0 for preMethod in klazz.</span><span class=\"si\">%(preName)s</span><span class=\"s\">:</span></td></tr><tr><th id=\"L87\"><a href=\"#L87\">87</a></th><td><span class=\"s\">\u00a0 \u00a0 \u00a0 \u00a0 preMethod(*args, **kw)</span></td></tr><tr><th id=\"L88\"><a href=\"#L88\">88</a></th><td><span class=\"s\">\u00a0 \u00a0 try:</span></td></tr><tr><th id=\"L89\"><a href=\"#L89\">89</a></th><td><span class=\"s\">\u00a0 \u00a0 \u00a0 \u00a0 return klazz.</span><span class=\"si\">%(originalName)s</span><span class=\"s\">(*args, **kw)</span></td></tr><tr><th id=\"L90\"><a href=\"#L90\">90</a></th><td><span class=\"s\">\u00a0 \u00a0 finally:</span></td></tr><tr><th id=\"L91\"><a href=\"#L91\">91</a></th><td><span class=\"s\">\u00a0 \u00a0 \u00a0 \u00a0 for postMethod in klazz.</span><span class=\"si\">%(postName)s</span><span class=\"s\">:</span></td></tr><tr><th id=\"L92\"><a href=\"#L92\">92</a></th><td><span class=\"s\">\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 postMethod(*args, **kw)</span></td></tr><tr><th id=\"L93\"><a href=\"#L93\">93</a></th><td><span class=\"s\">\"\"\"</span></td></tr><tr><th id=\"L94\"><a href=\"#L94\">94</a></th><td></td></tr><tr><th id=\"L95\"><a href=\"#L95\">95</a></th><td>_PRE <span class=\"o\">=</span>\u00a0<span class=\"s\">'__hook_pre_</span><span class=\"si\">%s</span><span class=\"s\">_</span><span class=\"si\">%s</span><span class=\"s\">_</span><span class=\"si\">%s</span><span class=\"s\">__'</span></td></tr><tr><th id=\"L96\"><a href=\"#L96\">96</a></th><td>_POST <span class=\"o\">=</span>\u00a0<span class=\"s\">'__hook_post_</span><span class=\"si\">%s</span><span class=\"s\">_</span><span class=\"si\">%s</span><span class=\"s\">_</span><span class=\"si\">%s</span><span class=\"s\">__'</span></td></tr><tr><th id=\"L97\"><a href=\"#L97\">97</a></th><td>_ORIG <span class=\"o\">=</span>\u00a0<span class=\"s\">'__hook_orig_</span><span class=\"si\">%s</span><span class=\"s\">_</span><span class=\"si\">%s</span><span class=\"s\">_</span><span class=\"si\">%s</span><span class=\"s\">__'</span></td></tr><tr><th id=\"L98\"><a href=\"#L98\">98</a></th><td></td></tr><tr><th id=\"L99\"><a href=\"#L99\">99</a></th><td></td></tr><tr><th id=\"L100\"><a href=\"#L100\">100</a></th><td><span class=\"k\">def</span>\u00a0<span class=\"nf\">_XXX</span><span class=\"p\">(</span>k<span class=\"p\">,</span>n<span class=\"p\">,</span>s<span class=\"p\">):</span></td></tr><tr><th id=\"L101\"><a href=\"#L101\">101</a></th><td>\u00a0 \u00a0 <span class=\"s\">\"string manipulation garbage\"</span></td></tr><tr><th id=\"L102\"><a href=\"#L102\">102</a></th><td>\u00a0 \u00a0 x <span class=\"o\">=</span>\u00a0s <span class=\"o\">%</span>\u00a0<span class=\"p\">(</span>string<span class=\"o\">.</span>replace<span class=\"p\">(</span>k<span class=\"o\">.</span>__module__<span class=\"p\">,</span><span class=\"s\">'.'</span><span class=\"p\">,</span><span class=\"s\">'_'</span><span class=\"p\">),</span>\u00a0k<span class=\"o\">.</span>__name__<span class=\"p\">,</span>\u00a0n<span class=\"p\">)</span></td></tr><tr><th id=\"L103\"><a href=\"#L103\">103</a></th><td>\u00a0 \u00a0 <span class=\"k\">return</span>\u00a0x</td></tr><tr><th id=\"L104\"><a href=\"#L104\">104</a></th><td></td></tr><tr><th id=\"L105\"><a href=\"#L105\">105</a></th><td><span class=\"k\">def</span>\u00a0<span class=\"nf\">PRE</span><span class=\"p\">(</span>k<span class=\"p\">,</span>n<span class=\"p\">):</span></td></tr><tr><th id=\"L106\"><a href=\"#L106\">106</a></th><td>\u00a0 \u00a0 <span class=\"s\">\"(private) munging to turn a method name into a pre-hook-method-name\"</span></td></tr><tr><th id=\"L107\"><a href=\"#L107\">107</a></th><td>\u00a0 \u00a0 <span class=\"k\">return</span>\u00a0_XXX<span class=\"p\">(</span>k<span class=\"p\">,</span>n<span class=\"p\">,</span>_PRE<span class=\"p\">)</span></td></tr><tr><th id=\"L108\"><a href=\"#L108\">108</a></th><td></td></tr><tr><th id=\"L109\"><a href=\"#L109\">109</a></th><td><span class=\"k\">def</span>\u00a0<span class=\"nf\">POST</span><span class=\"p\">(</span>k<span class=\"p\">,</span>n<span class=\"p\">):</span></td></tr><tr><th id=\"L110\"><a href=\"#L110\">110</a></th><td>\u00a0 \u00a0 <span class=\"s\">\"(private) munging to turn a method name into a post-hook-method-name\"</span></td></tr><tr><th id=\"L111\"><a href=\"#L111\">111</a></th><td>\u00a0 \u00a0 <span class=\"k\">return</span>\u00a0_XXX<span class=\"p\">(</span>k<span class=\"p\">,</span>n<span class=\"p\">,</span>_POST<span class=\"p\">)</span></td></tr><tr><th id=\"L112\"><a href=\"#L112\">112</a></th><td></td></tr><tr><th id=\"L113\"><a href=\"#L113\">113</a></th><td><span class=\"k\">def</span>\u00a0<span class=\"nf\">ORIG</span><span class=\"p\">(</span>k<span class=\"p\">,</span>n<span class=\"p\">):</span></td></tr><tr><th id=\"L114\"><a href=\"#L114\">114</a></th><td>\u00a0 \u00a0 <span class=\"s\">\"(private) munging to turn a method name into an `original' identifier\"</span></td></tr><tr><th id=\"L115\"><a href=\"#L115\">115</a></th><td>\u00a0 \u00a0 <span class=\"k\">return</span>\u00a0_XXX<span class=\"p\">(</span>k<span class=\"p\">,</span>n<span class=\"p\">,</span>_ORIG<span class=\"p\">)</span></td></tr><tr><th id=\"L116\"><a href=\"#L116\">116</a></th><td></td></tr><tr><th id=\"L117\"><a href=\"#L117\">117</a></th><td></td></tr><tr><th id=\"L118\"><a href=\"#L118\">118</a></th><td><span class=\"k\">def</span>\u00a0<span class=\"nf\">_addHook</span><span class=\"p\">(</span>klass<span class=\"p\">,</span>\u00a0name<span class=\"p\">,</span>\u00a0phase<span class=\"p\">,</span>\u00a0func<span class=\"p\">):</span></td></tr><tr><th id=\"L119\"><a href=\"#L119\">119</a></th><td>\u00a0 \u00a0 <span class=\"s\">\"(private) adds a hook to a method on a class\"</span></td></tr><tr><th id=\"L120\"><a href=\"#L120\">120</a></th><td>\u00a0 \u00a0 _enhook<span class=\"p\">(</span>klass<span class=\"p\">,</span>\u00a0name<span class=\"p\">)</span></td></tr><tr><th id=\"L121\"><a href=\"#L121\">121</a></th><td></td></tr><tr><th id=\"L122\"><a href=\"#L122\">122</a></th><td>\u00a0 \u00a0 <span class=\"k\">if</span>\u00a0<span class=\"ow\">not</span>\u00a0<span class=\"nb\">hasattr</span><span class=\"p\">(</span>klass<span class=\"p\">,</span>\u00a0phase<span class=\"p\">(</span>klass<span class=\"p\">,</span>\u00a0name<span class=\"p\">)):</span></td></tr><tr><th id=\"L123\"><a href=\"#L123\">123</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"nb\">setattr</span><span class=\"p\">(</span>klass<span class=\"p\">,</span>\u00a0phase<span class=\"p\">(</span>klass<span class=\"p\">,</span>\u00a0name<span class=\"p\">),</span>\u00a0<span class=\"p\">[])</span></td></tr><tr><th id=\"L124\"><a href=\"#L124\">124</a></th><td></td></tr><tr><th id=\"L125\"><a href=\"#L125\">125</a></th><td>\u00a0 \u00a0 phaselist <span class=\"o\">=</span>\u00a0<span class=\"nb\">getattr</span><span class=\"p\">(</span>klass<span class=\"p\">,</span>\u00a0phase<span class=\"p\">(</span>klass<span class=\"p\">,</span>\u00a0name<span class=\"p\">))</span></td></tr><tr><th id=\"L126\"><a href=\"#L126\">126</a></th><td>\u00a0 \u00a0 phaselist<span class=\"o\">.</span>append<span class=\"p\">(</span>func<span class=\"p\">)</span></td></tr><tr><th id=\"L127\"><a href=\"#L127\">127</a></th><td></td></tr><tr><th id=\"L128\"><a href=\"#L128\">128</a></th><td></td></tr><tr><th id=\"L129\"><a href=\"#L129\">129</a></th><td><span class=\"k\">def</span>\u00a0<span class=\"nf\">_removeHook</span><span class=\"p\">(</span>klass<span class=\"p\">,</span>\u00a0name<span class=\"p\">,</span>\u00a0phase<span class=\"p\">,</span>\u00a0func<span class=\"p\">):</span></td></tr><tr><th id=\"L130\"><a href=\"#L130\">130</a></th><td>\u00a0 \u00a0 <span class=\"s\">\"(private) removes a hook from a method on a class\"</span></td></tr><tr><th id=\"L131\"><a href=\"#L131\">131</a></th><td>\u00a0 \u00a0 phaselistname <span class=\"o\">=</span>\u00a0phase<span class=\"p\">(</span>klass<span class=\"p\">,</span>\u00a0name<span class=\"p\">)</span></td></tr><tr><th id=\"L132\"><a href=\"#L132\">132</a></th><td>\u00a0 \u00a0 <span class=\"k\">if</span>\u00a0<span class=\"ow\">not</span>\u00a0<span class=\"nb\">hasattr</span><span class=\"p\">(</span>klass<span class=\"p\">,</span>\u00a0ORIG<span class=\"p\">(</span>klass<span class=\"p\">,</span>name<span class=\"p\">)):</span></td></tr><tr><th id=\"L133\"><a href=\"#L133\">133</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">raise</span>\u00a0HookError<span class=\"p\">(</span><span class=\"s\">\"no hooks present!\"</span><span class=\"p\">)</span></td></tr><tr><th id=\"L134\"><a href=\"#L134\">134</a></th><td></td></tr><tr><th id=\"L135\"><a href=\"#L135\">135</a></th><td>\u00a0 \u00a0 phaselist <span class=\"o\">=</span>\u00a0<span class=\"nb\">getattr</span><span class=\"p\">(</span>klass<span class=\"p\">,</span>\u00a0phase<span class=\"p\">(</span>klass<span class=\"p\">,</span>\u00a0name<span class=\"p\">))</span></td></tr><tr><th id=\"L136\"><a href=\"#L136\">136</a></th><td>\u00a0 \u00a0 <span class=\"k\">try</span><span class=\"p\">:</span>\u00a0phaselist<span class=\"o\">.</span>remove<span class=\"p\">(</span>func<span class=\"p\">)</span></td></tr><tr><th id=\"L137\"><a href=\"#L137\">137</a></th><td>\u00a0 \u00a0 <span class=\"k\">except</span>\u00a0<span class=\"ne\">ValueError</span><span class=\"p\">:</span></td></tr><tr><th id=\"L138\"><a href=\"#L138\">138</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">raise</span>\u00a0HookError<span class=\"p\">(</span><span class=\"s\">\"hook </span><span class=\"si\">%s</span><span class=\"s\">\u00a0not found in removal list for </span><span class=\"si\">%s</span><span class=\"s\">\"</span><span class=\"o\">%</span></td></tr><tr><th id=\"L139\"><a href=\"#L139\">139</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"p\">(</span>name<span class=\"p\">,</span>klass<span class=\"p\">))</span></td></tr><tr><th id=\"L140\"><a href=\"#L140\">140</a></th><td></td></tr><tr><th id=\"L141\"><a href=\"#L141\">141</a></th><td>\u00a0 \u00a0 <span class=\"k\">if</span>\u00a0<span class=\"ow\">not</span>\u00a0<span class=\"nb\">getattr</span><span class=\"p\">(</span>klass<span class=\"p\">,</span>\u00a0PRE<span class=\"p\">(</span>klass<span class=\"p\">,</span>name<span class=\"p\">))</span>\u00a0<span class=\"ow\">and</span>\u00a0<span class=\"ow\">not</span>\u00a0<span class=\"nb\">getattr</span><span class=\"p\">(</span>klass<span class=\"p\">,</span>\u00a0POST<span class=\"p\">(</span>klass<span class=\"p\">,</span>\u00a0name<span class=\"p\">)):</span></td></tr><tr><th id=\"L142\"><a href=\"#L142\">142</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 _dehook<span class=\"p\">(</span>klass<span class=\"p\">,</span>\u00a0name<span class=\"p\">)</span></td></tr><tr><th id=\"L143\"><a href=\"#L143\">143</a></th><td></td></tr><tr><th id=\"L144\"><a href=\"#L144\">144</a></th><td><span class=\"k\">def</span>\u00a0<span class=\"nf\">_enhook</span><span class=\"p\">(</span>klass<span class=\"p\">,</span>\u00a0name<span class=\"p\">):</span></td></tr><tr><th id=\"L145\"><a href=\"#L145\">145</a></th><td>\u00a0 \u00a0 <span class=\"s\">\"(private) causes a certain method name to be hooked on a class\"</span></td></tr><tr><th id=\"L146\"><a href=\"#L146\">146</a></th><td>\u00a0 \u00a0 <span class=\"k\">if</span>\u00a0<span class=\"nb\">hasattr</span><span class=\"p\">(</span>klass<span class=\"p\">,</span>\u00a0ORIG<span class=\"p\">(</span>klass<span class=\"p\">,</span>\u00a0name<span class=\"p\">)):</span></td></tr><tr><th id=\"L147\"><a href=\"#L147\">147</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">return</span></td></tr><tr><th id=\"L148\"><a href=\"#L148\">148</a></th><td></td></tr><tr><th id=\"L149\"><a href=\"#L149\">149</a></th><td>\u00a0 \u00a0 <span class=\"k\">def</span>\u00a0<span class=\"nf\">newfunc</span><span class=\"p\">(</span><span class=\"o\">*</span>args<span class=\"p\">,</span>\u00a0<span class=\"o\">**</span>kw<span class=\"p\">):</span></td></tr><tr><th id=\"L150\"><a href=\"#L150\">150</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">for</span>\u00a0preMethod <span class=\"ow\">in</span>\u00a0<span class=\"nb\">getattr</span><span class=\"p\">(</span>klass<span class=\"p\">,</span>\u00a0PRE<span class=\"p\">(</span>klass<span class=\"p\">,</span>\u00a0name<span class=\"p\">)):</span></td></tr><tr><th id=\"L151\"><a href=\"#L151\">151</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 preMethod<span class=\"p\">(</span><span class=\"o\">*</span>args<span class=\"p\">,</span>\u00a0<span class=\"o\">**</span>kw<span class=\"p\">)</span></td></tr><tr><th id=\"L152\"><a href=\"#L152\">152</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">try</span><span class=\"p\">:</span></td></tr><tr><th id=\"L153\"><a href=\"#L153\">153</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">return</span>\u00a0<span class=\"nb\">getattr</span><span class=\"p\">(</span>klass<span class=\"p\">,</span>\u00a0ORIG<span class=\"p\">(</span>klass<span class=\"p\">,</span>\u00a0name<span class=\"p\">))(</span><span class=\"o\">*</span>args<span class=\"p\">,</span>\u00a0<span class=\"o\">**</span>kw<span class=\"p\">)</span></td></tr><tr><th id=\"L154\"><a href=\"#L154\">154</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">finally</span><span class=\"p\">:</span></td></tr><tr><th id=\"L155\"><a href=\"#L155\">155</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">for</span>\u00a0postMethod <span class=\"ow\">in</span>\u00a0<span class=\"nb\">getattr</span><span class=\"p\">(</span>klass<span class=\"p\">,</span>\u00a0POST<span class=\"p\">(</span>klass<span class=\"p\">,</span>\u00a0name<span class=\"p\">)):</span></td></tr><tr><th id=\"L156\"><a href=\"#L156\">156</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 postMethod<span class=\"p\">(</span><span class=\"o\">*</span>args<span class=\"p\">,</span>\u00a0<span class=\"o\">**</span>kw<span class=\"p\">)</span></td></tr><tr><th id=\"L157\"><a href=\"#L157\">157</a></th><td>\u00a0 \u00a0 <span class=\"k\">try</span><span class=\"p\">:</span></td></tr><tr><th id=\"L158\"><a href=\"#L158\">158</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 newfunc<span class=\"o\">.</span>func_name <span class=\"o\">=</span>\u00a0name</td></tr><tr><th id=\"L159\"><a href=\"#L159\">159</a></th><td>\u00a0 \u00a0 <span class=\"k\">except</span>\u00a0<span class=\"ne\">TypeError</span><span class=\"p\">:</span></td></tr><tr><th id=\"L160\"><a href=\"#L160\">160</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"c\"># Older python's don't let you do this</span></td></tr><tr><th id=\"L161\"><a href=\"#L161\">161</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">pass</span></td></tr><tr><th id=\"L162\"><a href=\"#L162\">162</a></th><td></td></tr><tr><th id=\"L163\"><a href=\"#L163\">163</a></th><td>\u00a0 \u00a0 oldfunc <span class=\"o\">=</span>\u00a0<span class=\"nb\">getattr</span><span class=\"p\">(</span>klass<span class=\"p\">,</span>\u00a0name<span class=\"p\">)</span><span class=\"o\">.</span>im_func</td></tr><tr><th id=\"L164\"><a href=\"#L164\">164</a></th><td>\u00a0 \u00a0 <span class=\"nb\">setattr</span><span class=\"p\">(</span>klass<span class=\"p\">,</span>\u00a0ORIG<span class=\"p\">(</span>klass<span class=\"p\">,</span>\u00a0name<span class=\"p\">),</span>\u00a0oldfunc<span class=\"p\">)</span></td></tr><tr><th id=\"L165\"><a href=\"#L165\">165</a></th><td>\u00a0 \u00a0 <span class=\"nb\">setattr</span><span class=\"p\">(</span>klass<span class=\"p\">,</span>\u00a0PRE<span class=\"p\">(</span>klass<span class=\"p\">,</span>\u00a0name<span class=\"p\">),</span>\u00a0<span class=\"p\">[])</span></td></tr><tr><th id=\"L166\"><a href=\"#L166\">166</a></th><td>\u00a0 \u00a0 <span class=\"nb\">setattr</span><span class=\"p\">(</span>klass<span class=\"p\">,</span>\u00a0POST<span class=\"p\">(</span>klass<span class=\"p\">,</span>\u00a0name<span class=\"p\">),</span>\u00a0<span class=\"p\">[])</span></td></tr><tr><th id=\"L167\"><a href=\"#L167\">167</a></th><td>\u00a0 \u00a0 <span class=\"nb\">setattr</span><span class=\"p\">(</span>klass<span class=\"p\">,</span>\u00a0name<span class=\"p\">,</span>\u00a0newfunc<span class=\"p\">)</span></td></tr><tr><th id=\"L168\"><a href=\"#L168\">168</a></th><td></td></tr><tr><th id=\"L169\"><a href=\"#L169\">169</a></th><td><span class=\"k\">def</span>\u00a0<span class=\"nf\">_dehook</span><span class=\"p\">(</span>klass<span class=\"p\">,</span>\u00a0name<span class=\"p\">):</span></td></tr><tr><th id=\"L170\"><a href=\"#L170\">170</a></th><td>\u00a0 \u00a0 <span class=\"s\">\"(private) causes a certain method name no longer to be hooked on a class\"</span></td></tr><tr><th id=\"L171\"><a href=\"#L171\">171</a></th><td></td></tr><tr><th id=\"L172\"><a href=\"#L172\">172</a></th><td>\u00a0 \u00a0 <span class=\"k\">if</span>\u00a0<span class=\"ow\">not</span>\u00a0<span class=\"nb\">hasattr</span><span class=\"p\">(</span>klass<span class=\"p\">,</span>\u00a0ORIG<span class=\"p\">(</span>klass<span class=\"p\">,</span>\u00a0name<span class=\"p\">)):</span></td></tr><tr><th id=\"L173\"><a href=\"#L173\">173</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">raise</span>\u00a0HookError<span class=\"p\">(</span><span class=\"s\">\"Cannot unhook!\"</span><span class=\"p\">)</span></td></tr><tr><th id=\"L174\"><a href=\"#L174\">174</a></th><td>\u00a0 \u00a0 <span class=\"nb\">setattr</span><span class=\"p\">(</span>klass<span class=\"p\">,</span>\u00a0name<span class=\"p\">,</span>\u00a0<span class=\"nb\">getattr</span><span class=\"p\">(</span>klass<span class=\"p\">,</span>\u00a0ORIG<span class=\"p\">(</span>klass<span class=\"p\">,</span>name<span class=\"p\">)))</span></td></tr><tr><th id=\"L175\"><a href=\"#L175\">175</a></th><td>\u00a0 \u00a0 <span class=\"nb\">delattr</span><span class=\"p\">(</span>klass<span class=\"p\">,</span>\u00a0PRE<span class=\"p\">(</span>klass<span class=\"p\">,</span>name<span class=\"p\">))</span></td></tr><tr><th id=\"L176\"><a href=\"#L176\">176</a></th><td>\u00a0 \u00a0 <span class=\"nb\">delattr</span><span class=\"p\">(</span>klass<span class=\"p\">,</span>\u00a0POST<span class=\"p\">(</span>klass<span class=\"p\">,</span>name<span class=\"p\">))</span></td></tr><tr><th id=\"L177\"><a href=\"#L177\">177</a></th><td>\u00a0 \u00a0 <span class=\"nb\">delattr</span><span class=\"p\">(</span>klass<span class=\"p\">,</span>\u00a0ORIG<span class=\"p\">(</span>klass<span class=\"p\">,</span>name<span class=\"p\">))</span></td></tr></tbody></table>\n\n      </div>\n      <div id=\"anydiff\">\n        <form action=\"/LUCICodeRepository/nomaticIM/diff\" method=\"get\">\n          <div class=\"buttons\">\n            <input type=\"hidden\" name=\"new_path\" value=\"/nomatic/tags/NomaticIM-0.0.5/buddy_bots/src/twisted/python/hook.py\" />\n            <input type=\"hidden\" name=\"old_path\" value=\"/nomatic/tags/NomaticIM-0.0.5/buddy_bots/src/twisted/python/hook.py\" />\n            <input type=\"hidden\" name=\"new_rev\" />\n            <input type=\"hidden\" name=\"old_rev\" />\n            <input type=\"submit\" value=\"View changes...\" title=\"Select paths and revs for Diff\" />\n          </div>\n        </form>\n      </div>\n      <div id=\"help\"><strong>Note:</strong> See <a href=\"/LUCICodeRepository/nomaticIM/wiki/TracBrowser\">TracBrowser</a>\n        for help on using the repository browser.</div>\n    </div>\n    <div id=\"altlinks\">\n      <h3>Download in other formats:</h3>\n      <ul>\n        <li class=\"first\">\n          <a rel=\"nofollow\" href=\"/LUCICodeRepository/nomaticIM/browser/nomatic/tags/NomaticIM-0.0.5/buddy_bots/src/twisted/python/hook.py?format=txt\">Plain Text</a>\n        </li><li class=\"last\">\n          <a rel=\"nofollow\" href=\"/LUCICodeRepository/nomaticIM/export/1312/nomatic/tags/NomaticIM-0.0.5/buddy_bots/src/twisted/python/hook.py\">Original Format</a>\n        </li>\n      </ul>\n    </div>\n    </div>\n    <div id=\"footer\" lang=\"en\" xml:lang=\"en\"><hr />\n      <a id=\"tracpowered\" href=\"http://trac.edgewall.org/\"><img src=\"/LUCICodeRepository/nomaticIM/chrome/common/trac_logo_mini.png\" height=\"30\" width=\"107\" alt=\"Trac Powered\" /></a>\n      <p class=\"left\">Powered by <a href=\"/LUCICodeRepository/nomaticIM/about\"><strong>Trac 1.0.1</strong></a><br />\n        By <a href=\"http://www.edgewall.org/\">Edgewall Software</a>.</p>\n      <p class=\"right\">All content copyright 2007-2008 by LUCI <br /><a href=\"http://luci.ics.uci.edu/\">http://luci.ics.uci.edu/</a></p>\n    </div>\n\t\t<div id=\"sitefooter\">\n\t\t\t<script src=\"http://www.google-analytics.com/urchin.js\" type=\"text/javascript\">\n\t\t\t</script>\n\t\t\t<script type=\"text/javascript\">\n\t\t\t\t_uacct = \"UA-338915-2\";\n\t\t\t\turchinTracker();\n\t\t\t</script>\n\t\t</div>\n\t</body>\n</html>", "id": 44236.0}