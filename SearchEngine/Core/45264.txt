{"text": "Search LoginPreferencesHelp GuideAbout Trac WikiTimelineRoadmapBrowse SourceView TicketsSearch Context Navigation Previous ChangeNext Change Changeset 3 6 for nomatic trunk plugins gaim src service c View differences inlineside by side Show lines around each change Show the changes in full context Ignore Blank lines Case changes White space changes Timestamp Mar 3 2 7 9 2 25 PM 8 years ago Author skaufman1Message Continued work on network code in Gaim plugin and broke the source tree File 1 edited nomatic trunk plugins gaim src service c modified 1 diff Legend UnmodifiedAddedRemoved nomatic trunk plugins gaim src service c r29 r3 6 11 include glib h 2 include gnet h 3 include stdlib h 4 include strings h 5 include nomatic h 26 include error h 37 include service h 48 5 gboolean nomatic service is running 9 1 Public 11 12 13void nomatic service get async const gchar host 14 service get callback callback 15 void data 616 7 TODO Implement this 8 return FALSE 17 NomaticService serviceObj 18 GInetAddr serviceAddr 19 GTcpSocket socket 2 21 serviceAddr get addr from host host 22 if serviceAddr NULL 23 goto out 24 25 Try to connect 26 socket gnet tcp socket new serviceAddr 27 if socket NULL 28 If trying to loopback connect on the default port and the 29 service wasn t around start it 3 if gnet inetaddr is loopback serviceAddr 31 gnet inetaddr get port serviceAddr 32 DEFAULT NOMATIC SERVICE PORT 33 34 TODO Start the service somehow here 35 36 socket gnet tcp socket new serviceAddr 37 if socket NULL 38 char err msg 39 asprintf err msg 4 Couldn t start the service and connect to s host 41 set error err msg 42 goto out 43 44 45 else 46 char err msg 47 asprintf err msg Couldn t connect to s host 48 set error err msg 49 goto out 5 51 52 53 serviceObj malloc sizeof NomaticService 54 serviceObj conn gnet conn new socket socket gconn cb serviceObj 55 56out 57 if socket NULL 58 gnet tcp socket unref socket 59 if serviceAddr NULL 6 gnet inetaddr unref serviceAddr 61 callback serviceObj data 962 1 63 11 gboolean nomatic service start 64void nomatic service free NomaticService service 1265 13 set error nomatic service start is not yet implemented 14 return FALSE 66 TODO Disconnect too 67 if service conn NULL 68 gnet conn unref service conn 69 free service 157 71 72 73 Private 74 75 76void gconn cb GConn conn GConnEvent event gpointer user data 77 78 NomaticService service NomaticService user data 79 8 81GInetAddr get addr from host const gchar host 82 GInetAddr ret NULL 83 char cp 84 char hostname 85 int port 86 87 Compute length of string 88 size t length strlen host 89 if length 1 9 set error An empty string was passed to get addr from host 91 ret FALSE 92 goto out 93 94 95 Break host into hostname and port 96 if rindex host NULL 97 Then there is no port and we should use the default 98 ret gnet inetaddr new host DEFAULT NOMATIC SERVICE PORT 99 1 else 1 1 cp strdup host 1 2 TODO Check the following two calls for errors 1 3 hostname strtok cp 1 4 TODO Check the following for errors and don t use atoi 1 5 port atoi strtok NULL 1 6 Assert that that s the end 1 7 if strtok NULL NULL 1 8 set error Invalid host passed to get addr from host 1 9 goto out 11 111 112 ret gnet inetaddr new hostname port 113 114 115out 116 if cp NULL 117 free cp 118 TODO Figure out why we don t seem to need to free hostname 119 It s something about the way strdup works 12 if hostname NULL 121 free hostname 122 return ret 123 Note See TracChangeset for help on using the changeset viewer Download in other formats Unified Diff Zip Archive Powered by Trac 1 1 By Edgewall Software All content copyright 2 7 2 8 by LUCI http luci ics uci edu ", "_id": "http://djp3-pc2.ics.uci.edu/LUCICodeRepository/nomaticIM/changeset/306/nomatic/trunk/plugins/gaim/src/service.c", "title": "\n      changeset 306 for nomatic/trunk/plugins/gaim/src/service.c \u2013 nomatic*im\n    ", "html": "<!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Strict//EN\" \"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd\">\n<html xmlns=\"http://www.w3.org/1999/xhtml\">\n  \n  \n\n  \n\n\n  <head>\n\t\t<title>\n      Changeset 306 for nomatic/trunk/plugins/gaim/src/service.c \u2013 Nomatic*IM\n    </title><meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\" /><meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge\" /><link rel=\"search\" href=\"/LUCICodeRepository/nomaticIM/search\" /><link rel=\"help\" href=\"/LUCICodeRepository/nomaticIM/wiki/TracGuide\" /><link rel=\"alternate\" href=\"?format=diff&amp;new=306\" type=\"text/plain\" class=\"diff\" title=\"Unified Diff\" /><link rel=\"alternate\" href=\"?format=zip&amp;new=306\" type=\"application/zip\" class=\"zip\" title=\"Zip Archive\" /><link rel=\"next\" href=\"/LUCICodeRepository/nomaticIM/changeset/307/nomatic/trunk/plugins/gaim/src/service.c\" title=\"Changeset 307 for nomatic/trunk/plugins/gaim/src/service.c\" /><link rel=\"start\" href=\"/LUCICodeRepository/nomaticIM/wiki\" /><link rel=\"stylesheet\" href=\"/LUCICodeRepository/nomaticIM/chrome/common/css/trac.css\" type=\"text/css\" /><link rel=\"stylesheet\" href=\"/LUCICodeRepository/nomaticIM/chrome/common/css/changeset.css\" type=\"text/css\" /><link rel=\"stylesheet\" href=\"/LUCICodeRepository/nomaticIM/chrome/common/css/diff.css\" type=\"text/css\" /><link rel=\"stylesheet\" href=\"/LUCICodeRepository/nomaticIM/chrome/common/css/code.css\" type=\"text/css\" /><link rel=\"prev\" href=\"/LUCICodeRepository/nomaticIM/changeset/290/nomatic/trunk/plugins/gaim/src/service.c\" title=\"Changeset 290 for nomatic/trunk/plugins/gaim/src/service.c\" /><link rel=\"shortcut icon\" href=\"http://luci.ics.uci.edu/logo32by32.gif\" type=\"image/gif\" /><link rel=\"icon\" href=\"http://luci.ics.uci.edu/logo32by32.gif\" type=\"image/gif\" /><link type=\"application/opensearchdescription+xml\" rel=\"search\" href=\"/LUCICodeRepository/nomaticIM/search/opensearch\" title=\"Search Nomatic*IM\" /><script type=\"text/javascript\" charset=\"utf-8\" src=\"/LUCICodeRepository/nomaticIM/chrome/common/js/jquery.js\"></script><script type=\"text/javascript\" charset=\"utf-8\" src=\"/LUCICodeRepository/nomaticIM/chrome/common/js/babel.js\"></script><script type=\"text/javascript\" charset=\"utf-8\" src=\"/LUCICodeRepository/nomaticIM/chrome/common/js/messages/en_US.js\"></script><script type=\"text/javascript\" charset=\"utf-8\" src=\"/LUCICodeRepository/nomaticIM/chrome/common/js/trac.js\"></script><script type=\"text/javascript\" charset=\"utf-8\" src=\"/LUCICodeRepository/nomaticIM/chrome/common/js/search.js\"></script><script type=\"text/javascript\" charset=\"utf-8\" src=\"/LUCICodeRepository/nomaticIM/chrome/common/js/diff.js\"></script><script type=\"text/javascript\">\n      jQuery(document).ready(function($) {\n        $(\".trac-toggledeleted\").show().click(function() {\n                  $(this).siblings().find(\".trac-deleted\").toggle();\n                  return false;\n        }).click();\n        $(\"#content\").find(\"li.entry h2 a\").parent().addAnchor(_(\"Link to this diff\"));\n      });\n    </script>\n\t</head>\n  <body>\n    <div id=\"banner\">\n      <div id=\"header\">\n        <a id=\"logo\" href=\"http://luci.ics.uci.edu/#code\"><img src=\"http://luci.ics.uci.edu/blog/archives/LUCIhorzTight.jpg\" alt=\"LUCI Code Repository\" /></a>\n      </div>\n      <form id=\"search\" action=\"/LUCICodeRepository/nomaticIM/search\" method=\"get\">\n        <div>\n          <label for=\"proj-search\">Search:</label>\n          <input type=\"text\" id=\"proj-search\" name=\"q\" size=\"18\" value=\"\" />\n          <input type=\"submit\" value=\"Search\" />\n        </div>\n      </form>\n      <div id=\"metanav\" class=\"nav\">\n    <ul>\n      <li class=\"first\"><a href=\"/LUCICodeRepository/nomaticIM/login\">Login</a></li><li><a href=\"/LUCICodeRepository/nomaticIM/prefs\">Preferences</a></li><li><a href=\"/LUCICodeRepository/nomaticIM/wiki/TracGuide\">Help/Guide</a></li><li class=\"last\"><a href=\"/LUCICodeRepository/nomaticIM/about\">About Trac</a></li>\n    </ul>\n  </div>\n    </div>\n    <div id=\"mainnav\" class=\"nav\">\n    <ul>\n      <li class=\"first\"><a href=\"/LUCICodeRepository/nomaticIM/wiki\">Wiki</a></li><li><a href=\"/LUCICodeRepository/nomaticIM/timeline\">Timeline</a></li><li><a href=\"/LUCICodeRepository/nomaticIM/roadmap\">Roadmap</a></li><li class=\"active\"><a href=\"/LUCICodeRepository/nomaticIM/browser\">Browse Source</a></li><li><a href=\"/LUCICodeRepository/nomaticIM/report\">View Tickets</a></li><li class=\"last\"><a href=\"/LUCICodeRepository/nomaticIM/search\">Search</a></li>\n    </ul>\n  </div>\n    <div id=\"main\">\n      <div id=\"ctxtnav\" class=\"nav\">\n        <h2>Context Navigation</h2>\n        <ul>\n          <li class=\"first\"><span>&larr; <a class=\"prev\" href=\"/LUCICodeRepository/nomaticIM/changeset/290/nomatic/trunk/plugins/gaim/src/service.c\" title=\"Changeset 290 for nomatic/trunk/plugins/gaim/src/service.c\">Previous Change</a></span></li><li class=\"last\"><span><a class=\"next\" href=\"/LUCICodeRepository/nomaticIM/changeset/307/nomatic/trunk/plugins/gaim/src/service.c\" title=\"Changeset 307 for nomatic/trunk/plugins/gaim/src/service.c\">Next Change</a> &rarr;</span></li>\n        </ul>\n        <hr />\n      </div>\n    <div id=\"content\" class=\"changeset\">\n      <div id=\"title\">\n            <h1>Changeset <a title=\"Show full changeset\" href=\"/LUCICodeRepository/nomaticIM/changeset/306\">306</a>\n              for <a title=\"Show entry in browser\" href=\"/LUCICodeRepository/nomaticIM/browser/nomatic/trunk/plugins/gaim/src/service.c?rev=306\">nomatic/trunk/plugins/gaim/src/service.c</a></h1>\n      </div>\n      <form id=\"prefs\" action=\"\">\n        <div>\n          \n  <label for=\"style\">View differences</label>\n  <select id=\"style\" name=\"style\">\n    <option selected=\"selected\" value=\"inline\">inline</option>\n    <option value=\"sidebyside\">side by side</option>\n  </select>\n  <div class=\"field\">\n    <label><input type=\"radio\" name=\"contextall\" value=\"0\" checked=\"checked\" />\n             Show</label>\n      <label><input type=\"text\" name=\"contextlines\" id=\"contextlines\" size=\"2\" maxlength=\"3\" value=\"2\" />\n             lines around each change</label><br />\n    <label><input type=\"radio\" name=\"contextall\" value=\"1\" />\n           Show the changes in full context</label>\n  </div>\n  <fieldset id=\"ignore\">\n    <legend>Ignore:</legend>\n    <div class=\"field\">\n      <input type=\"checkbox\" id=\"ignoreblanklines\" name=\"ignoreblanklines\" />\n      <label for=\"ignoreblanklines\">Blank lines</label>\n    </div>\n    <div class=\"field\">\n      <input type=\"checkbox\" id=\"ignorecase\" name=\"ignorecase\" />\n      <label for=\"ignorecase\">Case changes</label>\n    </div>\n    <div class=\"field\">\n      <input type=\"checkbox\" id=\"ignorewhitespace\" name=\"ignorewhitespace\" />\n      <label for=\"ignorewhitespace\">White space changes</label>\n    </div>\n  </fieldset>\n  <div class=\"buttons\">\n    <input type=\"submit\" name=\"update\" value=\"Update\" />\n  </div>\n\n        </div>\n      </form>\n      <dl id=\"overview\">\n          <dt class=\"property time\">Timestamp:</dt>\n          <dd class=\"time\">\n             Mar 30, 2007, 9:02:25 PM\n             (<a class=\"timeline\" href=\"/LUCICodeRepository/nomaticIM/timeline?from=2007-03-30T21%3A02%3A25-07%3A00&amp;precision=second\" title=\"See timeline at Mar 30, 2007, 9:02:25 PM\">8 years</a> ago)\n          </dd>\n          <dt class=\"property author\">Author:</dt>\n          <dd class=\"author\">skaufman1</dd>\n          <dt class=\"property message\">Message:</dt>\n          <dd class=\"message searchable\">\n            \n            \n              <p>\nContinued work on network code in Gaim plugin... and broke the source tree<br />\n</p>\n\n            \n            \n          </dd>\n        <dt class=\"property files\">\n          File:\n        </dt>\n        <dd class=\"files\">\n          <div class=\"legend\" id=\"file-legend\">\n            <dl>\n              <dt class=\"mod\"></dt><dd>1 edited</dd>\n            </dl>\n          </div>\n          <br />\n          <ul>\n            <li>\n          <div class=\"mod\"> </div>\n            <a title=\"Show entry in browser\" href=\"/LUCICodeRepository/nomaticIM/browser/nomatic/trunk/plugins/gaim/src/service.c?rev=306\">\n              nomatic/trunk/plugins/gaim/src/service.c\n            </a>\n          <span class=\"comment\">(modified)</span>\n              (<a title=\"Show differences\" href=\"#file0\">1 diff</a>)\n            </li>\n          </ul>\n        </dd>\n      </dl>\n      <div class=\"diff\">\n        <div class=\"legend\" id=\"diff-legend\">\n          <h3>Legend:</h3>\n          <dl>\n            <dt class=\"unmod\"></dt><dd>Unmodified</dd>\n            <dt class=\"add\"></dt><dd>Added</dd>\n            <dt class=\"rem\"></dt><dd>Removed</dd>\n          </dl>\n        </div>\n        <div class=\"diff\">\n  <ul class=\"entries\">\n      <li class=\"entry\">\n        <h2 id=\"file0\">\n          <a href=\"/LUCICodeRepository/nomaticIM/changeset/306/nomatic/trunk/plugins/gaim/src/service.c\" title=\"Show the changeset 306 restricted to nomatic/trunk/plugins/gaim/src/service.c\">nomatic/trunk/plugins/gaim/src/service.c</a>\n        </h2>\n        <table class=\"trac-diff inline\" summary=\"Differences\" cellspacing=\"0\">\n              <colgroup><col class=\"lineno\" /><col class=\"lineno\" /><col class=\"content\" /></colgroup>\n              <thead>\n                <tr>\n                  <th title=\"Revision 290\">\n                    <a title=\"Show revision 290 of this file in browser\" href=\"/LUCICodeRepository/nomaticIM/browser/nomatic/trunk/plugins/gaim/src/service.c?rev=290#L1\">\n                      r290</a>\n                  </th>\n                  <th title=\"Revision 306\">\n                    <a title=\"Show revision 306 of this file in browser\" href=\"/LUCICodeRepository/nomaticIM/browser/nomatic/trunk/plugins/gaim/src/service.c?rev=306#L1\">\n                      r306</a>\n                  </th>\n                  <td>\u00a0</td>\n                </tr>\n              </thead>\n            <tbody class=\"unmod\">\n                  <tr>\n                          <th>1</th><th>1</th><td class=\"l\"><span>#include &lt;glib.h&gt;</span>\u00a0</td>\n                  </tr>\n            </tbody><tbody class=\"add\">\n                  <tr class=\"first\">\n                          <th>\u00a0</th><th>2</th><td class=\"r\"><ins>#include &lt;gnet.h&gt;</ins>\u00a0</td>\n                  </tr><tr>\n                          <th>\u00a0</th><th>3</th><td class=\"r\"><ins>#include &lt;stdlib.h&gt;</ins>\u00a0</td>\n                  </tr><tr>\n                          <th>\u00a0</th><th>4</th><td class=\"r\"><ins>#include &lt;strings.h&gt;</ins>\u00a0</td>\n                  </tr><tr class=\"last\">\n                          <th>\u00a0</th><th>5</th><td class=\"r\"><ins>#include \"nomatic.h\"</ins>\u00a0</td>\n                  </tr>\n            </tbody><tbody class=\"unmod\">\n                  <tr>\n                          <th>2</th><th>6</th><td class=\"l\"><span>#include \"error.h\"</span>\u00a0</td>\n                  </tr><tr>\n                          <th>3</th><th>7</th><td class=\"l\"><span>#include \"service.h\"</span>\u00a0</td>\n                  </tr><tr>\n                          <th>4</th><th>8</th><td class=\"l\"><span></span>\u00a0</td>\n                  </tr>\n            </tbody><tbody class=\"mod\">\n                      <tr class=\"first\">\n                        <th>5</th><th>\u00a0</th><td class=\"l\"><span>gboolean nomatic_service_is_running()</span>\u00a0</td>\n                      </tr>\n                      <tr>\n                        <th>\u00a0</th><th>9</th><td class=\"r\"><span>/*****************</span>\u00a0</td>\n                      </tr><tr>\n                        <th>\u00a0</th><th>10</th><td class=\"r\"><span>&nbsp;*&nbsp; Public&nbsp; *</span>\u00a0</td>\n                      </tr><tr>\n                        <th>\u00a0</th><th>11</th><td class=\"r\"><span>&nbsp;****************/</span>\u00a0</td>\n                      </tr><tr>\n                        <th>\u00a0</th><th>12</th><td class=\"r\"><span></span>\u00a0</td>\n                      </tr><tr>\n                        <th>\u00a0</th><th>13</th><td class=\"r\"><span>void nomatic_service_get_async(const gchar *host,</span>\u00a0</td>\n                      </tr><tr>\n                        <th>\u00a0</th><th>14</th><td class=\"r\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;service_get_callback callback,</span>\u00a0</td>\n                      </tr><tr class=\"last\">\n                        <th>\u00a0</th><th>15</th><td class=\"r\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;void *data)</span>\u00a0</td>\n                      </tr>\n            </tbody><tbody class=\"unmod\">\n                  <tr>\n                          <th>6</th><th>16</th><td class=\"l\"><span>{</span>\u00a0</td>\n                  </tr>\n            </tbody><tbody class=\"mod\">\n                      <tr class=\"first\">\n                        <th>7</th><th>\u00a0</th><td class=\"l\"><span>&nbsp; &nbsp; &nbsp; &nbsp; // TODO: Implement this</span>\u00a0</td>\n                      </tr><tr>\n                        <th>8</th><th>\u00a0</th><td class=\"l\"><span>&nbsp; &nbsp; &nbsp; &nbsp; return FALSE;</span>\u00a0</td>\n                      </tr>\n                      <tr>\n                        <th>\u00a0</th><th>17</th><td class=\"r\"><span>&nbsp; &nbsp; &nbsp; &nbsp; NomaticService *serviceObj;</span>\u00a0</td>\n                      </tr><tr>\n                        <th>\u00a0</th><th>18</th><td class=\"r\"><span>&nbsp; &nbsp; &nbsp; &nbsp; GInetAddr *serviceAddr;</span>\u00a0</td>\n                      </tr><tr>\n                        <th>\u00a0</th><th>19</th><td class=\"r\"><span>&nbsp; &nbsp; &nbsp; &nbsp; GTcpSocket *socket;</span>\u00a0</td>\n                      </tr><tr>\n                        <th>\u00a0</th><th>20</th><td class=\"r\"><span>&nbsp; &nbsp; &nbsp; &nbsp; </span>\u00a0</td>\n                      </tr><tr>\n                        <th>\u00a0</th><th>21</th><td class=\"r\"><span>&nbsp; &nbsp; &nbsp; &nbsp; serviceAddr = get_addr_from_host(host);</span>\u00a0</td>\n                      </tr><tr>\n                        <th>\u00a0</th><th>22</th><td class=\"r\"><span>&nbsp; &nbsp; &nbsp; &nbsp; if (serviceAddr == NULL)</span>\u00a0</td>\n                      </tr><tr>\n                        <th>\u00a0</th><th>23</th><td class=\"r\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; goto out;</span>\u00a0</td>\n                      </tr><tr>\n                        <th>\u00a0</th><th>24</th><td class=\"r\"><span>&nbsp; &nbsp; &nbsp; &nbsp; </span>\u00a0</td>\n                      </tr><tr>\n                        <th>\u00a0</th><th>25</th><td class=\"r\"><span>&nbsp; &nbsp; &nbsp; &nbsp; /* Try to connect */</span>\u00a0</td>\n                      </tr><tr>\n                        <th>\u00a0</th><th>26</th><td class=\"r\"><span>&nbsp; &nbsp; &nbsp; &nbsp; socket = gnet_tcp_socket_new(serviceAddr);</span>\u00a0</td>\n                      </tr><tr>\n                        <th>\u00a0</th><th>27</th><td class=\"r\"><span>&nbsp; &nbsp; &nbsp; &nbsp; if (socket == NULL) {</span>\u00a0</td>\n                      </tr><tr>\n                        <th>\u00a0</th><th>28</th><td class=\"r\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; /* If trying to loopback-connect on the default port and the</span>\u00a0</td>\n                      </tr><tr>\n                        <th>\u00a0</th><th>29</th><td class=\"r\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; * service wasn't around... start it. */</span>\u00a0</td>\n                      </tr><tr>\n                        <th>\u00a0</th><th>30</th><td class=\"r\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (gnet_inetaddr_is_loopback(serviceAddr)</span>\u00a0</td>\n                      </tr><tr>\n                        <th>\u00a0</th><th>31</th><td class=\"r\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &amp;&amp; gnet_inetaddr_get_port(serviceAddr)</span>\u00a0</td>\n                      </tr><tr>\n                        <th>\u00a0</th><th>32</th><td class=\"r\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;==DEFAULT_NOMATIC_SERVICE_PORT)</span>\u00a0</td>\n                      </tr><tr>\n                        <th>\u00a0</th><th>33</th><td class=\"r\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {</span>\u00a0</td>\n                      </tr><tr>\n                        <th>\u00a0</th><th>34</th><td class=\"r\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; /* TODO: Start the service somehow here */</span>\u00a0</td>\n                      </tr><tr>\n                        <th>\u00a0</th><th>35</th><td class=\"r\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span>\u00a0</td>\n                      </tr><tr>\n                        <th>\u00a0</th><th>36</th><td class=\"r\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; socket = gnet_tcp_socket_new(serviceAddr);</span>\u00a0</td>\n                      </tr><tr>\n                        <th>\u00a0</th><th>37</th><td class=\"r\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (socket == NULL) {</span>\u00a0</td>\n                      </tr><tr>\n                        <th>\u00a0</th><th>38</th><td class=\"r\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; char *err_msg;</span>\u00a0</td>\n                      </tr><tr>\n                        <th>\u00a0</th><th>39</th><td class=\"r\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; asprintf(&amp;err_msg,</span>\u00a0</td>\n                      </tr><tr>\n                        <th>\u00a0</th><th>40</th><td class=\"r\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; \"Couldn't start the service and connect to %s\", host);</span>\u00a0</td>\n                      </tr><tr>\n                        <th>\u00a0</th><th>41</th><td class=\"r\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; set_error(err_msg);</span>\u00a0</td>\n                      </tr><tr>\n                        <th>\u00a0</th><th>42</th><td class=\"r\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; goto out;</span>\u00a0</td>\n                      </tr><tr>\n                        <th>\u00a0</th><th>43</th><td class=\"r\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</span>\u00a0</td>\n                      </tr><tr>\n                        <th>\u00a0</th><th>44</th><td class=\"r\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</span>\u00a0</td>\n                      </tr><tr>\n                        <th>\u00a0</th><th>45</th><td class=\"r\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; else {</span>\u00a0</td>\n                      </tr><tr>\n                        <th>\u00a0</th><th>46</th><td class=\"r\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; char *err_msg;</span>\u00a0</td>\n                      </tr><tr>\n                        <th>\u00a0</th><th>47</th><td class=\"r\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; asprintf(&amp;err_msg, \"Couldn't connect to %s\", host);</span>\u00a0</td>\n                      </tr><tr>\n                        <th>\u00a0</th><th>48</th><td class=\"r\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; set_error(err_msg);</span>\u00a0</td>\n                      </tr><tr>\n                        <th>\u00a0</th><th>49</th><td class=\"r\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; goto out;</span>\u00a0</td>\n                      </tr><tr>\n                        <th>\u00a0</th><th>50</th><td class=\"r\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</span>\u00a0</td>\n                      </tr><tr>\n                        <th>\u00a0</th><th>51</th><td class=\"r\"><span>&nbsp; &nbsp; &nbsp; &nbsp; }</span>\u00a0</td>\n                      </tr><tr>\n                        <th>\u00a0</th><th>52</th><td class=\"r\"><span>&nbsp; &nbsp; &nbsp; &nbsp; </span>\u00a0</td>\n                      </tr><tr>\n                        <th>\u00a0</th><th>53</th><td class=\"r\"><span>&nbsp; &nbsp; &nbsp; &nbsp; serviceObj = malloc(sizeof(NomaticService));</span>\u00a0</td>\n                      </tr><tr>\n                        <th>\u00a0</th><th>54</th><td class=\"r\"><span>&nbsp; &nbsp; &nbsp; &nbsp; serviceObj-&gt;conn = gnet_conn_new_socket(socket, gconn_cb, serviceObj);</span>\u00a0</td>\n                      </tr><tr>\n                        <th>\u00a0</th><th>55</th><td class=\"r\"><span>&nbsp; &nbsp; &nbsp; &nbsp; </span>\u00a0</td>\n                      </tr><tr>\n                        <th>\u00a0</th><th>56</th><td class=\"r\"><span>out:</span>\u00a0</td>\n                      </tr><tr>\n                        <th>\u00a0</th><th>57</th><td class=\"r\"><span>&nbsp; &nbsp; &nbsp; &nbsp; if (socket != NULL)</span>\u00a0</td>\n                      </tr><tr>\n                        <th>\u00a0</th><th>58</th><td class=\"r\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; gnet_tcp_socket_unref(socket);</span>\u00a0</td>\n                      </tr><tr>\n                        <th>\u00a0</th><th>59</th><td class=\"r\"><span>&nbsp; &nbsp; &nbsp; &nbsp; if (serviceAddr != NULL)</span>\u00a0</td>\n                      </tr><tr>\n                        <th>\u00a0</th><th>60</th><td class=\"r\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; gnet_inetaddr_unref(serviceAddr);</span>\u00a0</td>\n                      </tr><tr class=\"last\">\n                        <th>\u00a0</th><th>61</th><td class=\"r\"><span>&nbsp; &nbsp; &nbsp; &nbsp; callback(serviceObj, data);</span>\u00a0</td>\n                      </tr>\n            </tbody><tbody class=\"unmod\">\n                  <tr>\n                          <th>9</th><th>62</th><td class=\"l\"><span>}</span>\u00a0</td>\n                  </tr><tr>\n                          <th>10</th><th>63</th><td class=\"l\"><span></span>\u00a0</td>\n                  </tr>\n            </tbody><tbody class=\"mod\">\n                      <tr class=\"first\">\n                        <th>11</th><th>\u00a0</th><td class=\"l\"><span><del>gboolean nomatic_service_start(</del>)</span>\u00a0</td>\n                      </tr>\n                      <tr class=\"last\">\n                        <th>\u00a0</th><th>64</th><td class=\"r\"><span><ins>void nomatic_service_free(NomaticService *service</ins>)</span>\u00a0</td>\n                      </tr>\n            </tbody><tbody class=\"unmod\">\n                  <tr>\n                          <th>12</th><th>65</th><td class=\"l\"><span>{</span>\u00a0</td>\n                  </tr>\n            </tbody><tbody class=\"mod\">\n                      <tr class=\"first\">\n                        <th>13</th><th>\u00a0</th><td class=\"l\"><span>&nbsp; &nbsp; &nbsp; &nbsp; set_error(\"nomatic_service_start is not yet implemented.\");</span>\u00a0</td>\n                      </tr><tr>\n                        <th>14</th><th>\u00a0</th><td class=\"l\"><span>&nbsp; &nbsp; &nbsp; &nbsp; return FALSE;</span>\u00a0</td>\n                      </tr>\n                      <tr>\n                        <th>\u00a0</th><th>66</th><td class=\"r\"><span>&nbsp; &nbsp; &nbsp; &nbsp; /* TODO: Disconnect, too */</span>\u00a0</td>\n                      </tr><tr>\n                        <th>\u00a0</th><th>67</th><td class=\"r\"><span>&nbsp; &nbsp; &nbsp; &nbsp; if (service-&gt;conn != NULL)</span>\u00a0</td>\n                      </tr><tr>\n                        <th>\u00a0</th><th>68</th><td class=\"r\"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; gnet_conn_unref(service-&gt;conn);</span>\u00a0</td>\n                      </tr><tr class=\"last\">\n                        <th>\u00a0</th><th>69</th><td class=\"r\"><span>&nbsp; &nbsp; &nbsp; &nbsp; free(service);</span>\u00a0</td>\n                      </tr>\n            </tbody><tbody class=\"unmod\">\n                  <tr>\n                          <th>15</th><th>70</th><td class=\"l\"><span>}</span>\u00a0</td>\n                  </tr>\n            </tbody><tbody class=\"add\">\n                  <tr class=\"first\">\n                          <th>\u00a0</th><th>71</th><td class=\"r\"><ins></ins>\u00a0</td>\n                  </tr><tr>\n                          <th>\u00a0</th><th>72</th><td class=\"r\"><ins>/*****************</ins>\u00a0</td>\n                  </tr><tr>\n                          <th>\u00a0</th><th>73</th><td class=\"r\"><ins>&nbsp;*&nbsp; Private&nbsp; *</ins>\u00a0</td>\n                  </tr><tr>\n                          <th>\u00a0</th><th>74</th><td class=\"r\"><ins>&nbsp;****************/</ins>\u00a0</td>\n                  </tr><tr>\n                          <th>\u00a0</th><th>75</th><td class=\"r\"><ins></ins>\u00a0</td>\n                  </tr><tr>\n                          <th>\u00a0</th><th>76</th><td class=\"r\"><ins>void gconn_cb(GConn *conn, GConnEvent *event, gpointer user_data)</ins>\u00a0</td>\n                  </tr><tr>\n                          <th>\u00a0</th><th>77</th><td class=\"r\"><ins>{</ins>\u00a0</td>\n                  </tr><tr>\n                          <th>\u00a0</th><th>78</th><td class=\"r\"><ins>&nbsp; &nbsp; &nbsp; &nbsp; NomaticService *service = (NomaticService*) user_data;</ins>\u00a0</td>\n                  </tr><tr>\n                          <th>\u00a0</th><th>79</th><td class=\"r\"><ins>}</ins>\u00a0</td>\n                  </tr><tr>\n                          <th>\u00a0</th><th>80</th><td class=\"r\"><ins></ins>\u00a0</td>\n                  </tr><tr>\n                          <th>\u00a0</th><th>81</th><td class=\"r\"><ins>GInetAddr *get_addr_from_host(const gchar *host) {</ins>\u00a0</td>\n                  </tr><tr>\n                          <th>\u00a0</th><th>82</th><td class=\"r\"><ins>&nbsp; &nbsp; &nbsp; &nbsp; GInetAddr *ret = NULL;</ins>\u00a0</td>\n                  </tr><tr>\n                          <th>\u00a0</th><th>83</th><td class=\"r\"><ins>&nbsp; &nbsp; &nbsp; &nbsp; char *cp;</ins>\u00a0</td>\n                  </tr><tr>\n                          <th>\u00a0</th><th>84</th><td class=\"r\"><ins>&nbsp; &nbsp; &nbsp; &nbsp; char *hostname;</ins>\u00a0</td>\n                  </tr><tr>\n                          <th>\u00a0</th><th>85</th><td class=\"r\"><ins>&nbsp; &nbsp; &nbsp; &nbsp; int port;</ins>\u00a0</td>\n                  </tr><tr>\n                          <th>\u00a0</th><th>86</th><td class=\"r\"><ins>&nbsp; &nbsp; &nbsp; &nbsp; </ins>\u00a0</td>\n                  </tr><tr>\n                          <th>\u00a0</th><th>87</th><td class=\"r\"><ins>&nbsp; &nbsp; &nbsp; &nbsp; /* Compute length of string */</ins>\u00a0</td>\n                  </tr><tr>\n                          <th>\u00a0</th><th>88</th><td class=\"r\"><ins>&nbsp; &nbsp; &nbsp; &nbsp; size_t length = strlen(host);</ins>\u00a0</td>\n                  </tr><tr>\n                          <th>\u00a0</th><th>89</th><td class=\"r\"><ins>&nbsp; &nbsp; &nbsp; &nbsp; if (length &lt; 1) {</ins>\u00a0</td>\n                  </tr><tr>\n                          <th>\u00a0</th><th>90</th><td class=\"r\"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; set_error(\"An empty string was passed to get_addr_from_host.\");</ins>\u00a0</td>\n                  </tr><tr>\n                          <th>\u00a0</th><th>91</th><td class=\"r\"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ret = FALSE;</ins>\u00a0</td>\n                  </tr><tr>\n                          <th>\u00a0</th><th>92</th><td class=\"r\"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; goto out;</ins>\u00a0</td>\n                  </tr><tr>\n                          <th>\u00a0</th><th>93</th><td class=\"r\"><ins>&nbsp; &nbsp; &nbsp; &nbsp; }</ins>\u00a0</td>\n                  </tr><tr>\n                          <th>\u00a0</th><th>94</th><td class=\"r\"><ins>&nbsp; &nbsp; &nbsp; &nbsp; </ins>\u00a0</td>\n                  </tr><tr>\n                          <th>\u00a0</th><th>95</th><td class=\"r\"><ins>&nbsp; &nbsp; &nbsp; &nbsp; /* Break host into hostname and port */</ins>\u00a0</td>\n                  </tr><tr>\n                          <th>\u00a0</th><th>96</th><td class=\"r\"><ins>&nbsp; &nbsp; &nbsp; &nbsp; if (rindex(host, ':') == NULL) {</ins>\u00a0</td>\n                  </tr><tr>\n                          <th>\u00a0</th><th>97</th><td class=\"r\"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; /* Then there is no port and we should use the default */</ins>\u00a0</td>\n                  </tr><tr>\n                          <th>\u00a0</th><th>98</th><td class=\"r\"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ret = gnet_inetaddr_new(host, DEFAULT_NOMATIC_SERVICE_PORT);</ins>\u00a0</td>\n                  </tr><tr>\n                          <th>\u00a0</th><th>99</th><td class=\"r\"><ins>&nbsp; &nbsp; &nbsp; &nbsp; }</ins>\u00a0</td>\n                  </tr><tr>\n                          <th>\u00a0</th><th>100</th><td class=\"r\"><ins>&nbsp; &nbsp; &nbsp; &nbsp; else {</ins>\u00a0</td>\n                  </tr><tr>\n                          <th>\u00a0</th><th>101</th><td class=\"r\"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; cp = strdup(host);</ins>\u00a0</td>\n                  </tr><tr>\n                          <th>\u00a0</th><th>102</th><td class=\"r\"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; /* TODO: Check the following two calls for errors */</ins>\u00a0</td>\n                  </tr><tr>\n                          <th>\u00a0</th><th>103</th><td class=\"r\"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; hostname = strtok(cp, \":\");</ins>\u00a0</td>\n                  </tr><tr>\n                          <th>\u00a0</th><th>104</th><td class=\"r\"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; /* TODO: Check the following for errors and don't use atoi() */</ins>\u00a0</td>\n                  </tr><tr>\n                          <th>\u00a0</th><th>105</th><td class=\"r\"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; port = atoi(strtok(NULL, \":\"));</ins>\u00a0</td>\n                  </tr><tr>\n                          <th>\u00a0</th><th>106</th><td class=\"r\"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; /* Assert that that's the end */</ins>\u00a0</td>\n                  </tr><tr>\n                          <th>\u00a0</th><th>107</th><td class=\"r\"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (strtok(NULL, \":\") != NULL) {</ins>\u00a0</td>\n                  </tr><tr>\n                          <th>\u00a0</th><th>108</th><td class=\"r\"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; set_error(\"Invalid host passed to get_addr_from_host.\");</ins>\u00a0</td>\n                  </tr><tr>\n                          <th>\u00a0</th><th>109</th><td class=\"r\"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; goto out;</ins>\u00a0</td>\n                  </tr><tr>\n                          <th>\u00a0</th><th>110</th><td class=\"r\"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</ins>\u00a0</td>\n                  </tr><tr>\n                          <th>\u00a0</th><th>111</th><td class=\"r\"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </ins>\u00a0</td>\n                  </tr><tr>\n                          <th>\u00a0</th><th>112</th><td class=\"r\"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ret = gnet_inetaddr_new(hostname, port);</ins>\u00a0</td>\n                  </tr><tr>\n                          <th>\u00a0</th><th>113</th><td class=\"r\"><ins>&nbsp; &nbsp; &nbsp; &nbsp; }</ins>\u00a0</td>\n                  </tr><tr>\n                          <th>\u00a0</th><th>114</th><td class=\"r\"><ins></ins>\u00a0</td>\n                  </tr><tr>\n                          <th>\u00a0</th><th>115</th><td class=\"r\"><ins>out:</ins>\u00a0</td>\n                  </tr><tr>\n                          <th>\u00a0</th><th>116</th><td class=\"r\"><ins>&nbsp; &nbsp; &nbsp; &nbsp; if (cp != NULL)</ins>\u00a0</td>\n                  </tr><tr>\n                          <th>\u00a0</th><th>117</th><td class=\"r\"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; free(cp);</ins>\u00a0</td>\n                  </tr><tr>\n                          <th>\u00a0</th><th>118</th><td class=\"r\"><ins>&nbsp; &nbsp; &nbsp; &nbsp; /* TODO: Figure out why we don't seem to need to free hostname.</ins>\u00a0</td>\n                  </tr><tr>\n                          <th>\u00a0</th><th>119</th><td class=\"r\"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;It's something about the way strdup works. */</ins>\u00a0</td>\n                  </tr><tr>\n                          <th>\u00a0</th><th>120</th><td class=\"r\"><ins>&nbsp; &nbsp; &nbsp; &nbsp; /*if (hostname != NULL)</ins>\u00a0</td>\n                  </tr><tr>\n                          <th>\u00a0</th><th>121</th><td class=\"r\"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; free(hostname);*/</ins>\u00a0</td>\n                  </tr><tr>\n                          <th>\u00a0</th><th>122</th><td class=\"r\"><ins>&nbsp; &nbsp; &nbsp; &nbsp; return ret;</ins>\u00a0</td>\n                  </tr><tr class=\"last\">\n                          <th>\u00a0</th><th>123</th><td class=\"r\"><ins>}</ins>\u00a0</td>\n                  </tr>\n            </tbody>\n        </table>\n      </li>\n  </ul>\n</div>\n        <div id=\"help\"><strong>Note:</strong> See <a href=\"/LUCICodeRepository/nomaticIM/wiki/TracChangeset\">TracChangeset</a>\n          for help on using the changeset viewer.</div>\n      </div>\n    </div>\n    <div id=\"altlinks\">\n      <h3>Download in other formats:</h3>\n      <ul>\n        <li class=\"first\">\n          <a rel=\"nofollow\" href=\"?format=diff&amp;new=306\" class=\"diff\">Unified Diff</a>\n        </li><li class=\"last\">\n          <a rel=\"nofollow\" href=\"?format=zip&amp;new=306\" class=\"zip\">Zip Archive</a>\n        </li>\n      </ul>\n    </div>\n    </div>\n    <div id=\"footer\" lang=\"en\" xml:lang=\"en\"><hr />\n      <a id=\"tracpowered\" href=\"http://trac.edgewall.org/\"><img src=\"/LUCICodeRepository/nomaticIM/chrome/common/trac_logo_mini.png\" height=\"30\" width=\"107\" alt=\"Trac Powered\" /></a>\n      <p class=\"left\">Powered by <a href=\"/LUCICodeRepository/nomaticIM/about\"><strong>Trac 1.0.1</strong></a><br />\n        By <a href=\"http://www.edgewall.org/\">Edgewall Software</a>.</p>\n      <p class=\"right\">All content copyright 2007-2008 by LUCI <br /><a href=\"http://luci.ics.uci.edu/\">http://luci.ics.uci.edu/</a></p>\n    </div>\n\t\t<div id=\"sitefooter\">\n\t\t\t<script src=\"http://www.google-analytics.com/urchin.js\" type=\"text/javascript\">\n\t\t\t</script>\n\t\t\t<script type=\"text/javascript\">\n\t\t\t\t_uacct = \"UA-338915-2\";\n\t\t\t\turchinTracker();\n\t\t\t</script>\n\t\t</div>\n\t</body>\n</html>", "id": 45264.0}