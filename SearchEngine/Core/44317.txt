{"text": "Search LoginPreferencesHelp GuideAbout Trac WikiTimelineRoadmapBrowse SourceView TicketsSearch Context Navigation BlameRevision Log source nomatic tags NomaticIM 5 buddy bots src twisted internet dumbwin32proc py View diff against View revision Visit trunk Last change on this file was 712 checked in by cbaker 7 years ago First draft of nomatic buddy bots oscar bot is functional if you give it good authentication credentials jabber bot is just an example from the web File size 1 4 KB Line 1 test case name twisted test test process 2 34http isometric sixsided org gates in the head 56 78import os91 Win32 imports11import win32api12import win32con13import win32event14import win32file15import win32pipe16import win32process17import win32security1819import pywintypes2 21 security attributes for pipes22PIPE ATTRS INHERITABLE win32security SECURITY ATTRIBUTES 23PIPE ATTRS INHERITABLE bInheritHandle 12425from zope interface import implements26from twisted internet interfaces import IProcessTransport IConsumer IProducer2728from twisted python win32 import quoteArguments293 from twisted internet import error31from twisted python import failure3233from twisted internet import pollingfile3435def debug msg 36 import sys37 print msg38 sys stdout flush 394 class Reaper pollingfile PollableResource 4142 def init self proc 43 self proc proc4445 def checkWork self 46 if win32event WaitForSingleObject self proc hProcess win32event WAIT OBJECT 47 return 48 exitCode win32process GetExitCodeProcess self proc hProcess 49 if exitCode 5 err error ProcessDone exitCode 51 else 52 err error ProcessTerminated exitCode 53 self deactivate 54 self proc protocol processEnded failure Failure err 55 return 565758def findShebang filename 59 6 Look for a line and return the value following the if one exists or61 None if this file is not a script 6263 I don t know if there are any conventions for quoting in Windows shebang64 lines so this doesn t support any therefore you may not pass any65 arguments to scripts invoked as filters That s probably wrong so if66 somebody knows more about the cultural expectations on Windows please feel67 free to fix 6869 This shebang line support was added in support of the CGI tests 7 appropriately enough I determined that shebang lines are culturally71 accepted in the Windows world through this page 7273 http www cgi1 1 com learn connect winxp html7475 param filename str representing a filename7677 return a str representing another filename 78 79 f file filename ru 8 if f read 2 81 exe f readline 1 24 strip n 82 return exe8384def invalidWin32App pywinerr 85 86 Determine if a pywintypes error is telling us that the given process is87 not a valid win32 application i e not a PE format executable 8889 param pywinerr a pywintypes error instance raised by CreateProcess9 91 return a boolean92 9394 Let s do this better in the future but I have no idea what this error95 is MSDN doesn t mention it and there is no symbolic constant in96 win32process module that represents 193 9798 return pywinerr args 193991 class Process pollingfile PollingTimer 1 1 A process that integrates with the Twisted event loop 1 21 3 If your subprocess is a python program you need to 1 41 5 Run python exe with the u command line option this turns on1 6 unbuffered I O Buffering stdout err in can cause problems see e g 1 7 http support microsoft com default aspx scid kb EN US q19 31 81 9 If you don t want Windows messing with data passed over11 stdin out err set the pipes to be in binary mode 111112 import os sys mscvrt113 msvcrt setmode sys stdin fileno os O BINARY 114 msvcrt setmode sys stdout fileno os O BINARY 115 msvcrt setmode sys stderr fileno os O BINARY 116117 118 implements IProcessTransport IConsumer IProducer 11912 buffer 121122 def init self reactor protocol command args environment path 123 pollingfile PollingTimer init self reactor 124 self protocol protocol125126 security attributes for pipes127 sAttrs win32security SECURITY ATTRIBUTES 128 sAttrs bInheritHandle 112913 create the pipes which will connect to the secondary process131 self hStdoutR hStdoutW win32pipe CreatePipe sAttrs 132 self hStderrR hStderrW win32pipe CreatePipe sAttrs 133 hStdinR self hStdinW win32pipe CreatePipe sAttrs 134135 win32pipe SetNamedPipeHandleState self hStdinW 136 win32pipe PIPE NOWAIT 137 None 138 None 13914 set the info structure for the new process 141 StartupInfo win32process STARTUPINFO 142 StartupInfo hStdOutput hStdoutW143 StartupInfo hStdError hStderrW144 StartupInfo hStdInput hStdinR145 StartupInfo dwFlags win32process STARTF USESTDHANDLES146147 Create new handles whose inheritance property is false148 pid win32api GetCurrentProcess 14915 tmp win32api DuplicateHandle pid self hStdoutR pid 151 win32con DUPLICATE SAME ACCESS 152 win32file CloseHandle self hStdoutR 153 self hStdoutR tmp154155 tmp win32api DuplicateHandle pid self hStderrR pid 156 win32con DUPLICATE SAME ACCESS 157 win32file CloseHandle self hStderrR 158 self hStderrR tmp15916 tmp win32api DuplicateHandle pid self hStdinW pid 161 win32con DUPLICATE SAME ACCESS 162 win32file CloseHandle self hStdinW 163 self hStdinW tmp164165 Add the specified environment to the current environment this is166 necessary because certain operations are only supported on Windows167 if certain environment variables are present 168169 env os environ copy 17 env update environment or 171172 cmdline quoteArguments args 173 TODO error detection here 174 def doCreate 175 self hProcess self hThread dwPid dwTid win32process CreateProcess 176 command cmdline None None 1 env path StartupInfo 177 try 178 doCreate 179 except pywintypes error pwte 18 if not invalidWin32App pwte 181 This behavior isn t really documented but let s make it182 consistent with the behavior that is documented 183 raise OSError pwte 184 else 185 look for a shebang line Insert the original command 186 actually a script into the new arguments list 187 sheb findShebang command 188 if sheb is None 189 raise OSError 19 r is neither a Windows executable 191 nor a script with a shebang line command 192 else 193 args list args 194 args insert command 195 cmdline quoteArguments args 196 origcmd command197 command sheb198 try 199 Let s try again 2 doCreate 2 1 except pywintypes error pwte2 2 2 d oh failed again 2 3 if invalidWin32App pwte2 2 4 raise OSError 2 5 r has an invalid shebang line 2 6 r is not a valid executable 2 7 origcmd sheb 2 8 raise OSError pwte2 2 921 win32file CloseHandle self hThread 211212 close handles which only the child will use213 win32file CloseHandle hStderrW 214 win32file CloseHandle hStdoutW 215 win32file CloseHandle hStdinR 216217 self closed 218 self closedNotifies 21922 set up everything221 self stdout pollingfile PollableReadPipe 222 self hStdoutR 223 lambda data self protocol childDataReceived 1 data 224 self outConnectionLost 225226 self stderr pollingfile PollableReadPipe 227 self hStderrR 228 lambda data self protocol childDataReceived 2 data 229 self errConnectionLost 23 231 self stdin pollingfile PollableWritePipe 232 self hStdinW self inConnectionLost 233234 for pipewatcher in self stdout self stderr self stdin 235 self addPollableResource pipewatcher 236237238 notify protocol239 self protocol makeConnection self 24 241 maybe a good idea in win32er otherwise not242 self reactor addEvent self hProcess self inConnectionLost 243244245 def signalProcess self signalID 246 if signalID in INT TERM KILL 247 win32process TerminateProcess self hProcess 1 248249 def write self data 25 Write data to the process stdin 251 self stdin write data 252253 def writeSequence self seq 254 Write data to the process stdin 255 self stdin writeSequence seq 256257 def closeChildFD self fd 258 if fd 259 self closeStdin 26 elif fd 1 261 self closeStdout 262 elif fd 2 263 self closeStderr 264 else 265 raise NotImplementedError Only standard IO file descriptors available on win32 266267 def closeStdin self 268 Close the process stdin 269 27 self stdin close 271272 def closeStderr self 273 self stderr close 274275 def closeStdout self 276 self stdout close 277278 def loseConnection self 279 Close the process stdout in and err 28 self closeStdin 281 self closeStdout 282 self closeStderr 283284 def outConnectionLost self 285 self protocol childConnectionLost 1 286 self connectionLostNotify 287288 def errConnectionLost self 289 self protocol childConnectionLost 2 29 self connectionLostNotify 291292 def inConnectionLost self 293 self protocol childConnectionLost 294 self connectionLostNotify 295296 def connectionLostNotify self 297 Will be called 3 times by stdout err threads and process handle 298 self closedNotifies self closedNotifies 1299 if self closedNotifies 3 3 self closed 13 1 self addPollableResource Reaper self 3 23 3 IConsumer3 4 def registerProducer self producer streaming 3 5 self stdin registerProducer producer streaming 3 63 7 def unregisterProducer self 3 8 self stdin unregisterProducer 3 931 IProducer311 def pauseProducing self 312 self pause 313314 def resumeProducing self 315 self unpause 316317 def stopProducing self 318 self loseConnection 319 Note See TracBrowser for help on using the repository browser Download in other formats Plain Text Original Format Powered by Trac 1 1 By Edgewall Software All content copyright 2 7 2 8 by LUCI http luci ics uci edu ", "_id": "http://djp3-pc2.ics.uci.edu/LUCICodeRepository/nomaticIM/browser/nomatic/tags/NomaticIM-0.0.5/buddy_bots/src/twisted/internet/_dumbwin32proc.py", "title": "\n      _dumbwin32proc.py in nomatic/tags/nomaticim-0.0.5/buddy_bots/src/twisted/internet\n     \u2013 nomatic*im\n    ", "html": "<!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Strict//EN\" \"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd\">\n<html xmlns=\"http://www.w3.org/1999/xhtml\">\n  \n  \n\n  \n\n\n  <head>\n\t\t<title>\n      _dumbwin32proc.py in nomatic/tags/NomaticIM-0.0.5/buddy_bots/src/twisted/internet\n     \u2013 Nomatic*IM\n    </title><meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\" /><meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge\" /><link rel=\"search\" href=\"/LUCICodeRepository/nomaticIM/search\" /><link rel=\"help\" href=\"/LUCICodeRepository/nomaticIM/wiki/TracGuide\" /><link rel=\"alternate\" href=\"/LUCICodeRepository/nomaticIM/browser/nomatic/tags/NomaticIM-0.0.5/buddy_bots/src/twisted/internet/_dumbwin32proc.py?format=txt\" type=\"text/plain\" title=\"Plain Text\" /><link rel=\"alternate\" href=\"/LUCICodeRepository/nomaticIM/export/1312/nomatic/tags/NomaticIM-0.0.5/buddy_bots/src/twisted/internet/_dumbwin32proc.py\" type=\"application/x-python; charset=iso-8859-15\" title=\"Original Format\" /><link rel=\"start\" href=\"/LUCICodeRepository/nomaticIM/wiki\" /><link rel=\"stylesheet\" href=\"/LUCICodeRepository/nomaticIM/chrome/common/css/trac.css\" type=\"text/css\" /><link rel=\"stylesheet\" href=\"/LUCICodeRepository/nomaticIM/chrome/common/css/code.css\" type=\"text/css\" /><link rel=\"stylesheet\" href=\"/LUCICodeRepository/nomaticIM/pygments/trac.css\" type=\"text/css\" /><link rel=\"stylesheet\" href=\"/LUCICodeRepository/nomaticIM/chrome/common/css/browser.css\" type=\"text/css\" /><link rel=\"shortcut icon\" href=\"http://luci.ics.uci.edu/logo32by32.gif\" type=\"image/gif\" /><link rel=\"icon\" href=\"http://luci.ics.uci.edu/logo32by32.gif\" type=\"image/gif\" /><link type=\"application/opensearchdescription+xml\" rel=\"search\" href=\"/LUCICodeRepository/nomaticIM/search/opensearch\" title=\"Search Nomatic*IM\" /><script type=\"text/javascript\" charset=\"utf-8\" src=\"/LUCICodeRepository/nomaticIM/chrome/common/js/jquery.js\"></script><script type=\"text/javascript\" charset=\"utf-8\" src=\"/LUCICodeRepository/nomaticIM/chrome/common/js/babel.js\"></script><script type=\"text/javascript\" charset=\"utf-8\" src=\"/LUCICodeRepository/nomaticIM/chrome/common/js/messages/en_US.js\"></script><script type=\"text/javascript\" charset=\"utf-8\" src=\"/LUCICodeRepository/nomaticIM/chrome/common/js/trac.js\"></script><script type=\"text/javascript\" charset=\"utf-8\" src=\"/LUCICodeRepository/nomaticIM/chrome/common/js/search.js\"></script><script type=\"text/javascript\" src=\"/LUCICodeRepository/nomaticIM/chrome/common/js/folding.js\"></script><script type=\"text/javascript\">\n      jQuery(document).ready(function($) {\n        $(\".trac-toggledeleted\").show().click(function() {\n                  $(this).siblings().find(\".trac-deleted\").toggle();\n                  return false;\n        }).click();\n        $(\"#jumploc input\").hide();\n        $(\"#jumploc select\").change(function () {\n          this.parentNode.parentNode.submit();\n        });\n          $('#preview table.code').enableCollapsibleColumns($('#preview table.code thead th.content'));\n      });\n    </script>\n\t</head>\n  <body>\n    <div id=\"banner\">\n      <div id=\"header\">\n        <a id=\"logo\" href=\"http://luci.ics.uci.edu/#code\"><img src=\"http://luci.ics.uci.edu/blog/archives/LUCIhorzTight.jpg\" alt=\"LUCI Code Repository\" /></a>\n      </div>\n      <form id=\"search\" action=\"/LUCICodeRepository/nomaticIM/search\" method=\"get\">\n        <div>\n          <label for=\"proj-search\">Search:</label>\n          <input type=\"text\" id=\"proj-search\" name=\"q\" size=\"18\" value=\"\" />\n          <input type=\"submit\" value=\"Search\" />\n        </div>\n      </form>\n      <div id=\"metanav\" class=\"nav\">\n    <ul>\n      <li class=\"first\"><a href=\"/LUCICodeRepository/nomaticIM/login\">Login</a></li><li><a href=\"/LUCICodeRepository/nomaticIM/prefs\">Preferences</a></li><li><a href=\"/LUCICodeRepository/nomaticIM/wiki/TracGuide\">Help/Guide</a></li><li class=\"last\"><a href=\"/LUCICodeRepository/nomaticIM/about\">About Trac</a></li>\n    </ul>\n  </div>\n    </div>\n    <div id=\"mainnav\" class=\"nav\">\n    <ul>\n      <li class=\"first\"><a href=\"/LUCICodeRepository/nomaticIM/wiki\">Wiki</a></li><li><a href=\"/LUCICodeRepository/nomaticIM/timeline\">Timeline</a></li><li><a href=\"/LUCICodeRepository/nomaticIM/roadmap\">Roadmap</a></li><li class=\"active\"><a href=\"/LUCICodeRepository/nomaticIM/browser\">Browse Source</a></li><li><a href=\"/LUCICodeRepository/nomaticIM/report\">View Tickets</a></li><li class=\"last\"><a href=\"/LUCICodeRepository/nomaticIM/search\">Search</a></li>\n    </ul>\n  </div>\n    <div id=\"main\">\n      <div id=\"ctxtnav\" class=\"nav\">\n        <h2>Context Navigation</h2>\n        <ul>\n          <li class=\"first\"><a href=\"/LUCICodeRepository/nomaticIM/browser/nomatic/trunk/buddy_bots/twisted/internet/_dumbwin32proc.py?annotate=blame\" title=\"Annotate each line with the last changed revision (this can be time consuming...)\">Blame</a></li><li class=\"last\"><a href=\"/LUCICodeRepository/nomaticIM/log/nomatic/tags/NomaticIM-0.0.5/buddy_bots/src/twisted/internet/_dumbwin32proc.py\">Revision Log</a></li>\n        </ul>\n        <hr />\n      </div>\n    <div id=\"content\" class=\"browser\">\n        <h1>\n          \n<a class=\"pathentry first\" href=\"/LUCICodeRepository/nomaticIM/browser?order=name\" title=\"Go to repository root\">source:</a>\n<a class=\"pathentry\" href=\"/LUCICodeRepository/nomaticIM/browser/nomatic?order=name\" title=\"View nomatic\">nomatic</a><span class=\"pathentry sep\">/</span><a class=\"pathentry\" href=\"/LUCICodeRepository/nomaticIM/browser/nomatic/tags?order=name\" title=\"View tags\">tags</a><span class=\"pathentry sep\">/</span><a class=\"pathentry\" href=\"/LUCICodeRepository/nomaticIM/browser/nomatic/tags/NomaticIM-0.0.5?order=name\" title=\"View NomaticIM-0.0.5\">NomaticIM-0.0.5</a><span class=\"pathentry sep\">/</span><a class=\"pathentry\" href=\"/LUCICodeRepository/nomaticIM/browser/nomatic/tags/NomaticIM-0.0.5/buddy_bots?order=name\" title=\"View buddy_bots\">buddy_bots</a><span class=\"pathentry sep\">/</span><a class=\"pathentry\" href=\"/LUCICodeRepository/nomaticIM/browser/nomatic/tags/NomaticIM-0.0.5/buddy_bots/src?order=name\" title=\"View src\">src</a><span class=\"pathentry sep\">/</span><a class=\"pathentry\" href=\"/LUCICodeRepository/nomaticIM/browser/nomatic/tags/NomaticIM-0.0.5/buddy_bots/src/twisted?order=name\" title=\"View twisted\">twisted</a><span class=\"pathentry sep\">/</span><a class=\"pathentry\" href=\"/LUCICodeRepository/nomaticIM/browser/nomatic/tags/NomaticIM-0.0.5/buddy_bots/src/twisted/internet?order=name\" title=\"View internet\">internet</a><span class=\"pathentry sep\">/</span><a class=\"pathentry\" href=\"/LUCICodeRepository/nomaticIM/browser/nomatic/tags/NomaticIM-0.0.5/buddy_bots/src/twisted/internet/_dumbwin32proc.py?order=name\" title=\"View _dumbwin32proc.py\">_dumbwin32proc.py</a>\n<br style=\"clear: both\" />\n\n        </h1>\n        <div id=\"diffrev\">\n          <form action=\"/LUCICodeRepository/nomaticIM/changeset\" method=\"get\">\n            <div>\n              <label title=\"Show the diff against a specific revision\">\n                View diff against: <input type=\"text\" name=\"old\" size=\"6\" />\n                <input type=\"hidden\" name=\"old_path\" value=\"nomatic/tags/NomaticIM-0.0.5/buddy_bots/src/twisted/internet/_dumbwin32proc.py\" />\n                <input type=\"hidden\" name=\"new\" />\n                <input type=\"hidden\" name=\"new_path\" value=\"nomatic/tags/NomaticIM-0.0.5/buddy_bots/src/twisted/internet/_dumbwin32proc.py\" />\n              </label>\n            </div>\n          </form>\n        </div>\n        <div id=\"jumprev\">\n          <form action=\"\" method=\"get\">\n            <div>\n              <label for=\"rev\">\n                View revision:</label>\n              <input type=\"text\" id=\"rev\" name=\"rev\" size=\"6\" />\n            </div>\n          </form>\n        </div>\n        <div id=\"jumploc\">\n          <form action=\"\" method=\"get\">\n            <div class=\"buttons\">\n              <label for=\"preselected\">Visit:</label>\n              <select id=\"preselected\" name=\"preselected\">\n                <option selected=\"selected\"></option>\n                <optgroup label=\"branches\">\n                  <option value=\"/LUCICodeRepository/nomaticIM/browser/trunk\">trunk</option>\n                </optgroup>\n              </select>\n              <input type=\"submit\" value=\"Go!\" title=\"Jump to the chosen preselected path\" />\n            </div>\n          </form>\n        </div>\n        <div class=\"trac-tags\">\n        </div>\n      <table id=\"info\" summary=\"Revision info\">\n        <tr>\n          <th>\n                <a href=\"/LUCICodeRepository/nomaticIM/changeset/712/nomatic/trunk/buddy_bots/twisted/internet/_dumbwin32proc.py\" title=\"View differences\">Last change</a>\n                  on this file was\n                  <a href=\"/LUCICodeRepository/nomaticIM/changeset/712/\" title=\"View changeset 712\">712</a>,\n                  checked in by cbaker, <a class=\"timeline\" href=\"/LUCICodeRepository/nomaticIM/timeline?from=2008-02-16T08%3A16%3A53-08%3A00&amp;precision=second\" title=\"See timeline at Feb 16, 2008, 8:16:53 AM\">7 years ago</a>\n          </th>\n        </tr>\n        <tr>\n          <td class=\"message searchable\">\n              <p>\nFirst draft of nomatic buddy bots. oscar_bot is functional if you give it good authentication credentials, jabber_bot is just an example from the web <br />\n</p>\n          </td>\n        </tr>\n        <tr><td colspan=\"2\">\n            <strong>File size:</strong>\n            <span title=\"10618 bytes\">10.4 KB</span>\n          </td></tr>\n      </table>\n      <div id=\"preview\" class=\"searchable\">\n        \n  <table class=\"code\"><thead><tr><th class=\"lineno\" title=\"Line numbers\">Line</th><th class=\"content\">\u00a0</th></tr></thead><tbody><tr><th id=\"L1\"><a href=\"#L1\">1</a></th><td><span class=\"c\"># -*- test-case-name: twisted.test.test_process -*-</span></td></tr><tr><th id=\"L2\"><a href=\"#L2\">2</a></th><td><span class=\"sd\">\"\"\"</span></td></tr><tr><th id=\"L3\"><a href=\"#L3\">3</a></th><td><span class=\"sd\"></span></td></tr><tr><th id=\"L4\"><a href=\"#L4\">4</a></th><td><span class=\"sd\">http://isometric.sixsided.org/_/gates_in_the_head/</span></td></tr><tr><th id=\"L5\"><a href=\"#L5\">5</a></th><td><span class=\"sd\"></span></td></tr><tr><th id=\"L6\"><a href=\"#L6\">6</a></th><td><span class=\"sd\">\"\"\"</span></td></tr><tr><th id=\"L7\"><a href=\"#L7\">7</a></th><td></td></tr><tr><th id=\"L8\"><a href=\"#L8\">8</a></th><td><span class=\"kn\">import</span>\u00a0<span class=\"nn\">os</span></td></tr><tr><th id=\"L9\"><a href=\"#L9\">9</a></th><td></td></tr><tr><th id=\"L10\"><a href=\"#L10\">10</a></th><td><span class=\"c\"># Win32 imports</span></td></tr><tr><th id=\"L11\"><a href=\"#L11\">11</a></th><td><span class=\"kn\">import</span>\u00a0<span class=\"nn\">win32api</span></td></tr><tr><th id=\"L12\"><a href=\"#L12\">12</a></th><td><span class=\"kn\">import</span>\u00a0<span class=\"nn\">win32con</span></td></tr><tr><th id=\"L13\"><a href=\"#L13\">13</a></th><td><span class=\"kn\">import</span>\u00a0<span class=\"nn\">win32event</span></td></tr><tr><th id=\"L14\"><a href=\"#L14\">14</a></th><td><span class=\"kn\">import</span>\u00a0<span class=\"nn\">win32file</span></td></tr><tr><th id=\"L15\"><a href=\"#L15\">15</a></th><td><span class=\"kn\">import</span>\u00a0<span class=\"nn\">win32pipe</span></td></tr><tr><th id=\"L16\"><a href=\"#L16\">16</a></th><td><span class=\"kn\">import</span>\u00a0<span class=\"nn\">win32process</span></td></tr><tr><th id=\"L17\"><a href=\"#L17\">17</a></th><td><span class=\"kn\">import</span>\u00a0<span class=\"nn\">win32security</span></td></tr><tr><th id=\"L18\"><a href=\"#L18\">18</a></th><td></td></tr><tr><th id=\"L19\"><a href=\"#L19\">19</a></th><td><span class=\"kn\">import</span>\u00a0<span class=\"nn\">pywintypes</span></td></tr><tr><th id=\"L20\"><a href=\"#L20\">20</a></th><td></td></tr><tr><th id=\"L21\"><a href=\"#L21\">21</a></th><td><span class=\"c\"># security attributes for pipes</span></td></tr><tr><th id=\"L22\"><a href=\"#L22\">22</a></th><td>PIPE_ATTRS_INHERITABLE <span class=\"o\">=</span>\u00a0win32security<span class=\"o\">.</span>SECURITY_ATTRIBUTES<span class=\"p\">()</span></td></tr><tr><th id=\"L23\"><a href=\"#L23\">23</a></th><td>PIPE_ATTRS_INHERITABLE<span class=\"o\">.</span>bInheritHandle <span class=\"o\">=</span>\u00a0<span class=\"mi\">1</span></td></tr><tr><th id=\"L24\"><a href=\"#L24\">24</a></th><td></td></tr><tr><th id=\"L25\"><a href=\"#L25\">25</a></th><td><span class=\"kn\">from</span>\u00a0<span class=\"nn\">zope.interface</span>\u00a0<span class=\"kn\">import</span>\u00a0implements</td></tr><tr><th id=\"L26\"><a href=\"#L26\">26</a></th><td><span class=\"kn\">from</span>\u00a0<span class=\"nn\">twisted.internet.interfaces</span>\u00a0<span class=\"kn\">import</span>\u00a0IProcessTransport<span class=\"p\">,</span>\u00a0IConsumer<span class=\"p\">,</span>\u00a0IProducer</td></tr><tr><th id=\"L27\"><a href=\"#L27\">27</a></th><td></td></tr><tr><th id=\"L28\"><a href=\"#L28\">28</a></th><td><span class=\"kn\">from</span>\u00a0<span class=\"nn\">twisted.python.win32</span>\u00a0<span class=\"kn\">import</span>\u00a0quoteArguments</td></tr><tr><th id=\"L29\"><a href=\"#L29\">29</a></th><td></td></tr><tr><th id=\"L30\"><a href=\"#L30\">30</a></th><td><span class=\"kn\">from</span>\u00a0<span class=\"nn\">twisted.internet</span>\u00a0<span class=\"kn\">import</span>\u00a0error</td></tr><tr><th id=\"L31\"><a href=\"#L31\">31</a></th><td><span class=\"kn\">from</span>\u00a0<span class=\"nn\">twisted.python</span>\u00a0<span class=\"kn\">import</span>\u00a0failure</td></tr><tr><th id=\"L32\"><a href=\"#L32\">32</a></th><td></td></tr><tr><th id=\"L33\"><a href=\"#L33\">33</a></th><td><span class=\"kn\">from</span>\u00a0<span class=\"nn\">twisted.internet</span>\u00a0<span class=\"kn\">import</span>\u00a0_pollingfile</td></tr><tr><th id=\"L34\"><a href=\"#L34\">34</a></th><td></td></tr><tr><th id=\"L35\"><a href=\"#L35\">35</a></th><td><span class=\"k\">def</span>\u00a0<span class=\"nf\">debug</span><span class=\"p\">(</span>msg<span class=\"p\">):</span></td></tr><tr><th id=\"L36\"><a href=\"#L36\">36</a></th><td>\u00a0 \u00a0 <span class=\"kn\">import</span>\u00a0<span class=\"nn\">sys</span></td></tr><tr><th id=\"L37\"><a href=\"#L37\">37</a></th><td>\u00a0 \u00a0 <span class=\"k\">print</span>\u00a0msg</td></tr><tr><th id=\"L38\"><a href=\"#L38\">38</a></th><td>\u00a0 \u00a0 sys<span class=\"o\">.</span>stdout<span class=\"o\">.</span>flush<span class=\"p\">()</span></td></tr><tr><th id=\"L39\"><a href=\"#L39\">39</a></th><td></td></tr><tr><th id=\"L40\"><a href=\"#L40\">40</a></th><td><span class=\"k\">class</span>\u00a0<span class=\"nc\">_Reaper</span><span class=\"p\">(</span>_pollingfile<span class=\"o\">.</span>_PollableResource<span class=\"p\">):</span></td></tr><tr><th id=\"L41\"><a href=\"#L41\">41</a></th><td></td></tr><tr><th id=\"L42\"><a href=\"#L42\">42</a></th><td>\u00a0 \u00a0 <span class=\"k\">def</span>\u00a0<span class=\"nf\">__init__</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span>\u00a0proc<span class=\"p\">):</span></td></tr><tr><th id=\"L43\"><a href=\"#L43\">43</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"bp\">self</span><span class=\"o\">.</span>proc <span class=\"o\">=</span>\u00a0proc</td></tr><tr><th id=\"L44\"><a href=\"#L44\">44</a></th><td></td></tr><tr><th id=\"L45\"><a href=\"#L45\">45</a></th><td>\u00a0 \u00a0 <span class=\"k\">def</span>\u00a0<span class=\"nf\">checkWork</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">):</span></td></tr><tr><th id=\"L46\"><a href=\"#L46\">46</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">if</span>\u00a0win32event<span class=\"o\">.</span>WaitForSingleObject<span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span>proc<span class=\"o\">.</span>hProcess<span class=\"p\">,</span>\u00a0<span class=\"mi\">0</span><span class=\"p\">)</span>\u00a0<span class=\"o\">!=</span>\u00a0win32event<span class=\"o\">.</span>WAIT_OBJECT_0<span class=\"p\">:</span></td></tr><tr><th id=\"L47\"><a href=\"#L47\">47</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">return</span>\u00a0<span class=\"mi\">0</span></td></tr><tr><th id=\"L48\"><a href=\"#L48\">48</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 exitCode <span class=\"o\">=</span>\u00a0win32process<span class=\"o\">.</span>GetExitCodeProcess<span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span>proc<span class=\"o\">.</span>hProcess<span class=\"p\">)</span></td></tr><tr><th id=\"L49\"><a href=\"#L49\">49</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">if</span>\u00a0exitCode <span class=\"o\">==</span>\u00a0<span class=\"mi\">0</span><span class=\"p\">:</span></td></tr><tr><th id=\"L50\"><a href=\"#L50\">50</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 err <span class=\"o\">=</span>\u00a0error<span class=\"o\">.</span>ProcessDone<span class=\"p\">(</span>exitCode<span class=\"p\">)</span></td></tr><tr><th id=\"L51\"><a href=\"#L51\">51</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">else</span><span class=\"p\">:</span></td></tr><tr><th id=\"L52\"><a href=\"#L52\">52</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 err <span class=\"o\">=</span>\u00a0error<span class=\"o\">.</span>ProcessTerminated<span class=\"p\">(</span>exitCode<span class=\"p\">)</span></td></tr><tr><th id=\"L53\"><a href=\"#L53\">53</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"bp\">self</span><span class=\"o\">.</span>deactivate<span class=\"p\">()</span></td></tr><tr><th id=\"L54\"><a href=\"#L54\">54</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"bp\">self</span><span class=\"o\">.</span>proc<span class=\"o\">.</span>protocol<span class=\"o\">.</span>processEnded<span class=\"p\">(</span>failure<span class=\"o\">.</span>Failure<span class=\"p\">(</span>err<span class=\"p\">))</span></td></tr><tr><th id=\"L55\"><a href=\"#L55\">55</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">return</span>\u00a0<span class=\"mi\">0</span></td></tr><tr><th id=\"L56\"><a href=\"#L56\">56</a></th><td></td></tr><tr><th id=\"L57\"><a href=\"#L57\">57</a></th><td></td></tr><tr><th id=\"L58\"><a href=\"#L58\">58</a></th><td><span class=\"k\">def</span>\u00a0<span class=\"nf\">_findShebang</span><span class=\"p\">(</span>filename<span class=\"p\">):</span></td></tr><tr><th id=\"L59\"><a href=\"#L59\">59</a></th><td>\u00a0 \u00a0 <span class=\"sd\">\"\"\"</span></td></tr><tr><th id=\"L60\"><a href=\"#L60\">60</a></th><td><span class=\"sd\">\u00a0 \u00a0 Look for a #! line, and return the value following the #! if one exists, or</span></td></tr><tr><th id=\"L61\"><a href=\"#L61\">61</a></th><td><span class=\"sd\">\u00a0 \u00a0 None if this file is not a script.</span></td></tr><tr><th id=\"L62\"><a href=\"#L62\">62</a></th><td><span class=\"sd\"></span></td></tr><tr><th id=\"L63\"><a href=\"#L63\">63</a></th><td><span class=\"sd\">\u00a0 \u00a0 I don't know if there are any conventions for quoting in Windows shebang</span></td></tr><tr><th id=\"L64\"><a href=\"#L64\">64</a></th><td><span class=\"sd\">\u00a0 \u00a0 lines, so this doesn't support any; therefore, you may not pass any</span></td></tr><tr><th id=\"L65\"><a href=\"#L65\">65</a></th><td><span class=\"sd\">\u00a0 \u00a0 arguments to scripts invoked as filters.\u00a0 That's probably wrong, so if</span></td></tr><tr><th id=\"L66\"><a href=\"#L66\">66</a></th><td><span class=\"sd\">\u00a0 \u00a0 somebody knows more about the cultural expectations on Windows, please feel</span></td></tr><tr><th id=\"L67\"><a href=\"#L67\">67</a></th><td><span class=\"sd\">\u00a0 \u00a0 free to fix.</span></td></tr><tr><th id=\"L68\"><a href=\"#L68\">68</a></th><td><span class=\"sd\"></span></td></tr><tr><th id=\"L69\"><a href=\"#L69\">69</a></th><td><span class=\"sd\">\u00a0 \u00a0 This shebang line support was added in support of the CGI tests;</span></td></tr><tr><th id=\"L70\"><a href=\"#L70\">70</a></th><td><span class=\"sd\">\u00a0 \u00a0 appropriately enough, I determined that shebang lines are culturally</span></td></tr><tr><th id=\"L71\"><a href=\"#L71\">71</a></th><td><span class=\"sd\">\u00a0 \u00a0 accepted in the Windows world through this page:</span></td></tr><tr><th id=\"L72\"><a href=\"#L72\">72</a></th><td><span class=\"sd\"></span></td></tr><tr><th id=\"L73\"><a href=\"#L73\">73</a></th><td><span class=\"sd\">\u00a0 \u00a0 \u00a0 \u00a0 http://www.cgi101.com/learn/connect/winxp.html</span></td></tr><tr><th id=\"L74\"><a href=\"#L74\">74</a></th><td><span class=\"sd\"></span></td></tr><tr><th id=\"L75\"><a href=\"#L75\">75</a></th><td><span class=\"sd\">\u00a0 \u00a0 @param filename: str representing a filename</span></td></tr><tr><th id=\"L76\"><a href=\"#L76\">76</a></th><td><span class=\"sd\"></span></td></tr><tr><th id=\"L77\"><a href=\"#L77\">77</a></th><td><span class=\"sd\">\u00a0 \u00a0 @return: a str representing another filename.</span></td></tr><tr><th id=\"L78\"><a href=\"#L78\">78</a></th><td><span class=\"sd\">\u00a0 \u00a0 \"\"\"</span></td></tr><tr><th id=\"L79\"><a href=\"#L79\">79</a></th><td>\u00a0 \u00a0 f <span class=\"o\">=</span>\u00a0<span class=\"nb\">file</span><span class=\"p\">(</span>filename<span class=\"p\">,</span>\u00a0<span class=\"s\">'ru'</span><span class=\"p\">)</span></td></tr><tr><th id=\"L80\"><a href=\"#L80\">80</a></th><td>\u00a0 \u00a0 <span class=\"k\">if</span>\u00a0f<span class=\"o\">.</span>read<span class=\"p\">(</span><span class=\"mi\">2</span><span class=\"p\">)</span>\u00a0<span class=\"o\">==</span>\u00a0<span class=\"s\">'#!'</span><span class=\"p\">:</span></td></tr><tr><th id=\"L81\"><a href=\"#L81\">81</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 exe <span class=\"o\">=</span>\u00a0f<span class=\"o\">.</span>readline<span class=\"p\">(</span><span class=\"mi\">1024</span><span class=\"p\">)</span><span class=\"o\">.</span>strip<span class=\"p\">(</span><span class=\"s\">'</span><span class=\"se\">\\n</span><span class=\"s\">'</span><span class=\"p\">)</span></td></tr><tr><th id=\"L82\"><a href=\"#L82\">82</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">return</span>\u00a0exe</td></tr><tr><th id=\"L83\"><a href=\"#L83\">83</a></th><td></td></tr><tr><th id=\"L84\"><a href=\"#L84\">84</a></th><td><span class=\"k\">def</span>\u00a0<span class=\"nf\">_invalidWin32App</span><span class=\"p\">(</span>pywinerr<span class=\"p\">):</span></td></tr><tr><th id=\"L85\"><a href=\"#L85\">85</a></th><td>\u00a0 \u00a0 <span class=\"sd\">\"\"\"</span></td></tr><tr><th id=\"L86\"><a href=\"#L86\">86</a></th><td><span class=\"sd\">\u00a0 \u00a0 Determine if a pywintypes.error is telling us that the given process is</span></td></tr><tr><th id=\"L87\"><a href=\"#L87\">87</a></th><td><span class=\"sd\">\u00a0 \u00a0 'not a valid win32 application', i.e. not a PE format executable.</span></td></tr><tr><th id=\"L88\"><a href=\"#L88\">88</a></th><td><span class=\"sd\"></span></td></tr><tr><th id=\"L89\"><a href=\"#L89\">89</a></th><td><span class=\"sd\">\u00a0 \u00a0 @param pywinerr: a pywintypes.error instance raised by CreateProcess</span></td></tr><tr><th id=\"L90\"><a href=\"#L90\">90</a></th><td><span class=\"sd\"></span></td></tr><tr><th id=\"L91\"><a href=\"#L91\">91</a></th><td><span class=\"sd\">\u00a0 \u00a0 @return: a boolean</span></td></tr><tr><th id=\"L92\"><a href=\"#L92\">92</a></th><td><span class=\"sd\">\u00a0 \u00a0 \"\"\"</span></td></tr><tr><th id=\"L93\"><a href=\"#L93\">93</a></th><td></td></tr><tr><th id=\"L94\"><a href=\"#L94\">94</a></th><td>\u00a0 \u00a0 <span class=\"c\"># Let's do this better in the future, but I have no idea what this error</span></td></tr><tr><th id=\"L95\"><a href=\"#L95\">95</a></th><td>\u00a0 \u00a0 <span class=\"c\"># is; MSDN doesn't mention it, and there is no symbolic constant in</span></td></tr><tr><th id=\"L96\"><a href=\"#L96\">96</a></th><td>\u00a0 \u00a0 <span class=\"c\"># win32process module that represents 193.</span></td></tr><tr><th id=\"L97\"><a href=\"#L97\">97</a></th><td></td></tr><tr><th id=\"L98\"><a href=\"#L98\">98</a></th><td>\u00a0 \u00a0 <span class=\"k\">return</span>\u00a0pywinerr<span class=\"o\">.</span>args<span class=\"p\">[</span><span class=\"mi\">0</span><span class=\"p\">]</span>\u00a0<span class=\"o\">==</span>\u00a0<span class=\"mi\">193</span></td></tr><tr><th id=\"L99\"><a href=\"#L99\">99</a></th><td></td></tr><tr><th id=\"L100\"><a href=\"#L100\">100</a></th><td><span class=\"k\">class</span>\u00a0<span class=\"nc\">Process</span><span class=\"p\">(</span>_pollingfile<span class=\"o\">.</span>_PollingTimer<span class=\"p\">):</span></td></tr><tr><th id=\"L101\"><a href=\"#L101\">101</a></th><td>\u00a0 \u00a0 <span class=\"sd\">\"\"\"A process that integrates with the Twisted event loop.</span></td></tr><tr><th id=\"L102\"><a href=\"#L102\">102</a></th><td><span class=\"sd\"></span></td></tr><tr><th id=\"L103\"><a href=\"#L103\">103</a></th><td><span class=\"sd\">\u00a0 \u00a0 If your subprocess is a python program, you need to:</span></td></tr><tr><th id=\"L104\"><a href=\"#L104\">104</a></th><td><span class=\"sd\"></span></td></tr><tr><th id=\"L105\"><a href=\"#L105\">105</a></th><td><span class=\"sd\">\u00a0 \u00a0 \u00a0- Run python.exe with the '-u' command line option - this turns on</span></td></tr><tr><th id=\"L106\"><a href=\"#L106\">106</a></th><td><span class=\"sd\">\u00a0 \u00a0 \u00a0 \u00a0unbuffered I/O. Buffering stdout/err/in can cause problems, see e.g.</span></td></tr><tr><th id=\"L107\"><a href=\"#L107\">107</a></th><td><span class=\"sd\">\u00a0 \u00a0 \u00a0 \u00a0http://support.microsoft.com/default.aspx?scid=kb;EN-US;q1903</span></td></tr><tr><th id=\"L108\"><a href=\"#L108\">108</a></th><td><span class=\"sd\"></span></td></tr><tr><th id=\"L109\"><a href=\"#L109\">109</a></th><td><span class=\"sd\">\u00a0 \u00a0 \u00a0- If you don't want Windows messing with data passed over</span></td></tr><tr><th id=\"L110\"><a href=\"#L110\">110</a></th><td><span class=\"sd\">\u00a0 \u00a0 \u00a0 \u00a0stdin/out/err, set the pipes to be in binary mode::</span></td></tr><tr><th id=\"L111\"><a href=\"#L111\">111</a></th><td><span class=\"sd\"></span></td></tr><tr><th id=\"L112\"><a href=\"#L112\">112</a></th><td><span class=\"sd\">\u00a0 \u00a0 \u00a0 \u00a0 import os, sys, mscvrt</span></td></tr><tr><th id=\"L113\"><a href=\"#L113\">113</a></th><td><span class=\"sd\">\u00a0 \u00a0 \u00a0 \u00a0 msvcrt.setmode(sys.stdin.fileno(), os.O_BINARY)</span></td></tr><tr><th id=\"L114\"><a href=\"#L114\">114</a></th><td><span class=\"sd\">\u00a0 \u00a0 \u00a0 \u00a0 msvcrt.setmode(sys.stdout.fileno(), os.O_BINARY)</span></td></tr><tr><th id=\"L115\"><a href=\"#L115\">115</a></th><td><span class=\"sd\">\u00a0 \u00a0 \u00a0 \u00a0 msvcrt.setmode(sys.stderr.fileno(), os.O_BINARY)</span></td></tr><tr><th id=\"L116\"><a href=\"#L116\">116</a></th><td><span class=\"sd\"></span></td></tr><tr><th id=\"L117\"><a href=\"#L117\">117</a></th><td><span class=\"sd\">\u00a0 \u00a0 \"\"\"</span></td></tr><tr><th id=\"L118\"><a href=\"#L118\">118</a></th><td>\u00a0 \u00a0 implements<span class=\"p\">(</span>IProcessTransport<span class=\"p\">,</span>\u00a0IConsumer<span class=\"p\">,</span>\u00a0IProducer<span class=\"p\">)</span></td></tr><tr><th id=\"L119\"><a href=\"#L119\">119</a></th><td></td></tr><tr><th id=\"L120\"><a href=\"#L120\">120</a></th><td>\u00a0 \u00a0 <span class=\"nb\">buffer</span>\u00a0<span class=\"o\">=</span>\u00a0<span class=\"s\">''</span></td></tr><tr><th id=\"L121\"><a href=\"#L121\">121</a></th><td></td></tr><tr><th id=\"L122\"><a href=\"#L122\">122</a></th><td>\u00a0 \u00a0 <span class=\"k\">def</span>\u00a0<span class=\"nf\">__init__</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span>\u00a0reactor<span class=\"p\">,</span>\u00a0protocol<span class=\"p\">,</span>\u00a0command<span class=\"p\">,</span>\u00a0args<span class=\"p\">,</span>\u00a0environment<span class=\"p\">,</span>\u00a0path<span class=\"p\">):</span></td></tr><tr><th id=\"L123\"><a href=\"#L123\">123</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 _pollingfile<span class=\"o\">.</span>_PollingTimer<span class=\"o\">.</span>__init__<span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span>\u00a0reactor<span class=\"p\">)</span></td></tr><tr><th id=\"L124\"><a href=\"#L124\">124</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"bp\">self</span><span class=\"o\">.</span>protocol <span class=\"o\">=</span>\u00a0protocol</td></tr><tr><th id=\"L125\"><a href=\"#L125\">125</a></th><td></td></tr><tr><th id=\"L126\"><a href=\"#L126\">126</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"c\"># security attributes for pipes</span></td></tr><tr><th id=\"L127\"><a href=\"#L127\">127</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 sAttrs <span class=\"o\">=</span>\u00a0win32security<span class=\"o\">.</span>SECURITY_ATTRIBUTES<span class=\"p\">()</span></td></tr><tr><th id=\"L128\"><a href=\"#L128\">128</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 sAttrs<span class=\"o\">.</span>bInheritHandle <span class=\"o\">=</span>\u00a0<span class=\"mi\">1</span></td></tr><tr><th id=\"L129\"><a href=\"#L129\">129</a></th><td></td></tr><tr><th id=\"L130\"><a href=\"#L130\">130</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"c\"># create the pipes which will connect to the secondary process</span></td></tr><tr><th id=\"L131\"><a href=\"#L131\">131</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"bp\">self</span><span class=\"o\">.</span>hStdoutR<span class=\"p\">,</span>\u00a0hStdoutW <span class=\"o\">=</span>\u00a0win32pipe<span class=\"o\">.</span>CreatePipe<span class=\"p\">(</span>sAttrs<span class=\"p\">,</span>\u00a0<span class=\"mi\">0</span><span class=\"p\">)</span></td></tr><tr><th id=\"L132\"><a href=\"#L132\">132</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"bp\">self</span><span class=\"o\">.</span>hStderrR<span class=\"p\">,</span>\u00a0hStderrW <span class=\"o\">=</span>\u00a0win32pipe<span class=\"o\">.</span>CreatePipe<span class=\"p\">(</span>sAttrs<span class=\"p\">,</span>\u00a0<span class=\"mi\">0</span><span class=\"p\">)</span></td></tr><tr><th id=\"L133\"><a href=\"#L133\">133</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 hStdinR<span class=\"p\">,</span>\u00a0 <span class=\"bp\">self</span><span class=\"o\">.</span>hStdinW\u00a0 <span class=\"o\">=</span>\u00a0win32pipe<span class=\"o\">.</span>CreatePipe<span class=\"p\">(</span>sAttrs<span class=\"p\">,</span>\u00a0<span class=\"mi\">0</span><span class=\"p\">)</span></td></tr><tr><th id=\"L134\"><a href=\"#L134\">134</a></th><td></td></tr><tr><th id=\"L135\"><a href=\"#L135\">135</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 win32pipe<span class=\"o\">.</span>SetNamedPipeHandleState<span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span>hStdinW<span class=\"p\">,</span></td></tr><tr><th id=\"L136\"><a href=\"#L136\">136</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 win32pipe<span class=\"o\">.</span>PIPE_NOWAIT<span class=\"p\">,</span></td></tr><tr><th id=\"L137\"><a href=\"#L137\">137</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"bp\">None</span><span class=\"p\">,</span></td></tr><tr><th id=\"L138\"><a href=\"#L138\">138</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"bp\">None</span><span class=\"p\">)</span></td></tr><tr><th id=\"L139\"><a href=\"#L139\">139</a></th><td></td></tr><tr><th id=\"L140\"><a href=\"#L140\">140</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"c\"># set the info structure for the new process.</span></td></tr><tr><th id=\"L141\"><a href=\"#L141\">141</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 StartupInfo <span class=\"o\">=</span>\u00a0win32process<span class=\"o\">.</span>STARTUPINFO<span class=\"p\">()</span></td></tr><tr><th id=\"L142\"><a href=\"#L142\">142</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 StartupInfo<span class=\"o\">.</span>hStdOutput <span class=\"o\">=</span>\u00a0hStdoutW</td></tr><tr><th id=\"L143\"><a href=\"#L143\">143</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 StartupInfo<span class=\"o\">.</span>hStdError\u00a0 <span class=\"o\">=</span>\u00a0hStderrW</td></tr><tr><th id=\"L144\"><a href=\"#L144\">144</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 StartupInfo<span class=\"o\">.</span>hStdInput\u00a0 <span class=\"o\">=</span>\u00a0hStdinR</td></tr><tr><th id=\"L145\"><a href=\"#L145\">145</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 StartupInfo<span class=\"o\">.</span>dwFlags <span class=\"o\">=</span>\u00a0win32process<span class=\"o\">.</span>STARTF_USESTDHANDLES</td></tr><tr><th id=\"L146\"><a href=\"#L146\">146</a></th><td></td></tr><tr><th id=\"L147\"><a href=\"#L147\">147</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"c\"># Create new handles whose inheritance property is false</span></td></tr><tr><th id=\"L148\"><a href=\"#L148\">148</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 pid <span class=\"o\">=</span>\u00a0win32api<span class=\"o\">.</span>GetCurrentProcess<span class=\"p\">()</span></td></tr><tr><th id=\"L149\"><a href=\"#L149\">149</a></th><td></td></tr><tr><th id=\"L150\"><a href=\"#L150\">150</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 tmp <span class=\"o\">=</span>\u00a0win32api<span class=\"o\">.</span>DuplicateHandle<span class=\"p\">(</span>pid<span class=\"p\">,</span>\u00a0<span class=\"bp\">self</span><span class=\"o\">.</span>hStdoutR<span class=\"p\">,</span>\u00a0pid<span class=\"p\">,</span>\u00a0<span class=\"mi\">0</span><span class=\"p\">,</span>\u00a0<span class=\"mi\">0</span><span class=\"p\">,</span></td></tr><tr><th id=\"L151\"><a href=\"#L151\">151</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0win32con<span class=\"o\">.</span>DUPLICATE_SAME_ACCESS<span class=\"p\">)</span></td></tr><tr><th id=\"L152\"><a href=\"#L152\">152</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 win32file<span class=\"o\">.</span>CloseHandle<span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span>hStdoutR<span class=\"p\">)</span></td></tr><tr><th id=\"L153\"><a href=\"#L153\">153</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"bp\">self</span><span class=\"o\">.</span>hStdoutR <span class=\"o\">=</span>\u00a0tmp</td></tr><tr><th id=\"L154\"><a href=\"#L154\">154</a></th><td></td></tr><tr><th id=\"L155\"><a href=\"#L155\">155</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 tmp <span class=\"o\">=</span>\u00a0win32api<span class=\"o\">.</span>DuplicateHandle<span class=\"p\">(</span>pid<span class=\"p\">,</span>\u00a0<span class=\"bp\">self</span><span class=\"o\">.</span>hStderrR<span class=\"p\">,</span>\u00a0pid<span class=\"p\">,</span>\u00a0<span class=\"mi\">0</span><span class=\"p\">,</span>\u00a0<span class=\"mi\">0</span><span class=\"p\">,</span></td></tr><tr><th id=\"L156\"><a href=\"#L156\">156</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0win32con<span class=\"o\">.</span>DUPLICATE_SAME_ACCESS<span class=\"p\">)</span></td></tr><tr><th id=\"L157\"><a href=\"#L157\">157</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 win32file<span class=\"o\">.</span>CloseHandle<span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span>hStderrR<span class=\"p\">)</span></td></tr><tr><th id=\"L158\"><a href=\"#L158\">158</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"bp\">self</span><span class=\"o\">.</span>hStderrR <span class=\"o\">=</span>\u00a0tmp</td></tr><tr><th id=\"L159\"><a href=\"#L159\">159</a></th><td></td></tr><tr><th id=\"L160\"><a href=\"#L160\">160</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 tmp <span class=\"o\">=</span>\u00a0win32api<span class=\"o\">.</span>DuplicateHandle<span class=\"p\">(</span>pid<span class=\"p\">,</span>\u00a0<span class=\"bp\">self</span><span class=\"o\">.</span>hStdinW<span class=\"p\">,</span>\u00a0pid<span class=\"p\">,</span>\u00a0<span class=\"mi\">0</span><span class=\"p\">,</span>\u00a0<span class=\"mi\">0</span><span class=\"p\">,</span></td></tr><tr><th id=\"L161\"><a href=\"#L161\">161</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0win32con<span class=\"o\">.</span>DUPLICATE_SAME_ACCESS<span class=\"p\">)</span></td></tr><tr><th id=\"L162\"><a href=\"#L162\">162</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 win32file<span class=\"o\">.</span>CloseHandle<span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span>hStdinW<span class=\"p\">)</span></td></tr><tr><th id=\"L163\"><a href=\"#L163\">163</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"bp\">self</span><span class=\"o\">.</span>hStdinW <span class=\"o\">=</span>\u00a0tmp</td></tr><tr><th id=\"L164\"><a href=\"#L164\">164</a></th><td></td></tr><tr><th id=\"L165\"><a href=\"#L165\">165</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"c\"># Add the specified environment to the current environment - this is</span></td></tr><tr><th id=\"L166\"><a href=\"#L166\">166</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"c\"># necessary because certain operations are only supported on Windows</span></td></tr><tr><th id=\"L167\"><a href=\"#L167\">167</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"c\"># if certain environment variables are present.</span></td></tr><tr><th id=\"L168\"><a href=\"#L168\">168</a></th><td></td></tr><tr><th id=\"L169\"><a href=\"#L169\">169</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 env <span class=\"o\">=</span>\u00a0os<span class=\"o\">.</span>environ<span class=\"o\">.</span>copy<span class=\"p\">()</span></td></tr><tr><th id=\"L170\"><a href=\"#L170\">170</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 env<span class=\"o\">.</span>update<span class=\"p\">(</span>environment <span class=\"ow\">or</span>\u00a0<span class=\"p\">{})</span></td></tr><tr><th id=\"L171\"><a href=\"#L171\">171</a></th><td></td></tr><tr><th id=\"L172\"><a href=\"#L172\">172</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 cmdline <span class=\"o\">=</span>\u00a0quoteArguments<span class=\"p\">(</span>args<span class=\"p\">)</span></td></tr><tr><th id=\"L173\"><a href=\"#L173\">173</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"c\"># TODO: error detection here.</span></td></tr><tr><th id=\"L174\"><a href=\"#L174\">174</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">def</span>\u00a0<span class=\"nf\">doCreate</span><span class=\"p\">():</span></td></tr><tr><th id=\"L175\"><a href=\"#L175\">175</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"bp\">self</span><span class=\"o\">.</span>hProcess<span class=\"p\">,</span>\u00a0<span class=\"bp\">self</span><span class=\"o\">.</span>hThread<span class=\"p\">,</span>\u00a0dwPid<span class=\"p\">,</span>\u00a0dwTid <span class=\"o\">=</span>\u00a0win32process<span class=\"o\">.</span>CreateProcess<span class=\"p\">(</span></td></tr><tr><th id=\"L176\"><a href=\"#L176\">176</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 command<span class=\"p\">,</span>\u00a0cmdline<span class=\"p\">,</span>\u00a0<span class=\"bp\">None</span><span class=\"p\">,</span>\u00a0<span class=\"bp\">None</span><span class=\"p\">,</span>\u00a0<span class=\"mi\">1</span><span class=\"p\">,</span>\u00a0<span class=\"mi\">0</span><span class=\"p\">,</span>\u00a0env<span class=\"p\">,</span>\u00a0path<span class=\"p\">,</span>\u00a0StartupInfo<span class=\"p\">)</span></td></tr><tr><th id=\"L177\"><a href=\"#L177\">177</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">try</span><span class=\"p\">:</span></td></tr><tr><th id=\"L178\"><a href=\"#L178\">178</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 doCreate<span class=\"p\">()</span></td></tr><tr><th id=\"L179\"><a href=\"#L179\">179</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">except</span>\u00a0pywintypes<span class=\"o\">.</span>error<span class=\"p\">,</span>\u00a0pwte<span class=\"p\">:</span></td></tr><tr><th id=\"L180\"><a href=\"#L180\">180</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">if</span>\u00a0<span class=\"ow\">not</span>\u00a0_invalidWin32App<span class=\"p\">(</span>pwte<span class=\"p\">):</span></td></tr><tr><th id=\"L181\"><a href=\"#L181\">181</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"c\"># This behavior isn't _really_ documented, but let's make it</span></td></tr><tr><th id=\"L182\"><a href=\"#L182\">182</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"c\"># consistent with the behavior that is documented.</span></td></tr><tr><th id=\"L183\"><a href=\"#L183\">183</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">raise</span>\u00a0<span class=\"ne\">OSError</span><span class=\"p\">(</span>pwte<span class=\"p\">)</span></td></tr><tr><th id=\"L184\"><a href=\"#L184\">184</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">else</span><span class=\"p\">:</span></td></tr><tr><th id=\"L185\"><a href=\"#L185\">185</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"c\"># look for a shebang line.\u00a0 Insert the original 'command'</span></td></tr><tr><th id=\"L186\"><a href=\"#L186\">186</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"c\"># (actually a script) into the new arguments list.</span></td></tr><tr><th id=\"L187\"><a href=\"#L187\">187</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 sheb <span class=\"o\">=</span>\u00a0_findShebang<span class=\"p\">(</span>command<span class=\"p\">)</span></td></tr><tr><th id=\"L188\"><a href=\"#L188\">188</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">if</span>\u00a0sheb <span class=\"ow\">is</span>\u00a0<span class=\"bp\">None</span><span class=\"p\">:</span></td></tr><tr><th id=\"L189\"><a href=\"#L189\">189</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">raise</span>\u00a0<span class=\"ne\">OSError</span><span class=\"p\">(</span></td></tr><tr><th id=\"L190\"><a href=\"#L190\">190</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"s\">\"</span><span class=\"si\">%r</span><span class=\"s\">\u00a0is neither a Windows executable, \"</span></td></tr><tr><th id=\"L191\"><a href=\"#L191\">191</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"s\">\"nor a script with a shebang line\"</span>\u00a0<span class=\"o\">%</span>\u00a0command<span class=\"p\">)</span></td></tr><tr><th id=\"L192\"><a href=\"#L192\">192</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">else</span><span class=\"p\">:</span></td></tr><tr><th id=\"L193\"><a href=\"#L193\">193</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 args <span class=\"o\">=</span>\u00a0<span class=\"nb\">list</span><span class=\"p\">(</span>args<span class=\"p\">)</span></td></tr><tr><th id=\"L194\"><a href=\"#L194\">194</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 args<span class=\"o\">.</span>insert<span class=\"p\">(</span><span class=\"mi\">0</span><span class=\"p\">,</span>\u00a0command<span class=\"p\">)</span></td></tr><tr><th id=\"L195\"><a href=\"#L195\">195</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 cmdline <span class=\"o\">=</span>\u00a0quoteArguments<span class=\"p\">(</span>args<span class=\"p\">)</span></td></tr><tr><th id=\"L196\"><a href=\"#L196\">196</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 origcmd <span class=\"o\">=</span>\u00a0command</td></tr><tr><th id=\"L197\"><a href=\"#L197\">197</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 command <span class=\"o\">=</span>\u00a0sheb</td></tr><tr><th id=\"L198\"><a href=\"#L198\">198</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">try</span><span class=\"p\">:</span></td></tr><tr><th id=\"L199\"><a href=\"#L199\">199</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"c\"># Let's try again.</span></td></tr><tr><th id=\"L200\"><a href=\"#L200\">200</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 doCreate<span class=\"p\">()</span></td></tr><tr><th id=\"L201\"><a href=\"#L201\">201</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">except</span>\u00a0pywintypes<span class=\"o\">.</span>error<span class=\"p\">,</span>\u00a0pwte2<span class=\"p\">:</span></td></tr><tr><th id=\"L202\"><a href=\"#L202\">202</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"c\"># d'oh, failed again!</span></td></tr><tr><th id=\"L203\"><a href=\"#L203\">203</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">if</span>\u00a0_invalidWin32App<span class=\"p\">(</span>pwte2<span class=\"p\">):</span></td></tr><tr><th id=\"L204\"><a href=\"#L204\">204</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">raise</span>\u00a0<span class=\"ne\">OSError</span><span class=\"p\">(</span></td></tr><tr><th id=\"L205\"><a href=\"#L205\">205</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"s\">\"</span><span class=\"si\">%r</span><span class=\"s\">\u00a0has an invalid shebang line: \"</span></td></tr><tr><th id=\"L206\"><a href=\"#L206\">206</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"s\">\"</span><span class=\"si\">%r</span><span class=\"s\">\u00a0is not a valid executable\"</span>\u00a0<span class=\"o\">%</span>\u00a0<span class=\"p\">(</span></td></tr><tr><th id=\"L207\"><a href=\"#L207\">207</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 origcmd<span class=\"p\">,</span>\u00a0sheb<span class=\"p\">))</span></td></tr><tr><th id=\"L208\"><a href=\"#L208\">208</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">raise</span>\u00a0<span class=\"ne\">OSError</span><span class=\"p\">(</span>pwte2<span class=\"p\">)</span></td></tr><tr><th id=\"L209\"><a href=\"#L209\">209</a></th><td></td></tr><tr><th id=\"L210\"><a href=\"#L210\">210</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 win32file<span class=\"o\">.</span>CloseHandle<span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span>hThread<span class=\"p\">)</span></td></tr><tr><th id=\"L211\"><a href=\"#L211\">211</a></th><td></td></tr><tr><th id=\"L212\"><a href=\"#L212\">212</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"c\"># close handles which only the child will use</span></td></tr><tr><th id=\"L213\"><a href=\"#L213\">213</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 win32file<span class=\"o\">.</span>CloseHandle<span class=\"p\">(</span>hStderrW<span class=\"p\">)</span></td></tr><tr><th id=\"L214\"><a href=\"#L214\">214</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 win32file<span class=\"o\">.</span>CloseHandle<span class=\"p\">(</span>hStdoutW<span class=\"p\">)</span></td></tr><tr><th id=\"L215\"><a href=\"#L215\">215</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 win32file<span class=\"o\">.</span>CloseHandle<span class=\"p\">(</span>hStdinR<span class=\"p\">)</span></td></tr><tr><th id=\"L216\"><a href=\"#L216\">216</a></th><td></td></tr><tr><th id=\"L217\"><a href=\"#L217\">217</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"bp\">self</span><span class=\"o\">.</span>closed <span class=\"o\">=</span>\u00a0<span class=\"mi\">0</span></td></tr><tr><th id=\"L218\"><a href=\"#L218\">218</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"bp\">self</span><span class=\"o\">.</span>closedNotifies <span class=\"o\">=</span>\u00a0<span class=\"mi\">0</span></td></tr><tr><th id=\"L219\"><a href=\"#L219\">219</a></th><td></td></tr><tr><th id=\"L220\"><a href=\"#L220\">220</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"c\"># set up everything</span></td></tr><tr><th id=\"L221\"><a href=\"#L221\">221</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"bp\">self</span><span class=\"o\">.</span>stdout <span class=\"o\">=</span>\u00a0_pollingfile<span class=\"o\">.</span>_PollableReadPipe<span class=\"p\">(</span></td></tr><tr><th id=\"L222\"><a href=\"#L222\">222</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"bp\">self</span><span class=\"o\">.</span>hStdoutR<span class=\"p\">,</span></td></tr><tr><th id=\"L223\"><a href=\"#L223\">223</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">lambda</span>\u00a0data<span class=\"p\">:</span>\u00a0<span class=\"bp\">self</span><span class=\"o\">.</span>protocol<span class=\"o\">.</span>childDataReceived<span class=\"p\">(</span><span class=\"mi\">1</span><span class=\"p\">,</span>\u00a0data<span class=\"p\">),</span></td></tr><tr><th id=\"L224\"><a href=\"#L224\">224</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"bp\">self</span><span class=\"o\">.</span>outConnectionLost<span class=\"p\">)</span></td></tr><tr><th id=\"L225\"><a href=\"#L225\">225</a></th><td></td></tr><tr><th id=\"L226\"><a href=\"#L226\">226</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"bp\">self</span><span class=\"o\">.</span>stderr <span class=\"o\">=</span>\u00a0_pollingfile<span class=\"o\">.</span>_PollableReadPipe<span class=\"p\">(</span></td></tr><tr><th id=\"L227\"><a href=\"#L227\">227</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"bp\">self</span><span class=\"o\">.</span>hStderrR<span class=\"p\">,</span></td></tr><tr><th id=\"L228\"><a href=\"#L228\">228</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">lambda</span>\u00a0data<span class=\"p\">:</span>\u00a0<span class=\"bp\">self</span><span class=\"o\">.</span>protocol<span class=\"o\">.</span>childDataReceived<span class=\"p\">(</span><span class=\"mi\">2</span><span class=\"p\">,</span>\u00a0data<span class=\"p\">),</span></td></tr><tr><th id=\"L229\"><a href=\"#L229\">229</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"bp\">self</span><span class=\"o\">.</span>errConnectionLost<span class=\"p\">)</span></td></tr><tr><th id=\"L230\"><a href=\"#L230\">230</a></th><td></td></tr><tr><th id=\"L231\"><a href=\"#L231\">231</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"bp\">self</span><span class=\"o\">.</span>stdin <span class=\"o\">=</span>\u00a0_pollingfile<span class=\"o\">.</span>_PollableWritePipe<span class=\"p\">(</span></td></tr><tr><th id=\"L232\"><a href=\"#L232\">232</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"bp\">self</span><span class=\"o\">.</span>hStdinW<span class=\"p\">,</span>\u00a0<span class=\"bp\">self</span><span class=\"o\">.</span>inConnectionLost<span class=\"p\">)</span></td></tr><tr><th id=\"L233\"><a href=\"#L233\">233</a></th><td></td></tr><tr><th id=\"L234\"><a href=\"#L234\">234</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">for</span>\u00a0pipewatcher <span class=\"ow\">in</span>\u00a0<span class=\"bp\">self</span><span class=\"o\">.</span>stdout<span class=\"p\">,</span>\u00a0<span class=\"bp\">self</span><span class=\"o\">.</span>stderr<span class=\"p\">,</span>\u00a0<span class=\"bp\">self</span><span class=\"o\">.</span>stdin<span class=\"p\">:</span></td></tr><tr><th id=\"L235\"><a href=\"#L235\">235</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"bp\">self</span><span class=\"o\">.</span>_addPollableResource<span class=\"p\">(</span>pipewatcher<span class=\"p\">)</span></td></tr><tr><th id=\"L236\"><a href=\"#L236\">236</a></th><td></td></tr><tr><th id=\"L237\"><a href=\"#L237\">237</a></th><td></td></tr><tr><th id=\"L238\"><a href=\"#L238\">238</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"c\"># notify protocol</span></td></tr><tr><th id=\"L239\"><a href=\"#L239\">239</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"bp\">self</span><span class=\"o\">.</span>protocol<span class=\"o\">.</span>makeConnection<span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">)</span></td></tr><tr><th id=\"L240\"><a href=\"#L240\">240</a></th><td></td></tr><tr><th id=\"L241\"><a href=\"#L241\">241</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"c\"># (maybe?) a good idea in win32er, otherwise not</span></td></tr><tr><th id=\"L242\"><a href=\"#L242\">242</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"c\"># self.reactor.addEvent(self.hProcess, self, 'inConnectionLost')</span></td></tr><tr><th id=\"L243\"><a href=\"#L243\">243</a></th><td></td></tr><tr><th id=\"L244\"><a href=\"#L244\">244</a></th><td></td></tr><tr><th id=\"L245\"><a href=\"#L245\">245</a></th><td>\u00a0 \u00a0 <span class=\"k\">def</span>\u00a0<span class=\"nf\">signalProcess</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span>\u00a0signalID<span class=\"p\">):</span></td></tr><tr><th id=\"L246\"><a href=\"#L246\">246</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">if</span>\u00a0signalID <span class=\"ow\">in</span>\u00a0<span class=\"p\">(</span><span class=\"s\">\"INT\"</span><span class=\"p\">,</span>\u00a0<span class=\"s\">\"TERM\"</span><span class=\"p\">,</span>\u00a0<span class=\"s\">\"KILL\"</span><span class=\"p\">):</span></td></tr><tr><th id=\"L247\"><a href=\"#L247\">247</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 win32process<span class=\"o\">.</span>TerminateProcess<span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span>hProcess<span class=\"p\">,</span>\u00a0<span class=\"mi\">1</span><span class=\"p\">)</span></td></tr><tr><th id=\"L248\"><a href=\"#L248\">248</a></th><td></td></tr><tr><th id=\"L249\"><a href=\"#L249\">249</a></th><td>\u00a0 \u00a0 <span class=\"k\">def</span>\u00a0<span class=\"nf\">write</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span>\u00a0data<span class=\"p\">):</span></td></tr><tr><th id=\"L250\"><a href=\"#L250\">250</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"sd\">\"\"\"Write data to the process' stdin.\"\"\"</span></td></tr><tr><th id=\"L251\"><a href=\"#L251\">251</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"bp\">self</span><span class=\"o\">.</span>stdin<span class=\"o\">.</span>write<span class=\"p\">(</span>data<span class=\"p\">)</span></td></tr><tr><th id=\"L252\"><a href=\"#L252\">252</a></th><td></td></tr><tr><th id=\"L253\"><a href=\"#L253\">253</a></th><td>\u00a0 \u00a0 <span class=\"k\">def</span>\u00a0<span class=\"nf\">writeSequence</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span>\u00a0seq<span class=\"p\">):</span></td></tr><tr><th id=\"L254\"><a href=\"#L254\">254</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"sd\">\"\"\"Write data to the process' stdin.\"\"\"</span></td></tr><tr><th id=\"L255\"><a href=\"#L255\">255</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"bp\">self</span><span class=\"o\">.</span>stdin<span class=\"o\">.</span>writeSequence<span class=\"p\">(</span>seq<span class=\"p\">)</span></td></tr><tr><th id=\"L256\"><a href=\"#L256\">256</a></th><td></td></tr><tr><th id=\"L257\"><a href=\"#L257\">257</a></th><td>\u00a0 \u00a0 <span class=\"k\">def</span>\u00a0<span class=\"nf\">closeChildFD</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span>\u00a0fd<span class=\"p\">):</span></td></tr><tr><th id=\"L258\"><a href=\"#L258\">258</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">if</span>\u00a0fd <span class=\"o\">==</span>\u00a0<span class=\"mi\">0</span><span class=\"p\">:</span></td></tr><tr><th id=\"L259\"><a href=\"#L259\">259</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"bp\">self</span><span class=\"o\">.</span>closeStdin<span class=\"p\">()</span></td></tr><tr><th id=\"L260\"><a href=\"#L260\">260</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">elif</span>\u00a0fd <span class=\"o\">==</span>\u00a0<span class=\"mi\">1</span><span class=\"p\">:</span></td></tr><tr><th id=\"L261\"><a href=\"#L261\">261</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"bp\">self</span><span class=\"o\">.</span>closeStdout<span class=\"p\">()</span></td></tr><tr><th id=\"L262\"><a href=\"#L262\">262</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">elif</span>\u00a0fd <span class=\"o\">==</span>\u00a0<span class=\"mi\">2</span><span class=\"p\">:</span></td></tr><tr><th id=\"L263\"><a href=\"#L263\">263</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"bp\">self</span><span class=\"o\">.</span>closeStderr<span class=\"p\">()</span></td></tr><tr><th id=\"L264\"><a href=\"#L264\">264</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">else</span><span class=\"p\">:</span></td></tr><tr><th id=\"L265\"><a href=\"#L265\">265</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">raise</span>\u00a0<span class=\"ne\">NotImplementedError</span><span class=\"p\">(</span><span class=\"s\">\"Only standard-IO file descriptors available on win32\"</span><span class=\"p\">)</span></td></tr><tr><th id=\"L266\"><a href=\"#L266\">266</a></th><td></td></tr><tr><th id=\"L267\"><a href=\"#L267\">267</a></th><td>\u00a0 \u00a0 <span class=\"k\">def</span>\u00a0<span class=\"nf\">closeStdin</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">):</span></td></tr><tr><th id=\"L268\"><a href=\"#L268\">268</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"sd\">\"\"\"Close the process' stdin.</span></td></tr><tr><th id=\"L269\"><a href=\"#L269\">269</a></th><td><span class=\"sd\">\u00a0 \u00a0 \u00a0 \u00a0 \"\"\"</span></td></tr><tr><th id=\"L270\"><a href=\"#L270\">270</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"bp\">self</span><span class=\"o\">.</span>stdin<span class=\"o\">.</span>close<span class=\"p\">()</span></td></tr><tr><th id=\"L271\"><a href=\"#L271\">271</a></th><td></td></tr><tr><th id=\"L272\"><a href=\"#L272\">272</a></th><td>\u00a0 \u00a0 <span class=\"k\">def</span>\u00a0<span class=\"nf\">closeStderr</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">):</span></td></tr><tr><th id=\"L273\"><a href=\"#L273\">273</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"bp\">self</span><span class=\"o\">.</span>stderr<span class=\"o\">.</span>close<span class=\"p\">()</span></td></tr><tr><th id=\"L274\"><a href=\"#L274\">274</a></th><td></td></tr><tr><th id=\"L275\"><a href=\"#L275\">275</a></th><td>\u00a0 \u00a0 <span class=\"k\">def</span>\u00a0<span class=\"nf\">closeStdout</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">):</span></td></tr><tr><th id=\"L276\"><a href=\"#L276\">276</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"bp\">self</span><span class=\"o\">.</span>stdout<span class=\"o\">.</span>close<span class=\"p\">()</span></td></tr><tr><th id=\"L277\"><a href=\"#L277\">277</a></th><td></td></tr><tr><th id=\"L278\"><a href=\"#L278\">278</a></th><td>\u00a0 \u00a0 <span class=\"k\">def</span>\u00a0<span class=\"nf\">loseConnection</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">):</span></td></tr><tr><th id=\"L279\"><a href=\"#L279\">279</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"sd\">\"\"\"Close the process' stdout, in and err.\"\"\"</span></td></tr><tr><th id=\"L280\"><a href=\"#L280\">280</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"bp\">self</span><span class=\"o\">.</span>closeStdin<span class=\"p\">()</span></td></tr><tr><th id=\"L281\"><a href=\"#L281\">281</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"bp\">self</span><span class=\"o\">.</span>closeStdout<span class=\"p\">()</span></td></tr><tr><th id=\"L282\"><a href=\"#L282\">282</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"bp\">self</span><span class=\"o\">.</span>closeStderr<span class=\"p\">()</span></td></tr><tr><th id=\"L283\"><a href=\"#L283\">283</a></th><td></td></tr><tr><th id=\"L284\"><a href=\"#L284\">284</a></th><td>\u00a0 \u00a0 <span class=\"k\">def</span>\u00a0<span class=\"nf\">outConnectionLost</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">):</span></td></tr><tr><th id=\"L285\"><a href=\"#L285\">285</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"bp\">self</span><span class=\"o\">.</span>protocol<span class=\"o\">.</span>childConnectionLost<span class=\"p\">(</span><span class=\"mi\">1</span><span class=\"p\">)</span></td></tr><tr><th id=\"L286\"><a href=\"#L286\">286</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"bp\">self</span><span class=\"o\">.</span>connectionLostNotify<span class=\"p\">()</span></td></tr><tr><th id=\"L287\"><a href=\"#L287\">287</a></th><td></td></tr><tr><th id=\"L288\"><a href=\"#L288\">288</a></th><td>\u00a0 \u00a0 <span class=\"k\">def</span>\u00a0<span class=\"nf\">errConnectionLost</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">):</span></td></tr><tr><th id=\"L289\"><a href=\"#L289\">289</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"bp\">self</span><span class=\"o\">.</span>protocol<span class=\"o\">.</span>childConnectionLost<span class=\"p\">(</span><span class=\"mi\">2</span><span class=\"p\">)</span></td></tr><tr><th id=\"L290\"><a href=\"#L290\">290</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"bp\">self</span><span class=\"o\">.</span>connectionLostNotify<span class=\"p\">()</span></td></tr><tr><th id=\"L291\"><a href=\"#L291\">291</a></th><td></td></tr><tr><th id=\"L292\"><a href=\"#L292\">292</a></th><td>\u00a0 \u00a0 <span class=\"k\">def</span>\u00a0<span class=\"nf\">inConnectionLost</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">):</span></td></tr><tr><th id=\"L293\"><a href=\"#L293\">293</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"bp\">self</span><span class=\"o\">.</span>protocol<span class=\"o\">.</span>childConnectionLost<span class=\"p\">(</span><span class=\"mi\">0</span><span class=\"p\">)</span></td></tr><tr><th id=\"L294\"><a href=\"#L294\">294</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"bp\">self</span><span class=\"o\">.</span>connectionLostNotify<span class=\"p\">()</span></td></tr><tr><th id=\"L295\"><a href=\"#L295\">295</a></th><td></td></tr><tr><th id=\"L296\"><a href=\"#L296\">296</a></th><td>\u00a0 \u00a0 <span class=\"k\">def</span>\u00a0<span class=\"nf\">connectionLostNotify</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">):</span></td></tr><tr><th id=\"L297\"><a href=\"#L297\">297</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"sd\">\"\"\"Will be called 3 times, by stdout/err threads and process handle.\"\"\"</span></td></tr><tr><th id=\"L298\"><a href=\"#L298\">298</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"bp\">self</span><span class=\"o\">.</span>closedNotifies <span class=\"o\">=</span>\u00a0<span class=\"bp\">self</span><span class=\"o\">.</span>closedNotifies <span class=\"o\">+</span>\u00a0<span class=\"mi\">1</span></td></tr><tr><th id=\"L299\"><a href=\"#L299\">299</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">if</span>\u00a0<span class=\"bp\">self</span><span class=\"o\">.</span>closedNotifies <span class=\"o\">==</span>\u00a0<span class=\"mi\">3</span><span class=\"p\">:</span></td></tr><tr><th id=\"L300\"><a href=\"#L300\">300</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"bp\">self</span><span class=\"o\">.</span>closed <span class=\"o\">=</span>\u00a0<span class=\"mi\">1</span></td></tr><tr><th id=\"L301\"><a href=\"#L301\">301</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"bp\">self</span><span class=\"o\">.</span>_addPollableResource<span class=\"p\">(</span>_Reaper<span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">))</span></td></tr><tr><th id=\"L302\"><a href=\"#L302\">302</a></th><td></td></tr><tr><th id=\"L303\"><a href=\"#L303\">303</a></th><td>\u00a0 \u00a0 <span class=\"c\"># IConsumer</span></td></tr><tr><th id=\"L304\"><a href=\"#L304\">304</a></th><td>\u00a0 \u00a0 <span class=\"k\">def</span>\u00a0<span class=\"nf\">registerProducer</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span>\u00a0producer<span class=\"p\">,</span>\u00a0streaming<span class=\"p\">):</span></td></tr><tr><th id=\"L305\"><a href=\"#L305\">305</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"bp\">self</span><span class=\"o\">.</span>stdin<span class=\"o\">.</span>registerProducer<span class=\"p\">(</span>producer<span class=\"p\">,</span>\u00a0streaming<span class=\"p\">)</span></td></tr><tr><th id=\"L306\"><a href=\"#L306\">306</a></th><td></td></tr><tr><th id=\"L307\"><a href=\"#L307\">307</a></th><td>\u00a0 \u00a0 <span class=\"k\">def</span>\u00a0<span class=\"nf\">unregisterProducer</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">):</span></td></tr><tr><th id=\"L308\"><a href=\"#L308\">308</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"bp\">self</span><span class=\"o\">.</span>stdin<span class=\"o\">.</span>unregisterProducer<span class=\"p\">()</span></td></tr><tr><th id=\"L309\"><a href=\"#L309\">309</a></th><td></td></tr><tr><th id=\"L310\"><a href=\"#L310\">310</a></th><td>\u00a0 \u00a0 <span class=\"c\"># IProducer</span></td></tr><tr><th id=\"L311\"><a href=\"#L311\">311</a></th><td>\u00a0 \u00a0 <span class=\"k\">def</span>\u00a0<span class=\"nf\">pauseProducing</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">):</span></td></tr><tr><th id=\"L312\"><a href=\"#L312\">312</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"bp\">self</span><span class=\"o\">.</span>_pause<span class=\"p\">()</span></td></tr><tr><th id=\"L313\"><a href=\"#L313\">313</a></th><td></td></tr><tr><th id=\"L314\"><a href=\"#L314\">314</a></th><td>\u00a0 \u00a0 <span class=\"k\">def</span>\u00a0<span class=\"nf\">resumeProducing</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">):</span></td></tr><tr><th id=\"L315\"><a href=\"#L315\">315</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"bp\">self</span><span class=\"o\">.</span>_unpause<span class=\"p\">()</span></td></tr><tr><th id=\"L316\"><a href=\"#L316\">316</a></th><td></td></tr><tr><th id=\"L317\"><a href=\"#L317\">317</a></th><td>\u00a0 \u00a0 <span class=\"k\">def</span>\u00a0<span class=\"nf\">stopProducing</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">):</span></td></tr><tr><th id=\"L318\"><a href=\"#L318\">318</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"bp\">self</span><span class=\"o\">.</span>loseConnection<span class=\"p\">()</span></td></tr><tr><th id=\"L319\"><a href=\"#L319\">319</a></th><td></td></tr></tbody></table>\n\n      </div>\n      <div id=\"anydiff\">\n        <form action=\"/LUCICodeRepository/nomaticIM/diff\" method=\"get\">\n          <div class=\"buttons\">\n            <input type=\"hidden\" name=\"new_path\" value=\"/nomatic/tags/NomaticIM-0.0.5/buddy_bots/src/twisted/internet/_dumbwin32proc.py\" />\n            <input type=\"hidden\" name=\"old_path\" value=\"/nomatic/tags/NomaticIM-0.0.5/buddy_bots/src/twisted/internet/_dumbwin32proc.py\" />\n            <input type=\"hidden\" name=\"new_rev\" />\n            <input type=\"hidden\" name=\"old_rev\" />\n            <input type=\"submit\" value=\"View changes...\" title=\"Select paths and revs for Diff\" />\n          </div>\n        </form>\n      </div>\n      <div id=\"help\"><strong>Note:</strong> See <a href=\"/LUCICodeRepository/nomaticIM/wiki/TracBrowser\">TracBrowser</a>\n        for help on using the repository browser.</div>\n    </div>\n    <div id=\"altlinks\">\n      <h3>Download in other formats:</h3>\n      <ul>\n        <li class=\"first\">\n          <a rel=\"nofollow\" href=\"/LUCICodeRepository/nomaticIM/browser/nomatic/tags/NomaticIM-0.0.5/buddy_bots/src/twisted/internet/_dumbwin32proc.py?format=txt\">Plain Text</a>\n        </li><li class=\"last\">\n          <a rel=\"nofollow\" href=\"/LUCICodeRepository/nomaticIM/export/1312/nomatic/tags/NomaticIM-0.0.5/buddy_bots/src/twisted/internet/_dumbwin32proc.py\">Original Format</a>\n        </li>\n      </ul>\n    </div>\n    </div>\n    <div id=\"footer\" lang=\"en\" xml:lang=\"en\"><hr />\n      <a id=\"tracpowered\" href=\"http://trac.edgewall.org/\"><img src=\"/LUCICodeRepository/nomaticIM/chrome/common/trac_logo_mini.png\" height=\"30\" width=\"107\" alt=\"Trac Powered\" /></a>\n      <p class=\"left\">Powered by <a href=\"/LUCICodeRepository/nomaticIM/about\"><strong>Trac 1.0.1</strong></a><br />\n        By <a href=\"http://www.edgewall.org/\">Edgewall Software</a>.</p>\n      <p class=\"right\">All content copyright 2007-2008 by LUCI <br /><a href=\"http://luci.ics.uci.edu/\">http://luci.ics.uci.edu/</a></p>\n    </div>\n\t\t<div id=\"sitefooter\">\n\t\t\t<script src=\"http://www.google-analytics.com/urchin.js\" type=\"text/javascript\">\n\t\t\t</script>\n\t\t\t<script type=\"text/javascript\">\n\t\t\t\t_uacct = \"UA-338915-2\";\n\t\t\t\turchinTracker();\n\t\t\t</script>\n\t\t</div>\n\t</body>\n</html>", "id": 44317.0}