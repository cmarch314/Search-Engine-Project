{"text": "Search LoginPreferencesHelp GuideAbout Trac WikiTimelineRoadmapBrowse SourceView TicketsSearch Context Navigation BlameRevision Log source nomatic tags NomaticIM 5 buddy bots src twisted internet base py View diff against View revision Visit trunk Last change on this file was 712 checked in by cbaker 7 years ago First draft of nomatic buddy bots oscar bot is functional if you give it good authentication credentials jabber bot is just an example from the web File size 24 6 KB Line 1 test case name twisted test test internet 2 Copyright c 2 1 2 4 Twisted Matrix Laboratories 3 See LICENSE for details 456 Very basic functionality for a Reactor implementation 78API Stability stable91 Maintainer U Itamar Shtull Trauring mailto twisted itamarst org 11 1213import socket needed only for sync dns14from zope interface import implements classImplements1516import imp17import sys18import warnings19import operator2 from heapq import heappush heappop heapreplace heapify2122try 23 import fcntl24except ImportError 25 fcntl None26import traceback2728from twisted internet interfaces import IReactorCore IReactorTime IReactorThreads29from twisted internet interfaces import IResolverSimple IReactorPluggableResolver3 from twisted internet interfaces import IConnector IDelayedCall31from twisted internet import main error abstract defer threads32from twisted python import log failure reflect33from twisted python runtime import seconds platform34from twisted internet defer import Deferred DeferredList35from twisted persisted import styles3637 This import is for side effects Even if you don t see any code using it38 in this module don t delete it 39from twisted python import threadable4 41class DelayedCall styles Ephemeral 4243 implements IDelayedCall 44 enable debug to record creator call stack and it will be logged if45 an exception occurs while the function is being run46 debug False47 str None4849 def init self time func args kw cancel reset seconds None 5 51 param time Seconds from the epoch at which to call C func 52 param func The callable to call 53 param args The positional arguments to pass to the callable 54 param kw The keyword arguments to pass to the callable 55 param cancel A callable which will be called with this56 DelayedCall before cancellation 57 param reset A callable which will be called with this58 DelayedCall after changing this DelayedCall s scheduled59 execution time The callable should adjust any necessary6 scheduling details to ensure this DelayedCall is invoked61 at the new appropriate time 62 param seconds If provided a no argument callable which will be63 used to determine the current time any time that information is64 needed 65 66 self time self func self args self kw time func args kw67 self resetter reset68 self canceller cancel69 self seconds seconds7 self cancelled self called 71 self delayed time 72 if self debug 73 self creator traceback format stack 2 7475 def getTime self 76 Return the time at which this call will fire7778 rtype C float 79 return The number of seconds after the epoch at which this call is8 scheduled to be made 81 82 return self time self delayed time8384 def cancel self 85 Unschedule this call8687 raise AlreadyCancelled Raised if this call has already been88 unscheduled 899 raise AlreadyCalled Raised if this call has already been made 91 92 if self cancelled 93 raise error AlreadyCancelled94 elif self called 95 raise error AlreadyCalled96 else 97 self canceller self 98 self cancelled 199 if self debug 1 self str str self 1 1 del self func self args self kw1 21 3 def reset self secondsFromNow 1 4 Reschedule this call for a different time1 51 6 type secondsFromNow C float 1 7 param secondsFromNow The number of seconds from the time of the1 8 C reset call at which this call will be scheduled 1 911 raise AlreadyCancelled Raised if this call has been cancelled 111 raise AlreadyCalled Raised if this call has already been made 112 113 if self cancelled 114 raise error AlreadyCancelled115 elif self called 116 raise error AlreadyCalled117 else 118 if self seconds is None 119 new time seconds secondsFromNow12 else 121 new time self seconds secondsFromNow122 if new time self time 123 self delayed time 124 self time new time125 self resetter self 126 else 127 self delayed time new time self time128129 def delay self secondsLater 13 Reschedule this call for a later time131132 type secondsLater C float 133 param secondsLater The number of seconds after the originally134 scheduled time for which to reschedule this call 135136 raise AlreadyCancelled Raised if this call has been cancelled 137 raise AlreadyCalled Raised if this call has already been made 138 139 if self cancelled 14 raise error AlreadyCancelled141 elif self called 142 raise error AlreadyCalled143 else 144 self delayed time secondsLater145 if self delayed time 146 self activate delay 147 self resetter self 148149 def activate delay self 15 self time self delayed time151 self delayed time 152153 def active self 154 Determine whether this call is still pending155156 rtype C bool 157 return True if this call has not yet been made or cancelled 158 False otherwise 159 16 return not self cancelled or self called 161162 def le self other 163 return self time other time164165 def str self 166 if self str is not None 167 return self str168 if hasattr self func 169 if hasattr self func func name 17 func self func func name171 if hasattr self func im class 172 func self func im class name func173 else 174 func reflect safe repr self func 175 else 176 func None177178 if self seconds is None 179 now seconds 18 else 181 now self seconds 182 L DelayedCall s ss called s cancelled s 183 id self self time now self called self cancelled 184 if func is not None 185 L extend func 186 if self args 187 L append join reflect safe repr e for e in self args 188 if self kw 189 L append 19 if self kw 191 L append join s s k reflect safe repr v for k v in self kw iteritems 192 L append 193194 if self debug 195 L append n ntraceback at creation n n s join self creator 196 L append 197198 return join L 1992 2 1class ThreadedResolver 2 2 implements IResolverSimple 2 32 4 def init self reactor 2 5 self reactor reactor2 6 self runningQueries 2 72 8 def fail self name err 2 9 err error DNSLookupError address r not found s name err 21 return failure Failure err 211212 def cleanup self name lookupDeferred 213 userDeferred cancelCall self runningQueries lookupDeferred 214 del self runningQueries lookupDeferred 215 userDeferred errback self fail name timeout error 216217 def checkTimeout self result name lookupDeferred 218 try 219 userDeferred cancelCall self runningQueries lookupDeferred 22 except KeyError 221 pass222 else 223 del self runningQueries lookupDeferred 224 cancelCall cancel 225226 if isinstance result failure Failure 227 userDeferred errback self fail name result getErrorMessage 228 else 229 userDeferred callback result 23 231 def getHostByName self name timeout 1 3 11 45 232 if timeout 233 timeoutDelay reduce operator add timeout 234 else 235 timeoutDelay 6 236 userDeferred defer Deferred 237 lookupDeferred threads deferToThread socket gethostbyname name 238 cancelCall self reactor callLater 239 timeoutDelay self cleanup name lookupDeferred 24 self runningQueries lookupDeferred userDeferred cancelCall 241 lookupDeferred addBoth self checkTimeout name lookupDeferred 242 return userDeferred243244class BlockingResolver 245 implements IResolverSimple 246247 def getHostByName self name timeout 1 3 11 45 248 try 249 address socket gethostbyname name 25 except socket error 251 msg address r not found name 252 err error DNSLookupError msg 253 return defer fail err 254 else 255 return defer succeed address 256257class ReactorBase object 258 Default base class for Reactors 259 26 261 implements IReactorCore IReactorTime IReactorPluggableResolver 262263 installed 264 usingThreads 265 resolver BlockingResolver 266267 name twisted internet reactor 268269 def init self 27 self threadCallQueue 271 self eventTriggers 272 self pendingTimedCalls 273 self newTimedCalls 274 self cancellations 275 self running 276 self waker None277278 self addSystemEventTrigger during shutdown self crash 279 self addSystemEventTrigger during shutdown self disconnectAll 28 281 if platform supportsThreads 282 self initThreads 283284 override in subclasses285286 lock None287288 def installWaker self 289 raise NotImplementedError 29 291 def installResolver self resolver 292 assert IResolverSimple providedBy resolver 293 oldResolver self resolver294 self resolver resolver295 return oldResolver296297 def wakeUp self 298 Wake up the event loop 299 if not threadable isInIOThread 3 if self waker 3 1 self waker wakeUp 3 2 if the waker isn t installed the reactor isn t running and3 3 therefore doesn t need to be woken up3 43 5 def doIteration self delay 3 6 Do one iteration over the readers and writers we know about 3 7 raise NotImplementedError3 83 9 def addReader self reader 31 raise NotImplementedError311312 def addWriter self writer 313 raise NotImplementedError314315 def removeReader self reader 316 raise NotImplementedError317318 def removeWriter self writer 319 raise NotImplementedError32 321 def removeAll self 322 raise NotImplementedError323324 def resolve self name timeout 1 3 11 45 325 Return a Deferred that will resolve a hostname 326 327 if not name 328 XXX This is less than and will screw up IPv6 servers329 return defer succeed 33 if abstract isIPAddress name 331 return defer succeed name 332 return self resolver getHostByName name timeout 333334 Installation 335336 IReactorCore337338 def stop self 339 See twisted internet interfaces IReactorCore stop 34 341 if not self running 342 raise RuntimeError can t stop reactor that isn t running 343 self fireSystemEvent shutdown 344345 def crash self 346 See twisted internet interfaces IReactorCore crash 347 348 self running 34935 def sigInt self args 351 Handle a SIGINT interrupt 352 353 log msg Received SIGINT shutting down 354 self callFromThread self stop 355356 def sigBreak self args 357 Handle a SIGBREAK interrupt 358 359 log msg Received SIGBREAK shutting down 36 self callFromThread self stop 361362 def sigTerm self args 363 Handle a SIGTERM interrupt 364 365 log msg Received SIGTERM shutting down 366 self callFromThread self stop 367368 def disconnectAll self 369 Disconnect every reader and writer in the system 37 371 selectables self removeAll 372 for reader in selectables 373 log callWithLogger reader 374 reader connectionLost 375 failure Failure main CONNECTION LOST 376377378 def iterate self delay 379 See twisted internet interfaces IReactorCore iterate 38 381 self runUntilCurrent 382 self doIteration delay 383384 def fireSystemEvent self eventType 385 See twisted internet interfaces IReactorCore fireSystemEvent 386 387 sysEvtTriggers self eventTriggers get eventType 388 if not sysEvtTriggers 389 return39 defrList 391 for callable args kw in sysEvtTriggers 392 try 393 d callable args kw 394 except 395 log deferr 396 else 397 if isinstance d Deferred 398 defrList append d 399 if defrList 4 DeferredList defrList addBoth self cbContinueSystemEvent eventType 4 1 else 4 2 self callLater self continueSystemEvent eventType 4 34 44 5 def cbContinueSystemEvent self result eventType 4 6 self continueSystemEvent eventType 4 74 84 9 def continueSystemEvent self eventType 41 sysEvtTriggers self eventTriggers get eventType 411 for callList in sysEvtTriggers 1 sysEvtTriggers 2 412 for callable args kw in callList 413 try 414 callable args kw 415 except 416 log deferr 417 now that we ve called all callbacks no need to store418 references to them anymore in fact this can cause problems 419 del self eventTriggers eventType 42 421 def addSystemEventTrigger self phase eventType f args kw 422 See twisted internet interfaces IReactorCore addSystemEventTrigger 423 424 assert callable f s is not callable f425 if self eventTriggers has key eventType 426 triglist self eventTriggers eventType 427 else 428 triglist 429 self eventTriggers eventType triglist43 evtList triglist before during 1 after 2 phase 431 evtList append f args kw 432 return phase eventType f args kw 433434 def removeSystemEventTrigger self triggerID 435 See twisted internet interfaces IReactorCore removeSystemEventTrigger 436 437 phase eventType item triggerID438 self eventTriggers eventType before 439 during 1 44 after 2 phase 441 remove item 442443 def callWhenRunning self callable args kw 444 See twisted internet interfaces IReactorCore callWhenRunning 445 446 if self running 447 callable args kw 448 else 449 return self addSystemEventTrigger after startup 45 callable args kw 451452 IReactorTime453454 def callLater self seconds f args kw 455 See twisted internet interfaces IReactorTime callLater 456 457 assert callable f s is not callable f458 assert sys maxint seconds 459 s is not greater than or equal to seconds seconds 46 tple DelayedCall seconds seconds f args kw 461 self cancelCallLater 462 self moveCallLaterSooner 463 self newTimedCalls append tple 464 return tple465466 def moveCallLaterSooner self tple 467 Linear time find slow 468 heap self pendingTimedCalls469 try 47 pos heap index tple 471472 Move elt up the heap until it rests at the right place 473 elt heap pos 474 while pos 475 parent pos 1 2476 if heap parent elt 477 break478 move parent down479 heap pos heap parent 48 pos parent481 heap pos elt482 except ValueError 483 element was not found in heap oh well 484 pass485486 def cancelCallLater self tple 487 self cancellations 1488489 def cancelCallLater self callID 49 See twisted internet interfaces IReactorTime cancelCallLater 491 492 DO NOT DELETE THIS this is documented in Python in a Nutshell so we493 we can t get rid of it for a long time 494 warnings warn reactor cancelCallLater callID is deprecated use callID cancel instead 495 callID cancel 496497 def getDelayedCalls self 498 Return all the outstanding delayed calls in the system 499 They are returned in no particular order 5 This method is not efficient it is really only meant for5 1 test cases 5 2 return x for x in self pendingTimedCalls self newTimedCalls if not x cancelled 5 35 4 def insertNewDelayedCalls self 5 5 for call in self newTimedCalls 5 6 if call cancelled 5 7 self cancellations 15 8 else 5 9 call activate delay 51 heappush self pendingTimedCalls call 511 self newTimedCalls 512513 def timeout self 514 insert new delayed calls to make sure to include them in timeout value515 self insertNewDelayedCalls 516517 if not self pendingTimedCalls 518 return None51952 return max self pendingTimedCalls time seconds 521522 def runUntilCurrent self 523 Run all pending timed calls 524 525 if self threadCallQueue 526 Keep track of how many calls we actually make as we re527 making them in case another call is added to the queue528 while we re in this loop 529 count 53 total len self threadCallQueue 531 for f a kw in self threadCallQueue 532 try 533 f a kw 534 except 535 log err 536 count 1537 if count total 538 break539 del self threadCallQueue count 54 if self threadCallQueue 541 if self waker 542 self waker wakeUp 543 544 insert new delayed calls now545 self insertNewDelayedCalls 546547 now seconds 548 while self pendingTimedCalls and self pendingTimedCalls time now 549 call heappop self pendingTimedCalls 55 if call cancelled 551 self cancellations 1552 continue553554 if call delayed time 555 call activate delay 556 heappush self pendingTimedCalls call 557 continue558559 try 56 call called 1561 call func call args call kw 562 except 563 log deferr 564 if hasattr call creator 565 e n 566 e C previous exception occurred in 567 a DelayedCall created here n 568 e C 569 e join call creator rstrip replace n n C 57 e n 571 log msg e 572573574 if self cancellations 5 and575 self cancellations len self pendingTimedCalls 1 576 self cancellations 577 self pendingTimedCalls x for x in self pendingTimedCalls578 if not x cancelled 579 heapify self pendingTimedCalls 58 581 IReactorThreads582 if platform supportsThreads 583 threadpool None584585 def initThreads self 586 self usingThreads 1587 self resolver ThreadedResolver self 588 self installWaker 58959 def callFromThread self f args kw 591 See twisted internet interfaces IReactorThreads callFromThread 592 593 assert callable f s is not callable f 594 lists are thread safe in CPython but not in Jython595 this is probably a bug in Jython but until fixed this code596 won t work in Jython 597 self threadCallQueue append f args kw 598 self wakeUp 5996 def initThreadPool self 6 1 from twisted python import threadpool6 2 self threadpool threadpool ThreadPool 1 twisted internet reactor 6 3 self callWhenRunning self threadpool start 6 4 self addSystemEventTrigger during shutdown self threadpool stop 6 56 6 def callInThread self callable args kwargs 6 7 See twisted internet interfaces IReactorThreads callInThread 6 8 6 9 if self threadpool is None 61 self initThreadPool 611 self threadpool callInThread callable args kwargs 612613 def suggestThreadPoolSize self size 614 See twisted internet interfaces IReactorThreads suggestThreadPoolSize 615 616 if size and not self threadpool 617 return618 if not self threadpool 619 self initThreadPool 62 self threadpool adjustPoolsize maxthreads size 621 else 622 This is for signal handlers 623 def callFromThread self f args kw 624 assert callable f s is not callable f 625 See comment in the other callFromThread implementation 626 self threadCallQueue append f args kw 627628if platform supportsThreads 629 classImplements ReactorBase IReactorThreads 63 631632class BaseConnector styles Ephemeral 633 Basic implementation of connector 634635 State can be connecting connected disconnected 636 637638 implements IConnector 63964 timeoutID None641 factoryStarted 642643 def init self factory timeout reactor 644 self state disconnected 645 self reactor reactor646 self factory factory647 self timeout timeout648649 def disconnect self 65 Disconnect whatever our state is 651 if self state connecting 652 self stopConnecting 653 elif self state connected 654 self transport loseConnection 655656 def connect self 657 Start connection to remote server 658 if self state disconnected 659 raise RuntimeError can t connect in this state 66 661 self state connecting 662 if not self factoryStarted 663 self factory doStart 664 self factoryStarted 1665 self transport transport self makeTransport 666 if self timeout is not None 667 self timeoutID self reactor callLater self timeout transport failIfNotConnected error TimeoutError 668 self factory startedConnecting self 66967 def stopConnecting self 671 Stop attempting to connect 672 if self state connecting 673 raise error NotConnectingError we re not trying to connect 674675 self state disconnected 676 self transport failIfNotConnected error UserError 677 del self transport678679 def cancelTimeout self 68 if self timeoutID is not None 681 try 682 self timeoutID cancel 683 except ValueError 684 pass685 del self timeoutID686687 def buildProtocol self addr 688 self state connected 689 self cancelTimeout 69 return self factory buildProtocol addr 691692 def connectionFailed self reason 693 self cancelTimeout 694 self transport None695 self state disconnected 696 self factory clientConnectionFailed self reason 697 if self state disconnected 698 factory hasn t called our connect method699 self factory doStop 7 self factoryStarted 7 17 2 def connectionLost self reason 7 3 self state disconnected 7 4 self factory clientConnectionLost self reason 7 5 if self state disconnected 7 6 factory hasn t called our connect method7 7 self factory doStop 7 8 self factoryStarted 7 971 def getDestination self 711 raise NotImplementedError implement in subclasses 712713714class BasePort abstract FileDescriptor 715 Basic implementation of a ListeningPort 716717 Note This does not actually implement IListeningPort 718 71972 addressFamily None721 socketType None722723 def createInternetSocket self 724 s socket socket self addressFamily self socketType 725 s setblocking 726 if fcntl and hasattr fcntl FD CLOEXEC 727 old fcntl fcntl s fileno fcntl F GETFD 728 fcntl fcntl s fileno fcntl F SETFD old fcntl FD CLOEXEC 729 return s73 731732 def doWrite self 733 Raises a RuntimeError 734 raise RuntimeError doWrite called on a s reflect qual self class 735736737 all Note See TracBrowser for help on using the repository browser Download in other formats Plain Text Original Format Powered by Trac 1 1 By Edgewall Software All content copyright 2 7 2 8 by LUCI http luci ics uci edu ", "_id": "http://djp3-pc2.ics.uci.edu/LUCICodeRepository/nomaticIM/browser/nomatic/tags/NomaticIM-0.0.5/buddy_bots/src/twisted/internet/base.py", "title": "\n      base.py in nomatic/tags/nomaticim-0.0.5/buddy_bots/src/twisted/internet\n     \u2013 nomatic*im\n    ", "html": "<!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Strict//EN\" \"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd\">\n<html xmlns=\"http://www.w3.org/1999/xhtml\">\n  \n  \n\n  \n\n\n  <head>\n\t\t<title>\n      base.py in nomatic/tags/NomaticIM-0.0.5/buddy_bots/src/twisted/internet\n     \u2013 Nomatic*IM\n    </title><meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\" /><meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge\" /><link rel=\"search\" href=\"/LUCICodeRepository/nomaticIM/search\" /><link rel=\"help\" href=\"/LUCICodeRepository/nomaticIM/wiki/TracGuide\" /><link rel=\"alternate\" href=\"/LUCICodeRepository/nomaticIM/browser/nomatic/tags/NomaticIM-0.0.5/buddy_bots/src/twisted/internet/base.py?format=txt\" type=\"text/plain\" title=\"Plain Text\" /><link rel=\"alternate\" href=\"/LUCICodeRepository/nomaticIM/export/1312/nomatic/tags/NomaticIM-0.0.5/buddy_bots/src/twisted/internet/base.py\" type=\"application/x-python; charset=iso-8859-15\" title=\"Original Format\" /><link rel=\"start\" href=\"/LUCICodeRepository/nomaticIM/wiki\" /><link rel=\"stylesheet\" href=\"/LUCICodeRepository/nomaticIM/chrome/common/css/trac.css\" type=\"text/css\" /><link rel=\"stylesheet\" href=\"/LUCICodeRepository/nomaticIM/chrome/common/css/code.css\" type=\"text/css\" /><link rel=\"stylesheet\" href=\"/LUCICodeRepository/nomaticIM/pygments/trac.css\" type=\"text/css\" /><link rel=\"stylesheet\" href=\"/LUCICodeRepository/nomaticIM/chrome/common/css/browser.css\" type=\"text/css\" /><link rel=\"shortcut icon\" href=\"http://luci.ics.uci.edu/logo32by32.gif\" type=\"image/gif\" /><link rel=\"icon\" href=\"http://luci.ics.uci.edu/logo32by32.gif\" type=\"image/gif\" /><link type=\"application/opensearchdescription+xml\" rel=\"search\" href=\"/LUCICodeRepository/nomaticIM/search/opensearch\" title=\"Search Nomatic*IM\" /><script type=\"text/javascript\" charset=\"utf-8\" src=\"/LUCICodeRepository/nomaticIM/chrome/common/js/jquery.js\"></script><script type=\"text/javascript\" charset=\"utf-8\" src=\"/LUCICodeRepository/nomaticIM/chrome/common/js/babel.js\"></script><script type=\"text/javascript\" charset=\"utf-8\" src=\"/LUCICodeRepository/nomaticIM/chrome/common/js/messages/en_US.js\"></script><script type=\"text/javascript\" charset=\"utf-8\" src=\"/LUCICodeRepository/nomaticIM/chrome/common/js/trac.js\"></script><script type=\"text/javascript\" charset=\"utf-8\" src=\"/LUCICodeRepository/nomaticIM/chrome/common/js/search.js\"></script><script type=\"text/javascript\" src=\"/LUCICodeRepository/nomaticIM/chrome/common/js/folding.js\"></script><script type=\"text/javascript\">\n      jQuery(document).ready(function($) {\n        $(\".trac-toggledeleted\").show().click(function() {\n                  $(this).siblings().find(\".trac-deleted\").toggle();\n                  return false;\n        }).click();\n        $(\"#jumploc input\").hide();\n        $(\"#jumploc select\").change(function () {\n          this.parentNode.parentNode.submit();\n        });\n          $('#preview table.code').enableCollapsibleColumns($('#preview table.code thead th.content'));\n      });\n    </script>\n\t</head>\n  <body>\n    <div id=\"banner\">\n      <div id=\"header\">\n        <a id=\"logo\" href=\"http://luci.ics.uci.edu/#code\"><img src=\"http://luci.ics.uci.edu/blog/archives/LUCIhorzTight.jpg\" alt=\"LUCI Code Repository\" /></a>\n      </div>\n      <form id=\"search\" action=\"/LUCICodeRepository/nomaticIM/search\" method=\"get\">\n        <div>\n          <label for=\"proj-search\">Search:</label>\n          <input type=\"text\" id=\"proj-search\" name=\"q\" size=\"18\" value=\"\" />\n          <input type=\"submit\" value=\"Search\" />\n        </div>\n      </form>\n      <div id=\"metanav\" class=\"nav\">\n    <ul>\n      <li class=\"first\"><a href=\"/LUCICodeRepository/nomaticIM/login\">Login</a></li><li><a href=\"/LUCICodeRepository/nomaticIM/prefs\">Preferences</a></li><li><a href=\"/LUCICodeRepository/nomaticIM/wiki/TracGuide\">Help/Guide</a></li><li class=\"last\"><a href=\"/LUCICodeRepository/nomaticIM/about\">About Trac</a></li>\n    </ul>\n  </div>\n    </div>\n    <div id=\"mainnav\" class=\"nav\">\n    <ul>\n      <li class=\"first\"><a href=\"/LUCICodeRepository/nomaticIM/wiki\">Wiki</a></li><li><a href=\"/LUCICodeRepository/nomaticIM/timeline\">Timeline</a></li><li><a href=\"/LUCICodeRepository/nomaticIM/roadmap\">Roadmap</a></li><li class=\"active\"><a href=\"/LUCICodeRepository/nomaticIM/browser\">Browse Source</a></li><li><a href=\"/LUCICodeRepository/nomaticIM/report\">View Tickets</a></li><li class=\"last\"><a href=\"/LUCICodeRepository/nomaticIM/search\">Search</a></li>\n    </ul>\n  </div>\n    <div id=\"main\">\n      <div id=\"ctxtnav\" class=\"nav\">\n        <h2>Context Navigation</h2>\n        <ul>\n          <li class=\"first\"><a href=\"/LUCICodeRepository/nomaticIM/browser/nomatic/trunk/buddy_bots/twisted/internet/base.py?annotate=blame\" title=\"Annotate each line with the last changed revision (this can be time consuming...)\">Blame</a></li><li class=\"last\"><a href=\"/LUCICodeRepository/nomaticIM/log/nomatic/tags/NomaticIM-0.0.5/buddy_bots/src/twisted/internet/base.py\">Revision Log</a></li>\n        </ul>\n        <hr />\n      </div>\n    <div id=\"content\" class=\"browser\">\n        <h1>\n          \n<a class=\"pathentry first\" href=\"/LUCICodeRepository/nomaticIM/browser?order=name\" title=\"Go to repository root\">source:</a>\n<a class=\"pathentry\" href=\"/LUCICodeRepository/nomaticIM/browser/nomatic?order=name\" title=\"View nomatic\">nomatic</a><span class=\"pathentry sep\">/</span><a class=\"pathentry\" href=\"/LUCICodeRepository/nomaticIM/browser/nomatic/tags?order=name\" title=\"View tags\">tags</a><span class=\"pathentry sep\">/</span><a class=\"pathentry\" href=\"/LUCICodeRepository/nomaticIM/browser/nomatic/tags/NomaticIM-0.0.5?order=name\" title=\"View NomaticIM-0.0.5\">NomaticIM-0.0.5</a><span class=\"pathentry sep\">/</span><a class=\"pathentry\" href=\"/LUCICodeRepository/nomaticIM/browser/nomatic/tags/NomaticIM-0.0.5/buddy_bots?order=name\" title=\"View buddy_bots\">buddy_bots</a><span class=\"pathentry sep\">/</span><a class=\"pathentry\" href=\"/LUCICodeRepository/nomaticIM/browser/nomatic/tags/NomaticIM-0.0.5/buddy_bots/src?order=name\" title=\"View src\">src</a><span class=\"pathentry sep\">/</span><a class=\"pathentry\" href=\"/LUCICodeRepository/nomaticIM/browser/nomatic/tags/NomaticIM-0.0.5/buddy_bots/src/twisted?order=name\" title=\"View twisted\">twisted</a><span class=\"pathentry sep\">/</span><a class=\"pathentry\" href=\"/LUCICodeRepository/nomaticIM/browser/nomatic/tags/NomaticIM-0.0.5/buddy_bots/src/twisted/internet?order=name\" title=\"View internet\">internet</a><span class=\"pathentry sep\">/</span><a class=\"pathentry\" href=\"/LUCICodeRepository/nomaticIM/browser/nomatic/tags/NomaticIM-0.0.5/buddy_bots/src/twisted/internet/base.py?order=name\" title=\"View base.py\">base.py</a>\n<br style=\"clear: both\" />\n\n        </h1>\n        <div id=\"diffrev\">\n          <form action=\"/LUCICodeRepository/nomaticIM/changeset\" method=\"get\">\n            <div>\n              <label title=\"Show the diff against a specific revision\">\n                View diff against: <input type=\"text\" name=\"old\" size=\"6\" />\n                <input type=\"hidden\" name=\"old_path\" value=\"nomatic/tags/NomaticIM-0.0.5/buddy_bots/src/twisted/internet/base.py\" />\n                <input type=\"hidden\" name=\"new\" />\n                <input type=\"hidden\" name=\"new_path\" value=\"nomatic/tags/NomaticIM-0.0.5/buddy_bots/src/twisted/internet/base.py\" />\n              </label>\n            </div>\n          </form>\n        </div>\n        <div id=\"jumprev\">\n          <form action=\"\" method=\"get\">\n            <div>\n              <label for=\"rev\">\n                View revision:</label>\n              <input type=\"text\" id=\"rev\" name=\"rev\" size=\"6\" />\n            </div>\n          </form>\n        </div>\n        <div id=\"jumploc\">\n          <form action=\"\" method=\"get\">\n            <div class=\"buttons\">\n              <label for=\"preselected\">Visit:</label>\n              <select id=\"preselected\" name=\"preselected\">\n                <option selected=\"selected\"></option>\n                <optgroup label=\"branches\">\n                  <option value=\"/LUCICodeRepository/nomaticIM/browser/trunk\">trunk</option>\n                </optgroup>\n              </select>\n              <input type=\"submit\" value=\"Go!\" title=\"Jump to the chosen preselected path\" />\n            </div>\n          </form>\n        </div>\n        <div class=\"trac-tags\">\n        </div>\n      <table id=\"info\" summary=\"Revision info\">\n        <tr>\n          <th>\n                <a href=\"/LUCICodeRepository/nomaticIM/changeset/712/nomatic/trunk/buddy_bots/twisted/internet/base.py\" title=\"View differences\">Last change</a>\n                  on this file was\n                  <a href=\"/LUCICodeRepository/nomaticIM/changeset/712/\" title=\"View changeset 712\">712</a>,\n                  checked in by cbaker, <a class=\"timeline\" href=\"/LUCICodeRepository/nomaticIM/timeline?from=2008-02-16T08%3A16%3A53-08%3A00&amp;precision=second\" title=\"See timeline at Feb 16, 2008, 8:16:53 AM\">7 years ago</a>\n          </th>\n        </tr>\n        <tr>\n          <td class=\"message searchable\">\n              <p>\nFirst draft of nomatic buddy bots. oscar_bot is functional if you give it good authentication credentials, jabber_bot is just an example from the web <br />\n</p>\n          </td>\n        </tr>\n        <tr><td colspan=\"2\">\n            <strong>File size:</strong>\n            <span title=\"25229 bytes\">24.6 KB</span>\n          </td></tr>\n      </table>\n      <div id=\"preview\" class=\"searchable\">\n        \n  <table class=\"code\"><thead><tr><th class=\"lineno\" title=\"Line numbers\">Line</th><th class=\"content\">\u00a0</th></tr></thead><tbody><tr><th id=\"L1\"><a href=\"#L1\">1</a></th><td><span class=\"c\"># -*- test-case-name: twisted.test.test_internet -*-</span></td></tr><tr><th id=\"L2\"><a href=\"#L2\">2</a></th><td><span class=\"c\"># Copyright (c) 2001-2004 Twisted Matrix Laboratories.</span></td></tr><tr><th id=\"L3\"><a href=\"#L3\">3</a></th><td><span class=\"c\"># See LICENSE for details.</span></td></tr><tr><th id=\"L4\"><a href=\"#L4\">4</a></th><td></td></tr><tr><th id=\"L5\"><a href=\"#L5\">5</a></th><td></td></tr><tr><th id=\"L6\"><a href=\"#L6\">6</a></th><td><span class=\"sd\">\"\"\"Very basic functionality for a Reactor implementation.</span></td></tr><tr><th id=\"L7\"><a href=\"#L7\">7</a></th><td><span class=\"sd\"></span></td></tr><tr><th id=\"L8\"><a href=\"#L8\">8</a></th><td><span class=\"sd\">API Stability: stable</span></td></tr><tr><th id=\"L9\"><a href=\"#L9\">9</a></th><td><span class=\"sd\"></span></td></tr><tr><th id=\"L10\"><a href=\"#L10\">10</a></th><td><span class=\"sd\">Maintainer: U{Itamar Shtull-Trauring&lt;mailto:twisted@itamarst.org&gt;}</span></td></tr><tr><th id=\"L11\"><a href=\"#L11\">11</a></th><td><span class=\"sd\">\"\"\"</span></td></tr><tr><th id=\"L12\"><a href=\"#L12\">12</a></th><td></td></tr><tr><th id=\"L13\"><a href=\"#L13\">13</a></th><td><span class=\"kn\">import</span>\u00a0<span class=\"nn\">socket</span>\u00a0<span class=\"c\"># needed only for sync-dns</span></td></tr><tr><th id=\"L14\"><a href=\"#L14\">14</a></th><td><span class=\"kn\">from</span>\u00a0<span class=\"nn\">zope.interface</span>\u00a0<span class=\"kn\">import</span>\u00a0implements<span class=\"p\">,</span>\u00a0classImplements</td></tr><tr><th id=\"L15\"><a href=\"#L15\">15</a></th><td></td></tr><tr><th id=\"L16\"><a href=\"#L16\">16</a></th><td><span class=\"kn\">import</span>\u00a0<span class=\"nn\">imp</span></td></tr><tr><th id=\"L17\"><a href=\"#L17\">17</a></th><td><span class=\"kn\">import</span>\u00a0<span class=\"nn\">sys</span></td></tr><tr><th id=\"L18\"><a href=\"#L18\">18</a></th><td><span class=\"kn\">import</span>\u00a0<span class=\"nn\">warnings</span></td></tr><tr><th id=\"L19\"><a href=\"#L19\">19</a></th><td><span class=\"kn\">import</span>\u00a0<span class=\"nn\">operator</span></td></tr><tr><th id=\"L20\"><a href=\"#L20\">20</a></th><td><span class=\"kn\">from</span>\u00a0<span class=\"nn\">heapq</span>\u00a0<span class=\"kn\">import</span>\u00a0heappush<span class=\"p\">,</span>\u00a0heappop<span class=\"p\">,</span>\u00a0heapreplace<span class=\"p\">,</span>\u00a0heapify</td></tr><tr><th id=\"L21\"><a href=\"#L21\">21</a></th><td></td></tr><tr><th id=\"L22\"><a href=\"#L22\">22</a></th><td><span class=\"k\">try</span><span class=\"p\">:</span></td></tr><tr><th id=\"L23\"><a href=\"#L23\">23</a></th><td>\u00a0 \u00a0 <span class=\"kn\">import</span>\u00a0<span class=\"nn\">fcntl</span></td></tr><tr><th id=\"L24\"><a href=\"#L24\">24</a></th><td><span class=\"k\">except</span>\u00a0<span class=\"ne\">ImportError</span><span class=\"p\">:</span></td></tr><tr><th id=\"L25\"><a href=\"#L25\">25</a></th><td>\u00a0 \u00a0 fcntl <span class=\"o\">=</span>\u00a0<span class=\"bp\">None</span></td></tr><tr><th id=\"L26\"><a href=\"#L26\">26</a></th><td><span class=\"kn\">import</span>\u00a0<span class=\"nn\">traceback</span></td></tr><tr><th id=\"L27\"><a href=\"#L27\">27</a></th><td></td></tr><tr><th id=\"L28\"><a href=\"#L28\">28</a></th><td><span class=\"kn\">from</span>\u00a0<span class=\"nn\">twisted.internet.interfaces</span>\u00a0<span class=\"kn\">import</span>\u00a0IReactorCore<span class=\"p\">,</span>\u00a0IReactorTime<span class=\"p\">,</span>\u00a0IReactorThreads</td></tr><tr><th id=\"L29\"><a href=\"#L29\">29</a></th><td><span class=\"kn\">from</span>\u00a0<span class=\"nn\">twisted.internet.interfaces</span>\u00a0<span class=\"kn\">import</span>\u00a0IResolverSimple<span class=\"p\">,</span>\u00a0IReactorPluggableResolver</td></tr><tr><th id=\"L30\"><a href=\"#L30\">30</a></th><td><span class=\"kn\">from</span>\u00a0<span class=\"nn\">twisted.internet.interfaces</span>\u00a0<span class=\"kn\">import</span>\u00a0IConnector<span class=\"p\">,</span>\u00a0IDelayedCall</td></tr><tr><th id=\"L31\"><a href=\"#L31\">31</a></th><td><span class=\"kn\">from</span>\u00a0<span class=\"nn\">twisted.internet</span>\u00a0<span class=\"kn\">import</span>\u00a0main<span class=\"p\">,</span>\u00a0error<span class=\"p\">,</span>\u00a0abstract<span class=\"p\">,</span>\u00a0defer<span class=\"p\">,</span>\u00a0threads</td></tr><tr><th id=\"L32\"><a href=\"#L32\">32</a></th><td><span class=\"kn\">from</span>\u00a0<span class=\"nn\">twisted.python</span>\u00a0<span class=\"kn\">import</span>\u00a0log<span class=\"p\">,</span>\u00a0failure<span class=\"p\">,</span>\u00a0reflect</td></tr><tr><th id=\"L33\"><a href=\"#L33\">33</a></th><td><span class=\"kn\">from</span>\u00a0<span class=\"nn\">twisted.python.runtime</span>\u00a0<span class=\"kn\">import</span>\u00a0seconds<span class=\"p\">,</span>\u00a0platform</td></tr><tr><th id=\"L34\"><a href=\"#L34\">34</a></th><td><span class=\"kn\">from</span>\u00a0<span class=\"nn\">twisted.internet.defer</span>\u00a0<span class=\"kn\">import</span>\u00a0Deferred<span class=\"p\">,</span>\u00a0DeferredList</td></tr><tr><th id=\"L35\"><a href=\"#L35\">35</a></th><td><span class=\"kn\">from</span>\u00a0<span class=\"nn\">twisted.persisted</span>\u00a0<span class=\"kn\">import</span>\u00a0styles</td></tr><tr><th id=\"L36\"><a href=\"#L36\">36</a></th><td></td></tr><tr><th id=\"L37\"><a href=\"#L37\">37</a></th><td><span class=\"c\"># This import is for side-effects!\u00a0 Even if you don't see any code using it</span></td></tr><tr><th id=\"L38\"><a href=\"#L38\">38</a></th><td><span class=\"c\"># in this module, don't delete it.</span></td></tr><tr><th id=\"L39\"><a href=\"#L39\">39</a></th><td><span class=\"kn\">from</span>\u00a0<span class=\"nn\">twisted.python</span>\u00a0<span class=\"kn\">import</span>\u00a0threadable</td></tr><tr><th id=\"L40\"><a href=\"#L40\">40</a></th><td></td></tr><tr><th id=\"L41\"><a href=\"#L41\">41</a></th><td><span class=\"k\">class</span>\u00a0<span class=\"nc\">DelayedCall</span><span class=\"p\">(</span>styles<span class=\"o\">.</span>Ephemeral<span class=\"p\">):</span></td></tr><tr><th id=\"L42\"><a href=\"#L42\">42</a></th><td></td></tr><tr><th id=\"L43\"><a href=\"#L43\">43</a></th><td>\u00a0 \u00a0 implements<span class=\"p\">(</span>IDelayedCall<span class=\"p\">)</span></td></tr><tr><th id=\"L44\"><a href=\"#L44\">44</a></th><td>\u00a0 \u00a0 <span class=\"c\"># enable .debug to record creator call stack, and it will be logged if</span></td></tr><tr><th id=\"L45\"><a href=\"#L45\">45</a></th><td>\u00a0 \u00a0 <span class=\"c\"># an exception occurs while the function is being run</span></td></tr><tr><th id=\"L46\"><a href=\"#L46\">46</a></th><td>\u00a0 \u00a0 debug <span class=\"o\">=</span>\u00a0<span class=\"bp\">False</span></td></tr><tr><th id=\"L47\"><a href=\"#L47\">47</a></th><td>\u00a0 \u00a0 _str <span class=\"o\">=</span>\u00a0<span class=\"bp\">None</span></td></tr><tr><th id=\"L48\"><a href=\"#L48\">48</a></th><td></td></tr><tr><th id=\"L49\"><a href=\"#L49\">49</a></th><td>\u00a0 \u00a0 <span class=\"k\">def</span>\u00a0<span class=\"nf\">__init__</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span>\u00a0time<span class=\"p\">,</span>\u00a0func<span class=\"p\">,</span>\u00a0args<span class=\"p\">,</span>\u00a0kw<span class=\"p\">,</span>\u00a0cancel<span class=\"p\">,</span>\u00a0reset<span class=\"p\">,</span>\u00a0seconds<span class=\"o\">=</span><span class=\"bp\">None</span><span class=\"p\">):</span></td></tr><tr><th id=\"L50\"><a href=\"#L50\">50</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"sd\">\"\"\"</span></td></tr><tr><th id=\"L51\"><a href=\"#L51\">51</a></th><td><span class=\"sd\">\u00a0 \u00a0 \u00a0 \u00a0 @param time: Seconds from the epoch at which to call C{func}.</span></td></tr><tr><th id=\"L52\"><a href=\"#L52\">52</a></th><td><span class=\"sd\">\u00a0 \u00a0 \u00a0 \u00a0 @param func: The callable to call.</span></td></tr><tr><th id=\"L53\"><a href=\"#L53\">53</a></th><td><span class=\"sd\">\u00a0 \u00a0 \u00a0 \u00a0 @param args: The positional arguments to pass to the callable.</span></td></tr><tr><th id=\"L54\"><a href=\"#L54\">54</a></th><td><span class=\"sd\">\u00a0 \u00a0 \u00a0 \u00a0 @param kw: The keyword arguments to pass to the callable.</span></td></tr><tr><th id=\"L55\"><a href=\"#L55\">55</a></th><td><span class=\"sd\">\u00a0 \u00a0 \u00a0 \u00a0 @param cancel: A callable which will be called with this</span></td></tr><tr><th id=\"L56\"><a href=\"#L56\">56</a></th><td><span class=\"sd\">\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 DelayedCall before cancellation.</span></td></tr><tr><th id=\"L57\"><a href=\"#L57\">57</a></th><td><span class=\"sd\">\u00a0 \u00a0 \u00a0 \u00a0 @param reset: A callable which will be called with this</span></td></tr><tr><th id=\"L58\"><a href=\"#L58\">58</a></th><td><span class=\"sd\">\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 DelayedCall after changing this DelayedCall's scheduled</span></td></tr><tr><th id=\"L59\"><a href=\"#L59\">59</a></th><td><span class=\"sd\">\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 execution time. The callable should adjust any necessary</span></td></tr><tr><th id=\"L60\"><a href=\"#L60\">60</a></th><td><span class=\"sd\">\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 scheduling details to ensure this DelayedCall is invoked</span></td></tr><tr><th id=\"L61\"><a href=\"#L61\">61</a></th><td><span class=\"sd\">\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 at the new appropriate time.</span></td></tr><tr><th id=\"L62\"><a href=\"#L62\">62</a></th><td><span class=\"sd\">\u00a0 \u00a0 \u00a0 \u00a0 @param seconds: If provided, a no-argument callable which will be</span></td></tr><tr><th id=\"L63\"><a href=\"#L63\">63</a></th><td><span class=\"sd\">\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 used to determine the current time any time that information is</span></td></tr><tr><th id=\"L64\"><a href=\"#L64\">64</a></th><td><span class=\"sd\">\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 needed.</span></td></tr><tr><th id=\"L65\"><a href=\"#L65\">65</a></th><td><span class=\"sd\">\u00a0 \u00a0 \u00a0 \u00a0 \"\"\"</span></td></tr><tr><th id=\"L66\"><a href=\"#L66\">66</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"bp\">self</span><span class=\"o\">.</span>time<span class=\"p\">,</span>\u00a0<span class=\"bp\">self</span><span class=\"o\">.</span>func<span class=\"p\">,</span>\u00a0<span class=\"bp\">self</span><span class=\"o\">.</span>args<span class=\"p\">,</span>\u00a0<span class=\"bp\">self</span><span class=\"o\">.</span>kw <span class=\"o\">=</span>\u00a0time<span class=\"p\">,</span>\u00a0func<span class=\"p\">,</span>\u00a0args<span class=\"p\">,</span>\u00a0kw</td></tr><tr><th id=\"L67\"><a href=\"#L67\">67</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"bp\">self</span><span class=\"o\">.</span>resetter <span class=\"o\">=</span>\u00a0reset</td></tr><tr><th id=\"L68\"><a href=\"#L68\">68</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"bp\">self</span><span class=\"o\">.</span>canceller <span class=\"o\">=</span>\u00a0cancel</td></tr><tr><th id=\"L69\"><a href=\"#L69\">69</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"bp\">self</span><span class=\"o\">.</span>seconds <span class=\"o\">=</span>\u00a0seconds</td></tr><tr><th id=\"L70\"><a href=\"#L70\">70</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"bp\">self</span><span class=\"o\">.</span>cancelled <span class=\"o\">=</span>\u00a0<span class=\"bp\">self</span><span class=\"o\">.</span>called <span class=\"o\">=</span>\u00a0<span class=\"mi\">0</span></td></tr><tr><th id=\"L71\"><a href=\"#L71\">71</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"bp\">self</span><span class=\"o\">.</span>delayed_time <span class=\"o\">=</span>\u00a0<span class=\"mi\">0</span></td></tr><tr><th id=\"L72\"><a href=\"#L72\">72</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">if</span>\u00a0<span class=\"bp\">self</span><span class=\"o\">.</span>debug<span class=\"p\">:</span></td></tr><tr><th id=\"L73\"><a href=\"#L73\">73</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"bp\">self</span><span class=\"o\">.</span>creator <span class=\"o\">=</span>\u00a0traceback<span class=\"o\">.</span>format_stack<span class=\"p\">()[:</span><span class=\"o\">-</span><span class=\"mi\">2</span><span class=\"p\">]</span></td></tr><tr><th id=\"L74\"><a href=\"#L74\">74</a></th><td></td></tr><tr><th id=\"L75\"><a href=\"#L75\">75</a></th><td>\u00a0 \u00a0 <span class=\"k\">def</span>\u00a0<span class=\"nf\">getTime</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">):</span></td></tr><tr><th id=\"L76\"><a href=\"#L76\">76</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"sd\">\"\"\"Return the time at which this call will fire</span></td></tr><tr><th id=\"L77\"><a href=\"#L77\">77</a></th><td><span class=\"sd\"></span></td></tr><tr><th id=\"L78\"><a href=\"#L78\">78</a></th><td><span class=\"sd\">\u00a0 \u00a0 \u00a0 \u00a0 @rtype: C{float}</span></td></tr><tr><th id=\"L79\"><a href=\"#L79\">79</a></th><td><span class=\"sd\">\u00a0 \u00a0 \u00a0 \u00a0 @return: The number of seconds after the epoch at which this call is</span></td></tr><tr><th id=\"L80\"><a href=\"#L80\">80</a></th><td><span class=\"sd\">\u00a0 \u00a0 \u00a0 \u00a0 scheduled to be made.</span></td></tr><tr><th id=\"L81\"><a href=\"#L81\">81</a></th><td><span class=\"sd\">\u00a0 \u00a0 \u00a0 \u00a0 \"\"\"</span></td></tr><tr><th id=\"L82\"><a href=\"#L82\">82</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">return</span>\u00a0<span class=\"bp\">self</span><span class=\"o\">.</span>time <span class=\"o\">+</span>\u00a0<span class=\"bp\">self</span><span class=\"o\">.</span>delayed_time</td></tr><tr><th id=\"L83\"><a href=\"#L83\">83</a></th><td></td></tr><tr><th id=\"L84\"><a href=\"#L84\">84</a></th><td>\u00a0 \u00a0 <span class=\"k\">def</span>\u00a0<span class=\"nf\">cancel</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">):</span></td></tr><tr><th id=\"L85\"><a href=\"#L85\">85</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"sd\">\"\"\"Unschedule this call</span></td></tr><tr><th id=\"L86\"><a href=\"#L86\">86</a></th><td><span class=\"sd\"></span></td></tr><tr><th id=\"L87\"><a href=\"#L87\">87</a></th><td><span class=\"sd\">\u00a0 \u00a0 \u00a0 \u00a0 @raise AlreadyCancelled: Raised if this call has already been</span></td></tr><tr><th id=\"L88\"><a href=\"#L88\">88</a></th><td><span class=\"sd\">\u00a0 \u00a0 \u00a0 \u00a0 unscheduled.</span></td></tr><tr><th id=\"L89\"><a href=\"#L89\">89</a></th><td><span class=\"sd\"></span></td></tr><tr><th id=\"L90\"><a href=\"#L90\">90</a></th><td><span class=\"sd\">\u00a0 \u00a0 \u00a0 \u00a0 @raise AlreadyCalled: Raised if this call has already been made.</span></td></tr><tr><th id=\"L91\"><a href=\"#L91\">91</a></th><td><span class=\"sd\">\u00a0 \u00a0 \u00a0 \u00a0 \"\"\"</span></td></tr><tr><th id=\"L92\"><a href=\"#L92\">92</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">if</span>\u00a0<span class=\"bp\">self</span><span class=\"o\">.</span>cancelled<span class=\"p\">:</span></td></tr><tr><th id=\"L93\"><a href=\"#L93\">93</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">raise</span>\u00a0error<span class=\"o\">.</span>AlreadyCancelled</td></tr><tr><th id=\"L94\"><a href=\"#L94\">94</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">elif</span>\u00a0<span class=\"bp\">self</span><span class=\"o\">.</span>called<span class=\"p\">:</span></td></tr><tr><th id=\"L95\"><a href=\"#L95\">95</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">raise</span>\u00a0error<span class=\"o\">.</span>AlreadyCalled</td></tr><tr><th id=\"L96\"><a href=\"#L96\">96</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">else</span><span class=\"p\">:</span></td></tr><tr><th id=\"L97\"><a href=\"#L97\">97</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"bp\">self</span><span class=\"o\">.</span>canceller<span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">)</span></td></tr><tr><th id=\"L98\"><a href=\"#L98\">98</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"bp\">self</span><span class=\"o\">.</span>cancelled <span class=\"o\">=</span>\u00a0<span class=\"mi\">1</span></td></tr><tr><th id=\"L99\"><a href=\"#L99\">99</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">if</span>\u00a0<span class=\"bp\">self</span><span class=\"o\">.</span>debug<span class=\"p\">:</span></td></tr><tr><th id=\"L100\"><a href=\"#L100\">100</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"bp\">self</span><span class=\"o\">.</span>_str <span class=\"o\">=</span>\u00a0<span class=\"nb\">str</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">)</span></td></tr><tr><th id=\"L101\"><a href=\"#L101\">101</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">del</span>\u00a0<span class=\"bp\">self</span><span class=\"o\">.</span>func<span class=\"p\">,</span>\u00a0<span class=\"bp\">self</span><span class=\"o\">.</span>args<span class=\"p\">,</span>\u00a0<span class=\"bp\">self</span><span class=\"o\">.</span>kw</td></tr><tr><th id=\"L102\"><a href=\"#L102\">102</a></th><td></td></tr><tr><th id=\"L103\"><a href=\"#L103\">103</a></th><td>\u00a0 \u00a0 <span class=\"k\">def</span>\u00a0<span class=\"nf\">reset</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span>\u00a0secondsFromNow<span class=\"p\">):</span></td></tr><tr><th id=\"L104\"><a href=\"#L104\">104</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"sd\">\"\"\"Reschedule this call for a different time</span></td></tr><tr><th id=\"L105\"><a href=\"#L105\">105</a></th><td><span class=\"sd\"></span></td></tr><tr><th id=\"L106\"><a href=\"#L106\">106</a></th><td><span class=\"sd\">\u00a0 \u00a0 \u00a0 \u00a0 @type secondsFromNow: C{float}</span></td></tr><tr><th id=\"L107\"><a href=\"#L107\">107</a></th><td><span class=\"sd\">\u00a0 \u00a0 \u00a0 \u00a0 @param secondsFromNow: The number of seconds from the time of the</span></td></tr><tr><th id=\"L108\"><a href=\"#L108\">108</a></th><td><span class=\"sd\">\u00a0 \u00a0 \u00a0 \u00a0 C{reset} call at which this call will be scheduled.</span></td></tr><tr><th id=\"L109\"><a href=\"#L109\">109</a></th><td><span class=\"sd\"></span></td></tr><tr><th id=\"L110\"><a href=\"#L110\">110</a></th><td><span class=\"sd\">\u00a0 \u00a0 \u00a0 \u00a0 @raise AlreadyCancelled: Raised if this call has been cancelled.</span></td></tr><tr><th id=\"L111\"><a href=\"#L111\">111</a></th><td><span class=\"sd\">\u00a0 \u00a0 \u00a0 \u00a0 @raise AlreadyCalled: Raised if this call has already been made.</span></td></tr><tr><th id=\"L112\"><a href=\"#L112\">112</a></th><td><span class=\"sd\">\u00a0 \u00a0 \u00a0 \u00a0 \"\"\"</span></td></tr><tr><th id=\"L113\"><a href=\"#L113\">113</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">if</span>\u00a0<span class=\"bp\">self</span><span class=\"o\">.</span>cancelled<span class=\"p\">:</span></td></tr><tr><th id=\"L114\"><a href=\"#L114\">114</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">raise</span>\u00a0error<span class=\"o\">.</span>AlreadyCancelled</td></tr><tr><th id=\"L115\"><a href=\"#L115\">115</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">elif</span>\u00a0<span class=\"bp\">self</span><span class=\"o\">.</span>called<span class=\"p\">:</span></td></tr><tr><th id=\"L116\"><a href=\"#L116\">116</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">raise</span>\u00a0error<span class=\"o\">.</span>AlreadyCalled</td></tr><tr><th id=\"L117\"><a href=\"#L117\">117</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">else</span><span class=\"p\">:</span></td></tr><tr><th id=\"L118\"><a href=\"#L118\">118</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">if</span>\u00a0<span class=\"bp\">self</span><span class=\"o\">.</span>seconds <span class=\"ow\">is</span>\u00a0<span class=\"bp\">None</span><span class=\"p\">:</span></td></tr><tr><th id=\"L119\"><a href=\"#L119\">119</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 new_time <span class=\"o\">=</span>\u00a0seconds<span class=\"p\">()</span>\u00a0<span class=\"o\">+</span>\u00a0secondsFromNow</td></tr><tr><th id=\"L120\"><a href=\"#L120\">120</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">else</span><span class=\"p\">:</span></td></tr><tr><th id=\"L121\"><a href=\"#L121\">121</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 new_time <span class=\"o\">=</span>\u00a0<span class=\"bp\">self</span><span class=\"o\">.</span>seconds<span class=\"p\">()</span>\u00a0<span class=\"o\">+</span>\u00a0secondsFromNow</td></tr><tr><th id=\"L122\"><a href=\"#L122\">122</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">if</span>\u00a0new_time <span class=\"o\">&lt;</span>\u00a0<span class=\"bp\">self</span><span class=\"o\">.</span>time<span class=\"p\">:</span></td></tr><tr><th id=\"L123\"><a href=\"#L123\">123</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"bp\">self</span><span class=\"o\">.</span>delayed_time <span class=\"o\">=</span>\u00a0<span class=\"mi\">0</span></td></tr><tr><th id=\"L124\"><a href=\"#L124\">124</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"bp\">self</span><span class=\"o\">.</span>time <span class=\"o\">=</span>\u00a0new_time</td></tr><tr><th id=\"L125\"><a href=\"#L125\">125</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"bp\">self</span><span class=\"o\">.</span>resetter<span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">)</span></td></tr><tr><th id=\"L126\"><a href=\"#L126\">126</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">else</span><span class=\"p\">:</span></td></tr><tr><th id=\"L127\"><a href=\"#L127\">127</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"bp\">self</span><span class=\"o\">.</span>delayed_time <span class=\"o\">=</span>\u00a0new_time <span class=\"o\">-</span>\u00a0<span class=\"bp\">self</span><span class=\"o\">.</span>time</td></tr><tr><th id=\"L128\"><a href=\"#L128\">128</a></th><td></td></tr><tr><th id=\"L129\"><a href=\"#L129\">129</a></th><td>\u00a0 \u00a0 <span class=\"k\">def</span>\u00a0<span class=\"nf\">delay</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span>\u00a0secondsLater<span class=\"p\">):</span></td></tr><tr><th id=\"L130\"><a href=\"#L130\">130</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"sd\">\"\"\"Reschedule this call for a later time</span></td></tr><tr><th id=\"L131\"><a href=\"#L131\">131</a></th><td><span class=\"sd\"></span></td></tr><tr><th id=\"L132\"><a href=\"#L132\">132</a></th><td><span class=\"sd\">\u00a0 \u00a0 \u00a0 \u00a0 @type secondsLater: C{float}</span></td></tr><tr><th id=\"L133\"><a href=\"#L133\">133</a></th><td><span class=\"sd\">\u00a0 \u00a0 \u00a0 \u00a0 @param secondsLater: The number of seconds after the originally</span></td></tr><tr><th id=\"L134\"><a href=\"#L134\">134</a></th><td><span class=\"sd\">\u00a0 \u00a0 \u00a0 \u00a0 scheduled time for which to reschedule this call.</span></td></tr><tr><th id=\"L135\"><a href=\"#L135\">135</a></th><td><span class=\"sd\"></span></td></tr><tr><th id=\"L136\"><a href=\"#L136\">136</a></th><td><span class=\"sd\">\u00a0 \u00a0 \u00a0 \u00a0 @raise AlreadyCancelled: Raised if this call has been cancelled.</span></td></tr><tr><th id=\"L137\"><a href=\"#L137\">137</a></th><td><span class=\"sd\">\u00a0 \u00a0 \u00a0 \u00a0 @raise AlreadyCalled: Raised if this call has already been made.</span></td></tr><tr><th id=\"L138\"><a href=\"#L138\">138</a></th><td><span class=\"sd\">\u00a0 \u00a0 \u00a0 \u00a0 \"\"\"</span></td></tr><tr><th id=\"L139\"><a href=\"#L139\">139</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">if</span>\u00a0<span class=\"bp\">self</span><span class=\"o\">.</span>cancelled<span class=\"p\">:</span></td></tr><tr><th id=\"L140\"><a href=\"#L140\">140</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">raise</span>\u00a0error<span class=\"o\">.</span>AlreadyCancelled</td></tr><tr><th id=\"L141\"><a href=\"#L141\">141</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">elif</span>\u00a0<span class=\"bp\">self</span><span class=\"o\">.</span>called<span class=\"p\">:</span></td></tr><tr><th id=\"L142\"><a href=\"#L142\">142</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">raise</span>\u00a0error<span class=\"o\">.</span>AlreadyCalled</td></tr><tr><th id=\"L143\"><a href=\"#L143\">143</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">else</span><span class=\"p\">:</span></td></tr><tr><th id=\"L144\"><a href=\"#L144\">144</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"bp\">self</span><span class=\"o\">.</span>delayed_time <span class=\"o\">+=</span>\u00a0secondsLater</td></tr><tr><th id=\"L145\"><a href=\"#L145\">145</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">if</span>\u00a0<span class=\"bp\">self</span><span class=\"o\">.</span>delayed_time <span class=\"o\">&lt;</span>\u00a0<span class=\"mi\">0</span><span class=\"p\">:</span></td></tr><tr><th id=\"L146\"><a href=\"#L146\">146</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"bp\">self</span><span class=\"o\">.</span>activate_delay<span class=\"p\">()</span></td></tr><tr><th id=\"L147\"><a href=\"#L147\">147</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"bp\">self</span><span class=\"o\">.</span>resetter<span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">)</span></td></tr><tr><th id=\"L148\"><a href=\"#L148\">148</a></th><td></td></tr><tr><th id=\"L149\"><a href=\"#L149\">149</a></th><td>\u00a0 \u00a0 <span class=\"k\">def</span>\u00a0<span class=\"nf\">activate_delay</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">):</span></td></tr><tr><th id=\"L150\"><a href=\"#L150\">150</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"bp\">self</span><span class=\"o\">.</span>time <span class=\"o\">+=</span>\u00a0<span class=\"bp\">self</span><span class=\"o\">.</span>delayed_time</td></tr><tr><th id=\"L151\"><a href=\"#L151\">151</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"bp\">self</span><span class=\"o\">.</span>delayed_time <span class=\"o\">=</span>\u00a0<span class=\"mi\">0</span></td></tr><tr><th id=\"L152\"><a href=\"#L152\">152</a></th><td></td></tr><tr><th id=\"L153\"><a href=\"#L153\">153</a></th><td>\u00a0 \u00a0 <span class=\"k\">def</span>\u00a0<span class=\"nf\">active</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">):</span></td></tr><tr><th id=\"L154\"><a href=\"#L154\">154</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"sd\">\"\"\"Determine whether this call is still pending</span></td></tr><tr><th id=\"L155\"><a href=\"#L155\">155</a></th><td><span class=\"sd\"></span></td></tr><tr><th id=\"L156\"><a href=\"#L156\">156</a></th><td><span class=\"sd\">\u00a0 \u00a0 \u00a0 \u00a0 @rtype: C{bool}</span></td></tr><tr><th id=\"L157\"><a href=\"#L157\">157</a></th><td><span class=\"sd\">\u00a0 \u00a0 \u00a0 \u00a0 @return: True if this call has not yet been made or cancelled,</span></td></tr><tr><th id=\"L158\"><a href=\"#L158\">158</a></th><td><span class=\"sd\">\u00a0 \u00a0 \u00a0 \u00a0 False otherwise.</span></td></tr><tr><th id=\"L159\"><a href=\"#L159\">159</a></th><td><span class=\"sd\">\u00a0 \u00a0 \u00a0 \u00a0 \"\"\"</span></td></tr><tr><th id=\"L160\"><a href=\"#L160\">160</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">return</span>\u00a0<span class=\"ow\">not</span>\u00a0<span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span>cancelled <span class=\"ow\">or</span>\u00a0<span class=\"bp\">self</span><span class=\"o\">.</span>called<span class=\"p\">)</span></td></tr><tr><th id=\"L161\"><a href=\"#L161\">161</a></th><td></td></tr><tr><th id=\"L162\"><a href=\"#L162\">162</a></th><td>\u00a0 \u00a0 <span class=\"k\">def</span>\u00a0<span class=\"nf\">__le__</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span>\u00a0other<span class=\"p\">):</span></td></tr><tr><th id=\"L163\"><a href=\"#L163\">163</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">return</span>\u00a0<span class=\"bp\">self</span><span class=\"o\">.</span>time <span class=\"o\">&lt;=</span>\u00a0other<span class=\"o\">.</span>time</td></tr><tr><th id=\"L164\"><a href=\"#L164\">164</a></th><td></td></tr><tr><th id=\"L165\"><a href=\"#L165\">165</a></th><td>\u00a0 \u00a0 <span class=\"k\">def</span>\u00a0<span class=\"nf\">__str__</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">):</span></td></tr><tr><th id=\"L166\"><a href=\"#L166\">166</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">if</span>\u00a0<span class=\"bp\">self</span><span class=\"o\">.</span>_str <span class=\"ow\">is</span>\u00a0<span class=\"ow\">not</span>\u00a0<span class=\"bp\">None</span><span class=\"p\">:</span></td></tr><tr><th id=\"L167\"><a href=\"#L167\">167</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">return</span>\u00a0<span class=\"bp\">self</span><span class=\"o\">.</span>_str</td></tr><tr><th id=\"L168\"><a href=\"#L168\">168</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">if</span>\u00a0<span class=\"nb\">hasattr</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span>\u00a0<span class=\"s\">'func'</span><span class=\"p\">):</span></td></tr><tr><th id=\"L169\"><a href=\"#L169\">169</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">if</span>\u00a0<span class=\"nb\">hasattr</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span>func<span class=\"p\">,</span>\u00a0<span class=\"s\">'func_name'</span><span class=\"p\">):</span></td></tr><tr><th id=\"L170\"><a href=\"#L170\">170</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 func <span class=\"o\">=</span>\u00a0<span class=\"bp\">self</span><span class=\"o\">.</span>func<span class=\"o\">.</span>func_name</td></tr><tr><th id=\"L171\"><a href=\"#L171\">171</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">if</span>\u00a0<span class=\"nb\">hasattr</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span>func<span class=\"p\">,</span>\u00a0<span class=\"s\">'im_class'</span><span class=\"p\">):</span></td></tr><tr><th id=\"L172\"><a href=\"#L172\">172</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 func <span class=\"o\">=</span>\u00a0<span class=\"bp\">self</span><span class=\"o\">.</span>func<span class=\"o\">.</span>im_class<span class=\"o\">.</span>__name__ <span class=\"o\">+</span>\u00a0<span class=\"s\">'.'</span>\u00a0<span class=\"o\">+</span>\u00a0func</td></tr><tr><th id=\"L173\"><a href=\"#L173\">173</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">else</span><span class=\"p\">:</span></td></tr><tr><th id=\"L174\"><a href=\"#L174\">174</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 func <span class=\"o\">=</span>\u00a0reflect<span class=\"o\">.</span>safe_repr<span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span>func<span class=\"p\">)</span></td></tr><tr><th id=\"L175\"><a href=\"#L175\">175</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">else</span><span class=\"p\">:</span></td></tr><tr><th id=\"L176\"><a href=\"#L176\">176</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 func <span class=\"o\">=</span>\u00a0<span class=\"bp\">None</span></td></tr><tr><th id=\"L177\"><a href=\"#L177\">177</a></th><td></td></tr><tr><th id=\"L178\"><a href=\"#L178\">178</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">if</span>\u00a0<span class=\"bp\">self</span><span class=\"o\">.</span>seconds <span class=\"ow\">is</span>\u00a0<span class=\"bp\">None</span><span class=\"p\">:</span></td></tr><tr><th id=\"L179\"><a href=\"#L179\">179</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 now <span class=\"o\">=</span>\u00a0seconds<span class=\"p\">()</span></td></tr><tr><th id=\"L180\"><a href=\"#L180\">180</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">else</span><span class=\"p\">:</span></td></tr><tr><th id=\"L181\"><a href=\"#L181\">181</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 now <span class=\"o\">=</span>\u00a0<span class=\"bp\">self</span><span class=\"o\">.</span>seconds<span class=\"p\">()</span></td></tr><tr><th id=\"L182\"><a href=\"#L182\">182</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 L <span class=\"o\">=</span>\u00a0<span class=\"p\">[</span><span class=\"s\">\"&lt;DelayedCall </span><span class=\"si\">%s</span><span class=\"s\">\u00a0[</span><span class=\"si\">%s</span><span class=\"s\">s] called=</span><span class=\"si\">%s</span><span class=\"s\">\u00a0cancelled=</span><span class=\"si\">%s</span><span class=\"s\">\"</span>\u00a0<span class=\"o\">%</span>\u00a0<span class=\"p\">(</span></td></tr><tr><th id=\"L183\"><a href=\"#L183\">183</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"nb\">id</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">),</span>\u00a0<span class=\"bp\">self</span><span class=\"o\">.</span>time <span class=\"o\">-</span>\u00a0now<span class=\"p\">,</span>\u00a0<span class=\"bp\">self</span><span class=\"o\">.</span>called<span class=\"p\">,</span>\u00a0<span class=\"bp\">self</span><span class=\"o\">.</span>cancelled<span class=\"p\">)]</span></td></tr><tr><th id=\"L184\"><a href=\"#L184\">184</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">if</span>\u00a0func <span class=\"ow\">is</span>\u00a0<span class=\"ow\">not</span>\u00a0<span class=\"bp\">None</span><span class=\"p\">:</span></td></tr><tr><th id=\"L185\"><a href=\"#L185\">185</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 L<span class=\"o\">.</span>extend<span class=\"p\">((</span><span class=\"s\">\" \"</span><span class=\"p\">,</span>\u00a0func<span class=\"p\">,</span>\u00a0<span class=\"s\">\"(\"</span><span class=\"p\">))</span></td></tr><tr><th id=\"L186\"><a href=\"#L186\">186</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">if</span>\u00a0<span class=\"bp\">self</span><span class=\"o\">.</span>args<span class=\"p\">:</span></td></tr><tr><th id=\"L187\"><a href=\"#L187\">187</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 L<span class=\"o\">.</span>append<span class=\"p\">(</span><span class=\"s\">\", \"</span><span class=\"o\">.</span>join<span class=\"p\">([</span>reflect<span class=\"o\">.</span>safe_repr<span class=\"p\">(</span>e<span class=\"p\">)</span>\u00a0<span class=\"k\">for</span>\u00a0e <span class=\"ow\">in</span>\u00a0<span class=\"bp\">self</span><span class=\"o\">.</span>args<span class=\"p\">]))</span></td></tr><tr><th id=\"L188\"><a href=\"#L188\">188</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">if</span>\u00a0<span class=\"bp\">self</span><span class=\"o\">.</span>kw<span class=\"p\">:</span></td></tr><tr><th id=\"L189\"><a href=\"#L189\">189</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 L<span class=\"o\">.</span>append<span class=\"p\">(</span><span class=\"s\">\", \"</span><span class=\"p\">)</span></td></tr><tr><th id=\"L190\"><a href=\"#L190\">190</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">if</span>\u00a0<span class=\"bp\">self</span><span class=\"o\">.</span>kw<span class=\"p\">:</span></td></tr><tr><th id=\"L191\"><a href=\"#L191\">191</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 L<span class=\"o\">.</span>append<span class=\"p\">(</span><span class=\"s\">\", \"</span><span class=\"o\">.</span>join<span class=\"p\">([</span><span class=\"s\">'</span><span class=\"si\">%s</span><span class=\"s\">=</span><span class=\"si\">%s</span><span class=\"s\">'</span>\u00a0<span class=\"o\">%</span>\u00a0<span class=\"p\">(</span>k<span class=\"p\">,</span>\u00a0reflect<span class=\"o\">.</span>safe_repr<span class=\"p\">(</span>v<span class=\"p\">))</span>\u00a0<span class=\"k\">for</span>\u00a0<span class=\"p\">(</span>k<span class=\"p\">,</span>\u00a0v<span class=\"p\">)</span>\u00a0<span class=\"ow\">in</span>\u00a0<span class=\"bp\">self</span><span class=\"o\">.</span>kw<span class=\"o\">.</span>iteritems<span class=\"p\">()]))</span></td></tr><tr><th id=\"L192\"><a href=\"#L192\">192</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 L<span class=\"o\">.</span>append<span class=\"p\">(</span><span class=\"s\">\")\"</span><span class=\"p\">)</span></td></tr><tr><th id=\"L193\"><a href=\"#L193\">193</a></th><td></td></tr><tr><th id=\"L194\"><a href=\"#L194\">194</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">if</span>\u00a0<span class=\"bp\">self</span><span class=\"o\">.</span>debug<span class=\"p\">:</span></td></tr><tr><th id=\"L195\"><a href=\"#L195\">195</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 L<span class=\"o\">.</span>append<span class=\"p\">(</span><span class=\"s\">\"</span><span class=\"se\">\\n\\n</span><span class=\"s\">traceback at creation: </span><span class=\"se\">\\n\\n</span><span class=\"si\">%s</span><span class=\"s\">\"</span>\u00a0<span class=\"o\">%</span>\u00a0<span class=\"p\">(</span><span class=\"s\">'\u00a0 \u00a0 '</span><span class=\"o\">.</span>join<span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span>creator<span class=\"p\">)))</span></td></tr><tr><th id=\"L196\"><a href=\"#L196\">196</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 L<span class=\"o\">.</span>append<span class=\"p\">(</span><span class=\"s\">'&gt;'</span><span class=\"p\">)</span></td></tr><tr><th id=\"L197\"><a href=\"#L197\">197</a></th><td></td></tr><tr><th id=\"L198\"><a href=\"#L198\">198</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">return</span>\u00a0<span class=\"s\">\"\"</span><span class=\"o\">.</span>join<span class=\"p\">(</span>L<span class=\"p\">)</span></td></tr><tr><th id=\"L199\"><a href=\"#L199\">199</a></th><td></td></tr><tr><th id=\"L200\"><a href=\"#L200\">200</a></th><td></td></tr><tr><th id=\"L201\"><a href=\"#L201\">201</a></th><td><span class=\"k\">class</span>\u00a0<span class=\"nc\">ThreadedResolver</span><span class=\"p\">:</span></td></tr><tr><th id=\"L202\"><a href=\"#L202\">202</a></th><td>\u00a0 \u00a0 implements<span class=\"p\">(</span>IResolverSimple<span class=\"p\">)</span></td></tr><tr><th id=\"L203\"><a href=\"#L203\">203</a></th><td></td></tr><tr><th id=\"L204\"><a href=\"#L204\">204</a></th><td>\u00a0 \u00a0 <span class=\"k\">def</span>\u00a0<span class=\"nf\">__init__</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span>\u00a0reactor<span class=\"p\">):</span></td></tr><tr><th id=\"L205\"><a href=\"#L205\">205</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"bp\">self</span><span class=\"o\">.</span>reactor <span class=\"o\">=</span>\u00a0reactor</td></tr><tr><th id=\"L206\"><a href=\"#L206\">206</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"bp\">self</span><span class=\"o\">.</span>_runningQueries <span class=\"o\">=</span>\u00a0<span class=\"p\">{}</span></td></tr><tr><th id=\"L207\"><a href=\"#L207\">207</a></th><td></td></tr><tr><th id=\"L208\"><a href=\"#L208\">208</a></th><td>\u00a0 \u00a0 <span class=\"k\">def</span>\u00a0<span class=\"nf\">_fail</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span>\u00a0name<span class=\"p\">,</span>\u00a0err<span class=\"p\">):</span></td></tr><tr><th id=\"L209\"><a href=\"#L209\">209</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 err <span class=\"o\">=</span>\u00a0error<span class=\"o\">.</span>DNSLookupError<span class=\"p\">(</span><span class=\"s\">\"address </span><span class=\"si\">%r</span><span class=\"s\">\u00a0not found: </span><span class=\"si\">%s</span><span class=\"s\">\"</span>\u00a0<span class=\"o\">%</span>\u00a0<span class=\"p\">(</span>name<span class=\"p\">,</span>\u00a0err<span class=\"p\">))</span></td></tr><tr><th id=\"L210\"><a href=\"#L210\">210</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">return</span>\u00a0failure<span class=\"o\">.</span>Failure<span class=\"p\">(</span>err<span class=\"p\">)</span></td></tr><tr><th id=\"L211\"><a href=\"#L211\">211</a></th><td></td></tr><tr><th id=\"L212\"><a href=\"#L212\">212</a></th><td>\u00a0 \u00a0 <span class=\"k\">def</span>\u00a0<span class=\"nf\">_cleanup</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span>\u00a0name<span class=\"p\">,</span>\u00a0lookupDeferred<span class=\"p\">):</span></td></tr><tr><th id=\"L213\"><a href=\"#L213\">213</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 userDeferred<span class=\"p\">,</span>\u00a0cancelCall <span class=\"o\">=</span>\u00a0<span class=\"bp\">self</span><span class=\"o\">.</span>_runningQueries<span class=\"p\">[</span>lookupDeferred<span class=\"p\">]</span></td></tr><tr><th id=\"L214\"><a href=\"#L214\">214</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">del</span>\u00a0<span class=\"bp\">self</span><span class=\"o\">.</span>_runningQueries<span class=\"p\">[</span>lookupDeferred<span class=\"p\">]</span></td></tr><tr><th id=\"L215\"><a href=\"#L215\">215</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 userDeferred<span class=\"o\">.</span>errback<span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span>_fail<span class=\"p\">(</span>name<span class=\"p\">,</span>\u00a0<span class=\"s\">\"timeout error\"</span><span class=\"p\">))</span></td></tr><tr><th id=\"L216\"><a href=\"#L216\">216</a></th><td></td></tr><tr><th id=\"L217\"><a href=\"#L217\">217</a></th><td>\u00a0 \u00a0 <span class=\"k\">def</span>\u00a0<span class=\"nf\">_checkTimeout</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span>\u00a0result<span class=\"p\">,</span>\u00a0name<span class=\"p\">,</span>\u00a0lookupDeferred<span class=\"p\">):</span></td></tr><tr><th id=\"L218\"><a href=\"#L218\">218</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">try</span><span class=\"p\">:</span></td></tr><tr><th id=\"L219\"><a href=\"#L219\">219</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 userDeferred<span class=\"p\">,</span>\u00a0cancelCall <span class=\"o\">=</span>\u00a0<span class=\"bp\">self</span><span class=\"o\">.</span>_runningQueries<span class=\"p\">[</span>lookupDeferred<span class=\"p\">]</span></td></tr><tr><th id=\"L220\"><a href=\"#L220\">220</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">except</span>\u00a0<span class=\"ne\">KeyError</span><span class=\"p\">:</span></td></tr><tr><th id=\"L221\"><a href=\"#L221\">221</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">pass</span></td></tr><tr><th id=\"L222\"><a href=\"#L222\">222</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">else</span><span class=\"p\">:</span></td></tr><tr><th id=\"L223\"><a href=\"#L223\">223</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">del</span>\u00a0<span class=\"bp\">self</span><span class=\"o\">.</span>_runningQueries<span class=\"p\">[</span>lookupDeferred<span class=\"p\">]</span></td></tr><tr><th id=\"L224\"><a href=\"#L224\">224</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 cancelCall<span class=\"o\">.</span>cancel<span class=\"p\">()</span></td></tr><tr><th id=\"L225\"><a href=\"#L225\">225</a></th><td></td></tr><tr><th id=\"L226\"><a href=\"#L226\">226</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">if</span>\u00a0<span class=\"nb\">isinstance</span><span class=\"p\">(</span>result<span class=\"p\">,</span>\u00a0failure<span class=\"o\">.</span>Failure<span class=\"p\">):</span></td></tr><tr><th id=\"L227\"><a href=\"#L227\">227</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 userDeferred<span class=\"o\">.</span>errback<span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span>_fail<span class=\"p\">(</span>name<span class=\"p\">,</span>\u00a0result<span class=\"o\">.</span>getErrorMessage<span class=\"p\">()))</span></td></tr><tr><th id=\"L228\"><a href=\"#L228\">228</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">else</span><span class=\"p\">:</span></td></tr><tr><th id=\"L229\"><a href=\"#L229\">229</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 userDeferred<span class=\"o\">.</span>callback<span class=\"p\">(</span>result<span class=\"p\">)</span></td></tr><tr><th id=\"L230\"><a href=\"#L230\">230</a></th><td></td></tr><tr><th id=\"L231\"><a href=\"#L231\">231</a></th><td>\u00a0 \u00a0 <span class=\"k\">def</span>\u00a0<span class=\"nf\">getHostByName</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span>\u00a0name<span class=\"p\">,</span>\u00a0timeout <span class=\"o\">=</span>\u00a0<span class=\"p\">(</span><span class=\"mi\">1</span><span class=\"p\">,</span>\u00a0<span class=\"mi\">3</span><span class=\"p\">,</span>\u00a0<span class=\"mi\">11</span><span class=\"p\">,</span>\u00a0<span class=\"mi\">45</span><span class=\"p\">)):</span></td></tr><tr><th id=\"L232\"><a href=\"#L232\">232</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">if</span>\u00a0timeout<span class=\"p\">:</span></td></tr><tr><th id=\"L233\"><a href=\"#L233\">233</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 timeoutDelay <span class=\"o\">=</span>\u00a0<span class=\"nb\">reduce</span><span class=\"p\">(</span>operator<span class=\"o\">.</span>add<span class=\"p\">,</span>\u00a0timeout<span class=\"p\">)</span></td></tr><tr><th id=\"L234\"><a href=\"#L234\">234</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">else</span><span class=\"p\">:</span></td></tr><tr><th id=\"L235\"><a href=\"#L235\">235</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 timeoutDelay <span class=\"o\">=</span>\u00a0<span class=\"mi\">60</span></td></tr><tr><th id=\"L236\"><a href=\"#L236\">236</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 userDeferred <span class=\"o\">=</span>\u00a0defer<span class=\"o\">.</span>Deferred<span class=\"p\">()</span></td></tr><tr><th id=\"L237\"><a href=\"#L237\">237</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 lookupDeferred <span class=\"o\">=</span>\u00a0threads<span class=\"o\">.</span>deferToThread<span class=\"p\">(</span>socket<span class=\"o\">.</span>gethostbyname<span class=\"p\">,</span>\u00a0name<span class=\"p\">)</span></td></tr><tr><th id=\"L238\"><a href=\"#L238\">238</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 cancelCall <span class=\"o\">=</span>\u00a0<span class=\"bp\">self</span><span class=\"o\">.</span>reactor<span class=\"o\">.</span>callLater<span class=\"p\">(</span></td></tr><tr><th id=\"L239\"><a href=\"#L239\">239</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 timeoutDelay<span class=\"p\">,</span>\u00a0<span class=\"bp\">self</span><span class=\"o\">.</span>_cleanup<span class=\"p\">,</span>\u00a0name<span class=\"p\">,</span>\u00a0lookupDeferred<span class=\"p\">)</span></td></tr><tr><th id=\"L240\"><a href=\"#L240\">240</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"bp\">self</span><span class=\"o\">.</span>_runningQueries<span class=\"p\">[</span>lookupDeferred<span class=\"p\">]</span>\u00a0<span class=\"o\">=</span>\u00a0<span class=\"p\">(</span>userDeferred<span class=\"p\">,</span>\u00a0cancelCall<span class=\"p\">)</span></td></tr><tr><th id=\"L241\"><a href=\"#L241\">241</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 lookupDeferred<span class=\"o\">.</span>addBoth<span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span>_checkTimeout<span class=\"p\">,</span>\u00a0name<span class=\"p\">,</span>\u00a0lookupDeferred<span class=\"p\">)</span></td></tr><tr><th id=\"L242\"><a href=\"#L242\">242</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">return</span>\u00a0userDeferred</td></tr><tr><th id=\"L243\"><a href=\"#L243\">243</a></th><td></td></tr><tr><th id=\"L244\"><a href=\"#L244\">244</a></th><td><span class=\"k\">class</span>\u00a0<span class=\"nc\">BlockingResolver</span><span class=\"p\">:</span></td></tr><tr><th id=\"L245\"><a href=\"#L245\">245</a></th><td>\u00a0 \u00a0 implements<span class=\"p\">(</span>IResolverSimple<span class=\"p\">)</span></td></tr><tr><th id=\"L246\"><a href=\"#L246\">246</a></th><td></td></tr><tr><th id=\"L247\"><a href=\"#L247\">247</a></th><td>\u00a0 \u00a0 <span class=\"k\">def</span>\u00a0<span class=\"nf\">getHostByName</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span>\u00a0name<span class=\"p\">,</span>\u00a0timeout <span class=\"o\">=</span>\u00a0<span class=\"p\">(</span><span class=\"mi\">1</span><span class=\"p\">,</span>\u00a0<span class=\"mi\">3</span><span class=\"p\">,</span>\u00a0<span class=\"mi\">11</span><span class=\"p\">,</span>\u00a0<span class=\"mi\">45</span><span class=\"p\">)):</span></td></tr><tr><th id=\"L248\"><a href=\"#L248\">248</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">try</span><span class=\"p\">:</span></td></tr><tr><th id=\"L249\"><a href=\"#L249\">249</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 address <span class=\"o\">=</span>\u00a0socket<span class=\"o\">.</span>gethostbyname<span class=\"p\">(</span>name<span class=\"p\">)</span></td></tr><tr><th id=\"L250\"><a href=\"#L250\">250</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">except</span>\u00a0socket<span class=\"o\">.</span>error<span class=\"p\">:</span></td></tr><tr><th id=\"L251\"><a href=\"#L251\">251</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 msg <span class=\"o\">=</span>\u00a0<span class=\"s\">\"address </span><span class=\"si\">%r</span><span class=\"s\">\u00a0not found\"</span>\u00a0<span class=\"o\">%</span>\u00a0<span class=\"p\">(</span>name<span class=\"p\">,)</span></td></tr><tr><th id=\"L252\"><a href=\"#L252\">252</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 err <span class=\"o\">=</span>\u00a0error<span class=\"o\">.</span>DNSLookupError<span class=\"p\">(</span>msg<span class=\"p\">)</span></td></tr><tr><th id=\"L253\"><a href=\"#L253\">253</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">return</span>\u00a0defer<span class=\"o\">.</span>fail<span class=\"p\">(</span>err<span class=\"p\">)</span></td></tr><tr><th id=\"L254\"><a href=\"#L254\">254</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">else</span><span class=\"p\">:</span></td></tr><tr><th id=\"L255\"><a href=\"#L255\">255</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">return</span>\u00a0defer<span class=\"o\">.</span>succeed<span class=\"p\">(</span>address<span class=\"p\">)</span></td></tr><tr><th id=\"L256\"><a href=\"#L256\">256</a></th><td></td></tr><tr><th id=\"L257\"><a href=\"#L257\">257</a></th><td><span class=\"k\">class</span>\u00a0<span class=\"nc\">ReactorBase</span><span class=\"p\">(</span><span class=\"nb\">object</span><span class=\"p\">):</span></td></tr><tr><th id=\"L258\"><a href=\"#L258\">258</a></th><td>\u00a0 \u00a0 <span class=\"sd\">\"\"\"Default base class for Reactors.</span></td></tr><tr><th id=\"L259\"><a href=\"#L259\">259</a></th><td><span class=\"sd\">\u00a0 \u00a0 \"\"\"</span></td></tr><tr><th id=\"L260\"><a href=\"#L260\">260</a></th><td></td></tr><tr><th id=\"L261\"><a href=\"#L261\">261</a></th><td>\u00a0 \u00a0 implements<span class=\"p\">(</span>IReactorCore<span class=\"p\">,</span>\u00a0IReactorTime<span class=\"p\">,</span>\u00a0IReactorPluggableResolver<span class=\"p\">)</span></td></tr><tr><th id=\"L262\"><a href=\"#L262\">262</a></th><td></td></tr><tr><th id=\"L263\"><a href=\"#L263\">263</a></th><td>\u00a0 \u00a0 installed <span class=\"o\">=</span>\u00a0<span class=\"mi\">0</span></td></tr><tr><th id=\"L264\"><a href=\"#L264\">264</a></th><td>\u00a0 \u00a0 usingThreads <span class=\"o\">=</span>\u00a0<span class=\"mi\">0</span></td></tr><tr><th id=\"L265\"><a href=\"#L265\">265</a></th><td>\u00a0 \u00a0 resolver <span class=\"o\">=</span>\u00a0BlockingResolver<span class=\"p\">()</span></td></tr><tr><th id=\"L266\"><a href=\"#L266\">266</a></th><td></td></tr><tr><th id=\"L267\"><a href=\"#L267\">267</a></th><td>\u00a0 \u00a0 __name__ <span class=\"o\">=</span>\u00a0<span class=\"s\">\"twisted.internet.reactor\"</span></td></tr><tr><th id=\"L268\"><a href=\"#L268\">268</a></th><td></td></tr><tr><th id=\"L269\"><a href=\"#L269\">269</a></th><td>\u00a0 \u00a0 <span class=\"k\">def</span>\u00a0<span class=\"nf\">__init__</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">):</span></td></tr><tr><th id=\"L270\"><a href=\"#L270\">270</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"bp\">self</span><span class=\"o\">.</span>threadCallQueue <span class=\"o\">=</span>\u00a0<span class=\"p\">[]</span></td></tr><tr><th id=\"L271\"><a href=\"#L271\">271</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"bp\">self</span><span class=\"o\">.</span>_eventTriggers <span class=\"o\">=</span>\u00a0<span class=\"p\">{}</span></td></tr><tr><th id=\"L272\"><a href=\"#L272\">272</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"bp\">self</span><span class=\"o\">.</span>_pendingTimedCalls <span class=\"o\">=</span>\u00a0<span class=\"p\">[]</span></td></tr><tr><th id=\"L273\"><a href=\"#L273\">273</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"bp\">self</span><span class=\"o\">.</span>_newTimedCalls <span class=\"o\">=</span>\u00a0<span class=\"p\">[]</span></td></tr><tr><th id=\"L274\"><a href=\"#L274\">274</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"bp\">self</span><span class=\"o\">.</span>_cancellations <span class=\"o\">=</span>\u00a0<span class=\"mi\">0</span></td></tr><tr><th id=\"L275\"><a href=\"#L275\">275</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"bp\">self</span><span class=\"o\">.</span>running <span class=\"o\">=</span>\u00a0<span class=\"mi\">0</span></td></tr><tr><th id=\"L276\"><a href=\"#L276\">276</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"bp\">self</span><span class=\"o\">.</span>waker <span class=\"o\">=</span>\u00a0<span class=\"bp\">None</span></td></tr><tr><th id=\"L277\"><a href=\"#L277\">277</a></th><td></td></tr><tr><th id=\"L278\"><a href=\"#L278\">278</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"bp\">self</span><span class=\"o\">.</span>addSystemEventTrigger<span class=\"p\">(</span><span class=\"s\">'during'</span><span class=\"p\">,</span>\u00a0<span class=\"s\">'shutdown'</span><span class=\"p\">,</span>\u00a0<span class=\"bp\">self</span><span class=\"o\">.</span>crash<span class=\"p\">)</span></td></tr><tr><th id=\"L279\"><a href=\"#L279\">279</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"bp\">self</span><span class=\"o\">.</span>addSystemEventTrigger<span class=\"p\">(</span><span class=\"s\">'during'</span><span class=\"p\">,</span>\u00a0<span class=\"s\">'shutdown'</span><span class=\"p\">,</span>\u00a0<span class=\"bp\">self</span><span class=\"o\">.</span>disconnectAll<span class=\"p\">)</span></td></tr><tr><th id=\"L280\"><a href=\"#L280\">280</a></th><td></td></tr><tr><th id=\"L281\"><a href=\"#L281\">281</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">if</span>\u00a0platform<span class=\"o\">.</span>supportsThreads<span class=\"p\">():</span></td></tr><tr><th id=\"L282\"><a href=\"#L282\">282</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"bp\">self</span><span class=\"o\">.</span>_initThreads<span class=\"p\">()</span></td></tr><tr><th id=\"L283\"><a href=\"#L283\">283</a></th><td></td></tr><tr><th id=\"L284\"><a href=\"#L284\">284</a></th><td>\u00a0 \u00a0 <span class=\"c\"># override in subclasses</span></td></tr><tr><th id=\"L285\"><a href=\"#L285\">285</a></th><td></td></tr><tr><th id=\"L286\"><a href=\"#L286\">286</a></th><td>\u00a0 \u00a0 _lock <span class=\"o\">=</span>\u00a0<span class=\"bp\">None</span></td></tr><tr><th id=\"L287\"><a href=\"#L287\">287</a></th><td></td></tr><tr><th id=\"L288\"><a href=\"#L288\">288</a></th><td>\u00a0 \u00a0 <span class=\"k\">def</span>\u00a0<span class=\"nf\">installWaker</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">):</span></td></tr><tr><th id=\"L289\"><a href=\"#L289\">289</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">raise</span>\u00a0<span class=\"ne\">NotImplementedError</span><span class=\"p\">()</span></td></tr><tr><th id=\"L290\"><a href=\"#L290\">290</a></th><td></td></tr><tr><th id=\"L291\"><a href=\"#L291\">291</a></th><td>\u00a0 \u00a0 <span class=\"k\">def</span>\u00a0<span class=\"nf\">installResolver</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span>\u00a0resolver<span class=\"p\">):</span></td></tr><tr><th id=\"L292\"><a href=\"#L292\">292</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">assert</span>\u00a0IResolverSimple<span class=\"o\">.</span>providedBy<span class=\"p\">(</span>resolver<span class=\"p\">)</span></td></tr><tr><th id=\"L293\"><a href=\"#L293\">293</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 oldResolver <span class=\"o\">=</span>\u00a0<span class=\"bp\">self</span><span class=\"o\">.</span>resolver</td></tr><tr><th id=\"L294\"><a href=\"#L294\">294</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"bp\">self</span><span class=\"o\">.</span>resolver <span class=\"o\">=</span>\u00a0resolver</td></tr><tr><th id=\"L295\"><a href=\"#L295\">295</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">return</span>\u00a0oldResolver</td></tr><tr><th id=\"L296\"><a href=\"#L296\">296</a></th><td></td></tr><tr><th id=\"L297\"><a href=\"#L297\">297</a></th><td>\u00a0 \u00a0 <span class=\"k\">def</span>\u00a0<span class=\"nf\">wakeUp</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">):</span></td></tr><tr><th id=\"L298\"><a href=\"#L298\">298</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"sd\">\"\"\"Wake up the event loop.\"\"\"</span></td></tr><tr><th id=\"L299\"><a href=\"#L299\">299</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">if</span>\u00a0<span class=\"ow\">not</span>\u00a0threadable<span class=\"o\">.</span>isInIOThread<span class=\"p\">():</span></td></tr><tr><th id=\"L300\"><a href=\"#L300\">300</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">if</span>\u00a0<span class=\"bp\">self</span><span class=\"o\">.</span>waker<span class=\"p\">:</span></td></tr><tr><th id=\"L301\"><a href=\"#L301\">301</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"bp\">self</span><span class=\"o\">.</span>waker<span class=\"o\">.</span>wakeUp<span class=\"p\">()</span></td></tr><tr><th id=\"L302\"><a href=\"#L302\">302</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"c\"># if the waker isn't installed, the reactor isn't running, and</span></td></tr><tr><th id=\"L303\"><a href=\"#L303\">303</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"c\"># therefore doesn't need to be woken up</span></td></tr><tr><th id=\"L304\"><a href=\"#L304\">304</a></th><td></td></tr><tr><th id=\"L305\"><a href=\"#L305\">305</a></th><td>\u00a0 \u00a0 <span class=\"k\">def</span>\u00a0<span class=\"nf\">doIteration</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span>\u00a0delay<span class=\"p\">):</span></td></tr><tr><th id=\"L306\"><a href=\"#L306\">306</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"sd\">\"\"\"Do one iteration over the readers and writers we know about.\"\"\"</span></td></tr><tr><th id=\"L307\"><a href=\"#L307\">307</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">raise</span>\u00a0<span class=\"ne\">NotImplementedError</span></td></tr><tr><th id=\"L308\"><a href=\"#L308\">308</a></th><td></td></tr><tr><th id=\"L309\"><a href=\"#L309\">309</a></th><td>\u00a0 \u00a0 <span class=\"k\">def</span>\u00a0<span class=\"nf\">addReader</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span>\u00a0reader<span class=\"p\">):</span></td></tr><tr><th id=\"L310\"><a href=\"#L310\">310</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">raise</span>\u00a0<span class=\"ne\">NotImplementedError</span></td></tr><tr><th id=\"L311\"><a href=\"#L311\">311</a></th><td></td></tr><tr><th id=\"L312\"><a href=\"#L312\">312</a></th><td>\u00a0 \u00a0 <span class=\"k\">def</span>\u00a0<span class=\"nf\">addWriter</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span>\u00a0writer<span class=\"p\">):</span></td></tr><tr><th id=\"L313\"><a href=\"#L313\">313</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">raise</span>\u00a0<span class=\"ne\">NotImplementedError</span></td></tr><tr><th id=\"L314\"><a href=\"#L314\">314</a></th><td></td></tr><tr><th id=\"L315\"><a href=\"#L315\">315</a></th><td>\u00a0 \u00a0 <span class=\"k\">def</span>\u00a0<span class=\"nf\">removeReader</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span>\u00a0reader<span class=\"p\">):</span></td></tr><tr><th id=\"L316\"><a href=\"#L316\">316</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">raise</span>\u00a0<span class=\"ne\">NotImplementedError</span></td></tr><tr><th id=\"L317\"><a href=\"#L317\">317</a></th><td></td></tr><tr><th id=\"L318\"><a href=\"#L318\">318</a></th><td>\u00a0 \u00a0 <span class=\"k\">def</span>\u00a0<span class=\"nf\">removeWriter</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span>\u00a0writer<span class=\"p\">):</span></td></tr><tr><th id=\"L319\"><a href=\"#L319\">319</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">raise</span>\u00a0<span class=\"ne\">NotImplementedError</span></td></tr><tr><th id=\"L320\"><a href=\"#L320\">320</a></th><td></td></tr><tr><th id=\"L321\"><a href=\"#L321\">321</a></th><td>\u00a0 \u00a0 <span class=\"k\">def</span>\u00a0<span class=\"nf\">removeAll</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">):</span></td></tr><tr><th id=\"L322\"><a href=\"#L322\">322</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">raise</span>\u00a0<span class=\"ne\">NotImplementedError</span></td></tr><tr><th id=\"L323\"><a href=\"#L323\">323</a></th><td></td></tr><tr><th id=\"L324\"><a href=\"#L324\">324</a></th><td>\u00a0 \u00a0 <span class=\"k\">def</span>\u00a0<span class=\"nf\">resolve</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span>\u00a0name<span class=\"p\">,</span>\u00a0timeout <span class=\"o\">=</span>\u00a0<span class=\"p\">(</span><span class=\"mi\">1</span><span class=\"p\">,</span>\u00a0<span class=\"mi\">3</span><span class=\"p\">,</span>\u00a0<span class=\"mi\">11</span><span class=\"p\">,</span>\u00a0<span class=\"mi\">45</span><span class=\"p\">)):</span></td></tr><tr><th id=\"L325\"><a href=\"#L325\">325</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"sd\">\"\"\"Return a Deferred that will resolve a hostname.</span></td></tr><tr><th id=\"L326\"><a href=\"#L326\">326</a></th><td><span class=\"sd\">\u00a0 \u00a0 \u00a0 \u00a0 \"\"\"</span></td></tr><tr><th id=\"L327\"><a href=\"#L327\">327</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">if</span>\u00a0<span class=\"ow\">not</span>\u00a0name<span class=\"p\">:</span></td></tr><tr><th id=\"L328\"><a href=\"#L328\">328</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"c\"># XXX - This is *less than* '::', and will screw up IPv6 servers</span></td></tr><tr><th id=\"L329\"><a href=\"#L329\">329</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">return</span>\u00a0defer<span class=\"o\">.</span>succeed<span class=\"p\">(</span><span class=\"s\">'0.0.0.0'</span><span class=\"p\">)</span></td></tr><tr><th id=\"L330\"><a href=\"#L330\">330</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">if</span>\u00a0abstract<span class=\"o\">.</span>isIPAddress<span class=\"p\">(</span>name<span class=\"p\">):</span></td></tr><tr><th id=\"L331\"><a href=\"#L331\">331</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">return</span>\u00a0defer<span class=\"o\">.</span>succeed<span class=\"p\">(</span>name<span class=\"p\">)</span></td></tr><tr><th id=\"L332\"><a href=\"#L332\">332</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">return</span>\u00a0<span class=\"bp\">self</span><span class=\"o\">.</span>resolver<span class=\"o\">.</span>getHostByName<span class=\"p\">(</span>name<span class=\"p\">,</span>\u00a0timeout<span class=\"p\">)</span></td></tr><tr><th id=\"L333\"><a href=\"#L333\">333</a></th><td></td></tr><tr><th id=\"L334\"><a href=\"#L334\">334</a></th><td>\u00a0 \u00a0 <span class=\"c\"># Installation.</span></td></tr><tr><th id=\"L335\"><a href=\"#L335\">335</a></th><td></td></tr><tr><th id=\"L336\"><a href=\"#L336\">336</a></th><td>\u00a0 \u00a0 <span class=\"c\"># IReactorCore</span></td></tr><tr><th id=\"L337\"><a href=\"#L337\">337</a></th><td></td></tr><tr><th id=\"L338\"><a href=\"#L338\">338</a></th><td>\u00a0 \u00a0 <span class=\"k\">def</span>\u00a0<span class=\"nf\">stop</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">):</span></td></tr><tr><th id=\"L339\"><a href=\"#L339\">339</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"sd\">\"\"\"See twisted.internet.interfaces.IReactorCore.stop.</span></td></tr><tr><th id=\"L340\"><a href=\"#L340\">340</a></th><td><span class=\"sd\">\u00a0 \u00a0 \u00a0 \u00a0 \"\"\"</span></td></tr><tr><th id=\"L341\"><a href=\"#L341\">341</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">if</span>\u00a0<span class=\"ow\">not</span>\u00a0<span class=\"bp\">self</span><span class=\"o\">.</span>running<span class=\"p\">:</span></td></tr><tr><th id=\"L342\"><a href=\"#L342\">342</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">raise</span>\u00a0<span class=\"ne\">RuntimeError</span><span class=\"p\">,</span>\u00a0<span class=\"s\">\"can't stop reactor that isn't running\"</span></td></tr><tr><th id=\"L343\"><a href=\"#L343\">343</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"bp\">self</span><span class=\"o\">.</span>fireSystemEvent<span class=\"p\">(</span><span class=\"s\">\"shutdown\"</span><span class=\"p\">)</span></td></tr><tr><th id=\"L344\"><a href=\"#L344\">344</a></th><td></td></tr><tr><th id=\"L345\"><a href=\"#L345\">345</a></th><td>\u00a0 \u00a0 <span class=\"k\">def</span>\u00a0<span class=\"nf\">crash</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">):</span></td></tr><tr><th id=\"L346\"><a href=\"#L346\">346</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"sd\">\"\"\"See twisted.internet.interfaces.IReactorCore.crash.</span></td></tr><tr><th id=\"L347\"><a href=\"#L347\">347</a></th><td><span class=\"sd\">\u00a0 \u00a0 \u00a0 \u00a0 \"\"\"</span></td></tr><tr><th id=\"L348\"><a href=\"#L348\">348</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"bp\">self</span><span class=\"o\">.</span>running <span class=\"o\">=</span>\u00a0<span class=\"mi\">0</span></td></tr><tr><th id=\"L349\"><a href=\"#L349\">349</a></th><td></td></tr><tr><th id=\"L350\"><a href=\"#L350\">350</a></th><td>\u00a0 \u00a0 <span class=\"k\">def</span>\u00a0<span class=\"nf\">sigInt</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span>\u00a0<span class=\"o\">*</span>args<span class=\"p\">):</span></td></tr><tr><th id=\"L351\"><a href=\"#L351\">351</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"sd\">\"\"\"Handle a SIGINT interrupt.</span></td></tr><tr><th id=\"L352\"><a href=\"#L352\">352</a></th><td><span class=\"sd\">\u00a0 \u00a0 \u00a0 \u00a0 \"\"\"</span></td></tr><tr><th id=\"L353\"><a href=\"#L353\">353</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 log<span class=\"o\">.</span>msg<span class=\"p\">(</span><span class=\"s\">\"Received SIGINT, shutting down.\"</span><span class=\"p\">)</span></td></tr><tr><th id=\"L354\"><a href=\"#L354\">354</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"bp\">self</span><span class=\"o\">.</span>callFromThread<span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span>stop<span class=\"p\">)</span></td></tr><tr><th id=\"L355\"><a href=\"#L355\">355</a></th><td></td></tr><tr><th id=\"L356\"><a href=\"#L356\">356</a></th><td>\u00a0 \u00a0 <span class=\"k\">def</span>\u00a0<span class=\"nf\">sigBreak</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span>\u00a0<span class=\"o\">*</span>args<span class=\"p\">):</span></td></tr><tr><th id=\"L357\"><a href=\"#L357\">357</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"sd\">\"\"\"Handle a SIGBREAK interrupt.</span></td></tr><tr><th id=\"L358\"><a href=\"#L358\">358</a></th><td><span class=\"sd\">\u00a0 \u00a0 \u00a0 \u00a0 \"\"\"</span></td></tr><tr><th id=\"L359\"><a href=\"#L359\">359</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 log<span class=\"o\">.</span>msg<span class=\"p\">(</span><span class=\"s\">\"Received SIGBREAK, shutting down.\"</span><span class=\"p\">)</span></td></tr><tr><th id=\"L360\"><a href=\"#L360\">360</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"bp\">self</span><span class=\"o\">.</span>callFromThread<span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span>stop<span class=\"p\">)</span></td></tr><tr><th id=\"L361\"><a href=\"#L361\">361</a></th><td></td></tr><tr><th id=\"L362\"><a href=\"#L362\">362</a></th><td>\u00a0 \u00a0 <span class=\"k\">def</span>\u00a0<span class=\"nf\">sigTerm</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span>\u00a0<span class=\"o\">*</span>args<span class=\"p\">):</span></td></tr><tr><th id=\"L363\"><a href=\"#L363\">363</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"sd\">\"\"\"Handle a SIGTERM interrupt.</span></td></tr><tr><th id=\"L364\"><a href=\"#L364\">364</a></th><td><span class=\"sd\">\u00a0 \u00a0 \u00a0 \u00a0 \"\"\"</span></td></tr><tr><th id=\"L365\"><a href=\"#L365\">365</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 log<span class=\"o\">.</span>msg<span class=\"p\">(</span><span class=\"s\">\"Received SIGTERM, shutting down.\"</span><span class=\"p\">)</span></td></tr><tr><th id=\"L366\"><a href=\"#L366\">366</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"bp\">self</span><span class=\"o\">.</span>callFromThread<span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span>stop<span class=\"p\">)</span></td></tr><tr><th id=\"L367\"><a href=\"#L367\">367</a></th><td></td></tr><tr><th id=\"L368\"><a href=\"#L368\">368</a></th><td>\u00a0 \u00a0 <span class=\"k\">def</span>\u00a0<span class=\"nf\">disconnectAll</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">):</span></td></tr><tr><th id=\"L369\"><a href=\"#L369\">369</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"sd\">\"\"\"Disconnect every reader, and writer in the system.</span></td></tr><tr><th id=\"L370\"><a href=\"#L370\">370</a></th><td><span class=\"sd\">\u00a0 \u00a0 \u00a0 \u00a0 \"\"\"</span></td></tr><tr><th id=\"L371\"><a href=\"#L371\">371</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 selectables <span class=\"o\">=</span>\u00a0<span class=\"bp\">self</span><span class=\"o\">.</span>removeAll<span class=\"p\">()</span></td></tr><tr><th id=\"L372\"><a href=\"#L372\">372</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">for</span>\u00a0reader <span class=\"ow\">in</span>\u00a0selectables<span class=\"p\">:</span></td></tr><tr><th id=\"L373\"><a href=\"#L373\">373</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 log<span class=\"o\">.</span>callWithLogger<span class=\"p\">(</span>reader<span class=\"p\">,</span></td></tr><tr><th id=\"L374\"><a href=\"#L374\">374</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0reader<span class=\"o\">.</span>connectionLost<span class=\"p\">,</span></td></tr><tr><th id=\"L375\"><a href=\"#L375\">375</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0failure<span class=\"o\">.</span>Failure<span class=\"p\">(</span>main<span class=\"o\">.</span>CONNECTION_LOST<span class=\"p\">))</span></td></tr><tr><th id=\"L376\"><a href=\"#L376\">376</a></th><td></td></tr><tr><th id=\"L377\"><a href=\"#L377\">377</a></th><td></td></tr><tr><th id=\"L378\"><a href=\"#L378\">378</a></th><td>\u00a0 \u00a0 <span class=\"k\">def</span>\u00a0<span class=\"nf\">iterate</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span>\u00a0delay<span class=\"o\">=</span><span class=\"mi\">0</span><span class=\"p\">):</span></td></tr><tr><th id=\"L379\"><a href=\"#L379\">379</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"sd\">\"\"\"See twisted.internet.interfaces.IReactorCore.iterate.</span></td></tr><tr><th id=\"L380\"><a href=\"#L380\">380</a></th><td><span class=\"sd\">\u00a0 \u00a0 \u00a0 \u00a0 \"\"\"</span></td></tr><tr><th id=\"L381\"><a href=\"#L381\">381</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"bp\">self</span><span class=\"o\">.</span>runUntilCurrent<span class=\"p\">()</span></td></tr><tr><th id=\"L382\"><a href=\"#L382\">382</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"bp\">self</span><span class=\"o\">.</span>doIteration<span class=\"p\">(</span>delay<span class=\"p\">)</span></td></tr><tr><th id=\"L383\"><a href=\"#L383\">383</a></th><td></td></tr><tr><th id=\"L384\"><a href=\"#L384\">384</a></th><td>\u00a0 \u00a0 <span class=\"k\">def</span>\u00a0<span class=\"nf\">fireSystemEvent</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span>\u00a0eventType<span class=\"p\">):</span></td></tr><tr><th id=\"L385\"><a href=\"#L385\">385</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"sd\">\"\"\"See twisted.internet.interfaces.IReactorCore.fireSystemEvent.</span></td></tr><tr><th id=\"L386\"><a href=\"#L386\">386</a></th><td><span class=\"sd\">\u00a0 \u00a0 \u00a0 \u00a0 \"\"\"</span></td></tr><tr><th id=\"L387\"><a href=\"#L387\">387</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 sysEvtTriggers <span class=\"o\">=</span>\u00a0<span class=\"bp\">self</span><span class=\"o\">.</span>_eventTriggers<span class=\"o\">.</span>get<span class=\"p\">(</span>eventType<span class=\"p\">)</span></td></tr><tr><th id=\"L388\"><a href=\"#L388\">388</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">if</span>\u00a0<span class=\"ow\">not</span>\u00a0sysEvtTriggers<span class=\"p\">:</span></td></tr><tr><th id=\"L389\"><a href=\"#L389\">389</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">return</span></td></tr><tr><th id=\"L390\"><a href=\"#L390\">390</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 defrList <span class=\"o\">=</span>\u00a0<span class=\"p\">[]</span></td></tr><tr><th id=\"L391\"><a href=\"#L391\">391</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">for</span>\u00a0<span class=\"nb\">callable</span><span class=\"p\">,</span>\u00a0args<span class=\"p\">,</span>\u00a0kw <span class=\"ow\">in</span>\u00a0sysEvtTriggers<span class=\"p\">[</span><span class=\"mi\">0</span><span class=\"p\">]:</span></td></tr><tr><th id=\"L392\"><a href=\"#L392\">392</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">try</span><span class=\"p\">:</span></td></tr><tr><th id=\"L393\"><a href=\"#L393\">393</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 d <span class=\"o\">=</span>\u00a0<span class=\"nb\">callable</span><span class=\"p\">(</span><span class=\"o\">*</span>args<span class=\"p\">,</span>\u00a0<span class=\"o\">**</span>kw<span class=\"p\">)</span></td></tr><tr><th id=\"L394\"><a href=\"#L394\">394</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">except</span><span class=\"p\">:</span></td></tr><tr><th id=\"L395\"><a href=\"#L395\">395</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 log<span class=\"o\">.</span>deferr<span class=\"p\">()</span></td></tr><tr><th id=\"L396\"><a href=\"#L396\">396</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">else</span><span class=\"p\">:</span></td></tr><tr><th id=\"L397\"><a href=\"#L397\">397</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">if</span>\u00a0<span class=\"nb\">isinstance</span><span class=\"p\">(</span>d<span class=\"p\">,</span>\u00a0Deferred<span class=\"p\">):</span></td></tr><tr><th id=\"L398\"><a href=\"#L398\">398</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 defrList<span class=\"o\">.</span>append<span class=\"p\">(</span>d<span class=\"p\">)</span></td></tr><tr><th id=\"L399\"><a href=\"#L399\">399</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">if</span>\u00a0defrList<span class=\"p\">:</span></td></tr><tr><th id=\"L400\"><a href=\"#L400\">400</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 DeferredList<span class=\"p\">(</span>defrList<span class=\"p\">)</span><span class=\"o\">.</span>addBoth<span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span>_cbContinueSystemEvent<span class=\"p\">,</span>\u00a0eventType<span class=\"p\">)</span></td></tr><tr><th id=\"L401\"><a href=\"#L401\">401</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">else</span><span class=\"p\">:</span></td></tr><tr><th id=\"L402\"><a href=\"#L402\">402</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"bp\">self</span><span class=\"o\">.</span>callLater<span class=\"p\">(</span><span class=\"mi\">0</span><span class=\"p\">,</span>\u00a0<span class=\"bp\">self</span><span class=\"o\">.</span>_continueSystemEvent<span class=\"p\">,</span>\u00a0eventType<span class=\"p\">)</span></td></tr><tr><th id=\"L403\"><a href=\"#L403\">403</a></th><td></td></tr><tr><th id=\"L404\"><a href=\"#L404\">404</a></th><td></td></tr><tr><th id=\"L405\"><a href=\"#L405\">405</a></th><td>\u00a0 \u00a0 <span class=\"k\">def</span>\u00a0<span class=\"nf\">_cbContinueSystemEvent</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span>\u00a0result<span class=\"p\">,</span>\u00a0eventType<span class=\"p\">):</span></td></tr><tr><th id=\"L406\"><a href=\"#L406\">406</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"bp\">self</span><span class=\"o\">.</span>_continueSystemEvent<span class=\"p\">(</span>eventType<span class=\"p\">)</span></td></tr><tr><th id=\"L407\"><a href=\"#L407\">407</a></th><td></td></tr><tr><th id=\"L408\"><a href=\"#L408\">408</a></th><td></td></tr><tr><th id=\"L409\"><a href=\"#L409\">409</a></th><td>\u00a0 \u00a0 <span class=\"k\">def</span>\u00a0<span class=\"nf\">_continueSystemEvent</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span>\u00a0eventType<span class=\"p\">):</span></td></tr><tr><th id=\"L410\"><a href=\"#L410\">410</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 sysEvtTriggers <span class=\"o\">=</span>\u00a0<span class=\"bp\">self</span><span class=\"o\">.</span>_eventTriggers<span class=\"o\">.</span>get<span class=\"p\">(</span>eventType<span class=\"p\">)</span></td></tr><tr><th id=\"L411\"><a href=\"#L411\">411</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">for</span>\u00a0callList <span class=\"ow\">in</span>\u00a0sysEvtTriggers<span class=\"p\">[</span><span class=\"mi\">1</span><span class=\"p\">],</span>\u00a0sysEvtTriggers<span class=\"p\">[</span><span class=\"mi\">2</span><span class=\"p\">]:</span></td></tr><tr><th id=\"L412\"><a href=\"#L412\">412</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">for</span>\u00a0<span class=\"nb\">callable</span><span class=\"p\">,</span>\u00a0args<span class=\"p\">,</span>\u00a0kw <span class=\"ow\">in</span>\u00a0callList<span class=\"p\">:</span></td></tr><tr><th id=\"L413\"><a href=\"#L413\">413</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">try</span><span class=\"p\">:</span></td></tr><tr><th id=\"L414\"><a href=\"#L414\">414</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"nb\">callable</span><span class=\"p\">(</span><span class=\"o\">*</span>args<span class=\"p\">,</span>\u00a0<span class=\"o\">**</span>kw<span class=\"p\">)</span></td></tr><tr><th id=\"L415\"><a href=\"#L415\">415</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">except</span><span class=\"p\">:</span></td></tr><tr><th id=\"L416\"><a href=\"#L416\">416</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 log<span class=\"o\">.</span>deferr<span class=\"p\">()</span></td></tr><tr><th id=\"L417\"><a href=\"#L417\">417</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"c\"># now that we've called all callbacks, no need to store</span></td></tr><tr><th id=\"L418\"><a href=\"#L418\">418</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"c\"># references to them anymore, in fact this can cause problems.</span></td></tr><tr><th id=\"L419\"><a href=\"#L419\">419</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">del</span>\u00a0<span class=\"bp\">self</span><span class=\"o\">.</span>_eventTriggers<span class=\"p\">[</span>eventType<span class=\"p\">]</span></td></tr><tr><th id=\"L420\"><a href=\"#L420\">420</a></th><td></td></tr><tr><th id=\"L421\"><a href=\"#L421\">421</a></th><td>\u00a0 \u00a0 <span class=\"k\">def</span>\u00a0<span class=\"nf\">addSystemEventTrigger</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span>\u00a0_phase<span class=\"p\">,</span>\u00a0_eventType<span class=\"p\">,</span>\u00a0_f<span class=\"p\">,</span>\u00a0<span class=\"o\">*</span>args<span class=\"p\">,</span>\u00a0<span class=\"o\">**</span>kw<span class=\"p\">):</span></td></tr><tr><th id=\"L422\"><a href=\"#L422\">422</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"sd\">\"\"\"See twisted.internet.interfaces.IReactorCore.addSystemEventTrigger.</span></td></tr><tr><th id=\"L423\"><a href=\"#L423\">423</a></th><td><span class=\"sd\">\u00a0 \u00a0 \u00a0 \u00a0 \"\"\"</span></td></tr><tr><th id=\"L424\"><a href=\"#L424\">424</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">assert</span>\u00a0<span class=\"nb\">callable</span><span class=\"p\">(</span>_f<span class=\"p\">),</span>\u00a0<span class=\"s\">\"</span><span class=\"si\">%s</span><span class=\"s\">\u00a0is not callable\"</span>\u00a0<span class=\"o\">%</span>\u00a0_f</td></tr><tr><th id=\"L425\"><a href=\"#L425\">425</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">if</span>\u00a0<span class=\"bp\">self</span><span class=\"o\">.</span>_eventTriggers<span class=\"o\">.</span>has_key<span class=\"p\">(</span>_eventType<span class=\"p\">):</span></td></tr><tr><th id=\"L426\"><a href=\"#L426\">426</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 triglist <span class=\"o\">=</span>\u00a0<span class=\"bp\">self</span><span class=\"o\">.</span>_eventTriggers<span class=\"p\">[</span>_eventType<span class=\"p\">]</span></td></tr><tr><th id=\"L427\"><a href=\"#L427\">427</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">else</span><span class=\"p\">:</span></td></tr><tr><th id=\"L428\"><a href=\"#L428\">428</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 triglist <span class=\"o\">=</span>\u00a0<span class=\"p\">[[],</span>\u00a0<span class=\"p\">[],</span>\u00a0<span class=\"p\">[]]</span></td></tr><tr><th id=\"L429\"><a href=\"#L429\">429</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"bp\">self</span><span class=\"o\">.</span>_eventTriggers<span class=\"p\">[</span>_eventType<span class=\"p\">]</span>\u00a0<span class=\"o\">=</span>\u00a0triglist</td></tr><tr><th id=\"L430\"><a href=\"#L430\">430</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 evtList <span class=\"o\">=</span>\u00a0triglist<span class=\"p\">[{</span><span class=\"s\">\"before\"</span><span class=\"p\">:</span>\u00a0<span class=\"mi\">0</span><span class=\"p\">,</span>\u00a0<span class=\"s\">\"during\"</span><span class=\"p\">:</span>\u00a0<span class=\"mi\">1</span><span class=\"p\">,</span>\u00a0<span class=\"s\">\"after\"</span><span class=\"p\">:</span>\u00a0<span class=\"mi\">2</span><span class=\"p\">}[</span>_phase<span class=\"p\">]]</span></td></tr><tr><th id=\"L431\"><a href=\"#L431\">431</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 evtList<span class=\"o\">.</span>append<span class=\"p\">((</span>_f<span class=\"p\">,</span>\u00a0args<span class=\"p\">,</span>\u00a0kw<span class=\"p\">))</span></td></tr><tr><th id=\"L432\"><a href=\"#L432\">432</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">return</span>\u00a0<span class=\"p\">(</span>_phase<span class=\"p\">,</span>\u00a0_eventType<span class=\"p\">,</span>\u00a0<span class=\"p\">(</span>_f<span class=\"p\">,</span>\u00a0args<span class=\"p\">,</span>\u00a0kw<span class=\"p\">))</span></td></tr><tr><th id=\"L433\"><a href=\"#L433\">433</a></th><td></td></tr><tr><th id=\"L434\"><a href=\"#L434\">434</a></th><td>\u00a0 \u00a0 <span class=\"k\">def</span>\u00a0<span class=\"nf\">removeSystemEventTrigger</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span>\u00a0triggerID<span class=\"p\">):</span></td></tr><tr><th id=\"L435\"><a href=\"#L435\">435</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"sd\">\"\"\"See twisted.internet.interfaces.IReactorCore.removeSystemEventTrigger.</span></td></tr><tr><th id=\"L436\"><a href=\"#L436\">436</a></th><td><span class=\"sd\">\u00a0 \u00a0 \u00a0 \u00a0 \"\"\"</span></td></tr><tr><th id=\"L437\"><a href=\"#L437\">437</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 phase<span class=\"p\">,</span>\u00a0eventType<span class=\"p\">,</span>\u00a0item <span class=\"o\">=</span>\u00a0triggerID</td></tr><tr><th id=\"L438\"><a href=\"#L438\">438</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"bp\">self</span><span class=\"o\">.</span>_eventTriggers<span class=\"p\">[</span>eventType<span class=\"p\">][{</span><span class=\"s\">\"before\"</span><span class=\"p\">:</span>\u00a0<span class=\"mi\">0</span><span class=\"p\">,</span></td></tr><tr><th id=\"L439\"><a href=\"#L439\">439</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"s\">\"during\"</span><span class=\"p\">:</span>\u00a0<span class=\"mi\">1</span><span class=\"p\">,</span></td></tr><tr><th id=\"L440\"><a href=\"#L440\">440</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"s\">\"after\"</span><span class=\"p\">:</span>\u00a0 <span class=\"mi\">2</span><span class=\"p\">}[</span>phase<span class=\"p\">]</span></td></tr><tr><th id=\"L441\"><a href=\"#L441\">441</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0<span class=\"p\">]</span><span class=\"o\">.</span>remove<span class=\"p\">(</span>item<span class=\"p\">)</span></td></tr><tr><th id=\"L442\"><a href=\"#L442\">442</a></th><td></td></tr><tr><th id=\"L443\"><a href=\"#L443\">443</a></th><td>\u00a0 \u00a0 <span class=\"k\">def</span>\u00a0<span class=\"nf\">callWhenRunning</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span>\u00a0_callable<span class=\"p\">,</span>\u00a0<span class=\"o\">*</span>args<span class=\"p\">,</span>\u00a0<span class=\"o\">**</span>kw<span class=\"p\">):</span></td></tr><tr><th id=\"L444\"><a href=\"#L444\">444</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"sd\">\"\"\"See twisted.internet.interfaces.IReactorCore.callWhenRunning.</span></td></tr><tr><th id=\"L445\"><a href=\"#L445\">445</a></th><td><span class=\"sd\">\u00a0 \u00a0 \u00a0 \u00a0 \"\"\"</span></td></tr><tr><th id=\"L446\"><a href=\"#L446\">446</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">if</span>\u00a0<span class=\"bp\">self</span><span class=\"o\">.</span>running<span class=\"p\">:</span></td></tr><tr><th id=\"L447\"><a href=\"#L447\">447</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 _callable<span class=\"p\">(</span><span class=\"o\">*</span>args<span class=\"p\">,</span>\u00a0<span class=\"o\">**</span>kw<span class=\"p\">)</span></td></tr><tr><th id=\"L448\"><a href=\"#L448\">448</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">else</span><span class=\"p\">:</span></td></tr><tr><th id=\"L449\"><a href=\"#L449\">449</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">return</span>\u00a0<span class=\"bp\">self</span><span class=\"o\">.</span>addSystemEventTrigger<span class=\"p\">(</span><span class=\"s\">'after'</span><span class=\"p\">,</span>\u00a0<span class=\"s\">'startup'</span><span class=\"p\">,</span></td></tr><tr><th id=\"L450\"><a href=\"#L450\">450</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 _callable<span class=\"p\">,</span>\u00a0<span class=\"o\">*</span>args<span class=\"p\">,</span>\u00a0<span class=\"o\">**</span>kw<span class=\"p\">)</span></td></tr><tr><th id=\"L451\"><a href=\"#L451\">451</a></th><td></td></tr><tr><th id=\"L452\"><a href=\"#L452\">452</a></th><td>\u00a0 \u00a0 <span class=\"c\"># IReactorTime</span></td></tr><tr><th id=\"L453\"><a href=\"#L453\">453</a></th><td></td></tr><tr><th id=\"L454\"><a href=\"#L454\">454</a></th><td>\u00a0 \u00a0 <span class=\"k\">def</span>\u00a0<span class=\"nf\">callLater</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span>\u00a0_seconds<span class=\"p\">,</span>\u00a0_f<span class=\"p\">,</span>\u00a0<span class=\"o\">*</span>args<span class=\"p\">,</span>\u00a0<span class=\"o\">**</span>kw<span class=\"p\">):</span></td></tr><tr><th id=\"L455\"><a href=\"#L455\">455</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"sd\">\"\"\"See twisted.internet.interfaces.IReactorTime.callLater.</span></td></tr><tr><th id=\"L456\"><a href=\"#L456\">456</a></th><td><span class=\"sd\">\u00a0 \u00a0 \u00a0 \u00a0 \"\"\"</span></td></tr><tr><th id=\"L457\"><a href=\"#L457\">457</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">assert</span>\u00a0<span class=\"nb\">callable</span><span class=\"p\">(</span>_f<span class=\"p\">),</span>\u00a0<span class=\"s\">\"</span><span class=\"si\">%s</span><span class=\"s\">\u00a0is not callable\"</span>\u00a0<span class=\"o\">%</span>\u00a0_f</td></tr><tr><th id=\"L458\"><a href=\"#L458\">458</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">assert</span>\u00a0sys<span class=\"o\">.</span>maxint <span class=\"o\">&gt;=</span>\u00a0_seconds <span class=\"o\">&gt;=</span>\u00a0<span class=\"mi\">0</span><span class=\"p\">,</span>\u00a0\\</td></tr><tr><th id=\"L459\"><a href=\"#L459\">459</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0<span class=\"s\">\"</span><span class=\"si\">%s</span><span class=\"s\">\u00a0is not greater than or equal to 0 seconds\"</span>\u00a0<span class=\"o\">%</span>\u00a0<span class=\"p\">(</span>_seconds<span class=\"p\">,)</span></td></tr><tr><th id=\"L460\"><a href=\"#L460\">460</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 tple <span class=\"o\">=</span>\u00a0DelayedCall<span class=\"p\">(</span>seconds<span class=\"p\">()</span>\u00a0<span class=\"o\">+</span>\u00a0_seconds<span class=\"p\">,</span>\u00a0_f<span class=\"p\">,</span>\u00a0args<span class=\"p\">,</span>\u00a0kw<span class=\"p\">,</span></td></tr><tr><th id=\"L461\"><a href=\"#L461\">461</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0<span class=\"bp\">self</span><span class=\"o\">.</span>_cancelCallLater<span class=\"p\">,</span></td></tr><tr><th id=\"L462\"><a href=\"#L462\">462</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0<span class=\"bp\">self</span><span class=\"o\">.</span>_moveCallLaterSooner<span class=\"p\">)</span></td></tr><tr><th id=\"L463\"><a href=\"#L463\">463</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"bp\">self</span><span class=\"o\">.</span>_newTimedCalls<span class=\"o\">.</span>append<span class=\"p\">(</span>tple<span class=\"p\">)</span></td></tr><tr><th id=\"L464\"><a href=\"#L464\">464</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">return</span>\u00a0tple</td></tr><tr><th id=\"L465\"><a href=\"#L465\">465</a></th><td></td></tr><tr><th id=\"L466\"><a href=\"#L466\">466</a></th><td>\u00a0 \u00a0 <span class=\"k\">def</span>\u00a0<span class=\"nf\">_moveCallLaterSooner</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span>\u00a0tple<span class=\"p\">):</span></td></tr><tr><th id=\"L467\"><a href=\"#L467\">467</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"c\"># Linear time find: slow.</span></td></tr><tr><th id=\"L468\"><a href=\"#L468\">468</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 heap <span class=\"o\">=</span>\u00a0<span class=\"bp\">self</span><span class=\"o\">.</span>_pendingTimedCalls</td></tr><tr><th id=\"L469\"><a href=\"#L469\">469</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">try</span><span class=\"p\">:</span></td></tr><tr><th id=\"L470\"><a href=\"#L470\">470</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 pos <span class=\"o\">=</span>\u00a0heap<span class=\"o\">.</span>index<span class=\"p\">(</span>tple<span class=\"p\">)</span></td></tr><tr><th id=\"L471\"><a href=\"#L471\">471</a></th><td></td></tr><tr><th id=\"L472\"><a href=\"#L472\">472</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"c\"># Move elt up the heap until it rests at the right place.</span></td></tr><tr><th id=\"L473\"><a href=\"#L473\">473</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 elt <span class=\"o\">=</span>\u00a0heap<span class=\"p\">[</span>pos<span class=\"p\">]</span></td></tr><tr><th id=\"L474\"><a href=\"#L474\">474</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">while</span>\u00a0pos <span class=\"o\">!=</span>\u00a0<span class=\"mi\">0</span><span class=\"p\">:</span></td></tr><tr><th id=\"L475\"><a href=\"#L475\">475</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 parent <span class=\"o\">=</span>\u00a0<span class=\"p\">(</span>pos<span class=\"o\">-</span><span class=\"mi\">1</span><span class=\"p\">)</span>\u00a0<span class=\"o\">//</span>\u00a0<span class=\"mi\">2</span></td></tr><tr><th id=\"L476\"><a href=\"#L476\">476</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">if</span>\u00a0heap<span class=\"p\">[</span>parent<span class=\"p\">]</span>\u00a0<span class=\"o\">&lt;=</span>\u00a0elt<span class=\"p\">:</span></td></tr><tr><th id=\"L477\"><a href=\"#L477\">477</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">break</span></td></tr><tr><th id=\"L478\"><a href=\"#L478\">478</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"c\"># move parent down</span></td></tr><tr><th id=\"L479\"><a href=\"#L479\">479</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 heap<span class=\"p\">[</span>pos<span class=\"p\">]</span>\u00a0<span class=\"o\">=</span>\u00a0heap<span class=\"p\">[</span>parent<span class=\"p\">]</span></td></tr><tr><th id=\"L480\"><a href=\"#L480\">480</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 pos <span class=\"o\">=</span>\u00a0parent</td></tr><tr><th id=\"L481\"><a href=\"#L481\">481</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 heap<span class=\"p\">[</span>pos<span class=\"p\">]</span>\u00a0<span class=\"o\">=</span>\u00a0elt</td></tr><tr><th id=\"L482\"><a href=\"#L482\">482</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">except</span>\u00a0<span class=\"ne\">ValueError</span><span class=\"p\">:</span></td></tr><tr><th id=\"L483\"><a href=\"#L483\">483</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"c\"># element was not found in heap - oh well...</span></td></tr><tr><th id=\"L484\"><a href=\"#L484\">484</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">pass</span></td></tr><tr><th id=\"L485\"><a href=\"#L485\">485</a></th><td></td></tr><tr><th id=\"L486\"><a href=\"#L486\">486</a></th><td>\u00a0 \u00a0 <span class=\"k\">def</span>\u00a0<span class=\"nf\">_cancelCallLater</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span>\u00a0tple<span class=\"p\">):</span></td></tr><tr><th id=\"L487\"><a href=\"#L487\">487</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"bp\">self</span><span class=\"o\">.</span>_cancellations<span class=\"o\">+=</span><span class=\"mi\">1</span></td></tr><tr><th id=\"L488\"><a href=\"#L488\">488</a></th><td></td></tr><tr><th id=\"L489\"><a href=\"#L489\">489</a></th><td>\u00a0 \u00a0 <span class=\"k\">def</span>\u00a0<span class=\"nf\">cancelCallLater</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span>\u00a0callID<span class=\"p\">):</span></td></tr><tr><th id=\"L490\"><a href=\"#L490\">490</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"sd\">\"\"\"See twisted.internet.interfaces.IReactorTime.cancelCallLater.</span></td></tr><tr><th id=\"L491\"><a href=\"#L491\">491</a></th><td><span class=\"sd\">\u00a0 \u00a0 \u00a0 \u00a0 \"\"\"</span></td></tr><tr><th id=\"L492\"><a href=\"#L492\">492</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"c\"># DO NOT DELETE THIS - this is documented in Python in a Nutshell, so we</span></td></tr><tr><th id=\"L493\"><a href=\"#L493\">493</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"c\"># we can't get rid of it for a long time.</span></td></tr><tr><th id=\"L494\"><a href=\"#L494\">494</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 warnings<span class=\"o\">.</span>warn<span class=\"p\">(</span><span class=\"s\">\"reactor.cancelCallLater(callID) is deprecated - use callID.cancel() instead\"</span><span class=\"p\">)</span></td></tr><tr><th id=\"L495\"><a href=\"#L495\">495</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 callID<span class=\"o\">.</span>cancel<span class=\"p\">()</span></td></tr><tr><th id=\"L496\"><a href=\"#L496\">496</a></th><td></td></tr><tr><th id=\"L497\"><a href=\"#L497\">497</a></th><td>\u00a0 \u00a0 <span class=\"k\">def</span>\u00a0<span class=\"nf\">getDelayedCalls</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">):</span></td></tr><tr><th id=\"L498\"><a href=\"#L498\">498</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"sd\">\"\"\"Return all the outstanding delayed calls in the system.</span></td></tr><tr><th id=\"L499\"><a href=\"#L499\">499</a></th><td><span class=\"sd\">\u00a0 \u00a0 \u00a0 \u00a0 They are returned in no particular order.</span></td></tr><tr><th id=\"L500\"><a href=\"#L500\">500</a></th><td><span class=\"sd\">\u00a0 \u00a0 \u00a0 \u00a0 This method is not efficient -- it is really only meant for</span></td></tr><tr><th id=\"L501\"><a href=\"#L501\">501</a></th><td><span class=\"sd\">\u00a0 \u00a0 \u00a0 \u00a0 test cases.\"\"\"</span></td></tr><tr><th id=\"L502\"><a href=\"#L502\">502</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">return</span>\u00a0<span class=\"p\">[</span>x <span class=\"k\">for</span>\u00a0x <span class=\"ow\">in</span>\u00a0<span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span>_pendingTimedCalls <span class=\"o\">+</span>\u00a0<span class=\"bp\">self</span><span class=\"o\">.</span>_newTimedCalls<span class=\"p\">)</span>\u00a0<span class=\"k\">if</span>\u00a0<span class=\"ow\">not</span>\u00a0x<span class=\"o\">.</span>cancelled<span class=\"p\">]</span></td></tr><tr><th id=\"L503\"><a href=\"#L503\">503</a></th><td></td></tr><tr><th id=\"L504\"><a href=\"#L504\">504</a></th><td>\u00a0 \u00a0 <span class=\"k\">def</span>\u00a0<span class=\"nf\">_insertNewDelayedCalls</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">):</span></td></tr><tr><th id=\"L505\"><a href=\"#L505\">505</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">for</span>\u00a0call <span class=\"ow\">in</span>\u00a0<span class=\"bp\">self</span><span class=\"o\">.</span>_newTimedCalls<span class=\"p\">:</span></td></tr><tr><th id=\"L506\"><a href=\"#L506\">506</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">if</span>\u00a0call<span class=\"o\">.</span>cancelled<span class=\"p\">:</span></td></tr><tr><th id=\"L507\"><a href=\"#L507\">507</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"bp\">self</span><span class=\"o\">.</span>_cancellations<span class=\"o\">-=</span><span class=\"mi\">1</span></td></tr><tr><th id=\"L508\"><a href=\"#L508\">508</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">else</span><span class=\"p\">:</span></td></tr><tr><th id=\"L509\"><a href=\"#L509\">509</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 call<span class=\"o\">.</span>activate_delay<span class=\"p\">()</span></td></tr><tr><th id=\"L510\"><a href=\"#L510\">510</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 heappush<span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span>_pendingTimedCalls<span class=\"p\">,</span>\u00a0call<span class=\"p\">)</span></td></tr><tr><th id=\"L511\"><a href=\"#L511\">511</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"bp\">self</span><span class=\"o\">.</span>_newTimedCalls <span class=\"o\">=</span>\u00a0<span class=\"p\">[]</span></td></tr><tr><th id=\"L512\"><a href=\"#L512\">512</a></th><td></td></tr><tr><th id=\"L513\"><a href=\"#L513\">513</a></th><td>\u00a0 \u00a0 <span class=\"k\">def</span>\u00a0<span class=\"nf\">timeout</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">):</span></td></tr><tr><th id=\"L514\"><a href=\"#L514\">514</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"c\"># insert new delayed calls to make sure to include them in timeout value</span></td></tr><tr><th id=\"L515\"><a href=\"#L515\">515</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"bp\">self</span><span class=\"o\">.</span>_insertNewDelayedCalls<span class=\"p\">()</span></td></tr><tr><th id=\"L516\"><a href=\"#L516\">516</a></th><td></td></tr><tr><th id=\"L517\"><a href=\"#L517\">517</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">if</span>\u00a0<span class=\"ow\">not</span>\u00a0<span class=\"bp\">self</span><span class=\"o\">.</span>_pendingTimedCalls<span class=\"p\">:</span></td></tr><tr><th id=\"L518\"><a href=\"#L518\">518</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">return</span>\u00a0<span class=\"bp\">None</span></td></tr><tr><th id=\"L519\"><a href=\"#L519\">519</a></th><td></td></tr><tr><th id=\"L520\"><a href=\"#L520\">520</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">return</span>\u00a0<span class=\"nb\">max</span><span class=\"p\">(</span><span class=\"mi\">0</span><span class=\"p\">,</span>\u00a0<span class=\"bp\">self</span><span class=\"o\">.</span>_pendingTimedCalls<span class=\"p\">[</span><span class=\"mi\">0</span><span class=\"p\">]</span><span class=\"o\">.</span>time <span class=\"o\">-</span>\u00a0seconds<span class=\"p\">())</span></td></tr><tr><th id=\"L521\"><a href=\"#L521\">521</a></th><td></td></tr><tr><th id=\"L522\"><a href=\"#L522\">522</a></th><td>\u00a0 \u00a0 <span class=\"k\">def</span>\u00a0<span class=\"nf\">runUntilCurrent</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">):</span></td></tr><tr><th id=\"L523\"><a href=\"#L523\">523</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"sd\">\"\"\"Run all pending timed calls.</span></td></tr><tr><th id=\"L524\"><a href=\"#L524\">524</a></th><td><span class=\"sd\">\u00a0 \u00a0 \u00a0 \u00a0 \"\"\"</span></td></tr><tr><th id=\"L525\"><a href=\"#L525\">525</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">if</span>\u00a0<span class=\"bp\">self</span><span class=\"o\">.</span>threadCallQueue<span class=\"p\">:</span></td></tr><tr><th id=\"L526\"><a href=\"#L526\">526</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"c\"># Keep track of how many calls we actually make, as we're</span></td></tr><tr><th id=\"L527\"><a href=\"#L527\">527</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"c\"># making them, in case another call is added to the queue</span></td></tr><tr><th id=\"L528\"><a href=\"#L528\">528</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"c\"># while we're in this loop.</span></td></tr><tr><th id=\"L529\"><a href=\"#L529\">529</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 count <span class=\"o\">=</span>\u00a0<span class=\"mi\">0</span></td></tr><tr><th id=\"L530\"><a href=\"#L530\">530</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 total <span class=\"o\">=</span>\u00a0<span class=\"nb\">len</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span>threadCallQueue<span class=\"p\">)</span></td></tr><tr><th id=\"L531\"><a href=\"#L531\">531</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">for</span>\u00a0<span class=\"p\">(</span>f<span class=\"p\">,</span>\u00a0a<span class=\"p\">,</span>\u00a0kw<span class=\"p\">)</span>\u00a0<span class=\"ow\">in</span>\u00a0<span class=\"bp\">self</span><span class=\"o\">.</span>threadCallQueue<span class=\"p\">:</span></td></tr><tr><th id=\"L532\"><a href=\"#L532\">532</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">try</span><span class=\"p\">:</span></td></tr><tr><th id=\"L533\"><a href=\"#L533\">533</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 f<span class=\"p\">(</span><span class=\"o\">*</span>a<span class=\"p\">,</span>\u00a0<span class=\"o\">**</span>kw<span class=\"p\">)</span></td></tr><tr><th id=\"L534\"><a href=\"#L534\">534</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">except</span><span class=\"p\">:</span></td></tr><tr><th id=\"L535\"><a href=\"#L535\">535</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 log<span class=\"o\">.</span>err<span class=\"p\">()</span></td></tr><tr><th id=\"L536\"><a href=\"#L536\">536</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 count <span class=\"o\">+=</span>\u00a0<span class=\"mi\">1</span></td></tr><tr><th id=\"L537\"><a href=\"#L537\">537</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">if</span>\u00a0count <span class=\"o\">==</span>\u00a0total<span class=\"p\">:</span></td></tr><tr><th id=\"L538\"><a href=\"#L538\">538</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">break</span></td></tr><tr><th id=\"L539\"><a href=\"#L539\">539</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">del</span>\u00a0<span class=\"bp\">self</span><span class=\"o\">.</span>threadCallQueue<span class=\"p\">[:</span>count<span class=\"p\">]</span></td></tr><tr><th id=\"L540\"><a href=\"#L540\">540</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">if</span>\u00a0<span class=\"bp\">self</span><span class=\"o\">.</span>threadCallQueue<span class=\"p\">:</span></td></tr><tr><th id=\"L541\"><a href=\"#L541\">541</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">if</span>\u00a0<span class=\"bp\">self</span><span class=\"o\">.</span>waker<span class=\"p\">:</span></td></tr><tr><th id=\"L542\"><a href=\"#L542\">542</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"bp\">self</span><span class=\"o\">.</span>waker<span class=\"o\">.</span>wakeUp<span class=\"p\">()</span></td></tr><tr><th id=\"L543\"><a href=\"#L543\">543</a></th><td>\u00a0</td></tr><tr><th id=\"L544\"><a href=\"#L544\">544</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"c\"># insert new delayed calls now</span></td></tr><tr><th id=\"L545\"><a href=\"#L545\">545</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"bp\">self</span><span class=\"o\">.</span>_insertNewDelayedCalls<span class=\"p\">()</span></td></tr><tr><th id=\"L546\"><a href=\"#L546\">546</a></th><td></td></tr><tr><th id=\"L547\"><a href=\"#L547\">547</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 now <span class=\"o\">=</span>\u00a0seconds<span class=\"p\">()</span></td></tr><tr><th id=\"L548\"><a href=\"#L548\">548</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">while</span>\u00a0<span class=\"bp\">self</span><span class=\"o\">.</span>_pendingTimedCalls <span class=\"ow\">and</span>\u00a0<span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span>_pendingTimedCalls<span class=\"p\">[</span><span class=\"mi\">0</span><span class=\"p\">]</span><span class=\"o\">.</span>time <span class=\"o\">&lt;=</span>\u00a0now<span class=\"p\">):</span></td></tr><tr><th id=\"L549\"><a href=\"#L549\">549</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 call <span class=\"o\">=</span>\u00a0heappop<span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span>_pendingTimedCalls<span class=\"p\">)</span></td></tr><tr><th id=\"L550\"><a href=\"#L550\">550</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">if</span>\u00a0call<span class=\"o\">.</span>cancelled<span class=\"p\">:</span></td></tr><tr><th id=\"L551\"><a href=\"#L551\">551</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"bp\">self</span><span class=\"o\">.</span>_cancellations<span class=\"o\">-=</span><span class=\"mi\">1</span></td></tr><tr><th id=\"L552\"><a href=\"#L552\">552</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">continue</span></td></tr><tr><th id=\"L553\"><a href=\"#L553\">553</a></th><td></td></tr><tr><th id=\"L554\"><a href=\"#L554\">554</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">if</span>\u00a0call<span class=\"o\">.</span>delayed_time <span class=\"o\">&gt;</span>\u00a0<span class=\"mi\">0</span><span class=\"p\">:</span></td></tr><tr><th id=\"L555\"><a href=\"#L555\">555</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 call<span class=\"o\">.</span>activate_delay<span class=\"p\">()</span></td></tr><tr><th id=\"L556\"><a href=\"#L556\">556</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 heappush<span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span>_pendingTimedCalls<span class=\"p\">,</span>\u00a0call<span class=\"p\">)</span></td></tr><tr><th id=\"L557\"><a href=\"#L557\">557</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">continue</span></td></tr><tr><th id=\"L558\"><a href=\"#L558\">558</a></th><td></td></tr><tr><th id=\"L559\"><a href=\"#L559\">559</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">try</span><span class=\"p\">:</span></td></tr><tr><th id=\"L560\"><a href=\"#L560\">560</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 call<span class=\"o\">.</span>called <span class=\"o\">=</span>\u00a0<span class=\"mi\">1</span></td></tr><tr><th id=\"L561\"><a href=\"#L561\">561</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 call<span class=\"o\">.</span>func<span class=\"p\">(</span><span class=\"o\">*</span>call<span class=\"o\">.</span>args<span class=\"p\">,</span>\u00a0<span class=\"o\">**</span>call<span class=\"o\">.</span>kw<span class=\"p\">)</span></td></tr><tr><th id=\"L562\"><a href=\"#L562\">562</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">except</span><span class=\"p\">:</span></td></tr><tr><th id=\"L563\"><a href=\"#L563\">563</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 log<span class=\"o\">.</span>deferr<span class=\"p\">()</span></td></tr><tr><th id=\"L564\"><a href=\"#L564\">564</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">if</span>\u00a0<span class=\"nb\">hasattr</span><span class=\"p\">(</span>call<span class=\"p\">,</span>\u00a0<span class=\"s\">\"creator\"</span><span class=\"p\">):</span></td></tr><tr><th id=\"L565\"><a href=\"#L565\">565</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 e <span class=\"o\">=</span>\u00a0<span class=\"s\">\"</span><span class=\"se\">\\n</span><span class=\"s\">\"</span></td></tr><tr><th id=\"L566\"><a href=\"#L566\">566</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 e <span class=\"o\">+=</span>\u00a0<span class=\"s\">\" C: previous exception occurred in \"</span>\u00a0<span class=\"o\">+</span>\u00a0\\</td></tr><tr><th id=\"L567\"><a href=\"#L567\">567</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0<span class=\"s\">\"a DelayedCall created here:</span><span class=\"se\">\\n</span><span class=\"s\">\"</span></td></tr><tr><th id=\"L568\"><a href=\"#L568\">568</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 e <span class=\"o\">+=</span>\u00a0<span class=\"s\">\" C:\"</span></td></tr><tr><th id=\"L569\"><a href=\"#L569\">569</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 e <span class=\"o\">+=</span>\u00a0<span class=\"s\">\"\"</span><span class=\"o\">.</span>join<span class=\"p\">(</span>call<span class=\"o\">.</span>creator<span class=\"p\">)</span><span class=\"o\">.</span>rstrip<span class=\"p\">()</span><span class=\"o\">.</span>replace<span class=\"p\">(</span><span class=\"s\">\"</span><span class=\"se\">\\n</span><span class=\"s\">\"</span><span class=\"p\">,</span><span class=\"s\">\"</span><span class=\"se\">\\n</span><span class=\"s\">\u00a0C:\"</span><span class=\"p\">)</span></td></tr><tr><th id=\"L570\"><a href=\"#L570\">570</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 e <span class=\"o\">+=</span>\u00a0<span class=\"s\">\"</span><span class=\"se\">\\n</span><span class=\"s\">\"</span></td></tr><tr><th id=\"L571\"><a href=\"#L571\">571</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 log<span class=\"o\">.</span>msg<span class=\"p\">(</span>e<span class=\"p\">)</span></td></tr><tr><th id=\"L572\"><a href=\"#L572\">572</a></th><td></td></tr><tr><th id=\"L573\"><a href=\"#L573\">573</a></th><td></td></tr><tr><th id=\"L574\"><a href=\"#L574\">574</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">if</span>\u00a0<span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span>_cancellations <span class=\"o\">&gt;</span>\u00a0<span class=\"mi\">50</span>\u00a0<span class=\"ow\">and</span></td></tr><tr><th id=\"L575\"><a href=\"#L575\">575</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0<span class=\"bp\">self</span><span class=\"o\">.</span>_cancellations <span class=\"o\">&gt;</span>\u00a0<span class=\"nb\">len</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span>_pendingTimedCalls<span class=\"p\">)</span>\u00a0<span class=\"o\">&gt;&gt;</span>\u00a0<span class=\"mi\">1</span><span class=\"p\">):</span></td></tr><tr><th id=\"L576\"><a href=\"#L576\">576</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"bp\">self</span><span class=\"o\">.</span>_cancellations <span class=\"o\">=</span>\u00a0<span class=\"mi\">0</span></td></tr><tr><th id=\"L577\"><a href=\"#L577\">577</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"bp\">self</span><span class=\"o\">.</span>_pendingTimedCalls <span class=\"o\">=</span>\u00a0<span class=\"p\">[</span>x <span class=\"k\">for</span>\u00a0x <span class=\"ow\">in</span>\u00a0<span class=\"bp\">self</span><span class=\"o\">.</span>_pendingTimedCalls</td></tr><tr><th id=\"L578\"><a href=\"#L578\">578</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0<span class=\"k\">if</span>\u00a0<span class=\"ow\">not</span>\u00a0x<span class=\"o\">.</span>cancelled<span class=\"p\">]</span></td></tr><tr><th id=\"L579\"><a href=\"#L579\">579</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 heapify<span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span>_pendingTimedCalls<span class=\"p\">)</span></td></tr><tr><th id=\"L580\"><a href=\"#L580\">580</a></th><td></td></tr><tr><th id=\"L581\"><a href=\"#L581\">581</a></th><td>\u00a0 \u00a0 <span class=\"c\"># IReactorThreads</span></td></tr><tr><th id=\"L582\"><a href=\"#L582\">582</a></th><td>\u00a0 \u00a0 <span class=\"k\">if</span>\u00a0platform<span class=\"o\">.</span>supportsThreads<span class=\"p\">():</span></td></tr><tr><th id=\"L583\"><a href=\"#L583\">583</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 threadpool <span class=\"o\">=</span>\u00a0<span class=\"bp\">None</span></td></tr><tr><th id=\"L584\"><a href=\"#L584\">584</a></th><td></td></tr><tr><th id=\"L585\"><a href=\"#L585\">585</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">def</span>\u00a0<span class=\"nf\">_initThreads</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">):</span></td></tr><tr><th id=\"L586\"><a href=\"#L586\">586</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"bp\">self</span><span class=\"o\">.</span>usingThreads <span class=\"o\">=</span>\u00a0<span class=\"mi\">1</span></td></tr><tr><th id=\"L587\"><a href=\"#L587\">587</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"bp\">self</span><span class=\"o\">.</span>resolver <span class=\"o\">=</span>\u00a0ThreadedResolver<span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">)</span></td></tr><tr><th id=\"L588\"><a href=\"#L588\">588</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"bp\">self</span><span class=\"o\">.</span>installWaker<span class=\"p\">()</span></td></tr><tr><th id=\"L589\"><a href=\"#L589\">589</a></th><td></td></tr><tr><th id=\"L590\"><a href=\"#L590\">590</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">def</span>\u00a0<span class=\"nf\">callFromThread</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span>\u00a0f<span class=\"p\">,</span>\u00a0<span class=\"o\">*</span>args<span class=\"p\">,</span>\u00a0<span class=\"o\">**</span>kw<span class=\"p\">):</span></td></tr><tr><th id=\"L591\"><a href=\"#L591\">591</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"sd\">\"\"\"See twisted.internet.interfaces.IReactorThreads.callFromThread.</span></td></tr><tr><th id=\"L592\"><a href=\"#L592\">592</a></th><td><span class=\"sd\">\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \"\"\"</span></td></tr><tr><th id=\"L593\"><a href=\"#L593\">593</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">assert</span>\u00a0<span class=\"nb\">callable</span><span class=\"p\">(</span>f<span class=\"p\">),</span>\u00a0<span class=\"s\">\"</span><span class=\"si\">%s</span><span class=\"s\">\u00a0is not callable\"</span>\u00a0<span class=\"o\">%</span>\u00a0<span class=\"p\">(</span>f<span class=\"p\">,)</span></td></tr><tr><th id=\"L594\"><a href=\"#L594\">594</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"c\"># lists are thread-safe in CPython, but not in Jython</span></td></tr><tr><th id=\"L595\"><a href=\"#L595\">595</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"c\"># this is probably a bug in Jython, but until fixed this code</span></td></tr><tr><th id=\"L596\"><a href=\"#L596\">596</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"c\"># won't work in Jython.</span></td></tr><tr><th id=\"L597\"><a href=\"#L597\">597</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"bp\">self</span><span class=\"o\">.</span>threadCallQueue<span class=\"o\">.</span>append<span class=\"p\">((</span>f<span class=\"p\">,</span>\u00a0args<span class=\"p\">,</span>\u00a0kw<span class=\"p\">))</span></td></tr><tr><th id=\"L598\"><a href=\"#L598\">598</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"bp\">self</span><span class=\"o\">.</span>wakeUp<span class=\"p\">()</span></td></tr><tr><th id=\"L599\"><a href=\"#L599\">599</a></th><td></td></tr><tr><th id=\"L600\"><a href=\"#L600\">600</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">def</span>\u00a0<span class=\"nf\">_initThreadPool</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">):</span></td></tr><tr><th id=\"L601\"><a href=\"#L601\">601</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"kn\">from</span>\u00a0<span class=\"nn\">twisted.python</span>\u00a0<span class=\"kn\">import</span>\u00a0threadpool</td></tr><tr><th id=\"L602\"><a href=\"#L602\">602</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"bp\">self</span><span class=\"o\">.</span>threadpool <span class=\"o\">=</span>\u00a0threadpool<span class=\"o\">.</span>ThreadPool<span class=\"p\">(</span><span class=\"mi\">0</span><span class=\"p\">,</span>\u00a0<span class=\"mi\">10</span><span class=\"p\">,</span>\u00a0<span class=\"s\">'twisted.internet.reactor'</span><span class=\"p\">)</span></td></tr><tr><th id=\"L603\"><a href=\"#L603\">603</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"bp\">self</span><span class=\"o\">.</span>callWhenRunning<span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span>threadpool<span class=\"o\">.</span>start<span class=\"p\">)</span></td></tr><tr><th id=\"L604\"><a href=\"#L604\">604</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"bp\">self</span><span class=\"o\">.</span>addSystemEventTrigger<span class=\"p\">(</span><span class=\"s\">'during'</span><span class=\"p\">,</span>\u00a0<span class=\"s\">'shutdown'</span><span class=\"p\">,</span>\u00a0<span class=\"bp\">self</span><span class=\"o\">.</span>threadpool<span class=\"o\">.</span>stop<span class=\"p\">)</span></td></tr><tr><th id=\"L605\"><a href=\"#L605\">605</a></th><td></td></tr><tr><th id=\"L606\"><a href=\"#L606\">606</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">def</span>\u00a0<span class=\"nf\">callInThread</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span>\u00a0_callable<span class=\"p\">,</span>\u00a0<span class=\"o\">*</span>args<span class=\"p\">,</span>\u00a0<span class=\"o\">**</span>kwargs<span class=\"p\">):</span></td></tr><tr><th id=\"L607\"><a href=\"#L607\">607</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"sd\">\"\"\"See twisted.internet.interfaces.IReactorThreads.callInThread.</span></td></tr><tr><th id=\"L608\"><a href=\"#L608\">608</a></th><td><span class=\"sd\">\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \"\"\"</span></td></tr><tr><th id=\"L609\"><a href=\"#L609\">609</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">if</span>\u00a0<span class=\"bp\">self</span><span class=\"o\">.</span>threadpool <span class=\"ow\">is</span>\u00a0<span class=\"bp\">None</span><span class=\"p\">:</span></td></tr><tr><th id=\"L610\"><a href=\"#L610\">610</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"bp\">self</span><span class=\"o\">.</span>_initThreadPool<span class=\"p\">()</span></td></tr><tr><th id=\"L611\"><a href=\"#L611\">611</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"bp\">self</span><span class=\"o\">.</span>threadpool<span class=\"o\">.</span>callInThread<span class=\"p\">(</span>_callable<span class=\"p\">,</span>\u00a0<span class=\"o\">*</span>args<span class=\"p\">,</span>\u00a0<span class=\"o\">**</span>kwargs<span class=\"p\">)</span></td></tr><tr><th id=\"L612\"><a href=\"#L612\">612</a></th><td></td></tr><tr><th id=\"L613\"><a href=\"#L613\">613</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">def</span>\u00a0<span class=\"nf\">suggestThreadPoolSize</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span>\u00a0size<span class=\"p\">):</span></td></tr><tr><th id=\"L614\"><a href=\"#L614\">614</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"sd\">\"\"\"See twisted.internet.interfaces.IReactorThreads.suggestThreadPoolSize.</span></td></tr><tr><th id=\"L615\"><a href=\"#L615\">615</a></th><td><span class=\"sd\">\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \"\"\"</span></td></tr><tr><th id=\"L616\"><a href=\"#L616\">616</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">if</span>\u00a0size <span class=\"o\">==</span>\u00a0<span class=\"mi\">0</span>\u00a0<span class=\"ow\">and</span>\u00a0<span class=\"ow\">not</span>\u00a0<span class=\"bp\">self</span><span class=\"o\">.</span>threadpool<span class=\"p\">:</span></td></tr><tr><th id=\"L617\"><a href=\"#L617\">617</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">return</span></td></tr><tr><th id=\"L618\"><a href=\"#L618\">618</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">if</span>\u00a0<span class=\"ow\">not</span>\u00a0<span class=\"bp\">self</span><span class=\"o\">.</span>threadpool<span class=\"p\">:</span></td></tr><tr><th id=\"L619\"><a href=\"#L619\">619</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"bp\">self</span><span class=\"o\">.</span>_initThreadPool<span class=\"p\">()</span></td></tr><tr><th id=\"L620\"><a href=\"#L620\">620</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"bp\">self</span><span class=\"o\">.</span>threadpool<span class=\"o\">.</span>adjustPoolsize<span class=\"p\">(</span>maxthreads<span class=\"o\">=</span>size<span class=\"p\">)</span></td></tr><tr><th id=\"L621\"><a href=\"#L621\">621</a></th><td>\u00a0 \u00a0 <span class=\"k\">else</span><span class=\"p\">:</span></td></tr><tr><th id=\"L622\"><a href=\"#L622\">622</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"c\"># This is for signal handlers.</span></td></tr><tr><th id=\"L623\"><a href=\"#L623\">623</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">def</span>\u00a0<span class=\"nf\">callFromThread</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span>\u00a0f<span class=\"p\">,</span>\u00a0<span class=\"o\">*</span>args<span class=\"p\">,</span>\u00a0<span class=\"o\">**</span>kw<span class=\"p\">):</span></td></tr><tr><th id=\"L624\"><a href=\"#L624\">624</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">assert</span>\u00a0<span class=\"nb\">callable</span><span class=\"p\">(</span>f<span class=\"p\">),</span>\u00a0<span class=\"s\">\"</span><span class=\"si\">%s</span><span class=\"s\">\u00a0is not callable\"</span>\u00a0<span class=\"o\">%</span>\u00a0<span class=\"p\">(</span>f<span class=\"p\">,)</span></td></tr><tr><th id=\"L625\"><a href=\"#L625\">625</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"c\"># See comment in the other callFromThread implementation.</span></td></tr><tr><th id=\"L626\"><a href=\"#L626\">626</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"bp\">self</span><span class=\"o\">.</span>threadCallQueue<span class=\"o\">.</span>append<span class=\"p\">((</span>f<span class=\"p\">,</span>\u00a0args<span class=\"p\">,</span>\u00a0kw<span class=\"p\">))</span></td></tr><tr><th id=\"L627\"><a href=\"#L627\">627</a></th><td></td></tr><tr><th id=\"L628\"><a href=\"#L628\">628</a></th><td><span class=\"k\">if</span>\u00a0platform<span class=\"o\">.</span>supportsThreads<span class=\"p\">():</span></td></tr><tr><th id=\"L629\"><a href=\"#L629\">629</a></th><td>\u00a0 \u00a0 classImplements<span class=\"p\">(</span>ReactorBase<span class=\"p\">,</span>\u00a0IReactorThreads<span class=\"p\">)</span></td></tr><tr><th id=\"L630\"><a href=\"#L630\">630</a></th><td></td></tr><tr><th id=\"L631\"><a href=\"#L631\">631</a></th><td></td></tr><tr><th id=\"L632\"><a href=\"#L632\">632</a></th><td><span class=\"k\">class</span>\u00a0<span class=\"nc\">BaseConnector</span><span class=\"p\">(</span>styles<span class=\"o\">.</span>Ephemeral<span class=\"p\">):</span></td></tr><tr><th id=\"L633\"><a href=\"#L633\">633</a></th><td>\u00a0 \u00a0 <span class=\"sd\">\"\"\"Basic implementation of connector.</span></td></tr><tr><th id=\"L634\"><a href=\"#L634\">634</a></th><td><span class=\"sd\"></span></td></tr><tr><th id=\"L635\"><a href=\"#L635\">635</a></th><td><span class=\"sd\">\u00a0 \u00a0 State can be: \"connecting\", \"connected\", \"disconnected\"</span></td></tr><tr><th id=\"L636\"><a href=\"#L636\">636</a></th><td><span class=\"sd\">\u00a0 \u00a0 \"\"\"</span></td></tr><tr><th id=\"L637\"><a href=\"#L637\">637</a></th><td></td></tr><tr><th id=\"L638\"><a href=\"#L638\">638</a></th><td>\u00a0 \u00a0 implements<span class=\"p\">(</span>IConnector<span class=\"p\">)</span></td></tr><tr><th id=\"L639\"><a href=\"#L639\">639</a></th><td></td></tr><tr><th id=\"L640\"><a href=\"#L640\">640</a></th><td>\u00a0 \u00a0 timeoutID <span class=\"o\">=</span>\u00a0<span class=\"bp\">None</span></td></tr><tr><th id=\"L641\"><a href=\"#L641\">641</a></th><td>\u00a0 \u00a0 factoryStarted <span class=\"o\">=</span>\u00a0<span class=\"mi\">0</span></td></tr><tr><th id=\"L642\"><a href=\"#L642\">642</a></th><td></td></tr><tr><th id=\"L643\"><a href=\"#L643\">643</a></th><td>\u00a0 \u00a0 <span class=\"k\">def</span>\u00a0<span class=\"nf\">__init__</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span>\u00a0factory<span class=\"p\">,</span>\u00a0timeout<span class=\"p\">,</span>\u00a0reactor<span class=\"p\">):</span></td></tr><tr><th id=\"L644\"><a href=\"#L644\">644</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"bp\">self</span><span class=\"o\">.</span>state <span class=\"o\">=</span>\u00a0<span class=\"s\">\"disconnected\"</span></td></tr><tr><th id=\"L645\"><a href=\"#L645\">645</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"bp\">self</span><span class=\"o\">.</span>reactor <span class=\"o\">=</span>\u00a0reactor</td></tr><tr><th id=\"L646\"><a href=\"#L646\">646</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"bp\">self</span><span class=\"o\">.</span>factory <span class=\"o\">=</span>\u00a0factory</td></tr><tr><th id=\"L647\"><a href=\"#L647\">647</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"bp\">self</span><span class=\"o\">.</span>timeout <span class=\"o\">=</span>\u00a0timeout</td></tr><tr><th id=\"L648\"><a href=\"#L648\">648</a></th><td></td></tr><tr><th id=\"L649\"><a href=\"#L649\">649</a></th><td>\u00a0 \u00a0 <span class=\"k\">def</span>\u00a0<span class=\"nf\">disconnect</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">):</span></td></tr><tr><th id=\"L650\"><a href=\"#L650\">650</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"sd\">\"\"\"Disconnect whatever our state is.\"\"\"</span></td></tr><tr><th id=\"L651\"><a href=\"#L651\">651</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">if</span>\u00a0<span class=\"bp\">self</span><span class=\"o\">.</span>state <span class=\"o\">==</span>\u00a0<span class=\"s\">'connecting'</span><span class=\"p\">:</span></td></tr><tr><th id=\"L652\"><a href=\"#L652\">652</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"bp\">self</span><span class=\"o\">.</span>stopConnecting<span class=\"p\">()</span></td></tr><tr><th id=\"L653\"><a href=\"#L653\">653</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">elif</span>\u00a0<span class=\"bp\">self</span><span class=\"o\">.</span>state <span class=\"o\">==</span>\u00a0<span class=\"s\">'connected'</span><span class=\"p\">:</span></td></tr><tr><th id=\"L654\"><a href=\"#L654\">654</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"bp\">self</span><span class=\"o\">.</span>transport<span class=\"o\">.</span>loseConnection<span class=\"p\">()</span></td></tr><tr><th id=\"L655\"><a href=\"#L655\">655</a></th><td></td></tr><tr><th id=\"L656\"><a href=\"#L656\">656</a></th><td>\u00a0 \u00a0 <span class=\"k\">def</span>\u00a0<span class=\"nf\">connect</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">):</span></td></tr><tr><th id=\"L657\"><a href=\"#L657\">657</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"sd\">\"\"\"Start connection to remote server.\"\"\"</span></td></tr><tr><th id=\"L658\"><a href=\"#L658\">658</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">if</span>\u00a0<span class=\"bp\">self</span><span class=\"o\">.</span>state <span class=\"o\">!=</span>\u00a0<span class=\"s\">\"disconnected\"</span><span class=\"p\">:</span></td></tr><tr><th id=\"L659\"><a href=\"#L659\">659</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">raise</span>\u00a0<span class=\"ne\">RuntimeError</span><span class=\"p\">,</span>\u00a0<span class=\"s\">\"can't connect in this state\"</span></td></tr><tr><th id=\"L660\"><a href=\"#L660\">660</a></th><td></td></tr><tr><th id=\"L661\"><a href=\"#L661\">661</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"bp\">self</span><span class=\"o\">.</span>state <span class=\"o\">=</span>\u00a0<span class=\"s\">\"connecting\"</span></td></tr><tr><th id=\"L662\"><a href=\"#L662\">662</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">if</span>\u00a0<span class=\"ow\">not</span>\u00a0<span class=\"bp\">self</span><span class=\"o\">.</span>factoryStarted<span class=\"p\">:</span></td></tr><tr><th id=\"L663\"><a href=\"#L663\">663</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"bp\">self</span><span class=\"o\">.</span>factory<span class=\"o\">.</span>doStart<span class=\"p\">()</span></td></tr><tr><th id=\"L664\"><a href=\"#L664\">664</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"bp\">self</span><span class=\"o\">.</span>factoryStarted <span class=\"o\">=</span>\u00a0<span class=\"mi\">1</span></td></tr><tr><th id=\"L665\"><a href=\"#L665\">665</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"bp\">self</span><span class=\"o\">.</span>transport <span class=\"o\">=</span>\u00a0transport <span class=\"o\">=</span>\u00a0<span class=\"bp\">self</span><span class=\"o\">.</span>_makeTransport<span class=\"p\">()</span></td></tr><tr><th id=\"L666\"><a href=\"#L666\">666</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">if</span>\u00a0<span class=\"bp\">self</span><span class=\"o\">.</span>timeout <span class=\"ow\">is</span>\u00a0<span class=\"ow\">not</span>\u00a0<span class=\"bp\">None</span><span class=\"p\">:</span></td></tr><tr><th id=\"L667\"><a href=\"#L667\">667</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"bp\">self</span><span class=\"o\">.</span>timeoutID <span class=\"o\">=</span>\u00a0<span class=\"bp\">self</span><span class=\"o\">.</span>reactor<span class=\"o\">.</span>callLater<span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span>timeout<span class=\"p\">,</span>\u00a0transport<span class=\"o\">.</span>failIfNotConnected<span class=\"p\">,</span>\u00a0error<span class=\"o\">.</span>TimeoutError<span class=\"p\">())</span></td></tr><tr><th id=\"L668\"><a href=\"#L668\">668</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"bp\">self</span><span class=\"o\">.</span>factory<span class=\"o\">.</span>startedConnecting<span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">)</span></td></tr><tr><th id=\"L669\"><a href=\"#L669\">669</a></th><td></td></tr><tr><th id=\"L670\"><a href=\"#L670\">670</a></th><td>\u00a0 \u00a0 <span class=\"k\">def</span>\u00a0<span class=\"nf\">stopConnecting</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">):</span></td></tr><tr><th id=\"L671\"><a href=\"#L671\">671</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"sd\">\"\"\"Stop attempting to connect.\"\"\"</span></td></tr><tr><th id=\"L672\"><a href=\"#L672\">672</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">if</span>\u00a0<span class=\"bp\">self</span><span class=\"o\">.</span>state <span class=\"o\">!=</span>\u00a0<span class=\"s\">\"connecting\"</span><span class=\"p\">:</span></td></tr><tr><th id=\"L673\"><a href=\"#L673\">673</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">raise</span>\u00a0error<span class=\"o\">.</span>NotConnectingError<span class=\"p\">,</span>\u00a0<span class=\"s\">\"we're not trying to connect\"</span></td></tr><tr><th id=\"L674\"><a href=\"#L674\">674</a></th><td></td></tr><tr><th id=\"L675\"><a href=\"#L675\">675</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"bp\">self</span><span class=\"o\">.</span>state <span class=\"o\">=</span>\u00a0<span class=\"s\">\"disconnected\"</span></td></tr><tr><th id=\"L676\"><a href=\"#L676\">676</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"bp\">self</span><span class=\"o\">.</span>transport<span class=\"o\">.</span>failIfNotConnected<span class=\"p\">(</span>error<span class=\"o\">.</span>UserError<span class=\"p\">())</span></td></tr><tr><th id=\"L677\"><a href=\"#L677\">677</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">del</span>\u00a0<span class=\"bp\">self</span><span class=\"o\">.</span>transport</td></tr><tr><th id=\"L678\"><a href=\"#L678\">678</a></th><td></td></tr><tr><th id=\"L679\"><a href=\"#L679\">679</a></th><td>\u00a0 \u00a0 <span class=\"k\">def</span>\u00a0<span class=\"nf\">cancelTimeout</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">):</span></td></tr><tr><th id=\"L680\"><a href=\"#L680\">680</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">if</span>\u00a0<span class=\"bp\">self</span><span class=\"o\">.</span>timeoutID <span class=\"ow\">is</span>\u00a0<span class=\"ow\">not</span>\u00a0<span class=\"bp\">None</span><span class=\"p\">:</span></td></tr><tr><th id=\"L681\"><a href=\"#L681\">681</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">try</span><span class=\"p\">:</span></td></tr><tr><th id=\"L682\"><a href=\"#L682\">682</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"bp\">self</span><span class=\"o\">.</span>timeoutID<span class=\"o\">.</span>cancel<span class=\"p\">()</span></td></tr><tr><th id=\"L683\"><a href=\"#L683\">683</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">except</span>\u00a0<span class=\"ne\">ValueError</span><span class=\"p\">:</span></td></tr><tr><th id=\"L684\"><a href=\"#L684\">684</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">pass</span></td></tr><tr><th id=\"L685\"><a href=\"#L685\">685</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">del</span>\u00a0<span class=\"bp\">self</span><span class=\"o\">.</span>timeoutID</td></tr><tr><th id=\"L686\"><a href=\"#L686\">686</a></th><td></td></tr><tr><th id=\"L687\"><a href=\"#L687\">687</a></th><td>\u00a0 \u00a0 <span class=\"k\">def</span>\u00a0<span class=\"nf\">buildProtocol</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span>\u00a0addr<span class=\"p\">):</span></td></tr><tr><th id=\"L688\"><a href=\"#L688\">688</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"bp\">self</span><span class=\"o\">.</span>state <span class=\"o\">=</span>\u00a0<span class=\"s\">\"connected\"</span></td></tr><tr><th id=\"L689\"><a href=\"#L689\">689</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"bp\">self</span><span class=\"o\">.</span>cancelTimeout<span class=\"p\">()</span></td></tr><tr><th id=\"L690\"><a href=\"#L690\">690</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">return</span>\u00a0<span class=\"bp\">self</span><span class=\"o\">.</span>factory<span class=\"o\">.</span>buildProtocol<span class=\"p\">(</span>addr<span class=\"p\">)</span></td></tr><tr><th id=\"L691\"><a href=\"#L691\">691</a></th><td></td></tr><tr><th id=\"L692\"><a href=\"#L692\">692</a></th><td>\u00a0 \u00a0 <span class=\"k\">def</span>\u00a0<span class=\"nf\">connectionFailed</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span>\u00a0reason<span class=\"p\">):</span></td></tr><tr><th id=\"L693\"><a href=\"#L693\">693</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"bp\">self</span><span class=\"o\">.</span>cancelTimeout<span class=\"p\">()</span></td></tr><tr><th id=\"L694\"><a href=\"#L694\">694</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"bp\">self</span><span class=\"o\">.</span>transport <span class=\"o\">=</span>\u00a0<span class=\"bp\">None</span></td></tr><tr><th id=\"L695\"><a href=\"#L695\">695</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"bp\">self</span><span class=\"o\">.</span>state <span class=\"o\">=</span>\u00a0<span class=\"s\">\"disconnected\"</span></td></tr><tr><th id=\"L696\"><a href=\"#L696\">696</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"bp\">self</span><span class=\"o\">.</span>factory<span class=\"o\">.</span>clientConnectionFailed<span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span>\u00a0reason<span class=\"p\">)</span></td></tr><tr><th id=\"L697\"><a href=\"#L697\">697</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">if</span>\u00a0<span class=\"bp\">self</span><span class=\"o\">.</span>state <span class=\"o\">==</span>\u00a0<span class=\"s\">\"disconnected\"</span><span class=\"p\">:</span></td></tr><tr><th id=\"L698\"><a href=\"#L698\">698</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"c\"># factory hasn't called our connect() method</span></td></tr><tr><th id=\"L699\"><a href=\"#L699\">699</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"bp\">self</span><span class=\"o\">.</span>factory<span class=\"o\">.</span>doStop<span class=\"p\">()</span></td></tr><tr><th id=\"L700\"><a href=\"#L700\">700</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"bp\">self</span><span class=\"o\">.</span>factoryStarted <span class=\"o\">=</span>\u00a0<span class=\"mi\">0</span></td></tr><tr><th id=\"L701\"><a href=\"#L701\">701</a></th><td></td></tr><tr><th id=\"L702\"><a href=\"#L702\">702</a></th><td>\u00a0 \u00a0 <span class=\"k\">def</span>\u00a0<span class=\"nf\">connectionLost</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span>\u00a0reason<span class=\"p\">):</span></td></tr><tr><th id=\"L703\"><a href=\"#L703\">703</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"bp\">self</span><span class=\"o\">.</span>state <span class=\"o\">=</span>\u00a0<span class=\"s\">\"disconnected\"</span></td></tr><tr><th id=\"L704\"><a href=\"#L704\">704</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"bp\">self</span><span class=\"o\">.</span>factory<span class=\"o\">.</span>clientConnectionLost<span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span>\u00a0reason<span class=\"p\">)</span></td></tr><tr><th id=\"L705\"><a href=\"#L705\">705</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">if</span>\u00a0<span class=\"bp\">self</span><span class=\"o\">.</span>state <span class=\"o\">==</span>\u00a0<span class=\"s\">\"disconnected\"</span><span class=\"p\">:</span></td></tr><tr><th id=\"L706\"><a href=\"#L706\">706</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"c\"># factory hasn't called our connect() method</span></td></tr><tr><th id=\"L707\"><a href=\"#L707\">707</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"bp\">self</span><span class=\"o\">.</span>factory<span class=\"o\">.</span>doStop<span class=\"p\">()</span></td></tr><tr><th id=\"L708\"><a href=\"#L708\">708</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"bp\">self</span><span class=\"o\">.</span>factoryStarted <span class=\"o\">=</span>\u00a0<span class=\"mi\">0</span></td></tr><tr><th id=\"L709\"><a href=\"#L709\">709</a></th><td></td></tr><tr><th id=\"L710\"><a href=\"#L710\">710</a></th><td>\u00a0 \u00a0 <span class=\"k\">def</span>\u00a0<span class=\"nf\">getDestination</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">):</span></td></tr><tr><th id=\"L711\"><a href=\"#L711\">711</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">raise</span>\u00a0<span class=\"ne\">NotImplementedError</span><span class=\"p\">,</span>\u00a0<span class=\"s\">\"implement in subclasses\"</span></td></tr><tr><th id=\"L712\"><a href=\"#L712\">712</a></th><td></td></tr><tr><th id=\"L713\"><a href=\"#L713\">713</a></th><td></td></tr><tr><th id=\"L714\"><a href=\"#L714\">714</a></th><td><span class=\"k\">class</span>\u00a0<span class=\"nc\">BasePort</span><span class=\"p\">(</span>abstract<span class=\"o\">.</span>FileDescriptor<span class=\"p\">):</span></td></tr><tr><th id=\"L715\"><a href=\"#L715\">715</a></th><td>\u00a0 \u00a0 <span class=\"sd\">\"\"\"Basic implementation of a ListeningPort.</span></td></tr><tr><th id=\"L716\"><a href=\"#L716\">716</a></th><td><span class=\"sd\"></span></td></tr><tr><th id=\"L717\"><a href=\"#L717\">717</a></th><td><span class=\"sd\">\u00a0 \u00a0 Note: This does not actually implement IListeningPort.</span></td></tr><tr><th id=\"L718\"><a href=\"#L718\">718</a></th><td><span class=\"sd\">\u00a0 \u00a0 \"\"\"</span></td></tr><tr><th id=\"L719\"><a href=\"#L719\">719</a></th><td></td></tr><tr><th id=\"L720\"><a href=\"#L720\">720</a></th><td>\u00a0 \u00a0 addressFamily <span class=\"o\">=</span>\u00a0<span class=\"bp\">None</span></td></tr><tr><th id=\"L721\"><a href=\"#L721\">721</a></th><td>\u00a0 \u00a0 socketType <span class=\"o\">=</span>\u00a0<span class=\"bp\">None</span></td></tr><tr><th id=\"L722\"><a href=\"#L722\">722</a></th><td></td></tr><tr><th id=\"L723\"><a href=\"#L723\">723</a></th><td>\u00a0 \u00a0 <span class=\"k\">def</span>\u00a0<span class=\"nf\">createInternetSocket</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">):</span></td></tr><tr><th id=\"L724\"><a href=\"#L724\">724</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 s <span class=\"o\">=</span>\u00a0socket<span class=\"o\">.</span>socket<span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span>addressFamily<span class=\"p\">,</span>\u00a0<span class=\"bp\">self</span><span class=\"o\">.</span>socketType<span class=\"p\">)</span></td></tr><tr><th id=\"L725\"><a href=\"#L725\">725</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 s<span class=\"o\">.</span>setblocking<span class=\"p\">(</span><span class=\"mi\">0</span><span class=\"p\">)</span></td></tr><tr><th id=\"L726\"><a href=\"#L726\">726</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">if</span>\u00a0fcntl <span class=\"ow\">and</span>\u00a0<span class=\"nb\">hasattr</span><span class=\"p\">(</span>fcntl<span class=\"p\">,</span>\u00a0<span class=\"s\">'FD_CLOEXEC'</span><span class=\"p\">):</span></td></tr><tr><th id=\"L727\"><a href=\"#L727\">727</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 old <span class=\"o\">=</span>\u00a0fcntl<span class=\"o\">.</span>fcntl<span class=\"p\">(</span>s<span class=\"o\">.</span>fileno<span class=\"p\">(),</span>\u00a0fcntl<span class=\"o\">.</span>F_GETFD<span class=\"p\">)</span></td></tr><tr><th id=\"L728\"><a href=\"#L728\">728</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 fcntl<span class=\"o\">.</span>fcntl<span class=\"p\">(</span>s<span class=\"o\">.</span>fileno<span class=\"p\">(),</span>\u00a0fcntl<span class=\"o\">.</span>F_SETFD<span class=\"p\">,</span>\u00a0old <span class=\"o\">|</span>\u00a0fcntl<span class=\"o\">.</span>FD_CLOEXEC<span class=\"p\">)</span></td></tr><tr><th id=\"L729\"><a href=\"#L729\">729</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">return</span>\u00a0s</td></tr><tr><th id=\"L730\"><a href=\"#L730\">730</a></th><td></td></tr><tr><th id=\"L731\"><a href=\"#L731\">731</a></th><td></td></tr><tr><th id=\"L732\"><a href=\"#L732\">732</a></th><td>\u00a0 \u00a0 <span class=\"k\">def</span>\u00a0<span class=\"nf\">doWrite</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">):</span></td></tr><tr><th id=\"L733\"><a href=\"#L733\">733</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"sd\">\"\"\"Raises a RuntimeError\"\"\"</span></td></tr><tr><th id=\"L734\"><a href=\"#L734\">734</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">raise</span>\u00a0<span class=\"ne\">RuntimeError</span><span class=\"p\">,</span>\u00a0<span class=\"s\">\"doWrite called on a </span><span class=\"si\">%s</span><span class=\"s\">\"</span>\u00a0<span class=\"o\">%</span>\u00a0reflect<span class=\"o\">.</span>qual<span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span>__class__<span class=\"p\">)</span></td></tr><tr><th id=\"L735\"><a href=\"#L735\">735</a></th><td></td></tr><tr><th id=\"L736\"><a href=\"#L736\">736</a></th><td></td></tr><tr><th id=\"L737\"><a href=\"#L737\">737</a></th><td>__all__ <span class=\"o\">=</span>\u00a0<span class=\"p\">[]</span></td></tr></tbody></table>\n\n      </div>\n      <div id=\"anydiff\">\n        <form action=\"/LUCICodeRepository/nomaticIM/diff\" method=\"get\">\n          <div class=\"buttons\">\n            <input type=\"hidden\" name=\"new_path\" value=\"/nomatic/tags/NomaticIM-0.0.5/buddy_bots/src/twisted/internet/base.py\" />\n            <input type=\"hidden\" name=\"old_path\" value=\"/nomatic/tags/NomaticIM-0.0.5/buddy_bots/src/twisted/internet/base.py\" />\n            <input type=\"hidden\" name=\"new_rev\" />\n            <input type=\"hidden\" name=\"old_rev\" />\n            <input type=\"submit\" value=\"View changes...\" title=\"Select paths and revs for Diff\" />\n          </div>\n        </form>\n      </div>\n      <div id=\"help\"><strong>Note:</strong> See <a href=\"/LUCICodeRepository/nomaticIM/wiki/TracBrowser\">TracBrowser</a>\n        for help on using the repository browser.</div>\n    </div>\n    <div id=\"altlinks\">\n      <h3>Download in other formats:</h3>\n      <ul>\n        <li class=\"first\">\n          <a rel=\"nofollow\" href=\"/LUCICodeRepository/nomaticIM/browser/nomatic/tags/NomaticIM-0.0.5/buddy_bots/src/twisted/internet/base.py?format=txt\">Plain Text</a>\n        </li><li class=\"last\">\n          <a rel=\"nofollow\" href=\"/LUCICodeRepository/nomaticIM/export/1312/nomatic/tags/NomaticIM-0.0.5/buddy_bots/src/twisted/internet/base.py\">Original Format</a>\n        </li>\n      </ul>\n    </div>\n    </div>\n    <div id=\"footer\" lang=\"en\" xml:lang=\"en\"><hr />\n      <a id=\"tracpowered\" href=\"http://trac.edgewall.org/\"><img src=\"/LUCICodeRepository/nomaticIM/chrome/common/trac_logo_mini.png\" height=\"30\" width=\"107\" alt=\"Trac Powered\" /></a>\n      <p class=\"left\">Powered by <a href=\"/LUCICodeRepository/nomaticIM/about\"><strong>Trac 1.0.1</strong></a><br />\n        By <a href=\"http://www.edgewall.org/\">Edgewall Software</a>.</p>\n      <p class=\"right\">All content copyright 2007-2008 by LUCI <br /><a href=\"http://luci.ics.uci.edu/\">http://luci.ics.uci.edu/</a></p>\n    </div>\n\t\t<div id=\"sitefooter\">\n\t\t\t<script src=\"http://www.google-analytics.com/urchin.js\" type=\"text/javascript\">\n\t\t\t</script>\n\t\t\t<script type=\"text/javascript\">\n\t\t\t\t_uacct = \"UA-338915-2\";\n\t\t\t\turchinTracker();\n\t\t\t</script>\n\t\t</div>\n\t</body>\n</html>", "id": 44349.0}