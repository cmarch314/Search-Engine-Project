{"text": "View Javadoc 1 package swirl workspace messages 2 3 import java util HashMap 4 import java util Iterator 5 import java util Map 6 7 import org apache commons logging Log 8 import org apache commons logging LogFactory 9 import org picocontainer Startable 1 11 import edu uci isr yancees EventInterface 12 import edu uci isr yancees GenericMessage 13 import edu uci isr yancees SubscriberInterface 14 import edu uci isr yancees YanceesEvent 15 import edu uci isr yancees client rmi YanceesRMIClient 16 17 18 DOCUMENT ME 19 2 author bpillet Adapter to log messages to Yancees 21 22 public class YanceesMessageReceiver implements MessageReceiver 23 SubscriberInterface 24 Startable 25 26 TODO 27 YanceesRMIClient yancees 28 29 TODO 3 MessageProcessor processors 31 32 common logging logger 33 private Log log LogFactory getLog this getClass 34 35 36 Creates a new YanceesMessageReceiver object 37 38 param yancees TODO 39 param processors TODO 4 41 public YanceesMessageReceiver YanceesRMIClient yancees 42 MessageProcessor processors 43 44 if log isDebugEnabled 45 46 log debug processors processors processors length 47 48 49 this yancees yancees 5 this processors processors 51 52 53 54 TODO 55 56 param myEvents TODO 57 58 public void notify EventInterface myEvents 59 6 for int i i myEvents length i 61 62 notify myEvents i 63 64 65 66 67 TODO 68 69 param myEvent TODO 7 71 public void notify EventInterface myEvent 72 73 if myEvent instanceof YanceesEvent 74 75 YanceesEvent ye YanceesEvent myEvent 76 77 try 78 79 Map msg new HashMap 8 81 for Iterator it ye getAttributeNamesIterator it hasNext 82 83 String name String it next 84 Object value ye get name 85 86 msg put name value 87 88 89 receiveMessage msg 9 91 catch Exception e 92 93 log error Error receiving msg e 94 95 96 97 98 99 TODO 1 1 1 param msg TODO 1 2 1 3 public void receiveMessage Map msg 1 4 1 5 if log isDebugEnabled 1 6 1 7 log debug receiveMessage msg 1 8 1 9 11 for int i i processors length i 111 112 processors i processMessage msg 113 114 115 116 117 118 119 TODO 12 121 public void start 122 123 try 124 125 if log isDebugEnabled 126 127 log debug starting 128 129 13 GenericMessage msg new GenericMessage subscription filter EQ name yancees version name 131 value type yanceesString 1 value EQ filter subscription 132 133 if msg null 134 135 System exit 1 136 137 138 yancees subscribe msg this 139 14 if log isDebugEnabled 141 142 log debug started 143 144 145 call init method for all message processors allows processors to defer initialization until 146 after the message receiver is fully initialized in order to avoid missed messages 147 for int i i processors length i 148 149 processors i initializeMessageProcessor 15 151 152 catch Exception ex 153 154 log error problem subscribing to yancees ex 155 156 157 158 159 TODO 16 161 public void stop 162 163 try 164 165 if log isDebugEnabled 166 167 log debug stopping 168 169 17 GenericMessage msg new GenericMessage subscription filter EQ name yancees version name 171 value type yanceesString 1 value EQ filter subscription 172 173 if msg null 174 175 System exit 1 176 177 178 yancees unsubscribe this msg 179 18 if log isDebugEnabled 181 182 log debug stopped 183 184 185 catch Exception ex 186 187 log error problem subscribing to yancees ex 188 189 19 This page was automatically generated by Maven", "_id": "http://drzaius.ics.uci.edu/~swirl/impromptu-0.20/xref/swirl/workspace/messages/YanceesMessageReceiver.html", "title": "yanceesmessagereceiver xref", "html": "<!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Transitional//EN\" \"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd\">\n<html xmlns=\"http://www.w3.org/1999/xhtml\" xml:lang=\"en\" lang=\"en\">\n<head>\n<meta http-equiv=\"content-type\" content=\"text/html; charset=ISO-8859-1\" /><title>YanceesMessageReceiver xref</title>\n<link type=\"text/css\" rel=\"stylesheet\" href=\"../../../stylesheet.css\" />\n</head>\n<body>\n<div id=\"overview\"><a href=\"../../../../apidocs/swirl/workspace/messages/YanceesMessageReceiver.html\">View Javadoc</a></div><pre>\n\n<a name=\"1\" href=\"#1\">1</a>   <strong>package</strong> <a href=\"../../../swirl/workspace/messages/package-summary.html\">swirl.workspace.messages</a>;\n<a name=\"2\" href=\"#2\">2</a>   \n<a name=\"3\" href=\"#3\">3</a>   <strong>import</strong> java.util.HashMap;\n<a name=\"4\" href=\"#4\">4</a>   <strong>import</strong> java.util.Iterator;\n<a name=\"5\" href=\"#5\">5</a>   <strong>import</strong> java.util.Map;\n<a name=\"6\" href=\"#6\">6</a>   \n<a name=\"7\" href=\"#7\">7</a>   <strong>import</strong> org.apache.commons.logging.Log;\n<a name=\"8\" href=\"#8\">8</a>   <strong>import</strong> org.apache.commons.logging.LogFactory;\n<a name=\"9\" href=\"#9\">9</a>   <strong>import</strong> org.picocontainer.Startable;\n<a name=\"10\" href=\"#10\">10</a>  \n<a name=\"11\" href=\"#11\">11</a>  <strong>import</strong> edu.uci.isr.yancees.EventInterface;\n<a name=\"12\" href=\"#12\">12</a>  <strong>import</strong> edu.uci.isr.yancees.GenericMessage;\n<a name=\"13\" href=\"#13\">13</a>  <strong>import</strong> edu.uci.isr.yancees.SubscriberInterface;\n<a name=\"14\" href=\"#14\">14</a>  <strong>import</strong> edu.uci.isr.yancees.YanceesEvent;\n<a name=\"15\" href=\"#15\">15</a>  <strong>import</strong> edu.uci.isr.yancees.client.rmi.YanceesRMIClient;\n<a name=\"16\" href=\"#16\">16</a>  \n<a name=\"17\" href=\"#17\">17</a>  <em>/**<em>*</em></em>\n<a name=\"18\" href=\"#18\">18</a>  <em> * DOCUMENT ME!</em>\n<a name=\"19\" href=\"#19\">19</a>  <em> *</em>\n<a name=\"20\" href=\"#20\">20</a>  <em> * @author bpillet Adapter to log messages to Yancees</em>\n<a name=\"21\" href=\"#21\">21</a>  <em> */</em>\n<a name=\"22\" href=\"#22\">22</a>  <strong>public</strong> <strong>class</strong> <a href=\"../../../swirl/workspace/messages/YanceesMessageReceiver.html\">YanceesMessageReceiver</a> implements MessageReceiver,\n<a name=\"23\" href=\"#23\">23</a>                                                 SubscriberInterface,\n<a name=\"24\" href=\"#24\">24</a>                                                 Startable\n<a name=\"25\" href=\"#25\">25</a>  {\n<a name=\"26\" href=\"#26\">26</a>      <em>/**<em>* TODO */</em></em>\n<a name=\"27\" href=\"#27\">27</a>      YanceesRMIClient yancees;\n<a name=\"28\" href=\"#28\">28</a>  \n<a name=\"29\" href=\"#29\">29</a>      <em>/**<em>* TODO */</em></em>\n<a name=\"30\" href=\"#30\">30</a>      <a href=\"../../../swirl/workspace/messages/MessageProcessor.html\">MessageProcessor</a>[] processors;\n<a name=\"31\" href=\"#31\">31</a>  \n<a name=\"32\" href=\"#32\">32</a>      <em>/**<em>* common-logging logger */</em></em>\n<a name=\"33\" href=\"#33\">33</a>      <strong>private</strong> Log log = LogFactory.getLog(<strong>this</strong>.getClass());\n<a name=\"34\" href=\"#34\">34</a>  \n<a name=\"35\" href=\"#35\">35</a>      <em>/**<em>*</em></em>\n<a name=\"36\" href=\"#36\">36</a>  <em>     * Creates a new YanceesMessageReceiver object.</em>\n<a name=\"37\" href=\"#37\">37</a>  <em>     *</em>\n<a name=\"38\" href=\"#38\">38</a>  <em>     * @param yancees TODO</em>\n<a name=\"39\" href=\"#39\">39</a>  <em>     * @param processors TODO</em>\n<a name=\"40\" href=\"#40\">40</a>  <em>     */</em>\n<a name=\"41\" href=\"#41\">41</a>      <strong>public</strong> <a href=\"../../../swirl/workspace/messages/YanceesMessageReceiver.html\">YanceesMessageReceiver</a>(YanceesRMIClient yancees,\n<a name=\"42\" href=\"#42\">42</a>                                    <a href=\"../../../swirl/workspace/messages/MessageProcessor.html\">MessageProcessor</a>[] processors)\n<a name=\"43\" href=\"#43\">43</a>      {\n<a name=\"44\" href=\"#44\">44</a>          <strong>if</strong>(log.isDebugEnabled())\n<a name=\"45\" href=\"#45\">45</a>          {\n<a name=\"46\" href=\"#46\">46</a>              log.debug(<span class=\"string\">\"processors: \"</span> + processors + <span class=\"string\">\" - \"</span> + processors.length);\n<a name=\"47\" href=\"#47\">47</a>          }\n<a name=\"48\" href=\"#48\">48</a>  \n<a name=\"49\" href=\"#49\">49</a>          <strong>this</strong>.yancees = yancees;\n<a name=\"50\" href=\"#50\">50</a>          <strong>this</strong>.processors = processors;\n<a name=\"51\" href=\"#51\">51</a>      }\n<a name=\"52\" href=\"#52\">52</a>  \n<a name=\"53\" href=\"#53\">53</a>      <em>/**<em>*</em></em>\n<a name=\"54\" href=\"#54\">54</a>  <em>     * TODO</em>\n<a name=\"55\" href=\"#55\">55</a>  <em>     *</em>\n<a name=\"56\" href=\"#56\">56</a>  <em>     * @param myEvents TODO</em>\n<a name=\"57\" href=\"#57\">57</a>  <em>     */</em>\n<a name=\"58\" href=\"#58\">58</a>      <strong>public</strong> <strong>void</strong> notify(EventInterface[] myEvents)\n<a name=\"59\" href=\"#59\">59</a>      {\n<a name=\"60\" href=\"#60\">60</a>          <strong>for</strong>(<strong>int</strong> i = 0; i &lt; myEvents.length; i++)\n<a name=\"61\" href=\"#61\">61</a>          {\n<a name=\"62\" href=\"#62\">62</a>              notify(myEvents[i]);\n<a name=\"63\" href=\"#63\">63</a>          }\n<a name=\"64\" href=\"#64\">64</a>      }\n<a name=\"65\" href=\"#65\">65</a>  \n<a name=\"66\" href=\"#66\">66</a>      <em>/**<em>*</em></em>\n<a name=\"67\" href=\"#67\">67</a>  <em>     * TODO</em>\n<a name=\"68\" href=\"#68\">68</a>  <em>     *</em>\n<a name=\"69\" href=\"#69\">69</a>  <em>     * @param myEvent TODO</em>\n<a name=\"70\" href=\"#70\">70</a>  <em>     */</em>\n<a name=\"71\" href=\"#71\">71</a>      <strong>public</strong> <strong>void</strong> notify(EventInterface myEvent)\n<a name=\"72\" href=\"#72\">72</a>      {\n<a name=\"73\" href=\"#73\">73</a>          <strong>if</strong>(myEvent instanceof YanceesEvent)\n<a name=\"74\" href=\"#74\">74</a>          {\n<a name=\"75\" href=\"#75\">75</a>              YanceesEvent ye = (YanceesEvent)myEvent;\n<a name=\"76\" href=\"#76\">76</a>  \n<a name=\"77\" href=\"#77\">77</a>              <strong>try</strong>\n<a name=\"78\" href=\"#78\">78</a>              {\n<a name=\"79\" href=\"#79\">79</a>                  Map msg = <strong>new</strong> HashMap();\n<a name=\"80\" href=\"#80\">80</a>  \n<a name=\"81\" href=\"#81\">81</a>                  <strong>for</strong>(Iterator it = ye.getAttributeNamesIterator(); it.hasNext();)\n<a name=\"82\" href=\"#82\">82</a>                  {\n<a name=\"83\" href=\"#83\">83</a>                      String name = (String)it.next();\n<a name=\"84\" href=\"#84\">84</a>                      Object value = ye.get(name);\n<a name=\"85\" href=\"#85\">85</a>  \n<a name=\"86\" href=\"#86\">86</a>                      msg.put(name, value);\n<a name=\"87\" href=\"#87\">87</a>                  }\n<a name=\"88\" href=\"#88\">88</a>  \n<a name=\"89\" href=\"#89\">89</a>                  receiveMessage(msg);\n<a name=\"90\" href=\"#90\">90</a>              }\n<a name=\"91\" href=\"#91\">91</a>              <strong>catch</strong>(Exception e)\n<a name=\"92\" href=\"#92\">92</a>              {\n<a name=\"93\" href=\"#93\">93</a>                  log.error(<span class=\"string\">\"Error receiving msg\"</span>, e);\n<a name=\"94\" href=\"#94\">94</a>              }\n<a name=\"95\" href=\"#95\">95</a>          }\n<a name=\"96\" href=\"#96\">96</a>      }\n<a name=\"97\" href=\"#97\">97</a>  \n<a name=\"98\" href=\"#98\">98</a>      <em>/**<em>*</em></em>\n<a name=\"99\" href=\"#99\">99</a>  <em>     * TODO</em>\n<a name=\"100\" href=\"#100\">100</a> <em>     *</em>\n<a name=\"101\" href=\"#101\">101</a> <em>     * @param msg TODO</em>\n<a name=\"102\" href=\"#102\">102</a> <em>     */</em>\n<a name=\"103\" href=\"#103\">103</a>     <strong>public</strong> <strong>void</strong> receiveMessage(Map msg)\n<a name=\"104\" href=\"#104\">104</a>     {\n<a name=\"105\" href=\"#105\">105</a>         <strong>if</strong>(log.isDebugEnabled())\n<a name=\"106\" href=\"#106\">106</a>         {\n<a name=\"107\" href=\"#107\">107</a>             log.debug(<span class=\"string\">\"receiveMessage(\"</span> + msg + <span class=\"string\">\")\"</span>);\n<a name=\"108\" href=\"#108\">108</a>         }\n<a name=\"109\" href=\"#109\">109</a> \n<a name=\"110\" href=\"#110\">110</a>         <strong>for</strong>(<strong>int</strong> i = 0; i &lt; processors.length; ++i)\n<a name=\"111\" href=\"#111\">111</a>         {\n<a name=\"112\" href=\"#112\">112</a>             processors[i].processMessage(msg);\n<a name=\"113\" href=\"#113\">113</a>         }\n<a name=\"114\" href=\"#114\">114</a>     }\n<a name=\"115\" href=\"#115\">115</a> \n<a name=\"116\" href=\"#116\">116</a> \n<a name=\"117\" href=\"#117\">117</a> \n<a name=\"118\" href=\"#118\">118</a>     <em>/**<em>*</em></em>\n<a name=\"119\" href=\"#119\">119</a> <em>     * TODO</em>\n<a name=\"120\" href=\"#120\">120</a> <em>     */</em>\n<a name=\"121\" href=\"#121\">121</a>     <strong>public</strong> <strong>void</strong> start()\n<a name=\"122\" href=\"#122\">122</a>     {\n<a name=\"123\" href=\"#123\">123</a>         <strong>try</strong>\n<a name=\"124\" href=\"#124\">124</a>         {\n<a name=\"125\" href=\"#125\">125</a>             <strong>if</strong>(log.isDebugEnabled())\n<a name=\"126\" href=\"#126\">126</a>             {\n<a name=\"127\" href=\"#127\">127</a>                 log.debug(<span class=\"string\">\"starting\"</span>);\n<a name=\"128\" href=\"#128\">128</a>             }\n<a name=\"129\" href=\"#129\">129</a> \n<a name=\"130\" href=\"#130\">130</a>             GenericMessage msg = <strong>new</strong> GenericMessage(<span class=\"string\">\"&lt;subscription>&lt;filter>&lt;EQ>&lt;name>yancees.version&lt;/name>\"</span>\n<a name=\"131\" href=\"#131\">131</a>                                                     + <span class=\"string\">\"&lt;value type=\\&quot;yanceesString\\&quot;>1.0&lt;/value>&lt;/EQ>&lt;/filter>&lt;/subscription>\"</span>);\n<a name=\"132\" href=\"#132\">132</a> \n<a name=\"133\" href=\"#133\">133</a>             <strong>if</strong>(msg == <strong>null</strong>)\n<a name=\"134\" href=\"#134\">134</a>             {\n<a name=\"135\" href=\"#135\">135</a>                 System.exit(1);\n<a name=\"136\" href=\"#136\">136</a>             }\n<a name=\"137\" href=\"#137\">137</a> \n<a name=\"138\" href=\"#138\">138</a>             yancees.subscribe(msg, <strong>this</strong>);\n<a name=\"139\" href=\"#139\">139</a> \n<a name=\"140\" href=\"#140\">140</a>             <strong>if</strong>(log.isDebugEnabled())\n<a name=\"141\" href=\"#141\">141</a>             {\n<a name=\"142\" href=\"#142\">142</a>                 log.debug(<span class=\"string\">\"started\"</span>);\n<a name=\"143\" href=\"#143\">143</a>             }\n<a name=\"144\" href=\"#144\">144</a>             \n<a name=\"145\" href=\"#145\">145</a>             <em class=\"comment\">// call init method for all message processors.  allows processors to defer initialization until</em>\n<a name=\"146\" href=\"#146\">146</a>             <em class=\"comment\">// after the message receiver is fully initialized in order to avoid missed messages.</em>\n<a name=\"147\" href=\"#147\">147</a>             <strong>for</strong>(<strong>int</strong> i = 0; i &lt; processors.length; ++i)\n<a name=\"148\" href=\"#148\">148</a>             {\n<a name=\"149\" href=\"#149\">149</a>                 processors[i].initializeMessageProcessor();\n<a name=\"150\" href=\"#150\">150</a>             }\n<a name=\"151\" href=\"#151\">151</a>         }\n<a name=\"152\" href=\"#152\">152</a>         <strong>catch</strong>(Exception ex)\n<a name=\"153\" href=\"#153\">153</a>         {\n<a name=\"154\" href=\"#154\">154</a>             log.error(<span class=\"string\">\"problem subscribing to yancees\"</span>, ex);\n<a name=\"155\" href=\"#155\">155</a>         }\n<a name=\"156\" href=\"#156\">156</a>     }\n<a name=\"157\" href=\"#157\">157</a> \n<a name=\"158\" href=\"#158\">158</a>     <em>/**<em>*</em></em>\n<a name=\"159\" href=\"#159\">159</a> <em>     * TODO</em>\n<a name=\"160\" href=\"#160\">160</a> <em>     */</em>\n<a name=\"161\" href=\"#161\">161</a>     <strong>public</strong> <strong>void</strong> stop()\n<a name=\"162\" href=\"#162\">162</a>     {\n<a name=\"163\" href=\"#163\">163</a>         <strong>try</strong>\n<a name=\"164\" href=\"#164\">164</a>         {\n<a name=\"165\" href=\"#165\">165</a>             <strong>if</strong>(log.isDebugEnabled())\n<a name=\"166\" href=\"#166\">166</a>             {\n<a name=\"167\" href=\"#167\">167</a>                 log.debug(<span class=\"string\">\"stopping\"</span>);\n<a name=\"168\" href=\"#168\">168</a>             }\n<a name=\"169\" href=\"#169\">169</a> \n<a name=\"170\" href=\"#170\">170</a>             GenericMessage msg = <strong>new</strong> GenericMessage(<span class=\"string\">\"&lt;subscription>&lt;filter>&lt;EQ>&lt;name>yancees.version&lt;/name>\"</span>\n<a name=\"171\" href=\"#171\">171</a>                                                     + <span class=\"string\">\"&lt;value type=\\&quot;yanceesString\\&quot;>1.0&lt;/value>&lt;/EQ>&lt;/filter>&lt;/subscription>\"</span>);\n<a name=\"172\" href=\"#172\">172</a> \n<a name=\"173\" href=\"#173\">173</a>             <strong>if</strong>(msg == <strong>null</strong>)\n<a name=\"174\" href=\"#174\">174</a>             {\n<a name=\"175\" href=\"#175\">175</a>                 System.exit(1);\n<a name=\"176\" href=\"#176\">176</a>             }\n<a name=\"177\" href=\"#177\">177</a> \n<a name=\"178\" href=\"#178\">178</a>             yancees.unsubscribe(<strong>this</strong>, msg);\n<a name=\"179\" href=\"#179\">179</a> \n<a name=\"180\" href=\"#180\">180</a>             <strong>if</strong>(log.isDebugEnabled())\n<a name=\"181\" href=\"#181\">181</a>             {\n<a name=\"182\" href=\"#182\">182</a>                 log.debug(<span class=\"string\">\"stopped\"</span>);\n<a name=\"183\" href=\"#183\">183</a>             }\n<a name=\"184\" href=\"#184\">184</a>         }\n<a name=\"185\" href=\"#185\">185</a>         <strong>catch</strong>(Exception ex)\n<a name=\"186\" href=\"#186\">186</a>         {\n<a name=\"187\" href=\"#187\">187</a>             log.error(<span class=\"string\">\"problem subscribing to yancees\"</span>, ex);\n<a name=\"188\" href=\"#188\">188</a>         }\n<a name=\"189\" href=\"#189\">189</a>     }\n<a name=\"190\" href=\"#190\">190</a> }\n</pre>\n<hr/><div id=\"footer\">This page was automatically generated by <a href=\"http://maven.apache.org/\">Maven</a></div></body>\n</html>\n\n", "id": 33011.0}