{"text": "View Javadoc 1 package swirl workspace viz pie 2 3 import java awt Color 4 import java io BufferedReader 5 import java io IOException 6 import java io InputStream 7 import java io InputStreamReader 8 import java io Reader 9 import java net URL 1 import java util Enumeration 11 import java util HashMap 12 import java util Iterator 13 import java util Vector 14 15 import org apache batik dom AbstractDocument 16 import org apache batik dom svg SVGDOMImplementation 17 import org apache commons logging Log 18 import org apache commons logging LogFactory 19 import org w3c dom Document 2 import org w3c dom Element 21 22 23 DOCUMENT ME 24 25 author bpillet 26 27 public class DotElementFactory implements SVGDOMImplementation ElementFactory 28 29 TODO 3 private static Log log LogFactory getLog DotElementFactory class 31 32 TODO 33 private static String svgNS SVGDOMImplementation SVG NAMESPACE URI 34 35 TODO 36 static HashMap providerMap new HashMap 37 38 39 Creates a new DotElementFactory object 4 41 public DotElementFactory 42 43 super 44 45 if log isDebugEnabled 46 47 log debug 48 49 5 51 52 TODO 53 54 param doc TODO 55 param fe TODO 56 param uColor TODO 57 58 return TODO 59 6 public static DotElement createDotElement Document doc FileElement fe 61 Color uColor int dotSize 62 63 Element element doc createElementNS DotElement URL DotElement TAG 64 DotElement realDot DotElement element 65 66 realDot setFileElement fe 67 realDot setColor uColor 68 if log isDebugEnabled 69 7 log debug dotSize dotSize 71 72 realDot setSize dotSize 73 74 return realDot 75 76 77 78 TODO 79 8 param prefix TODO 81 param doc TODO 82 83 return TODO 84 85 public Element create String prefix Document doc 86 87 if log isDebugEnabled 88 89 log debug create prefix doc 9 91 92 return new DotElement prefix AbstractDocument doc 93 94 95 96 TODO 97 98 param cls TODO 99 1 return TODO 1 1 1 2 public static synchronized Iterator providers Class cls 1 3 1 4 ClassLoader cl null 1 5 1 6 try 1 7 1 8 cl cls getClassLoader 1 9 11 catch SecurityException se 111 112 Ooops can t get his class loader 113 114 115 Can always request your own class loader But it might be null 116 if cl null 117 118 cl DotElementFactory class getClassLoader 119 12 121 String serviceFile META INF services cls getName 122 123 System out println File serviceFile 124 125 Vector v Vector providerMap get serviceFile 126 127 if v null 128 129 return v iterator 13 131 132 v new Vector 133 providerMap put serviceFile v 134 135 No class loader so we can t find serviceFile 136 if cl null 137 138 return v iterator 139 14 141 Enumeration e 142 143 try 144 145 e cl getResources serviceFile 146 147 catch IOException ioe 148 149 return v iterator 15 151 152 while e hasMoreElements 153 154 try 155 156 URL u URL e nextElement 157 158 System out println URL u 159 16 InputStream is u openStream 161 Reader r new InputStreamReader is UTF 8 162 BufferedReader br new BufferedReader r 163 164 String line br readLine 165 166 while line null 167 168 try 169 17 First strip any comment 171 int idx line indexOf 172 173 if idx 1 174 175 line line substring idx 176 177 178 Trim whitespace 179 line line trim 18 181 If nothing left then loop around 182 if line length 183 184 line br readLine 185 186 continue 187 188 189 System out println Line line 19 191 Try and load the class 192 Object obj cl loadClass line newInstance 193 194 stick it into our vector 195 v add obj 196 197 catch Exception ex 198 199 Just try the next line 2 2 1 2 2 line br readLine 2 3 2 4 2 5 catch Exception ex 2 6 2 7 Just try the next file 2 8 2 9 21 211 for Iterator it v iterator it hasNext 212 213 System err println provider it next 214 215 216 return v iterator 217 218 This page was automatically generated by Maven", "_id": "http://drzaius.ics.uci.edu/~swirl/impromptu-0.20/xref/swirl/workspace/viz/pie/DotElementFactory.html", "title": "dotelementfactory xref", "html": "<!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Transitional//EN\" \"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd\">\n<html xmlns=\"http://www.w3.org/1999/xhtml\" xml:lang=\"en\" lang=\"en\">\n<head>\n<meta http-equiv=\"content-type\" content=\"text/html; charset=ISO-8859-1\" /><title>DotElementFactory xref</title>\n<link type=\"text/css\" rel=\"stylesheet\" href=\"../../../../stylesheet.css\" />\n</head>\n<body>\n<div id=\"overview\"><a href=\"../../../../../apidocs/swirl/workspace/viz/pie/DotElementFactory.html\">View Javadoc</a></div><pre>\n\n<a name=\"1\" href=\"#1\">1</a>   <strong>package</strong> <a href=\"../../../../swirl/workspace/viz/pie/package-summary.html\">swirl.workspace.viz.pie</a>;\n<a name=\"2\" href=\"#2\">2</a>   \n<a name=\"3\" href=\"#3\">3</a>   <strong>import</strong> java.awt.Color;\n<a name=\"4\" href=\"#4\">4</a>   <strong>import</strong> java.io.BufferedReader;\n<a name=\"5\" href=\"#5\">5</a>   <strong>import</strong> java.io.IOException;\n<a name=\"6\" href=\"#6\">6</a>   <strong>import</strong> java.io.InputStream;\n<a name=\"7\" href=\"#7\">7</a>   <strong>import</strong> java.io.InputStreamReader;\n<a name=\"8\" href=\"#8\">8</a>   <strong>import</strong> java.io.Reader;\n<a name=\"9\" href=\"#9\">9</a>   <strong>import</strong> java.net.URL;\n<a name=\"10\" href=\"#10\">10</a>  <strong>import</strong> java.util.Enumeration;\n<a name=\"11\" href=\"#11\">11</a>  <strong>import</strong> java.util.HashMap;\n<a name=\"12\" href=\"#12\">12</a>  <strong>import</strong> java.util.Iterator;\n<a name=\"13\" href=\"#13\">13</a>  <strong>import</strong> java.util.Vector;\n<a name=\"14\" href=\"#14\">14</a>  \n<a name=\"15\" href=\"#15\">15</a>  <strong>import</strong> org.apache.batik.dom.AbstractDocument;\n<a name=\"16\" href=\"#16\">16</a>  <strong>import</strong> org.apache.batik.dom.svg.SVGDOMImplementation;\n<a name=\"17\" href=\"#17\">17</a>  <strong>import</strong> org.apache.commons.logging.Log;\n<a name=\"18\" href=\"#18\">18</a>  <strong>import</strong> org.apache.commons.logging.LogFactory;\n<a name=\"19\" href=\"#19\">19</a>  <strong>import</strong> org.w3c.dom.Document;\n<a name=\"20\" href=\"#20\">20</a>  <strong>import</strong> org.w3c.dom.Element;\n<a name=\"21\" href=\"#21\">21</a>  \n<a name=\"22\" href=\"#22\">22</a>  <em>/**<em>*</em></em>\n<a name=\"23\" href=\"#23\">23</a>  <em> * DOCUMENT ME!</em>\n<a name=\"24\" href=\"#24\">24</a>  <em> *</em>\n<a name=\"25\" href=\"#25\">25</a>  <em> * @author bpillet</em>\n<a name=\"26\" href=\"#26\">26</a>  <em> */</em>\n<a name=\"27\" href=\"#27\">27</a>  <strong>public</strong> <strong>class</strong> <a href=\"../../../../swirl/workspace/viz/pie/DotElementFactory.html\">DotElementFactory</a> implements SVGDOMImplementation.ElementFactory\n<a name=\"28\" href=\"#28\">28</a>  {\n<a name=\"29\" href=\"#29\">29</a>      <em>/**<em>* TODO */</em></em>\n<a name=\"30\" href=\"#30\">30</a>      <strong>private</strong> <strong>static</strong> Log log = LogFactory.getLog(DotElementFactory.<strong>class</strong>);\n<a name=\"31\" href=\"#31\">31</a>  \n<a name=\"32\" href=\"#32\">32</a>      <em>/**<em>* TODO */</em></em>\n<a name=\"33\" href=\"#33\">33</a>      <strong>private</strong> <strong>static</strong> String svgNS = SVGDOMImplementation.SVG_NAMESPACE_URI;\n<a name=\"34\" href=\"#34\">34</a>  \n<a name=\"35\" href=\"#35\">35</a>      <em>/**<em>* TODO */</em></em>\n<a name=\"36\" href=\"#36\">36</a>      <strong>static</strong> HashMap providerMap = <strong>new</strong> HashMap();\n<a name=\"37\" href=\"#37\">37</a>  \n<a name=\"38\" href=\"#38\">38</a>      <em>/**<em>*</em></em>\n<a name=\"39\" href=\"#39\">39</a>  <em>     * Creates a new DotElementFactory object.</em>\n<a name=\"40\" href=\"#40\">40</a>  <em>     */</em>\n<a name=\"41\" href=\"#41\">41</a>      <strong>public</strong> <a href=\"../../../../swirl/workspace/viz/pie/DotElementFactory.html\">DotElementFactory</a>()\n<a name=\"42\" href=\"#42\">42</a>      {\n<a name=\"43\" href=\"#43\">43</a>          <strong>super</strong>();\n<a name=\"44\" href=\"#44\">44</a>  \n<a name=\"45\" href=\"#45\">45</a>          <strong>if</strong>(log.isDebugEnabled())\n<a name=\"46\" href=\"#46\">46</a>          {\n<a name=\"47\" href=\"#47\">47</a>              log.debug(<span class=\"string\">\"()\"</span>);\n<a name=\"48\" href=\"#48\">48</a>          }\n<a name=\"49\" href=\"#49\">49</a>      }\n<a name=\"50\" href=\"#50\">50</a>  \n<a name=\"51\" href=\"#51\">51</a>      <em>/**<em>*</em></em>\n<a name=\"52\" href=\"#52\">52</a>  <em>     * TODO</em>\n<a name=\"53\" href=\"#53\">53</a>  <em>     *</em>\n<a name=\"54\" href=\"#54\">54</a>  <em>     * @param doc TODO</em>\n<a name=\"55\" href=\"#55\">55</a>  <em>     * @param fe TODO</em>\n<a name=\"56\" href=\"#56\">56</a>  <em>     * @param uColor TODO</em>\n<a name=\"57\" href=\"#57\">57</a>  <em>     *</em>\n<a name=\"58\" href=\"#58\">58</a>  <em>     * @return TODO</em>\n<a name=\"59\" href=\"#59\">59</a>  <em>     */</em>\n<a name=\"60\" href=\"#60\">60</a>      <strong>public</strong> <strong>static</strong> <a href=\"../../../../swirl/workspace/viz/pie/DotElement.html\">DotElement</a> createDotElement(Document doc, <a href=\"../../../../swirl/workspace/viz/pie/FileElement.html\">FileElement</a> fe,\n<a name=\"61\" href=\"#61\">61</a>                                                Color uColor, <strong>int</strong> dotSize)\n<a name=\"62\" href=\"#62\">62</a>      {\n<a name=\"63\" href=\"#63\">63</a>          Element element = doc.createElementNS(DotElement.URL, DotElement.TAG);\n<a name=\"64\" href=\"#64\">64</a>          <a href=\"../../../../swirl/workspace/viz/pie/DotElement.html\">DotElement</a> realDot = (DotElement)element;\n<a name=\"65\" href=\"#65\">65</a>  \n<a name=\"66\" href=\"#66\">66</a>          realDot.setFileElement(fe);\n<a name=\"67\" href=\"#67\">67</a>          realDot.setColor(uColor);\n<a name=\"68\" href=\"#68\">68</a>          <strong>if</strong>(log.isDebugEnabled())\n<a name=\"69\" href=\"#69\">69</a>          {\n<a name=\"70\" href=\"#70\">70</a>          \tlog.debug(<span class=\"string\">\"dotSize: \"</span> + dotSize);\n<a name=\"71\" href=\"#71\">71</a>          }\n<a name=\"72\" href=\"#72\">72</a>          realDot.setSize(dotSize);\n<a name=\"73\" href=\"#73\">73</a>  \n<a name=\"74\" href=\"#74\">74</a>          <strong>return</strong> realDot;\n<a name=\"75\" href=\"#75\">75</a>      }\n<a name=\"76\" href=\"#76\">76</a>  \n<a name=\"77\" href=\"#77\">77</a>      <em>/**<em>*</em></em>\n<a name=\"78\" href=\"#78\">78</a>  <em>     * TODO</em>\n<a name=\"79\" href=\"#79\">79</a>  <em>     *</em>\n<a name=\"80\" href=\"#80\">80</a>  <em>     * @param prefix TODO</em>\n<a name=\"81\" href=\"#81\">81</a>  <em>     * @param doc TODO</em>\n<a name=\"82\" href=\"#82\">82</a>  <em>     *</em>\n<a name=\"83\" href=\"#83\">83</a>  <em>     * @return TODO</em>\n<a name=\"84\" href=\"#84\">84</a>  <em>     */</em>\n<a name=\"85\" href=\"#85\">85</a>      <strong>public</strong> Element create(String prefix, Document doc)\n<a name=\"86\" href=\"#86\">86</a>      {\n<a name=\"87\" href=\"#87\">87</a>          <strong>if</strong>(log.isDebugEnabled())\n<a name=\"88\" href=\"#88\">88</a>          {\n<a name=\"89\" href=\"#89\">89</a>              log.debug(<span class=\"string\">\"create(\"</span> + prefix + <span class=\"string\">\", \"</span> + doc + <span class=\"string\">\")\"</span>);\n<a name=\"90\" href=\"#90\">90</a>          }\n<a name=\"91\" href=\"#91\">91</a>  \n<a name=\"92\" href=\"#92\">92</a>          <strong>return</strong> <strong>new</strong> <a href=\"../../../../swirl/workspace/viz/pie/DotElement.html\">DotElement</a>(prefix, (AbstractDocument)doc);\n<a name=\"93\" href=\"#93\">93</a>      }\n<a name=\"94\" href=\"#94\">94</a>  \n<a name=\"95\" href=\"#95\">95</a>      <em>/**<em>*</em></em>\n<a name=\"96\" href=\"#96\">96</a>  <em>     * TODO</em>\n<a name=\"97\" href=\"#97\">97</a>  <em>     *</em>\n<a name=\"98\" href=\"#98\">98</a>  <em>     * @param cls TODO</em>\n<a name=\"99\" href=\"#99\">99</a>  <em>     *</em>\n<a name=\"100\" href=\"#100\">100</a> <em>     * @return TODO</em>\n<a name=\"101\" href=\"#101\">101</a> <em>     */</em>\n<a name=\"102\" href=\"#102\">102</a>     <strong>public</strong> <strong>static</strong> <strong>synchronized</strong> Iterator providers(Class cls)\n<a name=\"103\" href=\"#103\">103</a>     {\n<a name=\"104\" href=\"#104\">104</a>         ClassLoader cl = <strong>null</strong>;\n<a name=\"105\" href=\"#105\">105</a> \n<a name=\"106\" href=\"#106\">106</a>         <strong>try</strong>\n<a name=\"107\" href=\"#107\">107</a>         {\n<a name=\"108\" href=\"#108\">108</a>             cl = cls.getClassLoader();\n<a name=\"109\" href=\"#109\">109</a>         }\n<a name=\"110\" href=\"#110\">110</a>         <strong>catch</strong>(SecurityException se)\n<a name=\"111\" href=\"#111\">111</a>         {\n<a name=\"112\" href=\"#112\">112</a>             <em class=\"comment\">// Ooops! can't get his class loader.</em>\n<a name=\"113\" href=\"#113\">113</a>         }\n<a name=\"114\" href=\"#114\">114</a> \n<a name=\"115\" href=\"#115\">115</a>         <em class=\"comment\">// Can always request your own class loader. But it might be 'null'.</em>\n<a name=\"116\" href=\"#116\">116</a>         <strong>if</strong>(cl == <strong>null</strong>)\n<a name=\"117\" href=\"#117\">117</a>         {\n<a name=\"118\" href=\"#118\">118</a>             cl = DotElementFactory.<strong>class</strong>.getClassLoader();\n<a name=\"119\" href=\"#119\">119</a>         }\n<a name=\"120\" href=\"#120\">120</a> \n<a name=\"121\" href=\"#121\">121</a>         String serviceFile = <span class=\"string\">\"META-INF/services/\"</span> + cls.getName();\n<a name=\"122\" href=\"#122\">122</a> \n<a name=\"123\" href=\"#123\">123</a>         System.out.println(<span class=\"string\">\"File: \"</span> + serviceFile);\n<a name=\"124\" href=\"#124\">124</a> \n<a name=\"125\" href=\"#125\">125</a>         Vector v = (Vector)providerMap.get(serviceFile);\n<a name=\"126\" href=\"#126\">126</a> \n<a name=\"127\" href=\"#127\">127</a>         <strong>if</strong>(v != <strong>null</strong>)\n<a name=\"128\" href=\"#128\">128</a>         {\n<a name=\"129\" href=\"#129\">129</a>             <strong>return</strong> v.iterator();\n<a name=\"130\" href=\"#130\">130</a>         }\n<a name=\"131\" href=\"#131\">131</a> \n<a name=\"132\" href=\"#132\">132</a>         v = <strong>new</strong> Vector();\n<a name=\"133\" href=\"#133\">133</a>         providerMap.put(serviceFile, v);\n<a name=\"134\" href=\"#134\">134</a> \n<a name=\"135\" href=\"#135\">135</a>         <em class=\"comment\">// No class loader so we can't find 'serviceFile'.</em>\n<a name=\"136\" href=\"#136\">136</a>         <strong>if</strong>(cl == <strong>null</strong>)\n<a name=\"137\" href=\"#137\">137</a>         {\n<a name=\"138\" href=\"#138\">138</a>             <strong>return</strong> v.iterator();\n<a name=\"139\" href=\"#139\">139</a>         }\n<a name=\"140\" href=\"#140\">140</a> \n<a name=\"141\" href=\"#141\">141</a>         Enumeration e;\n<a name=\"142\" href=\"#142\">142</a> \n<a name=\"143\" href=\"#143\">143</a>         <strong>try</strong>\n<a name=\"144\" href=\"#144\">144</a>         {\n<a name=\"145\" href=\"#145\">145</a>             e = cl.getResources(serviceFile);\n<a name=\"146\" href=\"#146\">146</a>         }\n<a name=\"147\" href=\"#147\">147</a>         <strong>catch</strong>(IOException ioe)\n<a name=\"148\" href=\"#148\">148</a>         {\n<a name=\"149\" href=\"#149\">149</a>             <strong>return</strong> v.iterator();\n<a name=\"150\" href=\"#150\">150</a>         }\n<a name=\"151\" href=\"#151\">151</a> \n<a name=\"152\" href=\"#152\">152</a>         <strong>while</strong>(e.hasMoreElements())\n<a name=\"153\" href=\"#153\">153</a>         {\n<a name=\"154\" href=\"#154\">154</a>             <strong>try</strong>\n<a name=\"155\" href=\"#155\">155</a>             {\n<a name=\"156\" href=\"#156\">156</a>                 URL u = (URL)e.nextElement();\n<a name=\"157\" href=\"#157\">157</a> \n<a name=\"158\" href=\"#158\">158</a>                 System.out.println(<span class=\"string\">\"URL: \"</span> + u);\n<a name=\"159\" href=\"#159\">159</a> \n<a name=\"160\" href=\"#160\">160</a>                 InputStream is = u.openStream();\n<a name=\"161\" href=\"#161\">161</a>                 Reader r = <strong>new</strong> InputStreamReader(is, <span class=\"string\">\"UTF-8\"</span>);\n<a name=\"162\" href=\"#162\">162</a>                 BufferedReader br = <strong>new</strong> BufferedReader(r);\n<a name=\"163\" href=\"#163\">163</a> \n<a name=\"164\" href=\"#164\">164</a>                 String line = br.readLine();\n<a name=\"165\" href=\"#165\">165</a> \n<a name=\"166\" href=\"#166\">166</a>                 <strong>while</strong>(line != <strong>null</strong>)\n<a name=\"167\" href=\"#167\">167</a>                 {\n<a name=\"168\" href=\"#168\">168</a>                     <strong>try</strong>\n<a name=\"169\" href=\"#169\">169</a>                     {\n<a name=\"170\" href=\"#170\">170</a>                         <em class=\"comment\">// First strip any comment...</em>\n<a name=\"171\" href=\"#171\">171</a>                         <strong>int</strong> idx = line.indexOf('#');\n<a name=\"172\" href=\"#172\">172</a> \n<a name=\"173\" href=\"#173\">173</a>                         <strong>if</strong>(idx != -1)\n<a name=\"174\" href=\"#174\">174</a>                         {\n<a name=\"175\" href=\"#175\">175</a>                             line = line.substring(0, idx);\n<a name=\"176\" href=\"#176\">176</a>                         }\n<a name=\"177\" href=\"#177\">177</a> \n<a name=\"178\" href=\"#178\">178</a>                         <em class=\"comment\">// Trim whitespace.</em>\n<a name=\"179\" href=\"#179\">179</a>                         line = line.trim();\n<a name=\"180\" href=\"#180\">180</a> \n<a name=\"181\" href=\"#181\">181</a>                         <em class=\"comment\">// If nothing left then loop around...</em>\n<a name=\"182\" href=\"#182\">182</a>                         <strong>if</strong>(line.length() == 0)\n<a name=\"183\" href=\"#183\">183</a>                         {\n<a name=\"184\" href=\"#184\">184</a>                             line = br.readLine();\n<a name=\"185\" href=\"#185\">185</a> \n<a name=\"186\" href=\"#186\">186</a>                             <strong>continue</strong>;\n<a name=\"187\" href=\"#187\">187</a>                         }\n<a name=\"188\" href=\"#188\">188</a> \n<a name=\"189\" href=\"#189\">189</a>                         System.out.println(<span class=\"string\">\"Line: \"</span> + line);\n<a name=\"190\" href=\"#190\">190</a> \n<a name=\"191\" href=\"#191\">191</a>                         <em class=\"comment\">// Try and load the class </em>\n<a name=\"192\" href=\"#192\">192</a>                         Object obj = cl.loadClass(line).newInstance();\n<a name=\"193\" href=\"#193\">193</a> \n<a name=\"194\" href=\"#194\">194</a>                         <em class=\"comment\">// stick it into our vector...</em>\n<a name=\"195\" href=\"#195\">195</a>                         v.add(obj);\n<a name=\"196\" href=\"#196\">196</a>                     }\n<a name=\"197\" href=\"#197\">197</a>                     <strong>catch</strong>(Exception ex)\n<a name=\"198\" href=\"#198\">198</a>                     {\n<a name=\"199\" href=\"#199\">199</a>                         <em class=\"comment\">// Just try the next line</em>\n<a name=\"200\" href=\"#200\">200</a>                     }\n<a name=\"201\" href=\"#201\">201</a> \n<a name=\"202\" href=\"#202\">202</a>                     line = br.readLine();\n<a name=\"203\" href=\"#203\">203</a>                 }\n<a name=\"204\" href=\"#204\">204</a>             }\n<a name=\"205\" href=\"#205\">205</a>             <strong>catch</strong>(Exception ex)\n<a name=\"206\" href=\"#206\">206</a>             {\n<a name=\"207\" href=\"#207\">207</a>                 <em class=\"comment\">// Just try the next file...</em>\n<a name=\"208\" href=\"#208\">208</a>             }\n<a name=\"209\" href=\"#209\">209</a>         }\n<a name=\"210\" href=\"#210\">210</a> \n<a name=\"211\" href=\"#211\">211</a>         <strong>for</strong>(Iterator it = v.iterator(); it.hasNext();)\n<a name=\"212\" href=\"#212\">212</a>         {\n<a name=\"213\" href=\"#213\">213</a>             System.err.println(<span class=\"string\">\"provider: \"</span> + it.next());\n<a name=\"214\" href=\"#214\">214</a>         }\n<a name=\"215\" href=\"#215\">215</a> \n<a name=\"216\" href=\"#216\">216</a>         <strong>return</strong> v.iterator();\n<a name=\"217\" href=\"#217\">217</a>     }\n<a name=\"218\" href=\"#218\">218</a> }\n</pre>\n<hr/><div id=\"footer\">This page was automatically generated by <a href=\"http://maven.apache.org/\">Maven</a></div></body>\n</html>\n\n", "id": 32964.0}