{"text": "View Javadoc 1 2 Created on Sep 2 2 4 3 4 5 package swirl workspace viz pie 6 7 import java awt Color 8 import java util HashMap 9 import java util Iterator 1 import java util Map 11 12 import org apache batik dom util XLinkSupport 13 import org apache batik util SVGConstants 14 import org apache commons logging Log 15 import org apache commons logging LogFactory 16 import org w3c dom Document 17 import org w3c dom Element 18 import org w3c dom NamedNodeMap 19 import org w3c dom Node 2 import org w3c dom NodeList 21 import org w3c dom events EventTarget 22 23 import swirl workspace Peer 24 import swirl workspace PeerManager 25 import swirl workspace viz SharingLevel 26 27 28 DOCUMENT ME 29 3 author dingx 31 32 public class GuiPeer 33 34 the group to hold filedots 35 36 TODO 37 private Element fileGroup 38 39 the group to hold background pies 4 41 TODO 42 private Element levelGroup 43 44 user name element 45 46 TODO 47 private Element textElement 48 49 TODO 5 private Log log LogFactory getLog this getClass 51 52 TODO 53 private Map fileDots new HashMap 54 55 TODO 56 private Map levels new HashMap 57 58 TODO 59 private Peer delegate 6 61 TODO 62 private PieWorkSpace parent 63 64 the start angle for this pie 65 66 TODO 67 private double startAngle 68 69 7 Creates a new GuiPeer object 71 72 param peer TODO 73 param doc TODO 74 param start TODO 75 param workspace TODO 76 77 public GuiPeer Peer peer Document doc PieWorkSpace workspace 78 79 delegate peer 8 parent workspace 81 change the paths for the user name text 82 Node tpnode doc getElementById PieWorkSpace TEXT PATH ID 83 NamedNodeMap tpmap tpnode getAttributes 84 85 make the text at the outer of the circle 86 String d Util caculateDforPath PieWorkSpace RADIUS 5 87 workspace getPeerNumber 1 88 89 tpmap getNamedItem d setNodeValue d 9 91 92 String userID peer getUniqueID 93 94 levelGroup doc createElementNS PieWorkSpace svgNS g 95 96 levelGroup setAttributeNS null id userID 97 98 for int i i SharingLevel SHARING LEVEL i 99 1 PublicLevel level new PublicLevel this doc new SharingLevel i 1 1 1 2 levels put String valueOf i level 1 3 1 4 1 5 fileGroup doc createElementNS PieWorkSpace svgNS g 1 6 fileGroup setAttributeNS null id Util getFileGroupforUser userID 1 7 creat track for the text 1 8 String c getStringColor 1 9 11 creat text element 111 textElement doc createElementNS PieWorkSpace svgNS text 112 textElement setAttributeNS null font family verdana 113 textElement setAttributeNS null font size 18 114 textElement setAttributeNS null fill c 115 116 Element textPath doc createElementNS PieWorkSpace svgNS textPath 117 118 XLinkSupport setXLinkHref textPath PieWorkSpace TEXT PATH ID 119 textPath setAttributeNS null startOffset 47 12 121 Node textNode doc createTextNode delegate getUserName 122 123 textPath appendChild textNode 124 textElement appendChild textPath 125 levelGroup appendChild textElement 126 parent getUserGroup appendChild levelGroup 127 parent getFileGroup appendChild fileGroup 128 129 13 131 protected GuiPeer 132 133 if log isDebugEnabled 134 135 log debug GuiPeer 136 137 138 139 14 TODO 141 142 return TODO 143 144 public Color getColor 145 146 return delegate getColor 147 148 149 15 DOCUMENT ME 151 152 return 153 154 public String getKey 155 156 return delegate getUniqueID 157 158 159 public Peer getDelegate 16 return delegate 161 162 163 164 TODO 165 166 return TODO 167 168 public boolean isLocal 169 17 return delegate getUniqueID equals PeerManager getLocalUserID 171 172 173 174 TODO 175 176 return TODO 177 178 public PieWorkSpace getParent 179 18 return parent 181 182 183 184 TODO 185 186 return TODO 187 188 public String getStringColor 189 19 return Util getStringColor getColor 191 192 193 194 TODO 195 196 return TODO 197 198 public Node getUserGroup 199 2 return levelGroup 2 1 2 2 2 3 2 4 TODO 2 5 2 6 param fe TODO 2 7 2 8 public void addFile FileElement fe 2 9 21 if fileDots get fe getKey null 211 212 if log isDebugEnabled 213 214 log debug File already exists fe getKey 215 216 return 217 218 if log isDebugEnabled 219 22 log debug sharingLevel1 is fe getShareDegree getValue 221 222 DotElement dot DotElementFactory createDotElement parent getDocument 223 fe 224 delegate getColor parent getDotSize 225 if log isDebugEnabled 226 227 log debug sharingLevel1 is fe getShareDegree getValue 228 229 23 only circle can receive that events 231 EventTarget dot getChildNodes item addEventListener SVGConstants SVG MOUSEDOWN EVENT TYPE 232 parent getView getMouseEvent 233 false 234 EventTarget dot getChildNodes item addEventListener SVGConstants SVG MOUSEOUT EVENT TYPE 235 parent getView getMouseEvent 236 false 237 EventTarget dot addEventListener SVGConstants SVG CLICK EVENT TYPE 238 parent getView getMouseEvent 239 false 24 EventTarget dot addEventListener SVGConstants SVG MOUSEOVER EVENT TYPE 241 parent getView getMouseEvent 242 false 243 244 if log isDebugEnabled 245 246 log debug relative angle in FileElement is fe getReangle 247 log debug radius in FileElement is fe getRadius 248 249 25 if fe hasReangle fe hasRadius 251 dot newLocation startAngle Util getAngle parent getPeerNumber fe getRadius fe getReangle 252 parent getPeerNumber parent getPeerIndex delegate getUniqueID 253 else 254 dot newLocation startAngle Util getAngle parent getPeerNumber parent getPeerNumber parent getPeerIndex delegate getUniqueID 255 256 257 if log isDebugEnabled 258 259 log debug add file to guipie fe getKey 26 261 fileGroup appendChild dot 262 fileDots put fe getKey dot 263 264 265 266 TODO 267 268 param start TODO 269 param peerNum TODO 27 271 return TODO 272 273 public double adjustAngle double start double arcAngle 274 275 NamedNodeMap gmap levelGroup getAttributes 276 277 tranform the group 278 startAngle start 279 28 String transform Util caculateTransformforPath PieWorkSpace getCenter 281 getX 282 PieWorkSpace getCenter 283 getY 284 start 285 286 levelGroup setAttributeNS null transform transform 287 gmap getNamedItem transform setNodeValue transform 288 289 change path for slices 29 for Iterator it levels values iterator it hasNext 291 292 PublicLevel level PublicLevel it next 293 294 level adjustAngle arcAngle 295 296 297 change tranform for files 298 transform Util getTranslateString PieWorkSpace getCenter getX 299 PieWorkSpace getCenter getY 3 fileGroup setAttributeNS null transform transform 3 1 3 2 for Iterator it fileDots values iterator it hasNext 3 3 3 4 DotElement dot DotElement it next 3 5 if dot getSharingLevel getValue 3 6 dot newLocation start arcAngle 3 7 dot setNumberOfUsers parent getPeerNumber parent getPeerIndex delegate getUniqueID 3 8 3 9 31 if this isLocal 311 312 String c getStringColor 313 parent getMaskLayer setAttribute style 314 fill c 315 stroke none opacity 1 316 Element clone Element levelGroup cloneNode true 317 NodeList nl clone getElementsByTagName path 318 clone removeChild nl item 319 32 NodeList childlist parent getMaskLayer getElementsByTagName g 321 322 for int j j nl getLength j 323 324 Element child Element nl item j 325 child removeAttribute fill 326 child removeAttribute stroke 327 328 if childlist getLength 329 suppose there is only g child 33 parent getMaskLayer replaceChild clone childlist item 331 else 332 parent getMaskLayer appendChild clone 333 334 335 336 return start arcAngle 337 338 339 34 TODO 341 342 public void detach 343 344 parent getUserGroup removeChild levelGroup 345 parent getFileGroup removeChild fileGroup 346 347 348 349 param fileKey 35 351 public void removeFile String fileKey 352 if log isDebugEnabled 353 354 log debug the file to remove is fileKey 355 356 Element dot Element fileDots get fileKey 357 if dot null 358 Node p dot getParentNode 359 p removeChild dot 36 fileDots remove fileKey 361 362 363 364 365 param key 366 367 public DotElement getDot String key 368 369 DotElement dot DotElement fileDots get key 37 return dot 371 372 373 374 375 return 376 377 public double getStartAngle 378 return this startAngle 379 38 381 382 param dotSize 383 384 public void setDotSize int dotSize 385 for Iterator it fileDots values iterator it hasNext 386 387 DotElement dot DotElement it next 388 dot setSize dotSize 389 39 391 This page was automatically generated by Maven", "_id": "http://drzaius.ics.uci.edu/~swirl/impromptu-0.20/xref/swirl/workspace/viz/pie/GuiPeer.html", "title": "guipeer xref", "html": "<!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Transitional//EN\" \"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd\">\n<html xmlns=\"http://www.w3.org/1999/xhtml\" xml:lang=\"en\" lang=\"en\">\n<head>\n<meta http-equiv=\"content-type\" content=\"text/html; charset=ISO-8859-1\" /><title>GuiPeer xref</title>\n<link type=\"text/css\" rel=\"stylesheet\" href=\"../../../../stylesheet.css\" />\n</head>\n<body>\n<div id=\"overview\"><a href=\"../../../../../apidocs/swirl/workspace/viz/pie/GuiPeer.html\">View Javadoc</a></div><pre>\n\n<a name=\"1\" href=\"#1\">1</a>   <em class=\"comment\">/*</em>\n<a name=\"2\" href=\"#2\">2</a>   <em class=\"comment\"> * Created on Sep 2, 2004</em>\n<a name=\"3\" href=\"#3\">3</a>   <em class=\"comment\"> *</em>\n<a name=\"4\" href=\"#4\">4</a>   <em class=\"comment\"> */</em>\n<a name=\"5\" href=\"#5\">5</a>   <strong>package</strong> <a href=\"../../../../swirl/workspace/viz/pie/package-summary.html\">swirl.workspace.viz.pie</a>;\n<a name=\"6\" href=\"#6\">6</a>   \n<a name=\"7\" href=\"#7\">7</a>   <strong>import</strong> java.awt.Color;\n<a name=\"8\" href=\"#8\">8</a>   <strong>import</strong> java.util.HashMap;\n<a name=\"9\" href=\"#9\">9</a>   <strong>import</strong> java.util.Iterator;\n<a name=\"10\" href=\"#10\">10</a>  <strong>import</strong> java.util.Map;\n<a name=\"11\" href=\"#11\">11</a>  \n<a name=\"12\" href=\"#12\">12</a>  <strong>import</strong> org.apache.batik.dom.util.XLinkSupport;\n<a name=\"13\" href=\"#13\">13</a>  <strong>import</strong> org.apache.batik.util.SVGConstants;\n<a name=\"14\" href=\"#14\">14</a>  <strong>import</strong> org.apache.commons.logging.Log;\n<a name=\"15\" href=\"#15\">15</a>  <strong>import</strong> org.apache.commons.logging.LogFactory;\n<a name=\"16\" href=\"#16\">16</a>  <strong>import</strong> org.w3c.dom.Document;\n<a name=\"17\" href=\"#17\">17</a>  <strong>import</strong> org.w3c.dom.Element;\n<a name=\"18\" href=\"#18\">18</a>  <strong>import</strong> org.w3c.dom.NamedNodeMap;\n<a name=\"19\" href=\"#19\">19</a>  <strong>import</strong> org.w3c.dom.Node;\n<a name=\"20\" href=\"#20\">20</a>  <strong>import</strong> org.w3c.dom.NodeList;\n<a name=\"21\" href=\"#21\">21</a>  <strong>import</strong> org.w3c.dom.events.EventTarget;\n<a name=\"22\" href=\"#22\">22</a>  \n<a name=\"23\" href=\"#23\">23</a>  <strong>import</strong> swirl.workspace.Peer;\n<a name=\"24\" href=\"#24\">24</a>  <strong>import</strong> swirl.workspace.PeerManager;\n<a name=\"25\" href=\"#25\">25</a>  <strong>import</strong> swirl.workspace.viz.SharingLevel;\n<a name=\"26\" href=\"#26\">26</a>  \n<a name=\"27\" href=\"#27\">27</a>  <em>/**<em>*</em></em>\n<a name=\"28\" href=\"#28\">28</a>  <em> * DOCUMENT ME!</em>\n<a name=\"29\" href=\"#29\">29</a>  <em> *</em>\n<a name=\"30\" href=\"#30\">30</a>  <em> * @author dingx</em>\n<a name=\"31\" href=\"#31\">31</a>  <em> */</em>\n<a name=\"32\" href=\"#32\">32</a>  <strong>public</strong> <strong>class</strong> <a href=\"../../../../swirl/workspace/viz/pie/GuiPeer.html\">GuiPeer</a>\n<a name=\"33\" href=\"#33\">33</a>  {\n<a name=\"34\" href=\"#34\">34</a>      <em class=\"comment\">//the group to hold filedots</em>\n<a name=\"35\" href=\"#35\">35</a>  \n<a name=\"36\" href=\"#36\">36</a>      <em>/**<em>* TODO */</em></em>\n<a name=\"37\" href=\"#37\">37</a>      <strong>private</strong> Element fileGroup;\n<a name=\"38\" href=\"#38\">38</a>  \n<a name=\"39\" href=\"#39\">39</a>      <em class=\"comment\">//the group to hold background pies</em>\n<a name=\"40\" href=\"#40\">40</a>  \n<a name=\"41\" href=\"#41\">41</a>      <em>/**<em>* TODO */</em></em>\n<a name=\"42\" href=\"#42\">42</a>      <strong>private</strong> Element levelGroup;\n<a name=\"43\" href=\"#43\">43</a>  \n<a name=\"44\" href=\"#44\">44</a>      <em class=\"comment\">//user name element</em>\n<a name=\"45\" href=\"#45\">45</a>  \n<a name=\"46\" href=\"#46\">46</a>      <em>/**<em>* TODO */</em></em>\n<a name=\"47\" href=\"#47\">47</a>      <strong>private</strong> Element textElement;\n<a name=\"48\" href=\"#48\">48</a>  \n<a name=\"49\" href=\"#49\">49</a>      <em>/**<em>* TODO */</em></em>\n<a name=\"50\" href=\"#50\">50</a>      <strong>private</strong> Log log = LogFactory.getLog(<strong>this</strong>.getClass());\n<a name=\"51\" href=\"#51\">51</a>  \n<a name=\"52\" href=\"#52\">52</a>      <em>/**<em>* TODO */</em></em>\n<a name=\"53\" href=\"#53\">53</a>      <strong>private</strong> Map fileDots = <strong>new</strong> HashMap();\n<a name=\"54\" href=\"#54\">54</a>  \n<a name=\"55\" href=\"#55\">55</a>      <em>/**<em>* TODO */</em></em>\n<a name=\"56\" href=\"#56\">56</a>      <strong>private</strong> Map levels = <strong>new</strong> HashMap();\n<a name=\"57\" href=\"#57\">57</a>  \n<a name=\"58\" href=\"#58\">58</a>      <em>/**<em>* TODO */</em></em>\n<a name=\"59\" href=\"#59\">59</a>      <strong>private</strong> <a href=\"../../../../swirl/workspace/Peer.html\">Peer</a> delegate;\n<a name=\"60\" href=\"#60\">60</a>  \n<a name=\"61\" href=\"#61\">61</a>      <em>/**<em>* TODO */</em></em>\n<a name=\"62\" href=\"#62\">62</a>      <strong>private</strong> <a href=\"../../../../swirl/workspace/viz/pie/PieWorkSpace.html\">PieWorkSpace</a> parent;\n<a name=\"63\" href=\"#63\">63</a>  \n<a name=\"64\" href=\"#64\">64</a>      <em class=\"comment\">//the start angle for this pie</em>\n<a name=\"65\" href=\"#65\">65</a>  \n<a name=\"66\" href=\"#66\">66</a>      <em>/**<em>* TODO */</em></em>\n<a name=\"67\" href=\"#67\">67</a>      <strong>private</strong> <strong>double</strong> startAngle;\n<a name=\"68\" href=\"#68\">68</a>  \n<a name=\"69\" href=\"#69\">69</a>      <em>/**<em>*</em></em>\n<a name=\"70\" href=\"#70\">70</a>  <em>     * Creates a new GuiPeer object.</em>\n<a name=\"71\" href=\"#71\">71</a>  <em>     *</em>\n<a name=\"72\" href=\"#72\">72</a>  <em>     * @param peer TODO</em>\n<a name=\"73\" href=\"#73\">73</a>  <em>     * @param doc TODO</em>\n<a name=\"74\" href=\"#74\">74</a>  <em>     * @param start TODO</em>\n<a name=\"75\" href=\"#75\">75</a>  <em>     * @param workspace TODO</em>\n<a name=\"76\" href=\"#76\">76</a>  <em>     */</em>\n<a name=\"77\" href=\"#77\">77</a>      <strong>public</strong> <a href=\"../../../../swirl/workspace/viz/pie/GuiPeer.html\">GuiPeer</a>(<a href=\"../../../../swirl/workspace/Peer.html\">Peer</a> peer, Document doc, <a href=\"../../../../swirl/workspace/viz/pie/PieWorkSpace.html\">PieWorkSpace</a> workspace)\n<a name=\"78\" href=\"#78\">78</a>      {\n<a name=\"79\" href=\"#79\">79</a>          delegate = peer;\n<a name=\"80\" href=\"#80\">80</a>          parent = workspace;\n<a name=\"81\" href=\"#81\">81</a>          <em class=\"comment\">//change the paths for the user name text</em>\n<a name=\"82\" href=\"#82\">82</a>          Node tpnode = doc.getElementById(PieWorkSpace.TEXT_PATH_ID);\n<a name=\"83\" href=\"#83\">83</a>          NamedNodeMap tpmap = tpnode.getAttributes();\n<a name=\"84\" href=\"#84\">84</a>  \n<a name=\"85\" href=\"#85\">85</a>          <em class=\"comment\">//make the text at the outer of the circle</em>\n<a name=\"86\" href=\"#86\">86</a>          String d = Util.caculateDforPath(PieWorkSpace.RADIUS + 5,\n<a name=\"87\" href=\"#87\">87</a>          \t\tworkspace.getPeerNumber() + 1);\n<a name=\"88\" href=\"#88\">88</a>  \n<a name=\"89\" href=\"#89\">89</a>          (tpmap.getNamedItem(<span class=\"string\">\"d\"</span>)).setNodeValue(d);\n<a name=\"90\" href=\"#90\">90</a>  \n<a name=\"91\" href=\"#91\">91</a>  \n<a name=\"92\" href=\"#92\">92</a>          String userID = peer.getUniqueID();\n<a name=\"93\" href=\"#93\">93</a>  \n<a name=\"94\" href=\"#94\">94</a>          levelGroup = doc.createElementNS(PieWorkSpace.svgNS, <span class=\"string\">\"g\"</span>);\n<a name=\"95\" href=\"#95\">95</a>  \n<a name=\"96\" href=\"#96\">96</a>          levelGroup.setAttributeNS(<strong>null</strong>, <span class=\"string\">\"id\"</span>, userID);\n<a name=\"97\" href=\"#97\">97</a>  \n<a name=\"98\" href=\"#98\">98</a>          <strong>for</strong>(<strong>int</strong> i = 0; i &lt; SharingLevel.SHARING_LEVEL; i++)\n<a name=\"99\" href=\"#99\">99</a>          {\n<a name=\"100\" href=\"#100\">100</a>             <a href=\"../../../../swirl/workspace/viz/pie/PublicLevel.html\">PublicLevel</a> level = <strong>new</strong> <a href=\"../../../../swirl/workspace/viz/pie/PublicLevel.html\">PublicLevel</a>(<strong>this</strong>, doc, <strong>new</strong> <a href=\"../../../../swirl/workspace/viz/SharingLevel.html\">SharingLevel</a>(i));\n<a name=\"101\" href=\"#101\">101</a> \n<a name=\"102\" href=\"#102\">102</a>             levels.put(String.valueOf(i), level);\n<a name=\"103\" href=\"#103\">103</a>         }\n<a name=\"104\" href=\"#104\">104</a> \n<a name=\"105\" href=\"#105\">105</a>         fileGroup = doc.createElementNS(PieWorkSpace.svgNS, <span class=\"string\">\"g\"</span>);\n<a name=\"106\" href=\"#106\">106</a>         fileGroup.setAttributeNS(<strong>null</strong>, <span class=\"string\">\"id\"</span>, Util.getFileGroupforUser(userID));\n<a name=\"107\" href=\"#107\">107</a>          <em class=\"comment\">//creat track for the text</em>\n<a name=\"108\" href=\"#108\">108</a>         String c = getStringColor();\n<a name=\"109\" href=\"#109\">109</a> \n<a name=\"110\" href=\"#110\">110</a>         <em class=\"comment\">//creat text element\t\t</em>\n<a name=\"111\" href=\"#111\">111</a>         textElement = doc.createElementNS(PieWorkSpace.svgNS, <span class=\"string\">\"text\"</span>);\n<a name=\"112\" href=\"#112\">112</a>         textElement.setAttributeNS(<strong>null</strong>, <span class=\"string\">\"font-family\"</span>, <span class=\"string\">\"verdana\"</span>);\n<a name=\"113\" href=\"#113\">113</a>         textElement.setAttributeNS(<strong>null</strong>, <span class=\"string\">\"font-size\"</span>, <span class=\"string\">\"18\"</span>);\n<a name=\"114\" href=\"#114\">114</a>         textElement.setAttributeNS(<strong>null</strong>, <span class=\"string\">\"fill\"</span>, c);\n<a name=\"115\" href=\"#115\">115</a>         \n<a name=\"116\" href=\"#116\">116</a>         Element textPath = doc.createElementNS(PieWorkSpace.svgNS, <span class=\"string\">\"textPath\"</span>);\n<a name=\"117\" href=\"#117\">117</a> \n<a name=\"118\" href=\"#118\">118</a>         XLinkSupport.setXLinkHref(textPath, <span class=\"string\">\"#\"</span> + PieWorkSpace.TEXT_PATH_ID);\n<a name=\"119\" href=\"#119\">119</a>         textPath.setAttributeNS(<strong>null</strong>, <span class=\"string\">\"startOffset\"</span>, <span class=\"string\">\"47%\"</span>);\n<a name=\"120\" href=\"#120\">120</a> \n<a name=\"121\" href=\"#121\">121</a>         Node textNode = doc.createTextNode(delegate.getUserName());\n<a name=\"122\" href=\"#122\">122</a> \n<a name=\"123\" href=\"#123\">123</a>         textPath.appendChild(textNode);\n<a name=\"124\" href=\"#124\">124</a>         textElement.appendChild(textPath);\n<a name=\"125\" href=\"#125\">125</a>         levelGroup.appendChild(textElement);\n<a name=\"126\" href=\"#126\">126</a>         parent.getUserGroup().appendChild(levelGroup);\n<a name=\"127\" href=\"#127\">127</a>         parent.getFileGroup().appendChild(fileGroup);\n<a name=\"128\" href=\"#128\">128</a>     \n<a name=\"129\" href=\"#129\">129</a>    }\n<a name=\"130\" href=\"#130\">130</a> \n<a name=\"131\" href=\"#131\">131</a>     <strong>protected</strong> <a href=\"../../../../swirl/workspace/viz/pie/GuiPeer.html\">GuiPeer</a>()\n<a name=\"132\" href=\"#132\">132</a>     {\n<a name=\"133\" href=\"#133\">133</a>         <strong>if</strong>(log.isDebugEnabled())\n<a name=\"134\" href=\"#134\">134</a>         {\n<a name=\"135\" href=\"#135\">135</a>             log.debug(<span class=\"string\">\"(GuiPeer)\"</span>);\n<a name=\"136\" href=\"#136\">136</a>         }\n<a name=\"137\" href=\"#137\">137</a>     }\n<a name=\"138\" href=\"#138\">138</a> \n<a name=\"139\" href=\"#139\">139</a>     <em>/**<em>*</em></em>\n<a name=\"140\" href=\"#140\">140</a> <em>     * TODO</em>\n<a name=\"141\" href=\"#141\">141</a> <em>     *</em>\n<a name=\"142\" href=\"#142\">142</a> <em>     * @return TODO</em>\n<a name=\"143\" href=\"#143\">143</a> <em>     */</em>\n<a name=\"144\" href=\"#144\">144</a>     <strong>public</strong> Color getColor()\n<a name=\"145\" href=\"#145\">145</a>     {\n<a name=\"146\" href=\"#146\">146</a>         <strong>return</strong> delegate.getColor();\n<a name=\"147\" href=\"#147\">147</a>     }\n<a name=\"148\" href=\"#148\">148</a> \n<a name=\"149\" href=\"#149\">149</a>     <em>/**<em>*</em></em>\n<a name=\"150\" href=\"#150\">150</a> <em>     * DOCUMENT ME!</em>\n<a name=\"151\" href=\"#151\">151</a> <em>     *</em>\n<a name=\"152\" href=\"#152\">152</a> <em>     * @return</em>\n<a name=\"153\" href=\"#153\">153</a> <em>     */</em>\n<a name=\"154\" href=\"#154\">154</a>     <strong>public</strong> String getKey()\n<a name=\"155\" href=\"#155\">155</a>     {\n<a name=\"156\" href=\"#156\">156</a>         <strong>return</strong> delegate.getUniqueID();\n<a name=\"157\" href=\"#157\">157</a>     }\n<a name=\"158\" href=\"#158\">158</a> \n<a name=\"159\" href=\"#159\">159</a>     <strong>public</strong> <a href=\"../../../../swirl/workspace/Peer.html\">Peer</a> getDelegate() {\n<a name=\"160\" href=\"#160\">160</a>         <strong>return</strong> delegate;\n<a name=\"161\" href=\"#161\">161</a>     }\n<a name=\"162\" href=\"#162\">162</a> \n<a name=\"163\" href=\"#163\">163</a>     <em>/**<em>*</em></em>\n<a name=\"164\" href=\"#164\">164</a> <em>     * TODO</em>\n<a name=\"165\" href=\"#165\">165</a> <em>     *</em>\n<a name=\"166\" href=\"#166\">166</a> <em>     * @return TODO</em>\n<a name=\"167\" href=\"#167\">167</a> <em>     */</em>\n<a name=\"168\" href=\"#168\">168</a>     <strong>public</strong> <strong>boolean</strong> isLocal()\n<a name=\"169\" href=\"#169\">169</a>     {\n<a name=\"170\" href=\"#170\">170</a>         <strong>return</strong> delegate.getUniqueID().equals(PeerManager.getLocalUserID());\n<a name=\"171\" href=\"#171\">171</a>     }\n<a name=\"172\" href=\"#172\">172</a> \n<a name=\"173\" href=\"#173\">173</a>     <em>/**<em>*</em></em>\n<a name=\"174\" href=\"#174\">174</a> <em>     * TODO</em>\n<a name=\"175\" href=\"#175\">175</a> <em>     *</em>\n<a name=\"176\" href=\"#176\">176</a> <em>     * @return TODO</em>\n<a name=\"177\" href=\"#177\">177</a> <em>     */</em>\n<a name=\"178\" href=\"#178\">178</a>     <strong>public</strong> <a href=\"../../../../swirl/workspace/viz/pie/PieWorkSpace.html\">PieWorkSpace</a> getParent()\n<a name=\"179\" href=\"#179\">179</a>     {\n<a name=\"180\" href=\"#180\">180</a>         <strong>return</strong> parent;\n<a name=\"181\" href=\"#181\">181</a>     }\n<a name=\"182\" href=\"#182\">182</a> \n<a name=\"183\" href=\"#183\">183</a>     <em>/**<em>*</em></em>\n<a name=\"184\" href=\"#184\">184</a> <em>     * TODO</em>\n<a name=\"185\" href=\"#185\">185</a> <em>     *</em>\n<a name=\"186\" href=\"#186\">186</a> <em>     * @return TODO</em>\n<a name=\"187\" href=\"#187\">187</a> <em>     */</em>\n<a name=\"188\" href=\"#188\">188</a>     <strong>public</strong> String getStringColor()\n<a name=\"189\" href=\"#189\">189</a>     {\n<a name=\"190\" href=\"#190\">190</a>         <strong>return</strong> Util.getStringColor(getColor());\n<a name=\"191\" href=\"#191\">191</a>     }\n<a name=\"192\" href=\"#192\">192</a> \n<a name=\"193\" href=\"#193\">193</a>     <em>/**<em>*</em></em>\n<a name=\"194\" href=\"#194\">194</a> <em>     * TODO</em>\n<a name=\"195\" href=\"#195\">195</a> <em>     *</em>\n<a name=\"196\" href=\"#196\">196</a> <em>     * @return TODO</em>\n<a name=\"197\" href=\"#197\">197</a> <em>     */</em>\n<a name=\"198\" href=\"#198\">198</a>     <strong>public</strong> Node getUserGroup()\n<a name=\"199\" href=\"#199\">199</a>     {\n<a name=\"200\" href=\"#200\">200</a>         <strong>return</strong> levelGroup;\n<a name=\"201\" href=\"#201\">201</a>     }\n<a name=\"202\" href=\"#202\">202</a> \n<a name=\"203\" href=\"#203\">203</a>     <em>/**<em>*</em></em>\n<a name=\"204\" href=\"#204\">204</a> <em>     * TODO</em>\n<a name=\"205\" href=\"#205\">205</a> <em>     *</em>\n<a name=\"206\" href=\"#206\">206</a> <em>     * @param fe TODO</em>\n<a name=\"207\" href=\"#207\">207</a> <em>     */</em>\n<a name=\"208\" href=\"#208\">208</a>     <strong>public</strong> <strong>void</strong> addFile(<a href=\"../../../../swirl/workspace/viz/pie/FileElement.html\">FileElement</a> fe)\n<a name=\"209\" href=\"#209\">209</a>     {\n<a name=\"210\" href=\"#210\">210</a>         <strong>if</strong>(fileDots.get(fe.getKey()) != <strong>null</strong>)\n<a name=\"211\" href=\"#211\">211</a>         {\n<a name=\"212\" href=\"#212\">212</a>         \t<strong>if</strong>(log.isDebugEnabled())\n<a name=\"213\" href=\"#213\">213</a>             {\n<a name=\"214\" href=\"#214\">214</a>         \t\tlog.debug(<span class=\"string\">\"File already exists:\"</span> + fe.getKey());\n<a name=\"215\" href=\"#215\">215</a>             }\n<a name=\"216\" href=\"#216\">216</a>             <strong>return</strong>;\n<a name=\"217\" href=\"#217\">217</a>         }\n<a name=\"218\" href=\"#218\">218</a>         <strong>if</strong>(log.isDebugEnabled())\n<a name=\"219\" href=\"#219\">219</a>         {\n<a name=\"220\" href=\"#220\">220</a>         \tlog.debug(<span class=\"string\">\"sharingLevel1 is \"</span> + fe.getShareDegree().getValue());\n<a name=\"221\" href=\"#221\">221</a>         }\n<a name=\"222\" href=\"#222\">222</a>         <a href=\"../../../../swirl/workspace/viz/pie/DotElement.html\">DotElement</a> dot = DotElementFactory.createDotElement(parent.getDocument(),\n<a name=\"223\" href=\"#223\">223</a>                                                             fe,\n<a name=\"224\" href=\"#224\">224</a>                                                             delegate.getColor(), parent.getDotSize());\n<a name=\"225\" href=\"#225\">225</a>         <strong>if</strong>(log.isDebugEnabled())\n<a name=\"226\" href=\"#226\">226</a>         {\n<a name=\"227\" href=\"#227\">227</a>         \tlog.debug(<span class=\"string\">\"sharingLevel1 is \"</span> + fe.getShareDegree().getValue());\n<a name=\"228\" href=\"#228\">228</a>         }\n<a name=\"229\" href=\"#229\">229</a> \n<a name=\"230\" href=\"#230\">230</a>         <em class=\"comment\">//only circle can receive that events</em>\n<a name=\"231\" href=\"#231\">231</a>         ((EventTarget)dot.getChildNodes().item(0)).addEventListener(SVGConstants.SVG_MOUSEDOWN_EVENT_TYPE,\n<a name=\"232\" href=\"#232\">232</a>                                             parent.getView().getMouseEvent(),\n<a name=\"233\" href=\"#233\">233</a>                                             false);\n<a name=\"234\" href=\"#234\">234</a>         ((EventTarget)dot.getChildNodes().item(0)).addEventListener(SVGConstants.SVG_MOUSEOUT_EVENT_TYPE,\n<a name=\"235\" href=\"#235\">235</a>                 parent.getView().getMouseEvent(),\n<a name=\"236\" href=\"#236\">236</a>                 false);\n<a name=\"237\" href=\"#237\">237</a>         ((EventTarget)dot).addEventListener(SVGConstants.SVG_CLICK_EVENT_TYPE,\n<a name=\"238\" href=\"#238\">238</a>                                             parent.getView().getMouseEvent(),\n<a name=\"239\" href=\"#239\">239</a>                                             false);\n<a name=\"240\" href=\"#240\">240</a>         ((EventTarget)dot).addEventListener(SVGConstants.SVG_MOUSEOVER_EVENT_TYPE,\n<a name=\"241\" href=\"#241\">241</a>                 parent.getView().getMouseEvent(),\n<a name=\"242\" href=\"#242\">242</a>                 false);\n<a name=\"243\" href=\"#243\">243</a> \n<a name=\"244\" href=\"#244\">244</a>         <strong>if</strong>(log.isDebugEnabled())\n<a name=\"245\" href=\"#245\">245</a>         {\n<a name=\"246\" href=\"#246\">246</a>         \tlog.debug(<span class=\"string\">\"relative angle in FileElement is \"</span> + fe.getReangle());\n<a name=\"247\" href=\"#247\">247</a>         \tlog.debug(<span class=\"string\">\"radius in FileElement is \"</span> + fe.getRadius());\n<a name=\"248\" href=\"#248\">248</a>         }\n<a name=\"249\" href=\"#249\">249</a>         \n<a name=\"250\" href=\"#250\">250</a>         <strong>if</strong>(fe.hasReangle() &amp;&amp; fe.hasRadius()){\n<a name=\"251\" href=\"#251\">251</a>         \tdot.newLocation(startAngle, Util.getAngle(parent.getPeerNumber()),fe.getRadius(), fe.getReangle(),\n<a name=\"252\" href=\"#252\">252</a>         \t\t\tparent.getPeerNumber(), parent.getPeerIndex(delegate.getUniqueID()));\n<a name=\"253\" href=\"#253\">253</a>         } <strong>else</strong> {\n<a name=\"254\" href=\"#254\">254</a>         \tdot.newLocation(startAngle, Util.getAngle(parent.getPeerNumber()), parent.getPeerNumber(), parent.getPeerIndex(delegate.getUniqueID()));\t\t\n<a name=\"255\" href=\"#255\">255</a>         }\n<a name=\"256\" href=\"#256\">256</a>         \n<a name=\"257\" href=\"#257\">257</a>         <strong>if</strong>(log.isDebugEnabled())\n<a name=\"258\" href=\"#258\">258</a>         {\n<a name=\"259\" href=\"#259\">259</a>         \tlog.debug(<span class=\"string\">\"add file to guipie:\"</span> + fe.getKey());\n<a name=\"260\" href=\"#260\">260</a>         }\n<a name=\"261\" href=\"#261\">261</a>         fileGroup.appendChild(dot);\n<a name=\"262\" href=\"#262\">262</a>         fileDots.put(fe.getKey(), dot);\n<a name=\"263\" href=\"#263\">263</a>     }\n<a name=\"264\" href=\"#264\">264</a> \n<a name=\"265\" href=\"#265\">265</a>     <em>/**<em>*</em></em>\n<a name=\"266\" href=\"#266\">266</a> <em>     * TODO</em>\n<a name=\"267\" href=\"#267\">267</a> <em>     *</em>\n<a name=\"268\" href=\"#268\">268</a> <em>     * @param start TODO</em>\n<a name=\"269\" href=\"#269\">269</a> <em>     * @param peerNum TODO</em>\n<a name=\"270\" href=\"#270\">270</a> <em>     *</em>\n<a name=\"271\" href=\"#271\">271</a> <em>     * @return TODO</em>\n<a name=\"272\" href=\"#272\">272</a> <em>     */</em>\n<a name=\"273\" href=\"#273\">273</a>     <strong>public</strong> <strong>double</strong> adjustAngle(<strong>double</strong> start, <strong>double</strong> arcAngle)\n<a name=\"274\" href=\"#274\">274</a>     {\n<a name=\"275\" href=\"#275\">275</a>         NamedNodeMap gmap = levelGroup.getAttributes();\n<a name=\"276\" href=\"#276\">276</a> \n<a name=\"277\" href=\"#277\">277</a>         <em class=\"comment\">//tranform the group</em>\n<a name=\"278\" href=\"#278\">278</a>         startAngle = start;\n<a name=\"279\" href=\"#279\">279</a> \n<a name=\"280\" href=\"#280\">280</a>         String transform = Util.caculateTransformforPath(PieWorkSpace.getCenter()\n<a name=\"281\" href=\"#281\">281</a>                                                                      .getX(),\n<a name=\"282\" href=\"#282\">282</a>                                                          PieWorkSpace.getCenter()\n<a name=\"283\" href=\"#283\">283</a>                                                                      .getY(),\n<a name=\"284\" href=\"#284\">284</a>                                                          start);\n<a name=\"285\" href=\"#285\">285</a> \n<a name=\"286\" href=\"#286\">286</a>         levelGroup.setAttributeNS(<strong>null</strong>, <span class=\"string\">\"transform\"</span>, transform);\n<a name=\"287\" href=\"#287\">287</a>      <em class=\"comment\">//   (gmap.getNamedItem(\"transform\")).setNodeValue(transform);</em>\n<a name=\"288\" href=\"#288\">288</a> \n<a name=\"289\" href=\"#289\">289</a>         <em class=\"comment\">//change path for slices</em>\n<a name=\"290\" href=\"#290\">290</a>         <strong>for</strong>(Iterator it = levels.values().iterator(); it.hasNext();)\n<a name=\"291\" href=\"#291\">291</a>         {\n<a name=\"292\" href=\"#292\">292</a>             <a href=\"../../../../swirl/workspace/viz/pie/PublicLevel.html\">PublicLevel</a> level = (PublicLevel)it.next();\n<a name=\"293\" href=\"#293\">293</a> \n<a name=\"294\" href=\"#294\">294</a>             level.adjustAngle(arcAngle);\n<a name=\"295\" href=\"#295\">295</a>         }\n<a name=\"296\" href=\"#296\">296</a> \n<a name=\"297\" href=\"#297\">297</a>         <em class=\"comment\">//change tranform for files</em>\n<a name=\"298\" href=\"#298\">298</a>         transform = Util.getTranslateString(PieWorkSpace.getCenter().getX(),\n<a name=\"299\" href=\"#299\">299</a>                                          PieWorkSpace.getCenter().getY());\n<a name=\"300\" href=\"#300\">300</a>         fileGroup.setAttributeNS(<strong>null</strong>, <span class=\"string\">\"transform\"</span>, transform);\n<a name=\"301\" href=\"#301\">301</a> \n<a name=\"302\" href=\"#302\">302</a>         <strong>for</strong>(Iterator it = fileDots.values().iterator(); it.hasNext();)\n<a name=\"303\" href=\"#303\">303</a>         {\n<a name=\"304\" href=\"#304\">304</a>             <a href=\"../../../../swirl/workspace/viz/pie/DotElement.html\">DotElement</a> dot = (DotElement)it.next();\n<a name=\"305\" href=\"#305\">305</a>             <em class=\"comment\">//if(dot.getSharingLevel().getValue() != 0){</em>\n<a name=\"306\" href=\"#306\">306</a>             \t<em class=\"comment\">//dot.newLocation(start, arcAngle);</em>\n<a name=\"307\" href=\"#307\">307</a> \t\t\t\tdot.setNumberOfUsers(parent.getPeerNumber(), parent.getPeerIndex(delegate.getUniqueID()));\n<a name=\"308\" href=\"#308\">308</a>             <em class=\"comment\">//}</em>\n<a name=\"309\" href=\"#309\">309</a>         }\n<a name=\"310\" href=\"#310\">310</a>         <strong>if</strong>(<strong>this</strong>.isLocal())\n<a name=\"311\" href=\"#311\">311</a>         {\n<a name=\"312\" href=\"#312\">312</a>             String c = getStringColor();\n<a name=\"313\" href=\"#313\">313</a>         \tparent.getMaskLayer().setAttribute(<span class=\"string\">\"style\"</span>,\n<a name=\"314\" href=\"#314\">314</a>                     <span class=\"string\">\"fill:\"</span> + c\n<a name=\"315\" href=\"#315\">315</a>                     + <span class=\"string\">\";stroke:none;opacity:.1\"</span>);\n<a name=\"316\" href=\"#316\">316</a>             Element clone = (Element)levelGroup.cloneNode(<strong>true</strong>);\n<a name=\"317\" href=\"#317\">317</a>             NodeList nl = clone.getElementsByTagName(<span class=\"string\">\"path\"</span>);\n<a name=\"318\" href=\"#318\">318</a>             clone.removeChild(nl.item(0));\n<a name=\"319\" href=\"#319\">319</a>             \n<a name=\"320\" href=\"#320\">320</a>             NodeList childlist = parent.getMaskLayer().getElementsByTagName(<span class=\"string\">\"g\"</span>);\n<a name=\"321\" href=\"#321\">321</a> \n<a name=\"322\" href=\"#322\">322</a>             <strong>for</strong>(<strong>int</strong> j = 0; j &lt; nl.getLength(); j++)\n<a name=\"323\" href=\"#323\">323</a>             {\n<a name=\"324\" href=\"#324\">324</a>                 Element child = (Element)nl.item(j);\n<a name=\"325\" href=\"#325\">325</a>                 child.removeAttribute(<span class=\"string\">\"fill\"</span>);\n<a name=\"326\" href=\"#326\">326</a>                 child.removeAttribute(<span class=\"string\">\"stroke\"</span>);\n<a name=\"327\" href=\"#327\">327</a>             }\n<a name=\"328\" href=\"#328\">328</a>             <strong>if</strong>(childlist.getLength() > 0){\n<a name=\"329\" href=\"#329\">329</a>             \t<em class=\"comment\">//suppose there is only g child</em>\n<a name=\"330\" href=\"#330\">330</a>             \tparent.getMaskLayer().replaceChild(clone, childlist.item(0));\n<a name=\"331\" href=\"#331\">331</a>             }<strong>else</strong>{\n<a name=\"332\" href=\"#332\">332</a>             \tparent.getMaskLayer().appendChild(clone);\n<a name=\"333\" href=\"#333\">333</a>             }\n<a name=\"334\" href=\"#334\">334</a>             \n<a name=\"335\" href=\"#335\">335</a>         }\n<a name=\"336\" href=\"#336\">336</a>         <strong>return</strong> start + arcAngle;\n<a name=\"337\" href=\"#337\">337</a>     }\n<a name=\"338\" href=\"#338\">338</a> \n<a name=\"339\" href=\"#339\">339</a>     <em>/**<em>*</em></em>\n<a name=\"340\" href=\"#340\">340</a> <em>     * TODO</em>\n<a name=\"341\" href=\"#341\">341</a> <em>     */</em>\n<a name=\"342\" href=\"#342\">342</a>     <strong>public</strong> <strong>void</strong> detach()\n<a name=\"343\" href=\"#343\">343</a>     {\n<a name=\"344\" href=\"#344\">344</a>     \tparent.getUserGroup().removeChild(levelGroup);\n<a name=\"345\" href=\"#345\">345</a>         parent.getFileGroup().removeChild(fileGroup);\n<a name=\"346\" href=\"#346\">346</a>     }\n<a name=\"347\" href=\"#347\">347</a> \n<a name=\"348\" href=\"#348\">348</a> \t<em>/**<em>*</em></em>\n<a name=\"349\" href=\"#349\">349</a> <em>\t * @param fileKey</em>\n<a name=\"350\" href=\"#350\">350</a> <em>\t */</em>\n<a name=\"351\" href=\"#351\">351</a> \t<strong>public</strong> <strong>void</strong> removeFile(String fileKey) {\n<a name=\"352\" href=\"#352\">352</a> \t\t<strong>if</strong>(log.isDebugEnabled())\n<a name=\"353\" href=\"#353\">353</a>         {\n<a name=\"354\" href=\"#354\">354</a> \t\t\tlog.debug(<span class=\"string\">\"the file to remove is \"</span> + fileKey);\n<a name=\"355\" href=\"#355\">355</a>         }\n<a name=\"356\" href=\"#356\">356</a> \t\tElement dot = (Element)fileDots.get(fileKey);\n<a name=\"357\" href=\"#357\">357</a> \t\t<strong>if</strong> (dot != <strong>null</strong>) {\n<a name=\"358\" href=\"#358\">358</a> \t\t\tNode p = dot.getParentNode();\n<a name=\"359\" href=\"#359\">359</a> \t\t\tp.removeChild(dot);\n<a name=\"360\" href=\"#360\">360</a> \t\t\tfileDots.remove(fileKey);\n<a name=\"361\" href=\"#361\">361</a> \t\t}\n<a name=\"362\" href=\"#362\">362</a> \t}\n<a name=\"363\" href=\"#363\">363</a> \n<a name=\"364\" href=\"#364\">364</a> \t<em>/**<em>*</em></em>\n<a name=\"365\" href=\"#365\">365</a> <em>\t * @param key</em>\n<a name=\"366\" href=\"#366\">366</a> <em>\t */</em>\n<a name=\"367\" href=\"#367\">367</a> \t<strong>public</strong> <a href=\"../../../../swirl/workspace/viz/pie/DotElement.html\">DotElement</a> getDot(String key) {\n<a name=\"368\" href=\"#368\">368</a> \t\t\n<a name=\"369\" href=\"#369\">369</a> \t\tDotElement dot = (DotElement)fileDots.get(key);\n<a name=\"370\" href=\"#370\">370</a> \t\t<strong>return</strong> dot;\n<a name=\"371\" href=\"#371\">371</a> \t\t\n<a name=\"372\" href=\"#372\">372</a> \t}\n<a name=\"373\" href=\"#373\">373</a> \n<a name=\"374\" href=\"#374\">374</a> \t<em>/**<em>*</em></em>\n<a name=\"375\" href=\"#375\">375</a> <em>\t * @return</em>\n<a name=\"376\" href=\"#376\">376</a> <em>\t */</em>\n<a name=\"377\" href=\"#377\">377</a> \t<strong>public</strong> <strong>double</strong> getStartAngle() {\n<a name=\"378\" href=\"#378\">378</a> \t\t<strong>return</strong> <strong>this</strong>.startAngle;\n<a name=\"379\" href=\"#379\">379</a> \t}\n<a name=\"380\" href=\"#380\">380</a> \n<a name=\"381\" href=\"#381\">381</a> \t<em>/**<em>*</em></em>\n<a name=\"382\" href=\"#382\">382</a> <em>\t * @param dotSize</em>\n<a name=\"383\" href=\"#383\">383</a> <em>\t */</em>\n<a name=\"384\" href=\"#384\">384</a> \t<strong>public</strong> <strong>void</strong> setDotSize(<strong>int</strong> dotSize) {\n<a name=\"385\" href=\"#385\">385</a> \t\t<strong>for</strong>(Iterator it = fileDots.values().iterator(); it.hasNext(); )\n<a name=\"386\" href=\"#386\">386</a> \t\t{\n<a name=\"387\" href=\"#387\">387</a> \t\t\tDotElement dot = (DotElement)it.next();\n<a name=\"388\" href=\"#388\">388</a> \t\t\tdot.setSize(dotSize);\n<a name=\"389\" href=\"#389\">389</a> \t\t}\n<a name=\"390\" href=\"#390\">390</a> \t}\n<a name=\"391\" href=\"#391\">391</a> }\n</pre>\n<hr/><div id=\"footer\">This page was automatically generated by <a href=\"http://maven.apache.org/\">Maven</a></div></body>\n</html>\n\n", "id": 32990.0}