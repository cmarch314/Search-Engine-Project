{"text": "Search LoginPreferencesHelp GuideAbout Trac WikiTimelineRoadmapBrowse SourceView TicketsSearch Context Navigation Back to Ticket 149 Ticket 149 ipgetterpatch txt File ipgetterpatch txt 1 7 KB added by cbaker 7 years ago Line 1Index Users chrisbaker code nomatic trunk trunk service edu uci ics luci nomatic service sensors IPGetter java2 3 Users chrisbaker code nomatic trunk trunk service edu uci ics luci nomatic service sensors IPGetter java revision 6 5 4 Users chrisbaker code nomatic trunk trunk service edu uci ics luci nomatic service sensors IPGetter java working copy 5 3 6 3 8 6 import java util Scanner 7 import java util logging Level 8 import java util logging Logger 9 import java util regex Matcher 1 import java util regex Pattern 11 12 public final class IPGetter 13 14 5 8 52 8 15 else 16 try 17 lastGetTime System currentTimeMillis 18 log fine Asking whatismyip org for IP 19 URL url new URL http whatismyip org 2 log fine Asking dyndns org for IP 21 URL url new URL http checkip dyndns org 22 URLConnection c url openConnection 23 c setConnectTimeout CONNECT TIMEOUT 24 c setReadTimeout READ TIMEOUT 25 6 12 62 15 26 String ip scanner nextLine 27 scanner close 28 s close 29 if ip matches d 1 3 d 1 3 d 1 3 d 1 3 3 lastIp ip 31 return ip 32 Pattern p Pattern compile Current IP Address d 1 3 d 1 3 d 1 3 d 1 3 33 Matcher m p matcher ip 34 if m matches 35 String parsedIP m group 1 36 lastIp parsedIP 37 return parsedIP 38 39 else 4 throw new Exception whatismyip org returned lastIp 41 throw new Exception dyndns org returned ip 42 43 catch Exception e 44 log log Level SEVERE Couldn t get IP so we re using lastIp e Download in other formats Original Format Powered by Trac 1 1 By Edgewall Software All content copyright 2 7 2 8 by LUCI http luci ics uci edu ", "_id": "http://djp3-pc2.ics.uci.edu/LUCICodeRepository/nomaticIM/attachment/ticket/149/ipgetterpatch.txt", "title": "\n      ipgetterpatch.txt on ticket #149 \u2013 attachment\n     \u2013 nomatic*im\n    ", "html": "<!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Strict//EN\" \"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd\">\n<html xmlns=\"http://www.w3.org/1999/xhtml\">\n  \n  \n\n  \n\n\n  <head>\n\t\t<title>\n      ipgetterpatch.txt on Ticket #149 \u2013 Attachment\n     \u2013 Nomatic*IM\n    </title><meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\" /><meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge\" /><link rel=\"search\" href=\"/LUCICodeRepository/nomaticIM/search\" /><link rel=\"help\" href=\"/LUCICodeRepository/nomaticIM/wiki/TracGuide\" /><link rel=\"alternate\" href=\"/LUCICodeRepository/nomaticIM/raw-attachment/ticket/149/ipgetterpatch.txt\" type=\"text/plain; charset=iso-8859-15\" title=\"Original Format\" /><link rel=\"up\" href=\"/LUCICodeRepository/nomaticIM/ticket/149\" title=\"Ticket #149\" /><link rel=\"start\" href=\"/LUCICodeRepository/nomaticIM/wiki\" /><link rel=\"stylesheet\" href=\"/LUCICodeRepository/nomaticIM/chrome/common/css/trac.css\" type=\"text/css\" /><link rel=\"stylesheet\" href=\"/LUCICodeRepository/nomaticIM/pygments/trac.css\" type=\"text/css\" /><link rel=\"stylesheet\" href=\"/LUCICodeRepository/nomaticIM/chrome/common/css/code.css\" type=\"text/css\" /><link rel=\"shortcut icon\" href=\"http://luci.ics.uci.edu/logo32by32.gif\" type=\"image/gif\" /><link rel=\"icon\" href=\"http://luci.ics.uci.edu/logo32by32.gif\" type=\"image/gif\" /><link type=\"application/opensearchdescription+xml\" rel=\"search\" href=\"/LUCICodeRepository/nomaticIM/search/opensearch\" title=\"Search Nomatic*IM\" /><script type=\"text/javascript\" charset=\"utf-8\" src=\"/LUCICodeRepository/nomaticIM/chrome/common/js/jquery.js\"></script><script type=\"text/javascript\" charset=\"utf-8\" src=\"/LUCICodeRepository/nomaticIM/chrome/common/js/babel.js\"></script><script type=\"text/javascript\" charset=\"utf-8\" src=\"/LUCICodeRepository/nomaticIM/chrome/common/js/messages/en_US.js\"></script><script type=\"text/javascript\" charset=\"utf-8\" src=\"/LUCICodeRepository/nomaticIM/chrome/common/js/trac.js\"></script><script type=\"text/javascript\" charset=\"utf-8\" src=\"/LUCICodeRepository/nomaticIM/chrome/common/js/search.js\"></script><script type=\"text/javascript\" src=\"/LUCICodeRepository/nomaticIM/chrome/common/js/folding.js\"></script><script type=\"text/javascript\">\n        jQuery(document).ready(function($) {\n          $('#preview table.code').enableCollapsibleColumns($('#preview table.code thead th.content'));\n        });\n      </script>\n\t</head>\n  <body>\n    <div id=\"banner\">\n      <div id=\"header\">\n        <a id=\"logo\" href=\"http://luci.ics.uci.edu/#code\"><img src=\"http://luci.ics.uci.edu/blog/archives/LUCIhorzTight.jpg\" alt=\"LUCI Code Repository\" /></a>\n      </div>\n      <form id=\"search\" action=\"/LUCICodeRepository/nomaticIM/search\" method=\"get\">\n        <div>\n          <label for=\"proj-search\">Search:</label>\n          <input type=\"text\" id=\"proj-search\" name=\"q\" size=\"18\" value=\"\" />\n          <input type=\"submit\" value=\"Search\" />\n        </div>\n      </form>\n      <div id=\"metanav\" class=\"nav\">\n    <ul>\n      <li class=\"first\"><a href=\"/LUCICodeRepository/nomaticIM/login\">Login</a></li><li><a href=\"/LUCICodeRepository/nomaticIM/prefs\">Preferences</a></li><li><a href=\"/LUCICodeRepository/nomaticIM/wiki/TracGuide\">Help/Guide</a></li><li class=\"last\"><a href=\"/LUCICodeRepository/nomaticIM/about\">About Trac</a></li>\n    </ul>\n  </div>\n    </div>\n    <div id=\"mainnav\" class=\"nav\">\n    <ul>\n      <li class=\"first\"><a href=\"/LUCICodeRepository/nomaticIM/wiki\">Wiki</a></li><li><a href=\"/LUCICodeRepository/nomaticIM/timeline\">Timeline</a></li><li><a href=\"/LUCICodeRepository/nomaticIM/roadmap\">Roadmap</a></li><li><a href=\"/LUCICodeRepository/nomaticIM/browser\">Browse Source</a></li><li><a href=\"/LUCICodeRepository/nomaticIM/report\">View Tickets</a></li><li class=\"last\"><a href=\"/LUCICodeRepository/nomaticIM/search\">Search</a></li>\n    </ul>\n  </div>\n    <div id=\"main\">\n      <div id=\"ctxtnav\" class=\"nav\">\n        <h2>Context Navigation</h2>\n        <ul>\n          <li class=\"last first\"><a href=\"/LUCICodeRepository/nomaticIM/ticket/149\">Back to Ticket #149</a></li>\n        </ul>\n        <hr />\n      </div>\n    <div id=\"content\" class=\"attachment\">\n        <h1><a href=\"/LUCICodeRepository/nomaticIM/ticket/149\">Ticket #149</a>: ipgetterpatch.txt</h1>\n        <table id=\"info\" summary=\"Description\">\n          <tbody>\n            <tr>\n              <th scope=\"col\">File ipgetterpatch.txt,\n                <span title=\"1728 bytes\">1.7 KB</span>\n                (added by cbaker, <a class=\"timeline\" href=\"/LUCICodeRepository/nomaticIM/timeline?from=2007-11-27T12%3A18%3A58-08%3A00&amp;precision=second\" title=\"See timeline at Nov 27, 2007, 12:18:58 PM\">7 years ago</a>)</th>\n            </tr>\n            <tr>\n              <td class=\"message searchable\">\n                \n              </td>\n            </tr>\n          </tbody>\n        </table>\n        <div id=\"preview\" class=\"searchable\">\n          \n  <table class=\"code\"><thead><tr><th class=\"lineno\" title=\"Line numbers\">Line</th><th class=\"content\">\u00a0</th></tr></thead><tbody><tr><th id=\"L1\"><a href=\"#L1\">1</a></th><td>Index: /Users/chrisbaker/code/nomatic/trunk/trunk/service/edu/uci/ics/luci/nomatic/service/sensors/IPGetter.java</td></tr><tr><th id=\"L2\"><a href=\"#L2\">2</a></th><td>===================================================================</td></tr><tr><th id=\"L3\"><a href=\"#L3\">3</a></th><td>--- /Users/chrisbaker/code/nomatic/trunk/trunk/service/edu/uci/ics/luci/nomatic/service/sensors/IPGetter.java\u00a0 \u00a0(revision 605)</td></tr><tr><th id=\"L4\"><a href=\"#L4\">4</a></th><td>+++ /Users/chrisbaker/code/nomatic/trunk/trunk/service/edu/uci/ics/luci/nomatic/service/sensors/IPGetter.java\u00a0 \u00a0(working copy)</td></tr><tr><th id=\"L5\"><a href=\"#L5\">5</a></th><td>@@ -30,6 +30,8 @@</td></tr><tr><th id=\"L6\"><a href=\"#L6\">6</a></th><td>\u00a0import java.util.Scanner;</td></tr><tr><th id=\"L7\"><a href=\"#L7\">7</a></th><td>\u00a0import java.util.logging.Level;</td></tr><tr><th id=\"L8\"><a href=\"#L8\">8</a></th><td>\u00a0import java.util.logging.Logger;</td></tr><tr><th id=\"L9\"><a href=\"#L9\">9</a></th><td>+import java.util.regex.Matcher;</td></tr><tr><th id=\"L10\"><a href=\"#L10\">10</a></th><td>+import java.util.regex.Pattern;</td></tr><tr><th id=\"L11\"><a href=\"#L11\">11</a></th><td>\u00a0</td></tr><tr><th id=\"L12\"><a href=\"#L12\">12</a></th><td>\u00a0public final class IPGetter {</td></tr><tr><th id=\"L13\"><a href=\"#L13\">13</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 </td></tr><tr><th id=\"L14\"><a href=\"#L14\">14</a></th><td>@@ -50,8 +52,8 @@</td></tr><tr><th id=\"L15\"><a href=\"#L15\">15</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 else {</td></tr><tr><th id=\"L16\"><a href=\"#L16\">16</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 try {</td></tr><tr><th id=\"L17\"><a href=\"#L17\">17</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 lastGetTime = System.currentTimeMillis();</td></tr><tr><th id=\"L18\"><a href=\"#L18\">18</a></th><td>-\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0log.fine(\"Asking whatismyip.org for IP\");</td></tr><tr><th id=\"L19\"><a href=\"#L19\">19</a></th><td>-\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0URL url = new URL(\"http://whatismyip.org/\");</td></tr><tr><th id=\"L20\"><a href=\"#L20\">20</a></th><td>+\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0log.fine(\"Asking dyndns.org for IP\");</td></tr><tr><th id=\"L21\"><a href=\"#L21\">21</a></th><td>+\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0URL url = new URL(\"http://checkip.dyndns.org/\");</td></tr><tr><th id=\"L22\"><a href=\"#L22\">22</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 URLConnection c = url.openConnection();</td></tr><tr><th id=\"L23\"><a href=\"#L23\">23</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 c.setConnectTimeout(CONNECT_TIMEOUT);</td></tr><tr><th id=\"L24\"><a href=\"#L24\">24</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 c.setReadTimeout(READ_TIMEOUT);</td></tr><tr><th id=\"L25\"><a href=\"#L25\">25</a></th><td>@@ -60,12 +62,15 @@</td></tr><tr><th id=\"L26\"><a href=\"#L26\">26</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 String ip = scanner.nextLine();</td></tr><tr><th id=\"L27\"><a href=\"#L27\">27</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 scanner.close();</td></tr><tr><th id=\"L28\"><a href=\"#L28\">28</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 s.close();</td></tr><tr><th id=\"L29\"><a href=\"#L29\">29</a></th><td>-\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0if (ip.matches(\"\\\\d{1,3}.\\\\d{1,3}.\\\\d{1,3}.\\\\d{1,3}\")) {</td></tr><tr><th id=\"L30\"><a href=\"#L30\">30</a></th><td>-\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0lastIp = ip;</td></tr><tr><th id=\"L31\"><a href=\"#L31\">31</a></th><td>-\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0return ip;</td></tr><tr><th id=\"L32\"><a href=\"#L32\">32</a></th><td>+\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0Pattern p = Pattern.compile(\".*Current IP Address: (\\\\d{1,3}.\\\\d{1,3}.\\\\d{1,3}.\\\\d{1,3}).*\");</td></tr><tr><th id=\"L33\"><a href=\"#L33\">33</a></th><td>+\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0Matcher m = p.matcher(ip);</td></tr><tr><th id=\"L34\"><a href=\"#L34\">34</a></th><td>+\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0if (m.matches()) {</td></tr><tr><th id=\"L35\"><a href=\"#L35\">35</a></th><td>+\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0String parsedIP = m.group(1);</td></tr><tr><th id=\"L36\"><a href=\"#L36\">36</a></th><td>+\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0lastIp = parsedIP;</td></tr><tr><th id=\"L37\"><a href=\"#L37\">37</a></th><td>+\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0return parsedIP;</td></tr><tr><th id=\"L38\"><a href=\"#L38\">38</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 }</td></tr><tr><th id=\"L39\"><a href=\"#L39\">39</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 else {</td></tr><tr><th id=\"L40\"><a href=\"#L40\">40</a></th><td>-\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0throw new Exception(\"whatismyip.org returned: \"+lastIp);</td></tr><tr><th id=\"L41\"><a href=\"#L41\">41</a></th><td>+\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0throw new Exception(\"dyndns.org returned: \"+ip);</td></tr><tr><th id=\"L42\"><a href=\"#L42\">42</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 }</td></tr><tr><th id=\"L43\"><a href=\"#L43\">43</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 } catch (Exception e) {</td></tr><tr><th id=\"L44\"><a href=\"#L44\">44</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 log.log(Level.SEVERE, \"Couldn't get IP, so we're using: \"+lastIp, e);</td></tr></tbody></table>\n\n        </div>\n    </div>\n    <div id=\"altlinks\">\n      <h3>Download in other formats:</h3>\n      <ul>\n        <li class=\"last first\">\n          <a rel=\"nofollow\" href=\"/LUCICodeRepository/nomaticIM/raw-attachment/ticket/149/ipgetterpatch.txt\">Original Format</a>\n        </li>\n      </ul>\n    </div>\n    </div>\n    <div id=\"footer\" lang=\"en\" xml:lang=\"en\"><hr />\n      <a id=\"tracpowered\" href=\"http://trac.edgewall.org/\"><img src=\"/LUCICodeRepository/nomaticIM/chrome/common/trac_logo_mini.png\" height=\"30\" width=\"107\" alt=\"Trac Powered\" /></a>\n      <p class=\"left\">Powered by <a href=\"/LUCICodeRepository/nomaticIM/about\"><strong>Trac 1.0.1</strong></a><br />\n        By <a href=\"http://www.edgewall.org/\">Edgewall Software</a>.</p>\n      <p class=\"right\">All content copyright 2007-2008 by LUCI <br /><a href=\"http://luci.ics.uci.edu/\">http://luci.ics.uci.edu/</a></p>\n    </div>\n\t\t<div id=\"sitefooter\">\n\t\t\t<script src=\"http://www.google-analytics.com/urchin.js\" type=\"text/javascript\">\n\t\t\t</script>\n\t\t\t<script type=\"text/javascript\">\n\t\t\t\t_uacct = \"UA-338915-2\";\n\t\t\t\turchinTracker();\n\t\t\t</script>\n\t\t</div>\n\t</body>\n</html>", "id": 36342.0}