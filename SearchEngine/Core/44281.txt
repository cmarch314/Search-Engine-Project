{"text": "Search LoginPreferencesHelp GuideAbout Trac WikiTimelineRoadmapBrowse SourceView TicketsSearch Context Navigation Previous RevisionNext Revision BlameRevision Log source nomatic tags NomaticIM 5 service native accelerometer mac unimotion c View diff against View revision Visit trunk Last change on this file was 837 checked in by djp3 7 years ago Minor feedback for debugging File size 11 9 KB Line 1 2 Copyright 2 7 2 83 University of California Irvine c o Donald J Patterson 4 5 6 This file is part of Nomatic IM 78 Nomatic IM is free software you can redistribute it and or modify9 it under the terms of the GNU General Public License as published by1 the Free Software Foundation either version 3 of the License or11 at your option any later version 1213 Nomatic IM is distributed in the hope that it will be useful 14 but WITHOUT ANY WARRANTY without even the implied warranty of15 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE See the16 GNU General Public License for more details 1718 You should have received a copy of the GNU General Public License19 along with Nomatic IM If not see http www gnu org licenses 2 21 22 JNI UniMotion JNI Unified Motion detection for Apple portables 23 24 Copyright c 2 6 Daniel Shiffman All rights reserved 25 26 This library is free software you can redistribute it and or27 modify it under the terms of the GNU Lesser General Public28 License version 2 1 as published by the Free Software Foundation 29 3 This library is distributed in the hope that it will be useful 31 but WITHOUT ANY WARRANTY without even the implied warranty of32 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE See the GNU33 Lesser General Public License for more details 34 35 You should have received a copy of the GNU Lesser General Public36 License along with this library if not write to the Free Software37 Foundation Inc 59 Temple Place Suite 33 Boston MA 2111 13 7 USA38 394 41 HISTORY of Motion42 Written by Christian Klein43 Modified for iBook compatibility by Pall Thayer44 Modified for Hi Res Powerbook compatibility by Pall Thayer45 Modified for MacBook Pro compatibility by Randy Green46 Disparate forks unified into UniMotion by Lincoln Ramsay47 Made into a Java Native Interface by Daniel Shiffman48 495 This license applies to the portions created by Lincoln Ramsay 51 52 UniMotion Unified Motion detection for Apple portables 53 54 Copyright c 2 6 Lincoln Ramsay All rights reserved 55 56 This library is free software you can redistribute it and or57 modify it under the terms of the GNU Lesser General Public58 License version 2 1 as published by the Free Software Foundation 59 6 This library is distributed in the hope that it will be useful 61 but WITHOUT ANY WARRANTY without even the implied warranty of62 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE See the GNU63 Lesser General Public License for more details 64 65 You should have received a copy of the GNU Lesser General Public66 License along with this library if not write to the Free Software67 Foundation Inc 59 Temple Place Suite 33 Boston MA 2111 13 7 USA68 697 This license applies to the portions created by Cristian Klein 71 motion c72 73 a little program to display the coords returned by74 the powerbook motion sensor75 76 A fine piece of c de brought to you by77 78 79 teenage mutant ninja hero coders 8 81 82 All of the software included is copyrighted by Christian Klein chris 5711 org 83 84 Copyright 2 5 Christian Klein All rights reserved 85 86 Redistribution and use in source and binary forms with or without87 modification are permitted provided that the following conditions88 are met 89 1 Redistributions of source code must retain the above copyright9 notice this list of conditions and the following disclaimer 91 2 Redistributions in binary form must reproduce the above copyright92 notice this list of conditions and the following disclaimer in the93 documentation and or other materials provided with the distribution 94 3 The name of the author must not be used to endorse or promote95 products derived from this software96 without specific prior written permission 97 98 THIS SOFTWARE IS PROVIDED BY THE REGENTS AND CONTRIBUTORS AS IS AND99 ANY EXPRESS OR IMPLIED WARRANTIES INCLUDING BUT NOT LIMITED TO THE1 IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE1 1 ARE DISCLAIMED IN NO EVENT SHALL THE REGENTS OR CONTRIBUTORS BE LIABLE1 2 FOR ANY DIRECT INDIRECT INCIDENTAL SPECIAL EXEMPLARY OR CONSEQUENTIAL1 3 DAMAGES INCLUDING BUT NOT LIMITED TO PROCUREMENT OF SUBSTITUTE GOODS1 4 OR SERVICES LOSS OF USE DATA OR PROFITS OR BUSINESS INTERRUPTION 1 5 HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY WHETHER IN CONTRACT STRICT1 6 LIABILITY OR TORT INCLUDING NEGLIGENCE OR OTHERWISE ARISING IN ANY WAY1 7 OUT OF THE USE OF THIS SOFTWARE EVEN IF ADVISED OF THE POSSIBILITY OF1 8 SUCH DAMAGE 1 9 11 111 112 include jni h 113114 include IOKit IOKitLib h 115 include CoreFoundation CoreFoundation h 116 include string h 117 include stdint h 118119 The various SMS hardware that unimotion supports12 enum sms hardware 121 unknown 122 powerbook 1 123 ibook 2 124 highrespb 3 125 macbookpro 4126 127128enum data type 129 PB IB 13 MBP131 132133struct pb ib data 134 int8 t x 135 int8 t y 136 int8 t z 137 int8 t pad 57 138 13914 struct mbp data 141 int16 t x 142 int16 t y 143 int16 t z 144 int8 t pad 34 145 146147union motion data 148 struct pb ib data pb ib 149 struct mbp data mbp 15 151152bool first true 153int type 154155static int set values int type int kernFunc char servMatch int dataType 156 157 switch type 158 case powerbook 159 kernFunc 21 16 servMatch IOI2CMotionSensor 161 dataType PB IB 162 break 163 case ibook 164 kernFunc 21 165 servMatch IOI2CMotionSensor 166 dataType PB IB 167 break 168 case highrespb 169 kernFunc 21 17 servMatch PMUMotionSensor 171 dataType PB IB 172 break 173 case macbookpro 174 kernFunc 5 175 servMatch SMCMotionSensor 176 dataType MBP 177 break 178 default 179 return 18 181 182 return 1 183 184185static int probe sms int kernFunc char servMatch int dataType void data 186 187 kern return t result 188 mach port t masterPort 189 io iterator t iterator 19 io object t aDevice 191 io connect t dataPort 192 193 IOItemCount structureInputSize 194 IOByteCount structureOutputSize 195 196 union motion data inputStructure 197 union motion data outputStructure 198 199 outputStructure union motion data data 2 2 1 result IOMasterPort MACH PORT NULL masterPort 2 2 2 3 CFMutableDictionaryRef matchingDictionary IOServiceMatching servMatch 2 4 2 5 result IOServiceGetMatchingServices masterPort matchingDictionary iterator 2 6 2 7 if result KERN SUCCESS 2 8 fputs IOServiceGetMatchingServices returned error n stderr 2 9 return 21 211 212 aDevice IOIteratorNext iterator 213 IOObjectRelease iterator 214 215 if aDevice 216 fputs No motion sensor available n stderr 217 return 218 219 22 result IOServiceOpen aDevice mach task self dataPort 221 IOObjectRelease aDevice 222 223 if result KERN SUCCESS 224 fputs Could not open motion sensor device n stderr 225 return 226 227 228 switch dataType 229 case PB IB 23 structureInputSize sizeof struct pb ib data 231 structureOutputSize sizeof struct pb ib data 232 break 233 case MBP 234 structureInputSize sizeof struct mbp data 235 structureOutputSize sizeof struct mbp data 236 break 237 default 238 return 239 24 241 memset inputStructure sizeof union motion data 242 memset outputStructure sizeof union motion data 243 244 result IOConnectMethodStructureIStructureO dataPort kernFunc structureInputSize 245 structureOutputSize inputStructure outputStructure 246 247 IOServiceClose dataPort 248 249 if result KERN SUCCESS 25 puts no coords 251 return 252 253 return 1 254 255256int detect sms 257 258 int kernFunc 259 char servMatch 26 int dataType 261 union motion data data 262 int i 263 264 for i 1 i 265 if set values i kernFunc servMatch dataType 266 break 267 if probe sms kernFunc servMatch dataType data 268 return i 269 27 271 return unknown 272 273274int read sms raw int type int x int y int z 275 276 int kernFunc 277 char servMatch 278 int dataType 279 union motion data data 28 281 if set values type kernFunc servMatch dataType 282 return 283 if probe sms kernFunc servMatch dataType data 284 switch dataType 285 case PB IB 286 if x x data pb ib x 287 if y y data pb ib y 288 if z z data pb ib z 289 break 29 case MBP 291 if x x data mbp x 292 if y y data mbp y 293 if z z data mbp z 294 break 295 default 296 return 297 298 return 1 299 3 return 3 1 3 23 3int read sms int type int x int y int z 3 4 3 5 int x y z 3 6 int xoff yoff zoff 3 7 Boolean ok 3 8 int ret 3 9 31 ret read sms raw type x y z 311 if ret 312 return 313 314 315 static CFStringRef app CFSTR com ramsayl UniMotion 316 static CFStringRef xoffstr CFSTR x offset 317 static CFStringRef yoffstr CFSTR y offset 318 static CFStringRef zoffstr CFSTR z offset 319 32 CFStringRef app CFSTR com ramsayl UniMotion 321 CFStringRef xoffstr CFSTR x offset 322 CFStringRef yoffstr CFSTR y offset 323 CFStringRef zoffstr CFSTR z offset 324325 xoff CFPreferencesGetAppIntegerValue xoffstr app ok 326 if ok x xoff 327 yoff CFPreferencesGetAppIntegerValue yoffstr app ok 328 if ok y yoff 329 zoff CFPreferencesGetAppIntegerValue zoffstr app ok 33 if ok z zoff 331 332 x x 333 y y 334 z z 335 336 return ret 337 338339int read sms real int type double x double y double z 34 341 int x y z 342 int xscale yscale zscale 343 int ret 344 Boolean ok 345 346 ret read sms raw type x y z 347 if ret 348 return 349 35 351 static CFStringRef app CFSTR com ramsayl UniMotion 352 static CFStringRef xscalestr CFSTR x scale 353 static CFStringRef yscalestr CFSTR y scale 354 static CFStringRef zscalestr CFSTR z scale 355 356 CFStringRef app CFSTR com ramsayl UniMotion 357 CFStringRef xscalestr CFSTR x scale 358 CFStringRef yscalestr CFSTR y scale 359 CFStringRef zscalestr CFSTR z scale 36 xscale CFPreferencesGetAppIntegerValue xscalestr app ok 361 if ok return 362 yscale CFPreferencesGetAppIntegerValue yscalestr app ok 363 if ok return 364 zscale CFPreferencesGetAppIntegerValue zscalestr app ok 365 if ok return 366 367 x x double xscale 368 y y double yscale 369 z z double zscale 37 371 return 1 372 373374375 JNI Function to return an array of ints w sensor values376JNIEXPORT jintArray JNICALL Java edu uci ics luci nomatic service sensors MacAccSensor readSMS JNIEnv env jobject this 377 char name 378 int x y z 379 x y z 38 381 if first 382 fprintf stderr Detecting SMS n 383 type detect sms 384 if type unknown 385 fprintf stderr Nomatic IM Could not detect an SMS n 386 return 1 387 388 switch type 389 case powerbook 39 name powerbook 391 break 392 case ibook 393 name ibook 394 break 395 case highrespb 396 name highrespb 397 break 398 case macbookpro 399 name macbookpro 4 break 4 1 default 4 2 name 4 3 break 4 4 4 5 fprintf stderr Nomatic IM Detected SMS type d s n type name 4 6 first false 4 7 4 8 4 9 int ok 41 ok read sms raw type x y z 411 if ok 412 printf d d d n x y z 413 414 jintArray jr 415 jsize rlen 3 jenv GetArrayLength jenv 3 416 jr env NewIntArray env rlen 417 int size 3 418 long data 419 data long malloc sizeof long size 42 data x data 1 y data 2 z 421 env SetIntArrayRegion env jr size data 422 free data 423 return jr 424 Note See TracBrowser for help on using the repository browser Download in other formats Plain Text Original Format Powered by Trac 1 1 By Edgewall Software All content copyright 2 7 2 8 by LUCI http luci ics uci edu ", "_id": "http://djp3-pc2.ics.uci.edu/LUCICodeRepository/nomaticIM/browser/nomatic/tags/NomaticIM-0.0.5/service/native/accelerometer/mac/unimotion.c", "title": "\n      unimotion.c in nomatic/tags/nomaticim-0.0.5/service/native/accelerometer/mac\n     \u2013 nomatic*im\n    ", "html": "<!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Strict//EN\" \"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd\">\n<html xmlns=\"http://www.w3.org/1999/xhtml\">\n  \n  \n\n  \n\n\n  <head>\n\t\t<title>\n      unimotion.c in nomatic/tags/NomaticIM-0.0.5/service/native/accelerometer/mac\n     \u2013 Nomatic*IM\n    </title><meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\" /><meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge\" /><link rel=\"search\" href=\"/LUCICodeRepository/nomaticIM/search\" /><link rel=\"help\" href=\"/LUCICodeRepository/nomaticIM/wiki/TracGuide\" /><link rel=\"alternate\" href=\"/LUCICodeRepository/nomaticIM/browser/nomatic/tags/NomaticIM-0.0.5/service/native/accelerometer/mac/unimotion.c?format=txt\" type=\"text/plain\" title=\"Plain Text\" /><link rel=\"alternate\" href=\"/LUCICodeRepository/nomaticIM/export/1312/nomatic/tags/NomaticIM-0.0.5/service/native/accelerometer/mac/unimotion.c\" type=\"text/x-csrc; charset=iso-8859-15\" title=\"Original Format\" /><link rel=\"start\" href=\"/LUCICodeRepository/nomaticIM/wiki\" /><link rel=\"stylesheet\" href=\"/LUCICodeRepository/nomaticIM/chrome/common/css/trac.css\" type=\"text/css\" /><link rel=\"stylesheet\" href=\"/LUCICodeRepository/nomaticIM/chrome/common/css/code.css\" type=\"text/css\" /><link rel=\"stylesheet\" href=\"/LUCICodeRepository/nomaticIM/pygments/trac.css\" type=\"text/css\" /><link rel=\"stylesheet\" href=\"/LUCICodeRepository/nomaticIM/chrome/common/css/browser.css\" type=\"text/css\" /><link rel=\"prev\" href=\"/LUCICodeRepository/nomaticIM/browser/nomatic/trunk/service/native/accelerometer/mac/unimotion.c?rev=775\" title=\"Revision 775\" /><link rel=\"shortcut icon\" href=\"http://luci.ics.uci.edu/logo32by32.gif\" type=\"image/gif\" /><link rel=\"icon\" href=\"http://luci.ics.uci.edu/logo32by32.gif\" type=\"image/gif\" /><link type=\"application/opensearchdescription+xml\" rel=\"search\" href=\"/LUCICodeRepository/nomaticIM/search/opensearch\" title=\"Search Nomatic*IM\" /><script type=\"text/javascript\" charset=\"utf-8\" src=\"/LUCICodeRepository/nomaticIM/chrome/common/js/jquery.js\"></script><script type=\"text/javascript\" charset=\"utf-8\" src=\"/LUCICodeRepository/nomaticIM/chrome/common/js/babel.js\"></script><script type=\"text/javascript\" charset=\"utf-8\" src=\"/LUCICodeRepository/nomaticIM/chrome/common/js/messages/en_US.js\"></script><script type=\"text/javascript\" charset=\"utf-8\" src=\"/LUCICodeRepository/nomaticIM/chrome/common/js/trac.js\"></script><script type=\"text/javascript\" charset=\"utf-8\" src=\"/LUCICodeRepository/nomaticIM/chrome/common/js/search.js\"></script><script type=\"text/javascript\" src=\"/LUCICodeRepository/nomaticIM/chrome/common/js/folding.js\"></script><script type=\"text/javascript\">\n      jQuery(document).ready(function($) {\n        $(\".trac-toggledeleted\").show().click(function() {\n                  $(this).siblings().find(\".trac-deleted\").toggle();\n                  return false;\n        }).click();\n        $(\"#jumploc input\").hide();\n        $(\"#jumploc select\").change(function () {\n          this.parentNode.parentNode.submit();\n        });\n          $('#preview table.code').enableCollapsibleColumns($('#preview table.code thead th.content'));\n      });\n    </script>\n\t</head>\n  <body>\n    <div id=\"banner\">\n      <div id=\"header\">\n        <a id=\"logo\" href=\"http://luci.ics.uci.edu/#code\"><img src=\"http://luci.ics.uci.edu/blog/archives/LUCIhorzTight.jpg\" alt=\"LUCI Code Repository\" /></a>\n      </div>\n      <form id=\"search\" action=\"/LUCICodeRepository/nomaticIM/search\" method=\"get\">\n        <div>\n          <label for=\"proj-search\">Search:</label>\n          <input type=\"text\" id=\"proj-search\" name=\"q\" size=\"18\" value=\"\" />\n          <input type=\"submit\" value=\"Search\" />\n        </div>\n      </form>\n      <div id=\"metanav\" class=\"nav\">\n    <ul>\n      <li class=\"first\"><a href=\"/LUCICodeRepository/nomaticIM/login\">Login</a></li><li><a href=\"/LUCICodeRepository/nomaticIM/prefs\">Preferences</a></li><li><a href=\"/LUCICodeRepository/nomaticIM/wiki/TracGuide\">Help/Guide</a></li><li class=\"last\"><a href=\"/LUCICodeRepository/nomaticIM/about\">About Trac</a></li>\n    </ul>\n  </div>\n    </div>\n    <div id=\"mainnav\" class=\"nav\">\n    <ul>\n      <li class=\"first\"><a href=\"/LUCICodeRepository/nomaticIM/wiki\">Wiki</a></li><li><a href=\"/LUCICodeRepository/nomaticIM/timeline\">Timeline</a></li><li><a href=\"/LUCICodeRepository/nomaticIM/roadmap\">Roadmap</a></li><li class=\"active\"><a href=\"/LUCICodeRepository/nomaticIM/browser\">Browse Source</a></li><li><a href=\"/LUCICodeRepository/nomaticIM/report\">View Tickets</a></li><li class=\"last\"><a href=\"/LUCICodeRepository/nomaticIM/search\">Search</a></li>\n    </ul>\n  </div>\n    <div id=\"main\">\n      <div id=\"ctxtnav\" class=\"nav\">\n        <h2>Context Navigation</h2>\n        <ul>\n          <li class=\"first\"><span>&larr; <a class=\"prev\" href=\"/LUCICodeRepository/nomaticIM/browser/nomatic/trunk/service/native/accelerometer/mac/unimotion.c?rev=775\" title=\"Revision 775\">Previous Revision</a></span></li><li><span class=\"missing\">Next Revision &rarr;</span></li><li><a href=\"/LUCICodeRepository/nomaticIM/browser/nomatic/trunk/service/native/accelerometer/mac/unimotion.c?annotate=blame\" title=\"Annotate each line with the last changed revision (this can be time consuming...)\">Blame</a></li><li class=\"last\"><a href=\"/LUCICodeRepository/nomaticIM/log/nomatic/tags/NomaticIM-0.0.5/service/native/accelerometer/mac/unimotion.c\">Revision Log</a></li>\n        </ul>\n        <hr />\n      </div>\n    <div id=\"content\" class=\"browser\">\n        <h1>\n          \n<a class=\"pathentry first\" href=\"/LUCICodeRepository/nomaticIM/browser?order=name\" title=\"Go to repository root\">source:</a>\n<a class=\"pathentry\" href=\"/LUCICodeRepository/nomaticIM/browser/nomatic?order=name\" title=\"View nomatic\">nomatic</a><span class=\"pathentry sep\">/</span><a class=\"pathentry\" href=\"/LUCICodeRepository/nomaticIM/browser/nomatic/tags?order=name\" title=\"View tags\">tags</a><span class=\"pathentry sep\">/</span><a class=\"pathentry\" href=\"/LUCICodeRepository/nomaticIM/browser/nomatic/tags/NomaticIM-0.0.5?order=name\" title=\"View NomaticIM-0.0.5\">NomaticIM-0.0.5</a><span class=\"pathentry sep\">/</span><a class=\"pathentry\" href=\"/LUCICodeRepository/nomaticIM/browser/nomatic/tags/NomaticIM-0.0.5/service?order=name\" title=\"View service\">service</a><span class=\"pathentry sep\">/</span><a class=\"pathentry\" href=\"/LUCICodeRepository/nomaticIM/browser/nomatic/tags/NomaticIM-0.0.5/service/native?order=name\" title=\"View native\">native</a><span class=\"pathentry sep\">/</span><a class=\"pathentry\" href=\"/LUCICodeRepository/nomaticIM/browser/nomatic/tags/NomaticIM-0.0.5/service/native/accelerometer?order=name\" title=\"View accelerometer\">accelerometer</a><span class=\"pathentry sep\">/</span><a class=\"pathentry\" href=\"/LUCICodeRepository/nomaticIM/browser/nomatic/tags/NomaticIM-0.0.5/service/native/accelerometer/mac?order=name\" title=\"View mac\">mac</a><span class=\"pathentry sep\">/</span><a class=\"pathentry\" href=\"/LUCICodeRepository/nomaticIM/browser/nomatic/tags/NomaticIM-0.0.5/service/native/accelerometer/mac/unimotion.c?order=name\" title=\"View unimotion.c\">unimotion.c</a>\n<br style=\"clear: both\" />\n\n        </h1>\n        <div id=\"diffrev\">\n          <form action=\"/LUCICodeRepository/nomaticIM/changeset\" method=\"get\">\n            <div>\n              <label title=\"Show the diff against a specific revision\">\n                View diff against: <input type=\"text\" name=\"old\" size=\"6\" />\n                <input type=\"hidden\" name=\"old_path\" value=\"nomatic/tags/NomaticIM-0.0.5/service/native/accelerometer/mac/unimotion.c\" />\n                <input type=\"hidden\" name=\"new\" />\n                <input type=\"hidden\" name=\"new_path\" value=\"nomatic/tags/NomaticIM-0.0.5/service/native/accelerometer/mac/unimotion.c\" />\n              </label>\n            </div>\n          </form>\n        </div>\n        <div id=\"jumprev\">\n          <form action=\"\" method=\"get\">\n            <div>\n              <label for=\"rev\">\n                View revision:</label>\n              <input type=\"text\" id=\"rev\" name=\"rev\" size=\"6\" />\n            </div>\n          </form>\n        </div>\n        <div id=\"jumploc\">\n          <form action=\"\" method=\"get\">\n            <div class=\"buttons\">\n              <label for=\"preselected\">Visit:</label>\n              <select id=\"preselected\" name=\"preselected\">\n                <option selected=\"selected\"></option>\n                <optgroup label=\"branches\">\n                  <option value=\"/LUCICodeRepository/nomaticIM/browser/trunk\">trunk</option>\n                </optgroup>\n              </select>\n              <input type=\"submit\" value=\"Go!\" title=\"Jump to the chosen preselected path\" />\n            </div>\n          </form>\n        </div>\n        <div class=\"trac-tags\">\n        </div>\n      <table id=\"info\" summary=\"Revision info\">\n        <tr>\n          <th>\n                <a href=\"/LUCICodeRepository/nomaticIM/changeset/837/nomatic/trunk/service/native/accelerometer/mac/unimotion.c\" title=\"View differences\">Last change</a>\n                  on this file was\n                  <a href=\"/LUCICodeRepository/nomaticIM/changeset/837/\" title=\"View changeset 837\">837</a>,\n                  checked in by djp3, <a class=\"timeline\" href=\"/LUCICodeRepository/nomaticIM/timeline?from=2008-02-25T09%3A18%3A10-08%3A00&amp;precision=second\" title=\"See timeline at Feb 25, 2008, 9:18:10 AM\">7 years ago</a>\n          </th>\n        </tr>\n        <tr>\n          <td class=\"message searchable\">\n              <p>\nMinor feedback for debugging.<br />\n</p>\n          </td>\n        </tr>\n        <tr><td colspan=\"2\">\n            <strong>File size:</strong>\n            <span title=\"12236 bytes\">11.9 KB</span>\n          </td></tr>\n      </table>\n      <div id=\"preview\" class=\"searchable\">\n        \n  <table class=\"code\"><thead><tr><th class=\"lineno\" title=\"Line numbers\">Line</th><th class=\"content\">\u00a0</th></tr></thead><tbody><tr><th id=\"L1\"><a href=\"#L1\">1</a></th><td><span class=\"cm\">/*</span></td></tr><tr><th id=\"L2\"><a href=\"#L2\">2</a></th><td><span class=\"cm\">\u00a0 \u00a0 Copyright 2007-2008</span></td></tr><tr><th id=\"L3\"><a href=\"#L3\">3</a></th><td><span class=\"cm\">\u00a0 \u00a0 \u00a0 \u00a0 University of California, Irvine (c/o Donald J. Patterson)</span></td></tr><tr><th id=\"L4\"><a href=\"#L4\">4</a></th><td><span class=\"cm\">*/</span></td></tr><tr><th id=\"L5\"><a href=\"#L5\">5</a></th><td><span class=\"cm\">/*</span></td></tr><tr><th id=\"L6\"><a href=\"#L6\">6</a></th><td><span class=\"cm\">\u00a0 \u00a0 This file is part of Nomatic*IM.</span></td></tr><tr><th id=\"L7\"><a href=\"#L7\">7</a></th><td><span class=\"cm\"></span></td></tr><tr><th id=\"L8\"><a href=\"#L8\">8</a></th><td><span class=\"cm\">\u00a0 \u00a0 Nomatic*IM is free software: you can redistribute it and/or modify</span></td></tr><tr><th id=\"L9\"><a href=\"#L9\">9</a></th><td><span class=\"cm\">\u00a0 \u00a0 it under the terms of the GNU General Public License as published by</span></td></tr><tr><th id=\"L10\"><a href=\"#L10\">10</a></th><td><span class=\"cm\">\u00a0 \u00a0 the Free Software Foundation, either version 3 of the License, or</span></td></tr><tr><th id=\"L11\"><a href=\"#L11\">11</a></th><td><span class=\"cm\">\u00a0 \u00a0 (at your option) any later version.</span></td></tr><tr><th id=\"L12\"><a href=\"#L12\">12</a></th><td><span class=\"cm\"></span></td></tr><tr><th id=\"L13\"><a href=\"#L13\">13</a></th><td><span class=\"cm\">\u00a0 \u00a0 Nomatic*IM is distributed in the hope that it will be useful,</span></td></tr><tr><th id=\"L14\"><a href=\"#L14\">14</a></th><td><span class=\"cm\">\u00a0 \u00a0 but WITHOUT ANY WARRANTY; without even the implied warranty of</span></td></tr><tr><th id=\"L15\"><a href=\"#L15\">15</a></th><td><span class=\"cm\">\u00a0 \u00a0 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.\u00a0 See the</span></td></tr><tr><th id=\"L16\"><a href=\"#L16\">16</a></th><td><span class=\"cm\">\u00a0 \u00a0 GNU General Public License for more details.</span></td></tr><tr><th id=\"L17\"><a href=\"#L17\">17</a></th><td><span class=\"cm\"></span></td></tr><tr><th id=\"L18\"><a href=\"#L18\">18</a></th><td><span class=\"cm\">\u00a0 \u00a0 You should have received a copy of the GNU General Public License</span></td></tr><tr><th id=\"L19\"><a href=\"#L19\">19</a></th><td><span class=\"cm\">\u00a0 \u00a0 along with Nomatic*IM.\u00a0 If not, see &lt;http://www.gnu.org/licenses/&gt;.</span></td></tr><tr><th id=\"L20\"><a href=\"#L20\">20</a></th><td><span class=\"cm\">*/</span></td></tr><tr><th id=\"L21\"><a href=\"#L21\">21</a></th><td><span class=\"cm\">/*</span></td></tr><tr><th id=\"L22\"><a href=\"#L22\">22</a></th><td><span class=\"cm\">\u00a0*\u00a0 JNI UniMotion - JNI Unified Motion detection for Apple portables.</span></td></tr><tr><th id=\"L23\"><a href=\"#L23\">23</a></th><td><span class=\"cm\">\u00a0*</span></td></tr><tr><th id=\"L24\"><a href=\"#L24\">24</a></th><td><span class=\"cm\">\u00a0*\u00a0 Copyright (c) 2006 Daniel Shiffman All rights reserved.</span></td></tr><tr><th id=\"L25\"><a href=\"#L25\">25</a></th><td><span class=\"cm\">\u00a0*</span></td></tr><tr><th id=\"L26\"><a href=\"#L26\">26</a></th><td><span class=\"cm\">\u00a0*\u00a0 This library is free software; you can redistribute it and/or</span></td></tr><tr><th id=\"L27\"><a href=\"#L27\">27</a></th><td><span class=\"cm\">\u00a0*\u00a0 modify it under the terms of the GNU Lesser General Public</span></td></tr><tr><th id=\"L28\"><a href=\"#L28\">28</a></th><td><span class=\"cm\">\u00a0*\u00a0 License version 2.1 as published by the Free Software Foundation.</span></td></tr><tr><th id=\"L29\"><a href=\"#L29\">29</a></th><td><span class=\"cm\">\u00a0*</span></td></tr><tr><th id=\"L30\"><a href=\"#L30\">30</a></th><td><span class=\"cm\">\u00a0*\u00a0 This library is distributed in the hope that it will be useful,</span></td></tr><tr><th id=\"L31\"><a href=\"#L31\">31</a></th><td><span class=\"cm\">\u00a0*\u00a0 but WITHOUT ANY WARRANTY; without even the implied warranty of</span></td></tr><tr><th id=\"L32\"><a href=\"#L32\">32</a></th><td><span class=\"cm\">\u00a0*\u00a0 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.\u00a0 See the GNU</span></td></tr><tr><th id=\"L33\"><a href=\"#L33\">33</a></th><td><span class=\"cm\">\u00a0*\u00a0 Lesser General Public License for more details.</span></td></tr><tr><th id=\"L34\"><a href=\"#L34\">34</a></th><td><span class=\"cm\">\u00a0*</span></td></tr><tr><th id=\"L35\"><a href=\"#L35\">35</a></th><td><span class=\"cm\">\u00a0*\u00a0 You should have received a copy of the GNU Lesser General Public</span></td></tr><tr><th id=\"L36\"><a href=\"#L36\">36</a></th><td><span class=\"cm\">\u00a0*\u00a0 License along with this library; if not, write to the Free Software</span></td></tr><tr><th id=\"L37\"><a href=\"#L37\">37</a></th><td><span class=\"cm\">\u00a0*\u00a0 Foundation Inc. 59 Temple Place, Suite 330, Boston MA 02111-1307 USA</span></td></tr><tr><th id=\"L38\"><a href=\"#L38\">38</a></th><td><span class=\"cm\">\u00a0*/</span></td></tr><tr><th id=\"L39\"><a href=\"#L39\">39</a></th><td></td></tr><tr><th id=\"L40\"><a href=\"#L40\">40</a></th><td><span class=\"cm\">/*</span></td></tr><tr><th id=\"L41\"><a href=\"#L41\">41</a></th><td><span class=\"cm\">\u00a0* HISTORY of Motion</span></td></tr><tr><th id=\"L42\"><a href=\"#L42\">42</a></th><td><span class=\"cm\">\u00a0* Written by Christian Klein</span></td></tr><tr><th id=\"L43\"><a href=\"#L43\">43</a></th><td><span class=\"cm\">\u00a0* Modified for iBook compatibility by Pall Thayer</span></td></tr><tr><th id=\"L44\"><a href=\"#L44\">44</a></th><td><span class=\"cm\">\u00a0* Modified for Hi Res Powerbook compatibility by Pall Thayer</span></td></tr><tr><th id=\"L45\"><a href=\"#L45\">45</a></th><td><span class=\"cm\">\u00a0* Modified for MacBook Pro compatibility by Randy Green</span></td></tr><tr><th id=\"L46\"><a href=\"#L46\">46</a></th><td><span class=\"cm\">\u00a0* Disparate forks unified into UniMotion by Lincoln Ramsay</span></td></tr><tr><th id=\"L47\"><a href=\"#L47\">47</a></th><td><span class=\"cm\">\u00a0* Made into a Java Native Interface by Daniel Shiffman</span></td></tr><tr><th id=\"L48\"><a href=\"#L48\">48</a></th><td><span class=\"cm\">\u00a0*/</span></td></tr><tr><th id=\"L49\"><a href=\"#L49\">49</a></th><td></td></tr><tr><th id=\"L50\"><a href=\"#L50\">50</a></th><td><span class=\"c1\">// This license applies to the portions created by Lincoln Ramsay.</span></td></tr><tr><th id=\"L51\"><a href=\"#L51\">51</a></th><td><span class=\"c1\"></span><span class=\"cm\">/*</span></td></tr><tr><th id=\"L52\"><a href=\"#L52\">52</a></th><td><span class=\"cm\">\u00a0*\u00a0 UniMotion - Unified Motion detection for Apple portables.</span></td></tr><tr><th id=\"L53\"><a href=\"#L53\">53</a></th><td><span class=\"cm\">\u00a0*</span></td></tr><tr><th id=\"L54\"><a href=\"#L54\">54</a></th><td><span class=\"cm\">\u00a0*\u00a0 Copyright (c) 2006 Lincoln Ramsay. All rights reserved.</span></td></tr><tr><th id=\"L55\"><a href=\"#L55\">55</a></th><td><span class=\"cm\">\u00a0*</span></td></tr><tr><th id=\"L56\"><a href=\"#L56\">56</a></th><td><span class=\"cm\">\u00a0*\u00a0 This library is free software; you can redistribute it and/or</span></td></tr><tr><th id=\"L57\"><a href=\"#L57\">57</a></th><td><span class=\"cm\">\u00a0*\u00a0 modify it under the terms of the GNU Lesser General Public</span></td></tr><tr><th id=\"L58\"><a href=\"#L58\">58</a></th><td><span class=\"cm\">\u00a0*\u00a0 License version 2.1 as published by the Free Software Foundation.</span></td></tr><tr><th id=\"L59\"><a href=\"#L59\">59</a></th><td><span class=\"cm\">\u00a0*</span></td></tr><tr><th id=\"L60\"><a href=\"#L60\">60</a></th><td><span class=\"cm\">\u00a0*\u00a0 This library is distributed in the hope that it will be useful,</span></td></tr><tr><th id=\"L61\"><a href=\"#L61\">61</a></th><td><span class=\"cm\">\u00a0*\u00a0 but WITHOUT ANY WARRANTY; without even the implied warranty of</span></td></tr><tr><th id=\"L62\"><a href=\"#L62\">62</a></th><td><span class=\"cm\">\u00a0*\u00a0 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.\u00a0 See the GNU</span></td></tr><tr><th id=\"L63\"><a href=\"#L63\">63</a></th><td><span class=\"cm\">\u00a0*\u00a0 Lesser General Public License for more details.</span></td></tr><tr><th id=\"L64\"><a href=\"#L64\">64</a></th><td><span class=\"cm\">\u00a0*</span></td></tr><tr><th id=\"L65\"><a href=\"#L65\">65</a></th><td><span class=\"cm\">\u00a0*\u00a0 You should have received a copy of the GNU Lesser General Public</span></td></tr><tr><th id=\"L66\"><a href=\"#L66\">66</a></th><td><span class=\"cm\">\u00a0*\u00a0 License along with this library; if not, write to the Free Software</span></td></tr><tr><th id=\"L67\"><a href=\"#L67\">67</a></th><td><span class=\"cm\">\u00a0*\u00a0 Foundation Inc. 59 Temple Place, Suite 330, Boston MA 02111-1307 USA</span></td></tr><tr><th id=\"L68\"><a href=\"#L68\">68</a></th><td><span class=\"cm\">\u00a0*/</span></td></tr><tr><th id=\"L69\"><a href=\"#L69\">69</a></th><td></td></tr><tr><th id=\"L70\"><a href=\"#L70\">70</a></th><td><span class=\"c1\">// This license applies to the portions created by Cristian Klein.</span></td></tr><tr><th id=\"L71\"><a href=\"#L71\">71</a></th><td><span class=\"c1\"></span><span class=\"cm\">/* motion.c</span></td></tr><tr><th id=\"L72\"><a href=\"#L72\">72</a></th><td><span class=\"cm\">\u00a0*</span></td></tr><tr><th id=\"L73\"><a href=\"#L73\">73</a></th><td><span class=\"cm\">\u00a0* a little program to display the coords returned by</span></td></tr><tr><th id=\"L74\"><a href=\"#L74\">74</a></th><td><span class=\"cm\">\u00a0* the powerbook motion sensor</span></td></tr><tr><th id=\"L75\"><a href=\"#L75\">75</a></th><td><span class=\"cm\">\u00a0*</span></td></tr><tr><th id=\"L76\"><a href=\"#L76\">76</a></th><td><span class=\"cm\">\u00a0* A fine piece of c0de, brought to you by</span></td></tr><tr><th id=\"L77\"><a href=\"#L77\">77</a></th><td><span class=\"cm\">\u00a0*</span></td></tr><tr><th id=\"L78\"><a href=\"#L78\">78</a></th><td><span class=\"cm\">\u00a0*\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0---===---</span></td></tr><tr><th id=\"L79\"><a href=\"#L79\">79</a></th><td><span class=\"cm\">\u00a0* *** teenage mutant ninja hero coders ***</span></td></tr><tr><th id=\"L80\"><a href=\"#L80\">80</a></th><td><span class=\"cm\">\u00a0*\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0---===---</span></td></tr><tr><th id=\"L81\"><a href=\"#L81\">81</a></th><td><span class=\"cm\">\u00a0*</span></td></tr><tr><th id=\"L82\"><a href=\"#L82\">82</a></th><td><span class=\"cm\">\u00a0* All of the software included is copyrighted by Christian Klein &lt;chris@5711.org&gt;.</span></td></tr><tr><th id=\"L83\"><a href=\"#L83\">83</a></th><td><span class=\"cm\">\u00a0*</span></td></tr><tr><th id=\"L84\"><a href=\"#L84\">84</a></th><td><span class=\"cm\">\u00a0* Copyright 2005 Christian Klein. All rights reserved.</span></td></tr><tr><th id=\"L85\"><a href=\"#L85\">85</a></th><td><span class=\"cm\">\u00a0*</span></td></tr><tr><th id=\"L86\"><a href=\"#L86\">86</a></th><td><span class=\"cm\">\u00a0* Redistribution and use in source and binary forms, with or without</span></td></tr><tr><th id=\"L87\"><a href=\"#L87\">87</a></th><td><span class=\"cm\">\u00a0* modification, are permitted provided that the following conditions</span></td></tr><tr><th id=\"L88\"><a href=\"#L88\">88</a></th><td><span class=\"cm\">\u00a0* are met:</span></td></tr><tr><th id=\"L89\"><a href=\"#L89\">89</a></th><td><span class=\"cm\">\u00a0* 1. Redistributions of source code must retain the above copyright</span></td></tr><tr><th id=\"L90\"><a href=\"#L90\">90</a></th><td><span class=\"cm\">\u00a0*\u00a0 \u00a0 notice, this list of conditions and the following disclaimer.</span></td></tr><tr><th id=\"L91\"><a href=\"#L91\">91</a></th><td><span class=\"cm\">\u00a0* 2. Redistributions in binary form must reproduce the above copyright</span></td></tr><tr><th id=\"L92\"><a href=\"#L92\">92</a></th><td><span class=\"cm\">\u00a0*\u00a0 \u00a0 notice, this list of conditions and the following disclaimer in the</span></td></tr><tr><th id=\"L93\"><a href=\"#L93\">93</a></th><td><span class=\"cm\">\u00a0*\u00a0 \u00a0 documentation and/or other materials provided with the distribution.</span></td></tr><tr><th id=\"L94\"><a href=\"#L94\">94</a></th><td><span class=\"cm\">\u00a0* 3. The name of the author must not be used to endorse or promote</span></td></tr><tr><th id=\"L95\"><a href=\"#L95\">95</a></th><td><span class=\"cm\">\u00a0*\u00a0 \u00a0 products derived from this software</span></td></tr><tr><th id=\"L96\"><a href=\"#L96\">96</a></th><td><span class=\"cm\">\u00a0*\u00a0 \u00a0 without specific prior written permission.</span></td></tr><tr><th id=\"L97\"><a href=\"#L97\">97</a></th><td><span class=\"cm\">\u00a0*</span></td></tr><tr><th id=\"L98\"><a href=\"#L98\">98</a></th><td><span class=\"cm\">\u00a0* THIS SOFTWARE IS PROVIDED BY THE REGENTS AND CONTRIBUTORS ``AS IS'' AND</span></td></tr><tr><th id=\"L99\"><a href=\"#L99\">99</a></th><td><span class=\"cm\">\u00a0* ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE</span></td></tr><tr><th id=\"L100\"><a href=\"#L100\">100</a></th><td><span class=\"cm\">\u00a0* IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE</span></td></tr><tr><th id=\"L101\"><a href=\"#L101\">101</a></th><td><span class=\"cm\">\u00a0* ARE DISCLAIMED.\u00a0 IN NO EVENT SHALL THE REGENTS OR CONTRIBUTORS BE LIABLE</span></td></tr><tr><th id=\"L102\"><a href=\"#L102\">102</a></th><td><span class=\"cm\">\u00a0* FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL</span></td></tr><tr><th id=\"L103\"><a href=\"#L103\">103</a></th><td><span class=\"cm\">\u00a0* DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS</span></td></tr><tr><th id=\"L104\"><a href=\"#L104\">104</a></th><td><span class=\"cm\">\u00a0* OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)</span></td></tr><tr><th id=\"L105\"><a href=\"#L105\">105</a></th><td><span class=\"cm\">\u00a0* HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT</span></td></tr><tr><th id=\"L106\"><a href=\"#L106\">106</a></th><td><span class=\"cm\">\u00a0* LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY</span></td></tr><tr><th id=\"L107\"><a href=\"#L107\">107</a></th><td><span class=\"cm\">\u00a0* OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF</span></td></tr><tr><th id=\"L108\"><a href=\"#L108\">108</a></th><td><span class=\"cm\">\u00a0* SUCH DAMAGE.</span></td></tr><tr><th id=\"L109\"><a href=\"#L109\">109</a></th><td><span class=\"cm\">\u00a0*</span></td></tr><tr><th id=\"L110\"><a href=\"#L110\">110</a></th><td><span class=\"cm\">\u00a0*/</span></td></tr><tr><th id=\"L111\"><a href=\"#L111\">111</a></th><td>\u00a0</td></tr><tr><th id=\"L112\"><a href=\"#L112\">112</a></th><td><span class=\"cp\">#include \"jni.h\"</span></td></tr><tr><th id=\"L113\"><a href=\"#L113\">113</a></th><td><span class=\"cp\"></span></td></tr><tr><th id=\"L114\"><a href=\"#L114\">114</a></th><td><span class=\"cp\">#include &lt;IOKit/IOKitLib.h&gt;</span></td></tr><tr><th id=\"L115\"><a href=\"#L115\">115</a></th><td><span class=\"cp\">#include &lt;CoreFoundation/CoreFoundation.h&gt;</span></td></tr><tr><th id=\"L116\"><a href=\"#L116\">116</a></th><td><span class=\"cp\">#include &lt;string.h&gt;</span></td></tr><tr><th id=\"L117\"><a href=\"#L117\">117</a></th><td><span class=\"cp\">#include &lt;stdint.h&gt;</span></td></tr><tr><th id=\"L118\"><a href=\"#L118\">118</a></th><td><span class=\"cp\"></span></td></tr><tr><th id=\"L119\"><a href=\"#L119\">119</a></th><td><span class=\"c1\">// The various SMS hardware that unimotion supports</span></td></tr><tr><th id=\"L120\"><a href=\"#L120\">120</a></th><td><span class=\"c1\"></span><span class=\"k\">enum</span>\u00a0sms_hardware <span class=\"p\">{</span></td></tr><tr><th id=\"L121\"><a href=\"#L121\">121</a></th><td>\u00a0 \u00a0 unknown <span class=\"o\">=</span>\u00a0<span class=\"mi\">0</span><span class=\"p\">,</span></td></tr><tr><th id=\"L122\"><a href=\"#L122\">122</a></th><td>\u00a0 \u00a0 powerbook <span class=\"o\">=</span>\u00a0<span class=\"mi\">1</span><span class=\"p\">,</span></td></tr><tr><th id=\"L123\"><a href=\"#L123\">123</a></th><td>\u00a0 \u00a0 ibook <span class=\"o\">=</span>\u00a0<span class=\"mi\">2</span><span class=\"p\">,</span></td></tr><tr><th id=\"L124\"><a href=\"#L124\">124</a></th><td>\u00a0 \u00a0 highrespb <span class=\"o\">=</span>\u00a0<span class=\"mi\">3</span><span class=\"p\">,</span></td></tr><tr><th id=\"L125\"><a href=\"#L125\">125</a></th><td>\u00a0 \u00a0 macbookpro <span class=\"o\">=</span>\u00a0<span class=\"mi\">4</span></td></tr><tr><th id=\"L126\"><a href=\"#L126\">126</a></th><td><span class=\"p\">};</span></td></tr><tr><th id=\"L127\"><a href=\"#L127\">127</a></th><td></td></tr><tr><th id=\"L128\"><a href=\"#L128\">128</a></th><td><span class=\"k\">enum</span>\u00a0data_type <span class=\"p\">{</span></td></tr><tr><th id=\"L129\"><a href=\"#L129\">129</a></th><td>\u00a0 \u00a0 PB_IB<span class=\"p\">,</span></td></tr><tr><th id=\"L130\"><a href=\"#L130\">130</a></th><td>\u00a0 \u00a0 MBP</td></tr><tr><th id=\"L131\"><a href=\"#L131\">131</a></th><td><span class=\"p\">};</span></td></tr><tr><th id=\"L132\"><a href=\"#L132\">132</a></th><td></td></tr><tr><th id=\"L133\"><a href=\"#L133\">133</a></th><td><span class=\"k\">struct</span>\u00a0pb_ib_data <span class=\"p\">{</span></td></tr><tr><th id=\"L134\"><a href=\"#L134\">134</a></th><td>\u00a0 \u00a0 <span class=\"kt\">int8_t</span>\u00a0x<span class=\"p\">;</span></td></tr><tr><th id=\"L135\"><a href=\"#L135\">135</a></th><td>\u00a0 \u00a0 <span class=\"kt\">int8_t</span>\u00a0y<span class=\"p\">;</span></td></tr><tr><th id=\"L136\"><a href=\"#L136\">136</a></th><td>\u00a0 \u00a0 <span class=\"kt\">int8_t</span>\u00a0z<span class=\"p\">;</span></td></tr><tr><th id=\"L137\"><a href=\"#L137\">137</a></th><td>\u00a0 \u00a0 <span class=\"kt\">int8_t</span>\u00a0pad<span class=\"p\">[</span><span class=\"mi\">57</span><span class=\"p\">];</span></td></tr><tr><th id=\"L138\"><a href=\"#L138\">138</a></th><td><span class=\"p\">};</span></td></tr><tr><th id=\"L139\"><a href=\"#L139\">139</a></th><td></td></tr><tr><th id=\"L140\"><a href=\"#L140\">140</a></th><td><span class=\"k\">struct</span>\u00a0mbp_data <span class=\"p\">{</span></td></tr><tr><th id=\"L141\"><a href=\"#L141\">141</a></th><td>\u00a0 \u00a0 <span class=\"kt\">int16_t</span>\u00a0x<span class=\"p\">;</span></td></tr><tr><th id=\"L142\"><a href=\"#L142\">142</a></th><td>\u00a0 \u00a0 <span class=\"kt\">int16_t</span>\u00a0y<span class=\"p\">;</span></td></tr><tr><th id=\"L143\"><a href=\"#L143\">143</a></th><td>\u00a0 \u00a0 <span class=\"kt\">int16_t</span>\u00a0z<span class=\"p\">;</span></td></tr><tr><th id=\"L144\"><a href=\"#L144\">144</a></th><td>\u00a0 \u00a0 <span class=\"kt\">int8_t</span>\u00a0pad<span class=\"p\">[</span><span class=\"mi\">34</span><span class=\"p\">];</span></td></tr><tr><th id=\"L145\"><a href=\"#L145\">145</a></th><td><span class=\"p\">};</span></td></tr><tr><th id=\"L146\"><a href=\"#L146\">146</a></th><td></td></tr><tr><th id=\"L147\"><a href=\"#L147\">147</a></th><td><span class=\"k\">union</span>\u00a0motion_data <span class=\"p\">{</span></td></tr><tr><th id=\"L148\"><a href=\"#L148\">148</a></th><td>\u00a0 \u00a0 <span class=\"k\">struct</span>\u00a0pb_ib_data pb_ib<span class=\"p\">;</span></td></tr><tr><th id=\"L149\"><a href=\"#L149\">149</a></th><td>\u00a0 \u00a0 <span class=\"k\">struct</span>\u00a0mbp_data mbp<span class=\"p\">;</span></td></tr><tr><th id=\"L150\"><a href=\"#L150\">150</a></th><td><span class=\"p\">};</span></td></tr><tr><th id=\"L151\"><a href=\"#L151\">151</a></th><td></td></tr><tr><th id=\"L152\"><a href=\"#L152\">152</a></th><td><span class=\"kt\">bool</span>\u00a0first <span class=\"o\">=</span>\u00a0<span class=\"nb\">true</span><span class=\"p\">;</span></td></tr><tr><th id=\"L153\"><a href=\"#L153\">153</a></th><td><span class=\"kt\">int</span>\u00a0type<span class=\"p\">;</span></td></tr><tr><th id=\"L154\"><a href=\"#L154\">154</a></th><td></td></tr><tr><th id=\"L155\"><a href=\"#L155\">155</a></th><td><span class=\"k\">static</span>\u00a0<span class=\"kt\">int</span>\u00a0<span class=\"nf\">set_values</span><span class=\"p\">(</span><span class=\"kt\">int</span>\u00a0type<span class=\"p\">,</span>\u00a0<span class=\"kt\">int</span>\u00a0<span class=\"o\">*</span>kernFunc<span class=\"p\">,</span>\u00a0<span class=\"kt\">char</span>\u00a0<span class=\"o\">**</span>servMatch<span class=\"p\">,</span>\u00a0<span class=\"kt\">int</span>\u00a0<span class=\"o\">*</span>dataType<span class=\"p\">)</span></td></tr><tr><th id=\"L156\"><a href=\"#L156\">156</a></th><td><span class=\"p\">{</span></td></tr><tr><th id=\"L157\"><a href=\"#L157\">157</a></th><td>\u00a0 \u00a0 <span class=\"k\">switch</span>\u00a0<span class=\"p\">(</span>\u00a0type <span class=\"p\">)</span>\u00a0<span class=\"p\">{</span></td></tr><tr><th id=\"L158\"><a href=\"#L158\">158</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">case</span>\u00a0powerbook:</td></tr><tr><th id=\"L159\"><a href=\"#L159\">159</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"o\">*</span>kernFunc <span class=\"o\">=</span>\u00a0<span class=\"mi\">21</span><span class=\"p\">;</span></td></tr><tr><th id=\"L160\"><a href=\"#L160\">160</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"o\">*</span>servMatch <span class=\"o\">=</span>\u00a0<span class=\"s\">\"IOI2CMotionSensor\"</span><span class=\"p\">;</span></td></tr><tr><th id=\"L161\"><a href=\"#L161\">161</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"o\">*</span>dataType <span class=\"o\">=</span>\u00a0PB_IB<span class=\"p\">;</span></td></tr><tr><th id=\"L162\"><a href=\"#L162\">162</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">break</span><span class=\"p\">;</span></td></tr><tr><th id=\"L163\"><a href=\"#L163\">163</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">case</span>\u00a0ibook:</td></tr><tr><th id=\"L164\"><a href=\"#L164\">164</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"o\">*</span>kernFunc <span class=\"o\">=</span>\u00a0<span class=\"mi\">21</span><span class=\"p\">;</span></td></tr><tr><th id=\"L165\"><a href=\"#L165\">165</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"o\">*</span>servMatch <span class=\"o\">=</span>\u00a0<span class=\"s\">\"IOI2CMotionSensor\"</span><span class=\"p\">;</span></td></tr><tr><th id=\"L166\"><a href=\"#L166\">166</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"o\">*</span>dataType <span class=\"o\">=</span>\u00a0PB_IB<span class=\"p\">;</span></td></tr><tr><th id=\"L167\"><a href=\"#L167\">167</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">break</span><span class=\"p\">;</span></td></tr><tr><th id=\"L168\"><a href=\"#L168\">168</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">case</span>\u00a0highrespb:</td></tr><tr><th id=\"L169\"><a href=\"#L169\">169</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"o\">*</span>kernFunc <span class=\"o\">=</span>\u00a0<span class=\"mi\">21</span><span class=\"p\">;</span></td></tr><tr><th id=\"L170\"><a href=\"#L170\">170</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"o\">*</span>servMatch <span class=\"o\">=</span>\u00a0<span class=\"s\">\"PMUMotionSensor\"</span><span class=\"p\">;</span></td></tr><tr><th id=\"L171\"><a href=\"#L171\">171</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"o\">*</span>dataType <span class=\"o\">=</span>\u00a0PB_IB<span class=\"p\">;</span></td></tr><tr><th id=\"L172\"><a href=\"#L172\">172</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">break</span><span class=\"p\">;</span></td></tr><tr><th id=\"L173\"><a href=\"#L173\">173</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">case</span>\u00a0macbookpro:</td></tr><tr><th id=\"L174\"><a href=\"#L174\">174</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"o\">*</span>kernFunc <span class=\"o\">=</span>\u00a0<span class=\"mi\">5</span><span class=\"p\">;</span></td></tr><tr><th id=\"L175\"><a href=\"#L175\">175</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"o\">*</span>servMatch <span class=\"o\">=</span>\u00a0<span class=\"s\">\"SMCMotionSensor\"</span><span class=\"p\">;</span></td></tr><tr><th id=\"L176\"><a href=\"#L176\">176</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"o\">*</span>dataType <span class=\"o\">=</span>\u00a0MBP<span class=\"p\">;</span></td></tr><tr><th id=\"L177\"><a href=\"#L177\">177</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">break</span><span class=\"p\">;</span></td></tr><tr><th id=\"L178\"><a href=\"#L178\">178</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"nl\">default:</span></td></tr><tr><th id=\"L179\"><a href=\"#L179\">179</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">return</span>\u00a0<span class=\"mi\">0</span><span class=\"p\">;</span></td></tr><tr><th id=\"L180\"><a href=\"#L180\">180</a></th><td>\u00a0 \u00a0 <span class=\"p\">}</span></td></tr><tr><th id=\"L181\"><a href=\"#L181\">181</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 </td></tr><tr><th id=\"L182\"><a href=\"#L182\">182</a></th><td>\u00a0 \u00a0 <span class=\"k\">return</span>\u00a0<span class=\"mi\">1</span><span class=\"p\">;</span></td></tr><tr><th id=\"L183\"><a href=\"#L183\">183</a></th><td><span class=\"p\">}</span></td></tr><tr><th id=\"L184\"><a href=\"#L184\">184</a></th><td></td></tr><tr><th id=\"L185\"><a href=\"#L185\">185</a></th><td><span class=\"k\">static</span>\u00a0<span class=\"kt\">int</span>\u00a0<span class=\"nf\">probe_sms</span><span class=\"p\">(</span><span class=\"kt\">int</span>\u00a0kernFunc<span class=\"p\">,</span>\u00a0<span class=\"kt\">char</span>\u00a0<span class=\"o\">*</span>servMatch<span class=\"p\">,</span>\u00a0<span class=\"kt\">int</span>\u00a0dataType<span class=\"p\">,</span>\u00a0<span class=\"kt\">void</span>\u00a0<span class=\"o\">*</span>data<span class=\"p\">)</span></td></tr><tr><th id=\"L186\"><a href=\"#L186\">186</a></th><td><span class=\"p\">{</span></td></tr><tr><th id=\"L187\"><a href=\"#L187\">187</a></th><td>\u00a0 \u00a0 <span class=\"kt\">kern_return_t</span>\u00a0result<span class=\"p\">;</span></td></tr><tr><th id=\"L188\"><a href=\"#L188\">188</a></th><td>\u00a0 \u00a0 <span class=\"kt\">mach_port_t</span>\u00a0masterPort<span class=\"p\">;</span></td></tr><tr><th id=\"L189\"><a href=\"#L189\">189</a></th><td>\u00a0 \u00a0 <span class=\"kt\">io_iterator_t</span>\u00a0iterator<span class=\"p\">;</span></td></tr><tr><th id=\"L190\"><a href=\"#L190\">190</a></th><td>\u00a0 \u00a0 <span class=\"kt\">io_object_t</span>\u00a0aDevice<span class=\"p\">;</span></td></tr><tr><th id=\"L191\"><a href=\"#L191\">191</a></th><td>\u00a0 \u00a0 <span class=\"kt\">io_connect_t</span>\u00a0 dataPort<span class=\"p\">;</span></td></tr><tr><th id=\"L192\"><a href=\"#L192\">192</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 </td></tr><tr><th id=\"L193\"><a href=\"#L193\">193</a></th><td>\u00a0 \u00a0 IOItemCount structureInputSize<span class=\"p\">;</span></td></tr><tr><th id=\"L194\"><a href=\"#L194\">194</a></th><td>\u00a0 \u00a0 IOByteCount structureOutputSize<span class=\"p\">;</span></td></tr><tr><th id=\"L195\"><a href=\"#L195\">195</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 </td></tr><tr><th id=\"L196\"><a href=\"#L196\">196</a></th><td>\u00a0 \u00a0 <span class=\"k\">union</span>\u00a0motion_data inputStructure<span class=\"p\">;</span></td></tr><tr><th id=\"L197\"><a href=\"#L197\">197</a></th><td>\u00a0 \u00a0 <span class=\"k\">union</span>\u00a0motion_data <span class=\"o\">*</span>outputStructure<span class=\"p\">;</span></td></tr><tr><th id=\"L198\"><a href=\"#L198\">198</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 </td></tr><tr><th id=\"L199\"><a href=\"#L199\">199</a></th><td>\u00a0 \u00a0 outputStructure <span class=\"o\">=</span>\u00a0<span class=\"p\">(</span><span class=\"k\">union</span>\u00a0motion_data <span class=\"o\">*</span><span class=\"p\">)</span>data<span class=\"p\">;</span></td></tr><tr><th id=\"L200\"><a href=\"#L200\">200</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 </td></tr><tr><th id=\"L201\"><a href=\"#L201\">201</a></th><td>\u00a0 \u00a0 result <span class=\"o\">=</span>\u00a0IOMasterPort<span class=\"p\">(</span>MACH_PORT_NULL<span class=\"p\">,</span>\u00a0<span class=\"o\">&amp;</span>masterPort<span class=\"p\">);</span></td></tr><tr><th id=\"L202\"><a href=\"#L202\">202</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 </td></tr><tr><th id=\"L203\"><a href=\"#L203\">203</a></th><td>\u00a0 \u00a0 CFMutableDictionaryRef matchingDictionary <span class=\"o\">=</span>\u00a0IOServiceMatching<span class=\"p\">(</span>servMatch<span class=\"p\">);</span></td></tr><tr><th id=\"L204\"><a href=\"#L204\">204</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 </td></tr><tr><th id=\"L205\"><a href=\"#L205\">205</a></th><td>\u00a0 \u00a0 result <span class=\"o\">=</span>\u00a0IOServiceGetMatchingServices<span class=\"p\">(</span>masterPort<span class=\"p\">,</span>\u00a0matchingDictionary<span class=\"p\">,</span>\u00a0<span class=\"o\">&amp;</span>iterator<span class=\"p\">);</span></td></tr><tr><th id=\"L206\"><a href=\"#L206\">206</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 </td></tr><tr><th id=\"L207\"><a href=\"#L207\">207</a></th><td>\u00a0 \u00a0 <span class=\"k\">if</span>\u00a0<span class=\"p\">(</span>result <span class=\"o\">!=</span>\u00a0KERN_SUCCESS<span class=\"p\">)</span>\u00a0<span class=\"p\">{</span></td></tr><tr><th id=\"L208\"><a href=\"#L208\">208</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"c1\">//fputs(\"IOServiceGetMatchingServices returned error.\\n\", stderr);</span></td></tr><tr><th id=\"L209\"><a href=\"#L209\">209</a></th><td><span class=\"c1\"></span>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">return</span>\u00a0<span class=\"mi\">0</span><span class=\"p\">;</span></td></tr><tr><th id=\"L210\"><a href=\"#L210\">210</a></th><td>\u00a0 \u00a0 <span class=\"p\">}</span></td></tr><tr><th id=\"L211\"><a href=\"#L211\">211</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 </td></tr><tr><th id=\"L212\"><a href=\"#L212\">212</a></th><td>\u00a0 \u00a0 aDevice <span class=\"o\">=</span>\u00a0IOIteratorNext<span class=\"p\">(</span>iterator<span class=\"p\">);</span></td></tr><tr><th id=\"L213\"><a href=\"#L213\">213</a></th><td>\u00a0 \u00a0 IOObjectRelease<span class=\"p\">(</span>iterator<span class=\"p\">);</span></td></tr><tr><th id=\"L214\"><a href=\"#L214\">214</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 </td></tr><tr><th id=\"L215\"><a href=\"#L215\">215</a></th><td>\u00a0 \u00a0 <span class=\"k\">if</span>\u00a0<span class=\"p\">(</span>aDevice <span class=\"o\">==</span>\u00a0<span class=\"mi\">0</span><span class=\"p\">)</span>\u00a0<span class=\"p\">{</span></td></tr><tr><th id=\"L216\"><a href=\"#L216\">216</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"c1\">//fputs(\"No motion sensor available\\n\", stderr);</span></td></tr><tr><th id=\"L217\"><a href=\"#L217\">217</a></th><td><span class=\"c1\"></span>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">return</span>\u00a0<span class=\"mi\">0</span><span class=\"p\">;</span></td></tr><tr><th id=\"L218\"><a href=\"#L218\">218</a></th><td>\u00a0 \u00a0 <span class=\"p\">}</span></td></tr><tr><th id=\"L219\"><a href=\"#L219\">219</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 </td></tr><tr><th id=\"L220\"><a href=\"#L220\">220</a></th><td>\u00a0 \u00a0 result <span class=\"o\">=</span>\u00a0IOServiceOpen<span class=\"p\">(</span>aDevice<span class=\"p\">,</span>\u00a0mach_task_self<span class=\"p\">(),</span>\u00a0<span class=\"mi\">0</span><span class=\"p\">,</span>\u00a0<span class=\"o\">&amp;</span>dataPort<span class=\"p\">);</span></td></tr><tr><th id=\"L221\"><a href=\"#L221\">221</a></th><td>\u00a0 \u00a0 IOObjectRelease<span class=\"p\">(</span>aDevice<span class=\"p\">);</span></td></tr><tr><th id=\"L222\"><a href=\"#L222\">222</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 </td></tr><tr><th id=\"L223\"><a href=\"#L223\">223</a></th><td>\u00a0 \u00a0 <span class=\"k\">if</span>\u00a0<span class=\"p\">(</span>result <span class=\"o\">!=</span>\u00a0KERN_SUCCESS<span class=\"p\">)</span>\u00a0<span class=\"p\">{</span></td></tr><tr><th id=\"L224\"><a href=\"#L224\">224</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"c1\">//fputs(\"Could not open motion sensor device\\n\", stderr);</span></td></tr><tr><th id=\"L225\"><a href=\"#L225\">225</a></th><td><span class=\"c1\"></span>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">return</span>\u00a0<span class=\"mi\">0</span><span class=\"p\">;</span></td></tr><tr><th id=\"L226\"><a href=\"#L226\">226</a></th><td>\u00a0 \u00a0 <span class=\"p\">}</span></td></tr><tr><th id=\"L227\"><a href=\"#L227\">227</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 </td></tr><tr><th id=\"L228\"><a href=\"#L228\">228</a></th><td>\u00a0 \u00a0 <span class=\"k\">switch</span>\u00a0<span class=\"p\">(</span>\u00a0dataType <span class=\"p\">)</span>\u00a0<span class=\"p\">{</span></td></tr><tr><th id=\"L229\"><a href=\"#L229\">229</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">case</span>\u00a0PB_IB:</td></tr><tr><th id=\"L230\"><a href=\"#L230\">230</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 structureInputSize <span class=\"o\">=</span>\u00a0<span class=\"k\">sizeof</span><span class=\"p\">(</span><span class=\"k\">struct</span>\u00a0pb_ib_data<span class=\"p\">);</span></td></tr><tr><th id=\"L231\"><a href=\"#L231\">231</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 structureOutputSize <span class=\"o\">=</span>\u00a0<span class=\"k\">sizeof</span><span class=\"p\">(</span><span class=\"k\">struct</span>\u00a0pb_ib_data<span class=\"p\">);</span></td></tr><tr><th id=\"L232\"><a href=\"#L232\">232</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">break</span><span class=\"p\">;</span></td></tr><tr><th id=\"L233\"><a href=\"#L233\">233</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">case</span>\u00a0MBP:</td></tr><tr><th id=\"L234\"><a href=\"#L234\">234</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 structureInputSize <span class=\"o\">=</span>\u00a0<span class=\"k\">sizeof</span><span class=\"p\">(</span><span class=\"k\">struct</span>\u00a0mbp_data<span class=\"p\">);</span></td></tr><tr><th id=\"L235\"><a href=\"#L235\">235</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 structureOutputSize <span class=\"o\">=</span>\u00a0<span class=\"k\">sizeof</span><span class=\"p\">(</span><span class=\"k\">struct</span>\u00a0mbp_data<span class=\"p\">);</span></td></tr><tr><th id=\"L236\"><a href=\"#L236\">236</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">break</span><span class=\"p\">;</span></td></tr><tr><th id=\"L237\"><a href=\"#L237\">237</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"nl\">default:</span></td></tr><tr><th id=\"L238\"><a href=\"#L238\">238</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">return</span>\u00a0<span class=\"mi\">0</span><span class=\"p\">;</span></td></tr><tr><th id=\"L239\"><a href=\"#L239\">239</a></th><td>\u00a0 \u00a0 <span class=\"p\">}</span></td></tr><tr><th id=\"L240\"><a href=\"#L240\">240</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 </td></tr><tr><th id=\"L241\"><a href=\"#L241\">241</a></th><td>\u00a0 \u00a0 memset<span class=\"p\">(</span><span class=\"o\">&amp;</span>inputStructure<span class=\"p\">,</span>\u00a0<span class=\"mi\">0</span><span class=\"p\">,</span>\u00a0<span class=\"k\">sizeof</span><span class=\"p\">(</span><span class=\"k\">union</span>\u00a0motion_data<span class=\"p\">));</span></td></tr><tr><th id=\"L242\"><a href=\"#L242\">242</a></th><td>\u00a0 \u00a0 memset<span class=\"p\">(</span>outputStructure<span class=\"p\">,</span>\u00a0<span class=\"mi\">0</span><span class=\"p\">,</span>\u00a0<span class=\"k\">sizeof</span><span class=\"p\">(</span><span class=\"k\">union</span>\u00a0motion_data<span class=\"p\">));</span></td></tr><tr><th id=\"L243\"><a href=\"#L243\">243</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 </td></tr><tr><th id=\"L244\"><a href=\"#L244\">244</a></th><td>\u00a0 \u00a0 result <span class=\"o\">=</span>\u00a0IOConnectMethodStructureIStructureO<span class=\"p\">(</span>dataPort<span class=\"p\">,</span>\u00a0kernFunc<span class=\"p\">,</span>\u00a0structureInputSize<span class=\"p\">,</span></td></tr><tr><th id=\"L245\"><a href=\"#L245\">245</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0<span class=\"o\">&amp;</span>structureOutputSize<span class=\"p\">,</span>\u00a0<span class=\"o\">&amp;</span>inputStructure<span class=\"p\">,</span>\u00a0outputStructure<span class=\"p\">);</span></td></tr><tr><th id=\"L246\"><a href=\"#L246\">246</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 </td></tr><tr><th id=\"L247\"><a href=\"#L247\">247</a></th><td>\u00a0 \u00a0 IOServiceClose<span class=\"p\">(</span>dataPort<span class=\"p\">);</span></td></tr><tr><th id=\"L248\"><a href=\"#L248\">248</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 </td></tr><tr><th id=\"L249\"><a href=\"#L249\">249</a></th><td>\u00a0 \u00a0 <span class=\"k\">if</span>\u00a0<span class=\"p\">(</span>result <span class=\"o\">!=</span>\u00a0KERN_SUCCESS<span class=\"p\">)</span>\u00a0<span class=\"p\">{</span></td></tr><tr><th id=\"L250\"><a href=\"#L250\">250</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"c1\">//puts(\"no coords\");</span></td></tr><tr><th id=\"L251\"><a href=\"#L251\">251</a></th><td><span class=\"c1\"></span>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">return</span>\u00a0<span class=\"mi\">0</span><span class=\"p\">;</span></td></tr><tr><th id=\"L252\"><a href=\"#L252\">252</a></th><td>\u00a0 \u00a0 <span class=\"p\">}</span></td></tr><tr><th id=\"L253\"><a href=\"#L253\">253</a></th><td>\u00a0 \u00a0 <span class=\"k\">return</span>\u00a0<span class=\"mi\">1</span><span class=\"p\">;</span></td></tr><tr><th id=\"L254\"><a href=\"#L254\">254</a></th><td><span class=\"p\">}</span></td></tr><tr><th id=\"L255\"><a href=\"#L255\">255</a></th><td></td></tr><tr><th id=\"L256\"><a href=\"#L256\">256</a></th><td><span class=\"kt\">int</span>\u00a0<span class=\"nf\">detect_sms</span><span class=\"p\">()</span></td></tr><tr><th id=\"L257\"><a href=\"#L257\">257</a></th><td><span class=\"p\">{</span></td></tr><tr><th id=\"L258\"><a href=\"#L258\">258</a></th><td>\u00a0 \u00a0 <span class=\"kt\">int</span>\u00a0kernFunc<span class=\"p\">;</span></td></tr><tr><th id=\"L259\"><a href=\"#L259\">259</a></th><td>\u00a0 \u00a0 <span class=\"kt\">char</span>\u00a0<span class=\"o\">*</span>servMatch<span class=\"p\">;</span></td></tr><tr><th id=\"L260\"><a href=\"#L260\">260</a></th><td>\u00a0 \u00a0 <span class=\"kt\">int</span>\u00a0dataType<span class=\"p\">;</span></td></tr><tr><th id=\"L261\"><a href=\"#L261\">261</a></th><td>\u00a0 \u00a0 <span class=\"k\">union</span>\u00a0motion_data data<span class=\"p\">;</span></td></tr><tr><th id=\"L262\"><a href=\"#L262\">262</a></th><td>\u00a0 \u00a0 <span class=\"kt\">int</span>\u00a0i<span class=\"p\">;</span></td></tr><tr><th id=\"L263\"><a href=\"#L263\">263</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 </td></tr><tr><th id=\"L264\"><a href=\"#L264\">264</a></th><td>\u00a0 \u00a0 <span class=\"k\">for</span>\u00a0<span class=\"p\">(</span>\u00a0i <span class=\"o\">=</span>\u00a0<span class=\"mi\">1</span><span class=\"p\">;</span>\u00a0<span class=\"p\">;</span>\u00a0i<span class=\"o\">++</span>\u00a0<span class=\"p\">)</span>\u00a0<span class=\"p\">{</span></td></tr><tr><th id=\"L265\"><a href=\"#L265\">265</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">if</span>\u00a0<span class=\"p\">(</span>\u00a0<span class=\"o\">!</span>set_values<span class=\"p\">(</span>i<span class=\"p\">,</span>\u00a0<span class=\"o\">&amp;</span>kernFunc<span class=\"p\">,</span>\u00a0<span class=\"o\">&amp;</span>servMatch<span class=\"p\">,</span>\u00a0<span class=\"o\">&amp;</span>dataType<span class=\"p\">)</span>\u00a0<span class=\"p\">)</span></td></tr><tr><th id=\"L266\"><a href=\"#L266\">266</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">break</span><span class=\"p\">;</span></td></tr><tr><th id=\"L267\"><a href=\"#L267\">267</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">if</span>\u00a0<span class=\"p\">(</span>\u00a0probe_sms<span class=\"p\">(</span>kernFunc<span class=\"p\">,</span>\u00a0servMatch<span class=\"p\">,</span>\u00a0dataType<span class=\"p\">,</span>\u00a0<span class=\"o\">&amp;</span>data<span class=\"p\">)</span>\u00a0<span class=\"p\">)</span></td></tr><tr><th id=\"L268\"><a href=\"#L268\">268</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">return</span>\u00a0i<span class=\"p\">;</span></td></tr><tr><th id=\"L269\"><a href=\"#L269\">269</a></th><td>\u00a0 \u00a0 <span class=\"p\">}</span></td></tr><tr><th id=\"L270\"><a href=\"#L270\">270</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 </td></tr><tr><th id=\"L271\"><a href=\"#L271\">271</a></th><td>\u00a0 \u00a0 <span class=\"k\">return</span>\u00a0unknown<span class=\"p\">;</span></td></tr><tr><th id=\"L272\"><a href=\"#L272\">272</a></th><td><span class=\"p\">}</span></td></tr><tr><th id=\"L273\"><a href=\"#L273\">273</a></th><td></td></tr><tr><th id=\"L274\"><a href=\"#L274\">274</a></th><td><span class=\"kt\">int</span>\u00a0<span class=\"nf\">read_sms_raw</span><span class=\"p\">(</span><span class=\"kt\">int</span>\u00a0type<span class=\"p\">,</span>\u00a0<span class=\"kt\">int</span>\u00a0<span class=\"o\">*</span>x<span class=\"p\">,</span>\u00a0<span class=\"kt\">int</span>\u00a0<span class=\"o\">*</span>y<span class=\"p\">,</span>\u00a0<span class=\"kt\">int</span>\u00a0<span class=\"o\">*</span>z<span class=\"p\">)</span></td></tr><tr><th id=\"L275\"><a href=\"#L275\">275</a></th><td><span class=\"p\">{</span></td></tr><tr><th id=\"L276\"><a href=\"#L276\">276</a></th><td>\u00a0 \u00a0 <span class=\"kt\">int</span>\u00a0kernFunc<span class=\"p\">;</span></td></tr><tr><th id=\"L277\"><a href=\"#L277\">277</a></th><td>\u00a0 \u00a0 <span class=\"kt\">char</span>\u00a0<span class=\"o\">*</span>servMatch<span class=\"p\">;</span></td></tr><tr><th id=\"L278\"><a href=\"#L278\">278</a></th><td>\u00a0 \u00a0 <span class=\"kt\">int</span>\u00a0dataType<span class=\"p\">;</span></td></tr><tr><th id=\"L279\"><a href=\"#L279\">279</a></th><td>\u00a0 \u00a0 <span class=\"k\">union</span>\u00a0motion_data data<span class=\"p\">;</span></td></tr><tr><th id=\"L280\"><a href=\"#L280\">280</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 </td></tr><tr><th id=\"L281\"><a href=\"#L281\">281</a></th><td>\u00a0 \u00a0 <span class=\"k\">if</span>\u00a0<span class=\"p\">(</span>\u00a0<span class=\"o\">!</span>set_values<span class=\"p\">(</span>type<span class=\"p\">,</span>\u00a0<span class=\"o\">&amp;</span>kernFunc<span class=\"p\">,</span>\u00a0<span class=\"o\">&amp;</span>servMatch<span class=\"p\">,</span>\u00a0<span class=\"o\">&amp;</span>dataType<span class=\"p\">)</span>\u00a0<span class=\"p\">)</span></td></tr><tr><th id=\"L282\"><a href=\"#L282\">282</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">return</span>\u00a0<span class=\"mi\">0</span><span class=\"p\">;</span></td></tr><tr><th id=\"L283\"><a href=\"#L283\">283</a></th><td>\u00a0 \u00a0 <span class=\"k\">if</span>\u00a0<span class=\"p\">(</span>\u00a0probe_sms<span class=\"p\">(</span>kernFunc<span class=\"p\">,</span>\u00a0servMatch<span class=\"p\">,</span>\u00a0dataType<span class=\"p\">,</span>\u00a0<span class=\"o\">&amp;</span>data<span class=\"p\">)</span>\u00a0<span class=\"p\">)</span>\u00a0<span class=\"p\">{</span></td></tr><tr><th id=\"L284\"><a href=\"#L284\">284</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">switch</span>\u00a0<span class=\"p\">(</span>\u00a0dataType <span class=\"p\">)</span>\u00a0<span class=\"p\">{</span></td></tr><tr><th id=\"L285\"><a href=\"#L285\">285</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">case</span>\u00a0PB_IB:</td></tr><tr><th id=\"L286\"><a href=\"#L286\">286</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">if</span>\u00a0<span class=\"p\">(</span>\u00a0x <span class=\"p\">)</span>\u00a0<span class=\"o\">*</span>x <span class=\"o\">=</span>\u00a0data<span class=\"p\">.</span>pb_ib<span class=\"p\">.</span>x<span class=\"p\">;</span></td></tr><tr><th id=\"L287\"><a href=\"#L287\">287</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">if</span>\u00a0<span class=\"p\">(</span>\u00a0y <span class=\"p\">)</span>\u00a0<span class=\"o\">*</span>y <span class=\"o\">=</span>\u00a0data<span class=\"p\">.</span>pb_ib<span class=\"p\">.</span>y<span class=\"p\">;</span></td></tr><tr><th id=\"L288\"><a href=\"#L288\">288</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">if</span>\u00a0<span class=\"p\">(</span>\u00a0z <span class=\"p\">)</span>\u00a0<span class=\"o\">*</span>z <span class=\"o\">=</span>\u00a0data<span class=\"p\">.</span>pb_ib<span class=\"p\">.</span>z<span class=\"p\">;</span></td></tr><tr><th id=\"L289\"><a href=\"#L289\">289</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">break</span><span class=\"p\">;</span></td></tr><tr><th id=\"L290\"><a href=\"#L290\">290</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">case</span>\u00a0MBP:</td></tr><tr><th id=\"L291\"><a href=\"#L291\">291</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">if</span>\u00a0<span class=\"p\">(</span>\u00a0x <span class=\"p\">)</span>\u00a0<span class=\"o\">*</span>x <span class=\"o\">=</span>\u00a0data<span class=\"p\">.</span>mbp<span class=\"p\">.</span>x<span class=\"p\">;</span></td></tr><tr><th id=\"L292\"><a href=\"#L292\">292</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">if</span>\u00a0<span class=\"p\">(</span>\u00a0y <span class=\"p\">)</span>\u00a0<span class=\"o\">*</span>y <span class=\"o\">=</span>\u00a0data<span class=\"p\">.</span>mbp<span class=\"p\">.</span>y<span class=\"p\">;</span></td></tr><tr><th id=\"L293\"><a href=\"#L293\">293</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">if</span>\u00a0<span class=\"p\">(</span>\u00a0z <span class=\"p\">)</span>\u00a0<span class=\"o\">*</span>z <span class=\"o\">=</span>\u00a0data<span class=\"p\">.</span>mbp<span class=\"p\">.</span>z<span class=\"p\">;</span></td></tr><tr><th id=\"L294\"><a href=\"#L294\">294</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">break</span><span class=\"p\">;</span></td></tr><tr><th id=\"L295\"><a href=\"#L295\">295</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"nl\">default:</span></td></tr><tr><th id=\"L296\"><a href=\"#L296\">296</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">return</span>\u00a0<span class=\"mi\">0</span><span class=\"p\">;</span></td></tr><tr><th id=\"L297\"><a href=\"#L297\">297</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"p\">}</span></td></tr><tr><th id=\"L298\"><a href=\"#L298\">298</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">return</span>\u00a0<span class=\"mi\">1</span><span class=\"p\">;</span></td></tr><tr><th id=\"L299\"><a href=\"#L299\">299</a></th><td>\u00a0 \u00a0 <span class=\"p\">}</span></td></tr><tr><th id=\"L300\"><a href=\"#L300\">300</a></th><td>\u00a0 \u00a0 <span class=\"k\">return</span>\u00a0<span class=\"mi\">0</span><span class=\"p\">;</span></td></tr><tr><th id=\"L301\"><a href=\"#L301\">301</a></th><td><span class=\"p\">}</span></td></tr><tr><th id=\"L302\"><a href=\"#L302\">302</a></th><td></td></tr><tr><th id=\"L303\"><a href=\"#L303\">303</a></th><td><span class=\"kt\">int</span>\u00a0<span class=\"nf\">read_sms</span><span class=\"p\">(</span><span class=\"kt\">int</span>\u00a0type<span class=\"p\">,</span>\u00a0<span class=\"kt\">int</span>\u00a0<span class=\"o\">*</span>x<span class=\"p\">,</span>\u00a0<span class=\"kt\">int</span>\u00a0<span class=\"o\">*</span>y<span class=\"p\">,</span>\u00a0<span class=\"kt\">int</span>\u00a0<span class=\"o\">*</span>z<span class=\"p\">)</span></td></tr><tr><th id=\"L304\"><a href=\"#L304\">304</a></th><td><span class=\"p\">{</span></td></tr><tr><th id=\"L305\"><a href=\"#L305\">305</a></th><td>\u00a0 \u00a0 <span class=\"kt\">int</span>\u00a0_x<span class=\"p\">,</span>\u00a0_y<span class=\"p\">,</span>\u00a0_z<span class=\"p\">;</span></td></tr><tr><th id=\"L306\"><a href=\"#L306\">306</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"kt\">int</span>\u00a0xoff<span class=\"p\">,</span>\u00a0yoff<span class=\"p\">,</span>\u00a0zoff<span class=\"p\">;</span></td></tr><tr><th id=\"L307\"><a href=\"#L307\">307</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 Boolean ok<span class=\"p\">;</span></td></tr><tr><th id=\"L308\"><a href=\"#L308\">308</a></th><td>\u00a0 \u00a0 <span class=\"kt\">int</span>\u00a0ret<span class=\"p\">;</span></td></tr><tr><th id=\"L309\"><a href=\"#L309\">309</a></th><td>\u00a0 \u00a0 </td></tr><tr><th id=\"L310\"><a href=\"#L310\">310</a></th><td>\u00a0 \u00a0 ret <span class=\"o\">=</span>\u00a0read_sms_raw<span class=\"p\">(</span>type<span class=\"p\">,</span>\u00a0<span class=\"o\">&amp;</span>_x<span class=\"p\">,</span>\u00a0<span class=\"o\">&amp;</span>_y<span class=\"p\">,</span>\u00a0<span class=\"o\">&amp;</span>_z<span class=\"p\">);</span></td></tr><tr><th id=\"L311\"><a href=\"#L311\">311</a></th><td>\u00a0 \u00a0 <span class=\"k\">if</span>\u00a0<span class=\"p\">(</span>\u00a0<span class=\"o\">!</span>ret <span class=\"p\">)</span></td></tr><tr><th id=\"L312\"><a href=\"#L312\">312</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">return</span>\u00a0<span class=\"mi\">0</span><span class=\"p\">;</span></td></tr><tr><th id=\"L313\"><a href=\"#L313\">313</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 </td></tr><tr><th id=\"L314\"><a href=\"#L314\">314</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"cm\">/*</span></td></tr><tr><th id=\"L315\"><a href=\"#L315\">315</a></th><td><span class=\"cm\">\u00a0 \u00a0 \u00a0 \u00a0 static CFStringRef app = CFSTR(\"com.ramsayl.UniMotion\");</span></td></tr><tr><th id=\"L316\"><a href=\"#L316\">316</a></th><td><span class=\"cm\">\u00a0 \u00a0 \u00a0 \u00a0 static CFStringRef xoffstr = CFSTR(\"x_offset\");</span></td></tr><tr><th id=\"L317\"><a href=\"#L317\">317</a></th><td><span class=\"cm\">\u00a0 \u00a0 \u00a0 \u00a0 static CFStringRef yoffstr = CFSTR(\"y_offset\");</span></td></tr><tr><th id=\"L318\"><a href=\"#L318\">318</a></th><td><span class=\"cm\">\u00a0 \u00a0 \u00a0 \u00a0 static CFStringRef zoffstr = CFSTR(\"z_offset\");</span></td></tr><tr><th id=\"L319\"><a href=\"#L319\">319</a></th><td><span class=\"cm\">\u00a0 \u00a0 \u00a0 \u00a0 */</span></td></tr><tr><th id=\"L320\"><a href=\"#L320\">320</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 CFStringRef app <span class=\"o\">=</span>\u00a0CFSTR<span class=\"p\">(</span><span class=\"s\">\"com.ramsayl.UniMotion\"</span><span class=\"p\">);</span></td></tr><tr><th id=\"L321\"><a href=\"#L321\">321</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 CFStringRef xoffstr <span class=\"o\">=</span>\u00a0CFSTR<span class=\"p\">(</span><span class=\"s\">\"x_offset\"</span><span class=\"p\">);</span></td></tr><tr><th id=\"L322\"><a href=\"#L322\">322</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 CFStringRef yoffstr <span class=\"o\">=</span>\u00a0CFSTR<span class=\"p\">(</span><span class=\"s\">\"y_offset\"</span><span class=\"p\">);</span></td></tr><tr><th id=\"L323\"><a href=\"#L323\">323</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 CFStringRef zoffstr <span class=\"o\">=</span>\u00a0CFSTR<span class=\"p\">(</span><span class=\"s\">\"z_offset\"</span><span class=\"p\">);</span></td></tr><tr><th id=\"L324\"><a href=\"#L324\">324</a></th><td></td></tr><tr><th id=\"L325\"><a href=\"#L325\">325</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 xoff <span class=\"o\">=</span>\u00a0CFPreferencesGetAppIntegerValue<span class=\"p\">(</span>xoffstr<span class=\"p\">,</span>\u00a0app<span class=\"p\">,</span>\u00a0<span class=\"o\">&amp;</span>ok<span class=\"p\">);</span></td></tr><tr><th id=\"L326\"><a href=\"#L326\">326</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">if</span>\u00a0<span class=\"p\">(</span>\u00a0ok <span class=\"p\">)</span>\u00a0_x <span class=\"o\">+=</span>\u00a0xoff<span class=\"p\">;</span></td></tr><tr><th id=\"L327\"><a href=\"#L327\">327</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 yoff <span class=\"o\">=</span>\u00a0CFPreferencesGetAppIntegerValue<span class=\"p\">(</span>yoffstr<span class=\"p\">,</span>\u00a0app<span class=\"p\">,</span>\u00a0<span class=\"o\">&amp;</span>ok<span class=\"p\">);</span></td></tr><tr><th id=\"L328\"><a href=\"#L328\">328</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">if</span>\u00a0<span class=\"p\">(</span>\u00a0ok <span class=\"p\">)</span>\u00a0_y <span class=\"o\">+=</span>\u00a0yoff<span class=\"p\">;</span></td></tr><tr><th id=\"L329\"><a href=\"#L329\">329</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 zoff <span class=\"o\">=</span>\u00a0CFPreferencesGetAppIntegerValue<span class=\"p\">(</span>zoffstr<span class=\"p\">,</span>\u00a0app<span class=\"p\">,</span>\u00a0<span class=\"o\">&amp;</span>ok<span class=\"p\">);</span></td></tr><tr><th id=\"L330\"><a href=\"#L330\">330</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">if</span>\u00a0<span class=\"p\">(</span>\u00a0ok <span class=\"p\">)</span>\u00a0_z <span class=\"o\">+=</span>\u00a0zoff<span class=\"p\">;</span></td></tr><tr><th id=\"L331\"><a href=\"#L331\">331</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 </td></tr><tr><th id=\"L332\"><a href=\"#L332\">332</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"o\">*</span>x <span class=\"o\">=</span>\u00a0_x<span class=\"p\">;</span></td></tr><tr><th id=\"L333\"><a href=\"#L333\">333</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"o\">*</span>y <span class=\"o\">=</span>\u00a0_y<span class=\"p\">;</span></td></tr><tr><th id=\"L334\"><a href=\"#L334\">334</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"o\">*</span>z <span class=\"o\">=</span>\u00a0_z<span class=\"p\">;</span></td></tr><tr><th id=\"L335\"><a href=\"#L335\">335</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 </td></tr><tr><th id=\"L336\"><a href=\"#L336\">336</a></th><td>\u00a0 \u00a0 <span class=\"k\">return</span>\u00a0ret<span class=\"p\">;</span></td></tr><tr><th id=\"L337\"><a href=\"#L337\">337</a></th><td><span class=\"p\">}</span></td></tr><tr><th id=\"L338\"><a href=\"#L338\">338</a></th><td></td></tr><tr><th id=\"L339\"><a href=\"#L339\">339</a></th><td><span class=\"kt\">int</span>\u00a0<span class=\"nf\">read_sms_real</span><span class=\"p\">(</span><span class=\"kt\">int</span>\u00a0type<span class=\"p\">,</span>\u00a0<span class=\"kt\">double</span>\u00a0<span class=\"o\">*</span>x<span class=\"p\">,</span>\u00a0<span class=\"kt\">double</span>\u00a0<span class=\"o\">*</span>y<span class=\"p\">,</span>\u00a0<span class=\"kt\">double</span>\u00a0<span class=\"o\">*</span>z<span class=\"p\">)</span></td></tr><tr><th id=\"L340\"><a href=\"#L340\">340</a></th><td><span class=\"p\">{</span></td></tr><tr><th id=\"L341\"><a href=\"#L341\">341</a></th><td>\u00a0 \u00a0 <span class=\"kt\">int</span>\u00a0_x<span class=\"p\">,</span>\u00a0_y<span class=\"p\">,</span>\u00a0_z<span class=\"p\">;</span></td></tr><tr><th id=\"L342\"><a href=\"#L342\">342</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"kt\">int</span>\u00a0xscale<span class=\"p\">,</span>\u00a0yscale<span class=\"p\">,</span>\u00a0zscale<span class=\"p\">;</span></td></tr><tr><th id=\"L343\"><a href=\"#L343\">343</a></th><td>\u00a0 \u00a0 <span class=\"kt\">int</span>\u00a0ret<span class=\"p\">;</span></td></tr><tr><th id=\"L344\"><a href=\"#L344\">344</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 Boolean ok<span class=\"p\">;</span></td></tr><tr><th id=\"L345\"><a href=\"#L345\">345</a></th><td>\u00a0 \u00a0 </td></tr><tr><th id=\"L346\"><a href=\"#L346\">346</a></th><td>\u00a0 \u00a0 ret <span class=\"o\">=</span>\u00a0read_sms_raw<span class=\"p\">(</span>type<span class=\"p\">,</span>\u00a0<span class=\"o\">&amp;</span>_x<span class=\"p\">,</span>\u00a0<span class=\"o\">&amp;</span>_y<span class=\"p\">,</span>\u00a0<span class=\"o\">&amp;</span>_z<span class=\"p\">);</span></td></tr><tr><th id=\"L347\"><a href=\"#L347\">347</a></th><td>\u00a0 \u00a0 <span class=\"k\">if</span>\u00a0<span class=\"p\">(</span>\u00a0<span class=\"o\">!</span>ret <span class=\"p\">)</span></td></tr><tr><th id=\"L348\"><a href=\"#L348\">348</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">return</span>\u00a0<span class=\"mi\">0</span><span class=\"p\">;</span></td></tr><tr><th id=\"L349\"><a href=\"#L349\">349</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 </td></tr><tr><th id=\"L350\"><a href=\"#L350\">350</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"cm\">/*</span></td></tr><tr><th id=\"L351\"><a href=\"#L351\">351</a></th><td><span class=\"cm\">\u00a0 \u00a0 \u00a0 \u00a0 static CFStringRef app = CFSTR(\"com.ramsayl.UniMotion\");</span></td></tr><tr><th id=\"L352\"><a href=\"#L352\">352</a></th><td><span class=\"cm\">\u00a0 \u00a0 \u00a0 \u00a0 static CFStringRef xscalestr = CFSTR(\"x_scale\");</span></td></tr><tr><th id=\"L353\"><a href=\"#L353\">353</a></th><td><span class=\"cm\">\u00a0 \u00a0 \u00a0 \u00a0 static CFStringRef yscalestr = CFSTR(\"y_scale\");</span></td></tr><tr><th id=\"L354\"><a href=\"#L354\">354</a></th><td><span class=\"cm\">\u00a0 \u00a0 \u00a0 \u00a0 static CFStringRef zscalestr = CFSTR(\"z_scale\");</span></td></tr><tr><th id=\"L355\"><a href=\"#L355\">355</a></th><td><span class=\"cm\">\u00a0 \u00a0 \u00a0 \u00a0 */</span></td></tr><tr><th id=\"L356\"><a href=\"#L356\">356</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 CFStringRef app <span class=\"o\">=</span>\u00a0CFSTR<span class=\"p\">(</span><span class=\"s\">\"com.ramsayl.UniMotion\"</span><span class=\"p\">);</span></td></tr><tr><th id=\"L357\"><a href=\"#L357\">357</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 CFStringRef xscalestr <span class=\"o\">=</span>\u00a0CFSTR<span class=\"p\">(</span><span class=\"s\">\"x_scale\"</span><span class=\"p\">);</span></td></tr><tr><th id=\"L358\"><a href=\"#L358\">358</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 CFStringRef yscalestr <span class=\"o\">=</span>\u00a0CFSTR<span class=\"p\">(</span><span class=\"s\">\"y_scale\"</span><span class=\"p\">);</span></td></tr><tr><th id=\"L359\"><a href=\"#L359\">359</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 CFStringRef zscalestr <span class=\"o\">=</span>\u00a0CFSTR<span class=\"p\">(</span><span class=\"s\">\"z_scale\"</span><span class=\"p\">);</span></td></tr><tr><th id=\"L360\"><a href=\"#L360\">360</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 xscale <span class=\"o\">=</span>\u00a0CFPreferencesGetAppIntegerValue<span class=\"p\">(</span>xscalestr<span class=\"p\">,</span>\u00a0app<span class=\"p\">,</span>\u00a0<span class=\"o\">&amp;</span>ok<span class=\"p\">);</span></td></tr><tr><th id=\"L361\"><a href=\"#L361\">361</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">if</span>\u00a0<span class=\"p\">(</span>\u00a0<span class=\"o\">!</span>ok <span class=\"p\">)</span>\u00a0<span class=\"k\">return</span>\u00a0<span class=\"mi\">0</span><span class=\"p\">;</span></td></tr><tr><th id=\"L362\"><a href=\"#L362\">362</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 yscale <span class=\"o\">=</span>\u00a0CFPreferencesGetAppIntegerValue<span class=\"p\">(</span>yscalestr<span class=\"p\">,</span>\u00a0app<span class=\"p\">,</span>\u00a0<span class=\"o\">&amp;</span>ok<span class=\"p\">);</span></td></tr><tr><th id=\"L363\"><a href=\"#L363\">363</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">if</span>\u00a0<span class=\"p\">(</span>\u00a0<span class=\"o\">!</span>ok <span class=\"p\">)</span>\u00a0<span class=\"k\">return</span>\u00a0<span class=\"mi\">0</span><span class=\"p\">;</span></td></tr><tr><th id=\"L364\"><a href=\"#L364\">364</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 zscale <span class=\"o\">=</span>\u00a0CFPreferencesGetAppIntegerValue<span class=\"p\">(</span>zscalestr<span class=\"p\">,</span>\u00a0app<span class=\"p\">,</span>\u00a0<span class=\"o\">&amp;</span>ok<span class=\"p\">);</span></td></tr><tr><th id=\"L365\"><a href=\"#L365\">365</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">if</span>\u00a0<span class=\"p\">(</span>\u00a0<span class=\"o\">!</span>ok <span class=\"p\">)</span>\u00a0<span class=\"k\">return</span>\u00a0<span class=\"mi\">0</span><span class=\"p\">;</span></td></tr><tr><th id=\"L366\"><a href=\"#L366\">366</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 </td></tr><tr><th id=\"L367\"><a href=\"#L367\">367</a></th><td>\u00a0 \u00a0 <span class=\"o\">*</span>x <span class=\"o\">=</span>\u00a0_x <span class=\"o\">/</span>\u00a0<span class=\"p\">(</span><span class=\"kt\">double</span><span class=\"p\">)</span>xscale<span class=\"p\">;</span></td></tr><tr><th id=\"L368\"><a href=\"#L368\">368</a></th><td>\u00a0 \u00a0 <span class=\"o\">*</span>y <span class=\"o\">=</span>\u00a0_y <span class=\"o\">/</span>\u00a0<span class=\"p\">(</span><span class=\"kt\">double</span><span class=\"p\">)</span>yscale<span class=\"p\">;</span></td></tr><tr><th id=\"L369\"><a href=\"#L369\">369</a></th><td>\u00a0 \u00a0 <span class=\"o\">*</span>z <span class=\"o\">=</span>\u00a0_z <span class=\"o\">/</span>\u00a0<span class=\"p\">(</span><span class=\"kt\">double</span><span class=\"p\">)</span>zscale<span class=\"p\">;</span></td></tr><tr><th id=\"L370\"><a href=\"#L370\">370</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 </td></tr><tr><th id=\"L371\"><a href=\"#L371\">371</a></th><td>\u00a0 \u00a0 <span class=\"k\">return</span>\u00a0<span class=\"mi\">1</span><span class=\"p\">;</span></td></tr><tr><th id=\"L372\"><a href=\"#L372\">372</a></th><td><span class=\"p\">}</span></td></tr><tr><th id=\"L373\"><a href=\"#L373\">373</a></th><td></td></tr><tr><th id=\"L374\"><a href=\"#L374\">374</a></th><td></td></tr><tr><th id=\"L375\"><a href=\"#L375\">375</a></th><td><span class=\"c1\">// JNI Function to return an array of ints w/ sensor values</span></td></tr><tr><th id=\"L376\"><a href=\"#L376\">376</a></th><td><span class=\"c1\"></span>JNIEXPORT jintArray JNICALL <span class=\"nf\">Java_edu_uci_ics_luci_nomatic_service_sensors_MacAccSensor_readSMS</span><span class=\"p\">(</span>JNIEnv <span class=\"o\">*</span>env<span class=\"p\">,</span>\u00a0jobject this<span class=\"p\">)</span>\u00a0<span class=\"p\">{</span></td></tr><tr><th id=\"L377\"><a href=\"#L377\">377</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"kt\">char</span>\u00a0<span class=\"o\">*</span>name<span class=\"p\">;</span></td></tr><tr><th id=\"L378\"><a href=\"#L378\">378</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"kt\">int</span>\u00a0x<span class=\"p\">,</span>y<span class=\"p\">,</span>z<span class=\"p\">;</span></td></tr><tr><th id=\"L379\"><a href=\"#L379\">379</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 x <span class=\"o\">=</span>\u00a0y <span class=\"o\">=</span>\u00a0z <span class=\"o\">=</span>\u00a0<span class=\"mi\">0</span><span class=\"p\">;</span></td></tr><tr><th id=\"L380\"><a href=\"#L380\">380</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 </td></tr><tr><th id=\"L381\"><a href=\"#L381\">381</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">if</span>\u00a0<span class=\"p\">(</span>first<span class=\"p\">)</span>\u00a0<span class=\"p\">{</span></td></tr><tr><th id=\"L382\"><a href=\"#L382\">382</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"c1\">//fprintf(stderr, \"Detecting SMS\\n\");</span></td></tr><tr><th id=\"L383\"><a href=\"#L383\">383</a></th><td><span class=\"c1\"></span>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 type <span class=\"o\">=</span>\u00a0detect_sms<span class=\"p\">();</span></td></tr><tr><th id=\"L384\"><a href=\"#L384\">384</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">if</span>\u00a0<span class=\"p\">(</span>\u00a0type <span class=\"o\">==</span>\u00a0unknown <span class=\"p\">)</span>\u00a0<span class=\"p\">{</span></td></tr><tr><th id=\"L385\"><a href=\"#L385\">385</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 fprintf<span class=\"p\">(</span>stderr<span class=\"p\">,</span>\u00a0<span class=\"s\">\"Nomatic*IM: Could not detect an SMS.</span><span class=\"se\">\\n</span><span class=\"s\">\"</span><span class=\"p\">);</span></td></tr><tr><th id=\"L386\"><a href=\"#L386\">386</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"c1\">//return 1;</span></td></tr><tr><th id=\"L387\"><a href=\"#L387\">387</a></th><td><span class=\"c1\"></span>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"p\">}</span></td></tr><tr><th id=\"L388\"><a href=\"#L388\">388</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">switch</span>\u00a0<span class=\"p\">(</span>\u00a0type <span class=\"p\">)</span>\u00a0<span class=\"p\">{</span></td></tr><tr><th id=\"L389\"><a href=\"#L389\">389</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">case</span>\u00a0powerbook:</td></tr><tr><th id=\"L390\"><a href=\"#L390\">390</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 name <span class=\"o\">=</span>\u00a0<span class=\"s\">\"powerbook\"</span><span class=\"p\">;</span></td></tr><tr><th id=\"L391\"><a href=\"#L391\">391</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">break</span><span class=\"p\">;</span></td></tr><tr><th id=\"L392\"><a href=\"#L392\">392</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">case</span>\u00a0ibook:</td></tr><tr><th id=\"L393\"><a href=\"#L393\">393</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 name <span class=\"o\">=</span>\u00a0<span class=\"s\">\"ibook\"</span><span class=\"p\">;</span></td></tr><tr><th id=\"L394\"><a href=\"#L394\">394</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">break</span><span class=\"p\">;</span></td></tr><tr><th id=\"L395\"><a href=\"#L395\">395</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">case</span>\u00a0highrespb:</td></tr><tr><th id=\"L396\"><a href=\"#L396\">396</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 name <span class=\"o\">=</span>\u00a0<span class=\"s\">\"highrespb\"</span><span class=\"p\">;</span></td></tr><tr><th id=\"L397\"><a href=\"#L397\">397</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">break</span><span class=\"p\">;</span></td></tr><tr><th id=\"L398\"><a href=\"#L398\">398</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">case</span>\u00a0macbookpro:</td></tr><tr><th id=\"L399\"><a href=\"#L399\">399</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 name <span class=\"o\">=</span>\u00a0<span class=\"s\">\"macbookpro\"</span><span class=\"p\">;</span></td></tr><tr><th id=\"L400\"><a href=\"#L400\">400</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">break</span><span class=\"p\">;</span></td></tr><tr><th id=\"L401\"><a href=\"#L401\">401</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"nl\">default:</span></td></tr><tr><th id=\"L402\"><a href=\"#L402\">402</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 name <span class=\"o\">=</span>\u00a0<span class=\"s\">\"???\"</span><span class=\"p\">;</span></td></tr><tr><th id=\"L403\"><a href=\"#L403\">403</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">break</span><span class=\"p\">;</span></td></tr><tr><th id=\"L404\"><a href=\"#L404\">404</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"p\">}</span>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0</td></tr><tr><th id=\"L405\"><a href=\"#L405\">405</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 fprintf<span class=\"p\">(</span>stderr<span class=\"p\">,</span>\u00a0<span class=\"s\">\"Nomatic*IM: Detected SMS type %d (%s)</span><span class=\"se\">\\n</span><span class=\"s\">\"</span><span class=\"p\">,</span>\u00a0type<span class=\"p\">,</span>\u00a0name<span class=\"p\">);</span>\u00a0</td></tr><tr><th id=\"L406\"><a href=\"#L406\">406</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 first <span class=\"o\">=</span>\u00a0<span class=\"nb\">false</span><span class=\"p\">;</span></td></tr><tr><th id=\"L407\"><a href=\"#L407\">407</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"p\">}</span></td></tr><tr><th id=\"L408\"><a href=\"#L408\">408</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 </td></tr><tr><th id=\"L409\"><a href=\"#L409\">409</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"kt\">int</span>\u00a0ok <span class=\"o\">=</span>\u00a0<span class=\"mi\">0</span><span class=\"p\">;</span></td></tr><tr><th id=\"L410\"><a href=\"#L410\">410</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 ok <span class=\"o\">=</span>\u00a0read_sms_raw<span class=\"p\">(</span>type<span class=\"p\">,</span>\u00a0<span class=\"o\">&amp;</span>x<span class=\"p\">,</span><span class=\"o\">&amp;</span>y<span class=\"p\">,</span><span class=\"o\">&amp;</span>z<span class=\"p\">);</span></td></tr><tr><th id=\"L411\"><a href=\"#L411\">411</a></th><td>\u00a0 \u00a0 <span class=\"k\">if</span>\u00a0<span class=\"p\">(</span>\u00a0ok <span class=\"p\">)</span>\u00a0<span class=\"p\">{</span></td></tr><tr><th id=\"L412\"><a href=\"#L412\">412</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <span class=\"c1\">//printf(\"%d %d %d\\n\",x,y,z);</span></td></tr><tr><th id=\"L413\"><a href=\"#L413\">413</a></th><td><span class=\"c1\"></span>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"p\">}</span></td></tr><tr><th id=\"L414\"><a href=\"#L414\">414</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 jintArray jr<span class=\"p\">;</span></td></tr><tr><th id=\"L415\"><a href=\"#L415\">415</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 jsize rlen <span class=\"o\">=</span>\u00a0<span class=\"mi\">3</span><span class=\"p\">;</span><span class=\"c1\">//(*jenv)-&gt;GetArrayLength(jenv, 3);</span></td></tr><tr><th id=\"L416\"><a href=\"#L416\">416</a></th><td><span class=\"c1\"></span>\u00a0 \u00a0 \u00a0 \u00a0 jr <span class=\"o\">=</span>\u00a0<span class=\"p\">(</span><span class=\"o\">*</span>env<span class=\"p\">)</span><span class=\"o\">-&gt;</span>NewIntArray<span class=\"p\">(</span>env<span class=\"p\">,</span>\u00a0rlen<span class=\"p\">);</span></td></tr><tr><th id=\"L417\"><a href=\"#L417\">417</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"kt\">int</span>\u00a0size <span class=\"o\">=</span>\u00a0<span class=\"mi\">3</span><span class=\"p\">;</span></td></tr><tr><th id=\"L418\"><a href=\"#L418\">418</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"kt\">long</span>\u00a0<span class=\"o\">*</span>data<span class=\"p\">;</span></td></tr><tr><th id=\"L419\"><a href=\"#L419\">419</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 data <span class=\"o\">=</span>\u00a0<span class=\"p\">(</span><span class=\"kt\">long</span>\u00a0<span class=\"o\">*</span><span class=\"p\">)</span>malloc<span class=\"p\">(</span><span class=\"k\">sizeof</span><span class=\"p\">(</span><span class=\"kt\">long</span><span class=\"p\">)</span><span class=\"o\">*</span>size<span class=\"p\">);</span></td></tr><tr><th id=\"L420\"><a href=\"#L420\">420</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 data<span class=\"p\">[</span><span class=\"mi\">0</span><span class=\"p\">]</span>\u00a0<span class=\"o\">=</span>\u00a0x<span class=\"p\">;</span>\u00a0data<span class=\"p\">[</span><span class=\"mi\">1</span><span class=\"p\">]</span>\u00a0<span class=\"o\">=</span>\u00a0y<span class=\"p\">;</span>\u00a0data<span class=\"p\">[</span><span class=\"mi\">2</span><span class=\"p\">]</span>\u00a0<span class=\"o\">=</span>\u00a0z<span class=\"p\">;</span></td></tr><tr><th id=\"L421\"><a href=\"#L421\">421</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"p\">(</span><span class=\"o\">*</span>env<span class=\"p\">)</span><span class=\"o\">-&gt;</span>SetIntArrayRegion<span class=\"p\">(</span>env<span class=\"p\">,</span>jr<span class=\"p\">,</span>\u00a0<span class=\"mi\">0</span><span class=\"p\">,</span>\u00a0size<span class=\"p\">,</span>data<span class=\"p\">);</span></td></tr><tr><th id=\"L422\"><a href=\"#L422\">422</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 free<span class=\"p\">(</span>data<span class=\"p\">);</span></td></tr><tr><th id=\"L423\"><a href=\"#L423\">423</a></th><td>\u00a0 \u00a0 \u00a0 \u00a0 <span class=\"k\">return</span>\u00a0jr<span class=\"p\">;</span></td></tr><tr><th id=\"L424\"><a href=\"#L424\">424</a></th><td><span class=\"p\">}</span></td></tr></tbody></table>\n\n      </div>\n      <div id=\"anydiff\">\n        <form action=\"/LUCICodeRepository/nomaticIM/diff\" method=\"get\">\n          <div class=\"buttons\">\n            <input type=\"hidden\" name=\"new_path\" value=\"/nomatic/tags/NomaticIM-0.0.5/service/native/accelerometer/mac/unimotion.c\" />\n            <input type=\"hidden\" name=\"old_path\" value=\"/nomatic/tags/NomaticIM-0.0.5/service/native/accelerometer/mac/unimotion.c\" />\n            <input type=\"hidden\" name=\"new_rev\" />\n            <input type=\"hidden\" name=\"old_rev\" />\n            <input type=\"submit\" value=\"View changes...\" title=\"Select paths and revs for Diff\" />\n          </div>\n        </form>\n      </div>\n      <div id=\"help\"><strong>Note:</strong> See <a href=\"/LUCICodeRepository/nomaticIM/wiki/TracBrowser\">TracBrowser</a>\n        for help on using the repository browser.</div>\n    </div>\n    <div id=\"altlinks\">\n      <h3>Download in other formats:</h3>\n      <ul>\n        <li class=\"first\">\n          <a rel=\"nofollow\" href=\"/LUCICodeRepository/nomaticIM/browser/nomatic/tags/NomaticIM-0.0.5/service/native/accelerometer/mac/unimotion.c?format=txt\">Plain Text</a>\n        </li><li class=\"last\">\n          <a rel=\"nofollow\" href=\"/LUCICodeRepository/nomaticIM/export/1312/nomatic/tags/NomaticIM-0.0.5/service/native/accelerometer/mac/unimotion.c\">Original Format</a>\n        </li>\n      </ul>\n    </div>\n    </div>\n    <div id=\"footer\" lang=\"en\" xml:lang=\"en\"><hr />\n      <a id=\"tracpowered\" href=\"http://trac.edgewall.org/\"><img src=\"/LUCICodeRepository/nomaticIM/chrome/common/trac_logo_mini.png\" height=\"30\" width=\"107\" alt=\"Trac Powered\" /></a>\n      <p class=\"left\">Powered by <a href=\"/LUCICodeRepository/nomaticIM/about\"><strong>Trac 1.0.1</strong></a><br />\n        By <a href=\"http://www.edgewall.org/\">Edgewall Software</a>.</p>\n      <p class=\"right\">All content copyright 2007-2008 by LUCI <br /><a href=\"http://luci.ics.uci.edu/\">http://luci.ics.uci.edu/</a></p>\n    </div>\n\t\t<div id=\"sitefooter\">\n\t\t\t<script src=\"http://www.google-analytics.com/urchin.js\" type=\"text/javascript\">\n\t\t\t</script>\n\t\t\t<script type=\"text/javascript\">\n\t\t\t\t_uacct = \"UA-338915-2\";\n\t\t\t\turchinTracker();\n\t\t\t</script>\n\t\t</div>\n\t</body>\n</html>", "id": 44281.0}